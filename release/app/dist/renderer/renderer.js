/*! For license information please see renderer.js.LICENSE.txt */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var i in n)("object"==typeof exports?exports:e)[i]=n[i]}}(self,(()=>(()=>{var e,t,n={725:(e,t,n)=>{"use strict";n.d(t,{pE:()=>Vo,vX:()=>ks,xf:()=>To,ln:()=>ms,uX:()=>Cs,VP:()=>Ps,um:()=>Is,ud:()=>Ns,UP:()=>ys,pk:()=>As,BK:()=>gs,LY:()=>Es,Pz:()=>Os,K6:()=>fo,gA:()=>po,Dl:()=>fs,GP:()=>co});var i={};n.r(i),n.d(i,{fixNegotiationNeeded:()=>Ne,shimAddTrackRemoveTrack:()=>Pe,shimAddTrackRemoveTrackWithNative:()=>Re,shimGetDisplayMedia:()=>Se,shimGetSendersWithDtmf:()=>ke,shimGetStats:()=>Ce,shimGetUserMedia:()=>we,shimMediaStream:()=>Te,shimOnTrack:()=>Ee,shimPeerConnection:()=>Ae,shimSenderReceiverGetStats:()=>Ie});var r={};n.r(r),n.d(r,{shimAddTransceiver:()=>Ve,shimCreateAnswer:()=>$e,shimCreateOffer:()=>ze,shimGetDisplayMedia:()=>De,shimGetParameters:()=>Be,shimGetUserMedia:()=>xe,shimOnTrack:()=>Oe,shimPeerConnection:()=>Le,shimRTCDataChannel:()=>Fe,shimReceiverGetStats:()=>je,shimRemoveStream:()=>Ue,shimSenderGetStats:()=>Me});var s={};n.r(s),n.d(s,{shimAudioContext:()=>Ze,shimCallbacksAPI:()=>We,shimConstraints:()=>Ke,shimCreateOfferLegacy:()=>Ye,shimGetUserMedia:()=>He,shimLocalStreamsAPI:()=>qe,shimRTCIceServerUrls:()=>Je,shimRemoteStreamsAPI:()=>Ge,shimTrackEventTransceiver:()=>Qe});var o={};function a(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];throw Error("[Immer] minified error nr: "+e+(n.length?" "+n.map((function(e){return"'"+e+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function l(e){return!!e&&!!e[J]}function c(e){var t;return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object||"function"==typeof n&&Function.toString.call(n)===Q}(e)||Array.isArray(e)||!!e[K]||!!(null===(t=e.constructor)||void 0===t?void 0:t[K])||g(e)||v(e))}function u(e,t,n){void 0===n&&(n=!1),0===d(e)?(n?Object.keys:Y)(e).forEach((function(i){n&&"symbol"==typeof i||t(i,e[i],e)})):e.forEach((function(n,i){return t(i,n,e)}))}function d(e){var t=e[J];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:g(e)?2:v(e)?3:0}function h(e,t){return 2===d(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function p(e,t){return 2===d(e)?e.get(t):e[t]}function f(e,t,n){var i=d(e);2===i?e.set(t,n):3===i?e.add(n):e[t]=n}function m(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function g(e){return q&&e instanceof Map}function v(e){return G&&e instanceof Set}function y(e){return e.o||e.t}function b(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=Z(e);delete t[J];for(var n=Y(t),i=0;i<n.length;i++){var r=n[i],s=t[r];!1===s.writable&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(t[r]={configurable:!0,writable:!0,enumerable:s.enumerable,value:e[r]})}return Object.create(Object.getPrototypeOf(e),t)}function _(e,t){return void 0===t&&(t=!1),S(e)||l(e)||!c(e)||(d(e)>1&&(e.set=e.add=e.clear=e.delete=w),Object.freeze(e),t&&u(e,(function(e,t){return _(t,!0)}),!0)),e}function w(){a(2)}function S(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function T(e){var t=X[e];return t||a(18,e),t}function E(){return z}function k(e,t){t&&(T("Patches"),e.u=[],e.s=[],e.v=t)}function C(e){I(e),e.p.forEach(P),e.p=null}function I(e){e===z&&(z=e.l)}function R(e){return z={p:[],l:z,h:e,m:!0,_:0}}function P(e){var t=e[J];0===t.i||1===t.i?t.j():t.g=!0}function A(e,t){t._=t.p.length;var n=t.p[0],i=void 0!==e&&e!==n;return t.h.O||T("ES5").S(t,e,i),i?(n[J].P&&(C(t),a(4)),c(e)&&(e=N(t,e),t.l||D(t,e)),t.u&&T("Patches").M(n[J].t,e,t.u,t.s)):e=N(t,n,[]),C(t),t.u&&t.v(t.u,t.s),e!==H?e:void 0}function N(e,t,n){if(S(t))return t;var i=t[J];if(!i)return u(t,(function(r,s){return x(e,i,t,r,s,n)}),!0),t;if(i.A!==e)return t;if(!i.P)return D(e,i.t,!0),i.t;if(!i.I){i.I=!0,i.A._--;var r=4===i.i||5===i.i?i.o=b(i.k):i.o,s=r,o=!1;3===i.i&&(s=new Set(r),r.clear(),o=!0),u(s,(function(t,s){return x(e,i,r,t,s,n,o)})),D(e,r,!1),n&&e.u&&T("Patches").N(i,n,e.u,e.s)}return i.o}function x(e,t,n,i,r,s,o){if(l(r)){var a=N(e,r,s&&t&&3!==t.i&&!h(t.R,i)?s.concat(i):void 0);if(f(n,i,a),!l(a))return;e.m=!1}else o&&n.add(r);if(c(r)&&!S(r)){if(!e.h.D&&e._<1)return;N(e,r),t&&t.A.l||D(e,r)}}function D(e,t,n){void 0===n&&(n=!1),!e.l&&e.h.D&&e.m&&_(t,n)}function O(e,t){var n=e[J];return(n?y(n):e)[t]}function L(e,t){if(t in e)for(var n=Object.getPrototypeOf(e);n;){var i=Object.getOwnPropertyDescriptor(n,t);if(i)return i;n=Object.getPrototypeOf(n)}}function M(e){e.P||(e.P=!0,e.l&&M(e.l))}function j(e){e.o||(e.o=b(e.t))}function U(e,t,n){var i=g(t)?T("MapSet").F(t,n):v(t)?T("MapSet").T(t,n):e.O?function(e,t){var n=Array.isArray(e),i={i:n?1:0,A:t?t.A:E(),P:!1,I:!1,R:{},l:t,t:e,k:null,o:null,j:null,C:!1},r=i,s=ee;n&&(r=[i],s=te);var o=Proxy.revocable(r,s),a=o.revoke,l=o.proxy;return i.k=l,i.j=a,l}(t,n):T("ES5").J(t,n);return(n?n.A:E()).p.push(i),i}function F(e){return l(e)||a(22,e),function e(t){if(!c(t))return t;var n,i=t[J],r=d(t);if(i){if(!i.P&&(i.i<4||!T("ES5").K(i)))return i.t;i.I=!0,n=V(t,r),i.I=!1}else n=V(t,r);return u(n,(function(t,r){i&&p(i.t,t)===r||f(n,t,e(r))})),3===r?new Set(n):n}(e)}function V(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return b(e)}n.r(o),n.d(o,{removeExtmapAllowMixed:()=>ot,shimAddIceCandidateNullOrEmpty:()=>at,shimConnectionState:()=>st,shimMaxMessageSize:()=>it,shimParameterlessSetLocalDescription:()=>lt,shimRTCIceCandidate:()=>tt,shimRTCIceCandidateRelayProtocol:()=>nt,shimSendThrowTypeError:()=>rt});var B,z,$="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),q="undefined"!=typeof Map,G="undefined"!=typeof Set,W="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,H=$?Symbol.for("immer-nothing"):((B={})["immer-nothing"]=!0,B),K=$?Symbol.for("immer-draftable"):"__$immer_draftable",J=$?Symbol.for("immer-state"):"__$immer_state",Q=("undefined"!=typeof Symbol&&Symbol.iterator,""+Object.prototype.constructor),Y="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,Z=Object.getOwnPropertyDescriptors||function(e){var t={};return Y(e).forEach((function(n){t[n]=Object.getOwnPropertyDescriptor(e,n)})),t},X={},ee={get:function(e,t){if(t===J)return e;var n=y(e);if(!h(n,t))return function(e,t,n){var i,r=L(t,n);return r?"value"in r?r.value:null===(i=r.get)||void 0===i?void 0:i.call(e.k):void 0}(e,n,t);var i=n[t];return e.I||!c(i)?i:i===O(e.t,t)?(j(e),e.o[t]=U(e.A.h,i,e)):i},has:function(e,t){return t in y(e)},ownKeys:function(e){return Reflect.ownKeys(y(e))},set:function(e,t,n){var i=L(y(e),t);if(null==i?void 0:i.set)return i.set.call(e.k,n),!0;if(!e.P){var r=O(y(e),t),s=null==r?void 0:r[J];if(s&&s.t===n)return e.o[t]=n,e.R[t]=!1,!0;if(m(n,r)&&(void 0!==n||h(e.t,t)))return!0;j(e),M(e)}return e.o[t]===n&&(void 0!==n||t in e.o)||Number.isNaN(n)&&Number.isNaN(e.o[t])||(e.o[t]=n,e.R[t]=!0),!0},deleteProperty:function(e,t){return void 0!==O(e.t,t)||t in e.t?(e.R[t]=!1,j(e),M(e)):delete e.R[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var n=y(e),i=Reflect.getOwnPropertyDescriptor(n,t);return i?{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:i.enumerable,value:n[t]}:i},defineProperty:function(){a(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){a(12)}},te={};u(ee,(function(e,t){te[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),te.deleteProperty=function(e,t){return te.set.call(this,e,t,void 0)},te.set=function(e,t,n){return ee.set.call(this,e[0],t,n,e[0])};var ne=function(){function e(e){var t=this;this.O=W,this.D=!0,this.produce=function(e,n,i){if("function"==typeof e&&"function"!=typeof n){var r=n;n=e;var s=t;return function(e){var t=this;void 0===e&&(e=r);for(var i=arguments.length,o=Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return s.produce(e,(function(e){var i;return(i=n).call.apply(i,[t,e].concat(o))}))}}var o;if("function"!=typeof n&&a(6),void 0!==i&&"function"!=typeof i&&a(7),c(e)){var l=R(t),u=U(t,e,void 0),d=!0;try{o=n(u),d=!1}finally{d?C(l):I(l)}return"undefined"!=typeof Promise&&o instanceof Promise?o.then((function(e){return k(l,i),A(e,l)}),(function(e){throw C(l),e})):(k(l,i),A(o,l))}if(!e||"object"!=typeof e){if(void 0===(o=n(e))&&(o=e),o===H&&(o=void 0),t.D&&_(o,!0),i){var h=[],p=[];T("Patches").M(e,o,h,p),i(h,p)}return o}a(21,e)},this.produceWithPatches=function(e,n){if("function"==typeof e)return function(n){for(var i=arguments.length,r=Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];return t.produceWithPatches(n,(function(t){return e.apply(void 0,[t].concat(r))}))};var i,r,s=t.produce(e,n,(function(e,t){i=e,r=t}));return"undefined"!=typeof Promise&&s instanceof Promise?s.then((function(e){return[e,i,r]})):[s,i,r]},"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze)}var t=e.prototype;return t.createDraft=function(e){c(e)||a(8),l(e)&&(e=F(e));var t=R(this),n=U(this,e,void 0);return n[J].C=!0,I(t),n},t.finishDraft=function(e,t){var n=(e&&e[J]).A;return k(n,t),A(void 0,n)},t.setAutoFreeze=function(e){this.D=e},t.setUseProxies=function(e){e&&!W&&a(20),this.O=e},t.applyPatches=function(e,t){var n;for(n=t.length-1;n>=0;n--){var i=t[n];if(0===i.path.length&&"replace"===i.op){e=i.value;break}}n>-1&&(t=t.slice(n+1));var r=T("Patches").$;return l(e)?r(e,t):this.produce(e,(function(e){return r(e,t)}))},e}(),ie=new ne,re=ie.produce;ie.produceWithPatches.bind(ie),ie.setAutoFreeze.bind(ie),ie.setUseProxies.bind(ie),ie.applyPatches.bind(ie),ie.createDraft.bind(ie),ie.finishDraft.bind(ie);const se=re;const oe=function(e){let t;const n=new Set,i=(e,i)=>{const r="function"==typeof e?e(t):e;if(r!==t){const e=t;t=i?r:Object.assign({},t,r),n.forEach((n=>n(t,e)))}},r=()=>t,s={setState:i,getState:r,subscribe:(e,i,s)=>i||s?((e,i=r,s=Object.is)=>{let o=i(t);function a(){const n=i(t);if(!s(o,n)){const t=o;e(o=n,t)}}return n.add(a),()=>n.delete(a)})(e,i,s):(n.add(e),()=>n.delete(e)),destroy:()=>n.clear()};return t=e(i,r,s),s};const ae=function(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(let i=0;i<n.length;i++)if(!Object.prototype.hasOwnProperty.call(t,n[i])||!Object.is(e[n[i]],t[n[i]]))return!1;return!0};let le=!0,ce=!0;function ue(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function de(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return r.apply(this,arguments);const s=e=>{const t=n(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(i,s),r.apply(this,[e,s])};const s=i.removeEventListener;i.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(n))return s.apply(this,arguments);const i=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,s.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function he(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(le=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function pe(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(ce=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function fe(){if("object"==typeof window){if(le)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function me(e,t){ce&&console.warn(e+" is deprecated, please use "+t+" instead.")}function ge(e){return"[object Object]"===Object.prototype.toString.call(e)}function ve(e){return ge(e)?Object.keys(e).reduce((function(t,n){const i=ge(e[n]),r=i?ve(e[n]):e[n],s=i&&!Object.keys(r).length;return void 0===r||s?t:Object.assign(t,{[n]:r})}),{}):e}function ye(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((i=>{i.endsWith("Id")?ye(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach((t=>{ye(e,e.get(t),n)}))})))}function be(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;const s=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&s.push(e)})),s.forEach((t=>{e.forEach((n=>{n.type===i&&n.trackId===t.id&&ye(e,n,r)}))})),r}const _e=fe;function we(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const i="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);const r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];let e={};"number"==typeof i.ideal?(e[r("min",n)]=i.ideal,t.optional.push(e),e={},e[r("max",n)]=i.ideal,t.optional.push(e)):(e[r("",n)]=i.ideal,t.optional.push(e))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",n)]=i.exact):["min","max"].forEach((e=>{void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,n)]=i[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},r=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"==typeof e.video){let s=e.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});const o=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||o)){let t;if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?t=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then((n=>{n=n.filter((e=>"videoinput"===e.kind));let o=n.find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!o&&n.length&&t.includes("back")&&(o=n[n.length-1]),o&&(e.video.deviceId=s.exact?{exact:o.deviceId}:{ideal:o.deviceId}),e.video=i(e.video),_e("chrome: "+JSON.stringify(e)),r(e)}))}e.video=i(e.video)}return _e("chrome: "+JSON.stringify(e)),r(e)},s=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,i){r(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{i&&i(s(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return r(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(s(e))))))}}}function Se(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((t=>{const i=n.video&&n.video.width,r=n.video&&n.video.height,s=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:s||3}},i&&(n.video.mandatory.maxWidth=i),r&&(n.video.mandatory.maxHeight=r),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function Te(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Ee(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};const r=new Event("track");r.track=n.track,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)})),t.stream.getTracks().forEach((n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};const r=new Event("track");r.track=n,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else de(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function ke(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){let r=n.apply(this,arguments);return r||(r=t(this,e),this._senders.push(r)),r};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Ce(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,i]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const r=function(e){const t={};return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t[n.id]=n})),t},s=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const i=function(e){n(s(r(e)))};return t.apply(this,[i,e])}return new Promise(((e,n)=>{t.apply(this,[function(t){e(s(r(t)))},n])})).then(n,i)}}function Ie(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>be(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),de(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>be(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,i;return this.getSenders().forEach((n=>{n.track===e&&(t?i=!0:t=n)})),this.getReceivers().forEach((t=>(t.track===e&&(n?i=!0:n=t),t.track===e))),i||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Re(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const i=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{const t=this.getSenders().find((t=>t.track===e));if(t)throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();n.apply(this,arguments);const i=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(i)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),r.apply(this,arguments)}}function Pe(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Re(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{const t=this.getSenders().find((t=>t.track===e));if(t)throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}i.apply(this,[t])};const r=e.RTCPeerConnection.prototype.removeStream;function s(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const r=this.getSenders().find((e=>e.track===t));if(r)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const s=this._streams[n.id];if(s)s.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const i=new e.MediaStream([t]);this._streams[n.id]=i,this._reverseStreams[i.id]=n,this.addStream(i)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=s(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>s(this,e)))}};e.RTCPeerConnection.prototype[t]=i[t]}));const o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};const a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=a.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Ae(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}))}function Ne(e,t){de(e,"negotiationneeded",(e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}function xe(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,i){me("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},i&&i.prototype.getSettings){const t=i.prototype.getSettings;i.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(i&&i.prototype.applyConstraints){const t=i.prototype.applyConstraints;i.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function De(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}function Oe(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Le(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,s]=arguments;return i.apply(this,[e||null]).then((e=>{if(t.version<53&&!r)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach(((t,i)=>{e.set(i,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(r,s)}}function Me(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function je(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),de(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Ue(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){me("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function Fe(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Ve(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach((e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const i=t.apply(this,arguments);if(n){const{sender:t}=i,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return i})}function Be(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function ze(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function $e(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function qe(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e,...n){return n&&n.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach((e=>{n.includes(e.track)&&this.removeTrack(e)}))})}}function Ge(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function We(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,r=t.setLocalDescription,s=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};let a=function(e,t,n){const i=r.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i};t.setLocalDescription=a,a=function(e,t,n){const i=s.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.setRemoteDescription=a,a=function(e,t,n){const i=o.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.addIceCandidate=a}function He(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(Ke(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,i){t.mediaDevices.getUserMedia(e).then(n,i)}.bind(t))}function Ke(e){return e&&void 0!==e.video?Object.assign({},e,{video:ve(e.video)}):e}function Je(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let i=e.iceServers[n];void 0===i.urls&&i.url?(me("RTCIceServer.url","RTCIceServer.urls"),i=JSON.parse(JSON.stringify(i)),i.urls=i.url,delete i.url,t.push(i)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Qe(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ye(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Ze(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Xe=n(7539),et=n.n(Xe);function tt(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const n=new t(e),i=et().parseCandidate(e.candidate);for(const e in i)e in n||Object.defineProperty(n,e,{value:i[e]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,de(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function nt(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||de(e,"icecandidate",(e=>{if(e.candidate){const t=et().parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function it(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=et().splitSections(e.sdp);return t.shift(),t.some((e=>{const t=et().parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n}(arguments[0]),n=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n}(e),i=function(e,n){let i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);const r=et().matchPrefix(e.sdp,"a=max-message-size:");return r.length>0?i=parseInt(r[0].substring(19),10):"firefox"===t.browser&&-1!==n&&(i=2147483637),i}(arguments[0],e);let r;r=0===n&&0===i?Number.POSITIVE_INFINITY:0===n||0===i?Math.max(n,i):Math.min(n,i);const s={};Object.defineProperty(s,"maxMessageSize",{get:()=>r}),this._sctp=s}return n.apply(this,arguments)}}function rt(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const i=arguments[0],r=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},de(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function st(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function ot(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function at(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function lt(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}if(e.sdp||"offer"!==e.type&&"answer"!==e.type)return n.apply(this,[e]);return("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then((e=>n.apply(this,[e])))})}const ct=function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=fe,a=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=ue(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=ue(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=ue(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),l={browserDetails:a,commonShim:o,extractVersion:ue,disableLog:he,disableWarnings:pe,sdp:Xe};switch(a.browser){case"chrome":if(!i||!Ae||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),l;if(null===a.version)return n("Chrome shim can not determine version, not shimming."),l;n("adapter.js shimming chrome."),l.browserShim=i,at(e,a),lt(e),we(e,a),Te(e),Ae(e,a),Ee(e),Pe(e,a),ke(e),Ce(e),Ie(e),Ne(e,a),tt(e),nt(e),st(e),it(e,a),rt(e),ot(e,a);break;case"firefox":if(!r||!Le||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),l;n("adapter.js shimming firefox."),l.browserShim=r,at(e,a),lt(e),xe(e,a),Le(e,a),Oe(e),Ue(e),Me(e),je(e),Fe(e),Ve(e),Be(e),ze(e),$e(e),tt(e),st(e),it(e,a),rt(e);break;case"safari":if(!s||!t.shimSafari)return n("Safari shim is not included in this adapter release."),l;n("adapter.js shimming safari."),l.browserShim=s,at(e,a),lt(e),Je(e),Ye(e),We(e),qe(e),Ge(e),Qe(e),He(e),Ze(e),tt(e),nt(e),it(e,a),rt(e),ot(e,a);break;default:n("Unsupported browser!")}return l}({window:"undefined"==typeof window?void 0:window}),ut=ct;var dt,ht=n(2238),pt=new Uint8Array(16);function ft(){if(!dt&&!(dt="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return dt(pt)}const mt=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;const gt=function(e){return"string"==typeof e&&mt.test(e)};for(var vt=[],yt=0;yt<256;++yt)vt.push((yt+256).toString(16).substr(1));const bt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(vt[e[t+0]]+vt[e[t+1]]+vt[e[t+2]]+vt[e[t+3]]+"-"+vt[e[t+4]]+vt[e[t+5]]+"-"+vt[e[t+6]]+vt[e[t+7]]+"-"+vt[e[t+8]]+vt[e[t+9]]+"-"+vt[e[t+10]]+vt[e[t+11]]+vt[e[t+12]]+vt[e[t+13]]+vt[e[t+14]]+vt[e[t+15]]).toLowerCase();if(!gt(n))throw TypeError("Stringified UUID is invalid");return n};const _t=function(e,t,n){var i=(e=e||{}).random||(e.rng||ft)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){n=n||0;for(var r=0;r<16;++r)t[n+r]=i[r];return t}return bt(i)};var wt,St,Tt=n(766),Et=n(6387),kt=Object.defineProperty,Ct=Object.defineProperties,It=Object.getOwnPropertyDescriptors,Rt=Object.getOwnPropertySymbols,Pt=Object.prototype.hasOwnProperty,At=Object.prototype.propertyIsEnumerable,Nt=(e,t,n)=>t in e?kt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,xt=(e,t)=>{for(var n in t||(t={}))Pt.call(t,n)&&Nt(e,n,t[n]);if(Rt)for(var n of Rt(t))At.call(t,n)&&Nt(e,n,t[n]);return e},Dt=(e,t)=>Ct(e,It(t)),Ot=(e,t)=>{var n={};for(var i in e)Pt.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&Rt)for(var i of Rt(e))t.indexOf(i)<0&&At.call(e,i)&&(n[i]=e[i]);return n},Lt=(e,t,n)=>new Promise(((i,r)=>{var s=e=>{try{a(n.next(e))}catch(e){r(e)}},o=e=>{try{a(n.throw(e))}catch(e){r(e)}},a=e=>e.done?i(e.value):Promise.resolve(e.value).then(s,o);a((n=n.apply(e,t)).next())})),Mt=((e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports))(((e,t)=>{t.exports={name:"@100mslive/hms-video",version:"0.5.4",license:"MIT",main:"dist/index.cjs.js",typings:"dist/index.d.ts",module:"dist/index.js",files:["dist","src"],engines:{node:">=10"},exports:{".":{require:"./dist/index.cjs.js",import:"./dist/index.js",default:"./dist/index.js"}},scripts:{prestart:"rm -rf dist && yarn types:build",start:'concurrently "yarn dev" "yarn types"',dev:"node ../../scripts/dev","build:only":"node ../../scripts/build",build:"yarn build:only && yarn types:build",types:"tsc -w","types:build":"tsc -p tsconfig.json",test:"jest --maxWorkers=1",lint:"eslint -c ../../.eslintrc .","lint:fix":"yarn lint --fix",prepare:"yarn build",size:"size-limit",analyze:"size-limit --why",format:"prettier --write src/**/*.ts"},author:"100ms <tech-common@100ms.live>",devDependencies:{"@types/sdp-transform":"^2.4.4","@types/ua-parser-js":"^0.7.36","@types/uuid":"^8.3.0","jest-canvas-mock":"^2.3.1",tslib:"^2.2.0"},dependencies:{eventemitter2:"^6.4.7","sdp-transform":"^2.14.1","ua-parser-js":"^1.0.1",uuid:"^8.3.2","webrtc-adapter":"^8.0.0"},gitHead:"fe00f2f7a62e19cb86e9d7bd8a80bc921909a2bb"}})),jt=class{constructor(e){this.key=e,this.storage=null}getStorage(){return Vt&&!this.storage&&(zt(),this.storage=window.localStorage),this.storage}get(){var e;let t=null==(e=this.getStorage())?void 0:e.getItem(this.key);return t?JSON.parse(t):void 0}set(e){var t;let n=JSON.stringify(e);null==(t=this.getStorage())||t.setItem(this.key,n)}clear(){var e;null==(e=this.getStorage())||e.removeItem(this.key)}},Ut=new ht.UAParser,Ft="undefined"==typeof window&&!(null==(wt=Ut.getBrowser().name)?void 0:wt.toLowerCase().includes("electron")),Vt="undefined"!=typeof window;!function(e){e.PROD="prod",e.QA="qa",e.DEV="dev"}(St||(St={}));var Bt,zt=()=>{Vt&&!localStorage&&(window.localStorage=new class{constructor(){this.valuesMap=new Map}getItem(e){return this.valuesMap.has(e)?String(this.valuesMap.get(e)):null}setItem(e,t){this.valuesMap.set(e,t)}removeItem(e){this.valuesMap.delete(e)}clear(){this.valuesMap.clear()}key(e){if(0===arguments.length)throw new TypeError("Failed to execute 'key' on 'Storage': 1 argument required, but only 0 present.");return Array.from(this.valuesMap.keys())[e]}get length(){return this.valuesMap.size}})};!function(e){e[e.VERBOSE=0]="VERBOSE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.TIME=4]="TIME",e[e.TIMEEND=5]="TIMEEND",e[e.ERROR=6]="ERROR",e[e.NONE=7]="NONE"}(Bt||(Bt={}));var $t,qt,Gt,Wt,Ht,Kt="undefined"!=typeof window&&void 0!==window.expect,Jt=class{static v(e,...t){this.log(0,e,...t)}static d(e,...t){this.log(1,e,...t)}static i(e,...t){this.log(2,e,...t)}static w(e,...t){this.log(3,e,...t)}static e(e,...t){this.log(6,e,...t)}static time(e){this.log(4,"[HMSPerformanceTiming]",e)}static timeEnd(e){this.log(5,"[HMSPerformanceTiming]",e,e)}static cleanUp(){performance.clearMarks(),performance.clearMeasures()}static log(e,t,...n){if(!(this.level.valueOf()>e.valueOf()))switch(e){case 0:console.log(t,...n);break;case 1:console.debug(t,...n);break;case 2:console.info(t,...n);break;case 3:console.warn(t,...n);break;case 6:console.error(t,...n);break;case 4:performance.mark(n[0]);break;case 5:{let e=n[0];try{let n=performance.measure(e,e);this.log(1,t,e,null==n?void 0:n.duration),performance.clearMarks(e),performance.clearMeasures(e)}catch(n){this.log(1,t,e,n)}break}}}};Jt.level=Kt?7:0,function(e){e.RECORDING_STATE_UPDATED="RECORDING_STATE_UPDATED",e.BROWSER_RECORDING_STATE_UPDATED="BROWSER_RECORDING_STATE_UPDATED",e.SERVER_RECORDING_STATE_UPDATED="SERVER_RECORDING_STATE_UPDATED",e.RTMP_STREAMING_STATE_UPDATED="RTMP_STREAMING_STATE_UPDATED",e.HLS_STREAMING_STATE_UPDATED="HLS_STREAMING_STATE_UPDATED"}($t||($t={})),function(e){e[e.PEER_JOINED=0]="PEER_JOINED",e[e.PEER_LEFT=1]="PEER_LEFT",e[e.AUDIO_TOGGLED=2]="AUDIO_TOGGLED",e[e.VIDEO_TOGGLED=3]="VIDEO_TOGGLED",e[e.BECAME_DOMINANT_SPEAKER=4]="BECAME_DOMINANT_SPEAKER",e[e.RESIGNED_DOMINANT_SPEAKER=5]="RESIGNED_DOMINANT_SPEAKER",e[e.STARTED_SPEAKING=6]="STARTED_SPEAKING",e[e.STOPPED_SPEAKING=7]="STOPPED_SPEAKING",e[e.ROLE_UPDATED=8]="ROLE_UPDATED",e[e.PEER_LIST=9]="PEER_LIST",e[e.NAME_UPDATED=10]="NAME_UPDATED",e[e.METADATA_UPDATED=11]="METADATA_UPDATED"}(qt||(qt={})),function(e){e[e.TRACK_ADDED=0]="TRACK_ADDED",e[e.TRACK_REMOVED=1]="TRACK_REMOVED",e[e.TRACK_MUTED=2]="TRACK_MUTED",e[e.TRACK_UNMUTED=3]="TRACK_UNMUTED",e[e.TRACK_DESCRIPTION_CHANGED=4]="TRACK_DESCRIPTION_CHANGED",e[e.TRACK_DEGRADED=5]="TRACK_DEGRADED",e[e.TRACK_RESTORED=6]="TRACK_RESTORED"}(Gt||(Gt={})),function(e){e[e.DEFAULT=0]="DEFAULT"}(Wt||(Wt={})),function(e){e.NONE="none",e.LOW="low",e.MEDIUM="medium",e.HIGH="high"}(Ht||(Ht={}));var Qt,Yt,Zt,Xt,en={f:Ht.HIGH,h:Ht.MEDIUM,q:Ht.LOW};!function(e){e.VP8="vp8",e.VP9="vp9",e.H264="h264"}(Qt||(Qt={})),function(e){e.OPUS="opus"}(Yt||(Yt={})),function(e){e.audio="audio",e.video="video"}(Zt||(Zt={})),function(e){e[e.Publish=0]="Publish",e[e.Subscribe=1]="Subscribe"}(Xt||(Xt={}));var tn,nn={WebSocketConnectionErrors:{FAILED_TO_CONNECT:1e3,WEBSOCKET_CONNECTION_LOST:1003,ABNORMAL_CLOSE:1006},InitAPIErrors:{SERVER_ERRORS:2e3,INIT_CONFIG_NOT_AVAILABLE:2002,ENDPOINT_UNREACHABLE:2003,INVALID_TOKEN_FORMAT:2004},TracksErrors:{GENERIC_TRACK:3e3,CANT_ACCESS_CAPTURE_DEVICE:3001,DEVICE_NOT_AVAILABLE:3002,DEVICE_IN_USE:3003,DEVICE_LOST_MIDWAY:3008,NOTHING_TO_RETURN:3005,INVALID_VIDEO_SETTINGS:3006,CODEC_CHANGE_NOT_PERMITTED:3007,AUTOPLAY_ERROR:3008,OVER_CONSTRAINED:3009,NO_AUDIO_DETECTED:3010,SYSTEM_DENIED_PERMISSION:3011},WebrtcErrors:{CREATE_OFFER_FAILED:4001,CREATE_ANSWER_FAILED:4002,SET_LOCAL_DESCRIPTION_FAILED:4003,SET_REMOTE_DESCRIPTION_FAILED:4004,ICE_FAILURE:4005},WebsocketMethodErrors:{SERVER_ERRORS:5e3,ALREADY_JOINED:5001,CANNOT_JOIN_PREVIEW_IN_PROGRESS:5002},GenericErrors:{NOT_CONNECTED:6e3,SIGNALLING:6001,UNKNOWN:6002,NOT_READY:6003,JSON_PARSING_FAILED:6004,TRACK_METADATA_MISSING:6005,RTC_TRACK_MISSING:6006,PEER_METADATA_MISSING:6007,INVALID_ROLE:6008,PREVIEW_IN_PROGRESS:6009,MISSING_MEDIADEVICES:6010,MISSING_RTCPEERCONNECTION:6011},PlaylistErrors:{NO_ENTRY_TO_PLAY:8001,NO_ENTRY_IS_PLAYING:8002}},rn=class extends Error{constructor(e,t,n,i,r,s=!1){super(i),this.code=e,this.name=t,this.message=i,this.description=r,this.isTerminal=s,Object.setPrototypeOf(this,rn.prototype),this.action=n.toString()}toAnalyticsProperties(){return{error_name:this.name,error_code:this.code,error_message:this.message,error_description:this.description,action:this.action,is_terminal:this.isTerminal}}addNativeError(e){this.nativeError=e}toString(){var e;return`{\n      code: ${this.code};\n      name: ${this.name};\n      action: ${this.action};\n      message: ${this.message};\n      description: ${this.description};\n      isTerminal: ${this.isTerminal};\n      nativeError: ${null==(e=this.nativeError)?void 0:e.message};\n    }`}};!function(e){e.NONE="NONE",e.TRACK="TRACK",e.INIT="INIT",e.PUBLISH="PUBLISH",e.UNPUBLISH="UNPUBLISH",e.JOIN="JOIN",e.SUBSCRIBE="SUBSCRIBE",e.DATA_CHANNEL_SEND="DATA_CHANNEL_SEND",e.RESTART_ICE="RESTART_ICE",e.VIDEO_PLUGINS="VIDEO_PLUGINS",e.AUDIO_PLUGINS="AUDIO_PLUGINS",e.AUTOPLAY="AUTOPLAY",e.RECONNECT_SIGNAL="RECONNECT_SIGNAL",e.VALIDATION="VALIDATION",e.PLAYLIST="PLAYLIST",e.PREVIEW="PREVIEW"}(tn||(tn={}));var sn={WebSocketConnectionErrors:{FailedToConnect:(e,t="")=>new rn(nn.WebSocketConnectionErrors.FAILED_TO_CONNECT,"WebsocketFailedToConnect",e,`[WS]: ${t}`,`[WS]: ${t}`),WebSocketConnectionLost:(e,t="")=>new rn(nn.WebSocketConnectionErrors.WEBSOCKET_CONNECTION_LOST,"WebSocketConnectionLost",e,"Network connection lost ",t),AbnormalClose:(e,t="")=>new rn(nn.WebSocketConnectionErrors.ABNORMAL_CLOSE,"WebSocketAbnormalClose",e,"Websocket closed abnormally",t)},InitAPIErrors:{ServerErrors:(e,t,n="")=>new rn(e,"ServerErrors",t,`[INIT]: Server error ${n}`,n,!0),EndpointUnreachable:(e,t="")=>new rn(nn.InitAPIErrors.ENDPOINT_UNREACHABLE,"EndpointUnreachable",e,`Endpoint is not reachable - ${t}`,t),InvalidTokenFormat:(e,t="")=>new rn(nn.InitAPIErrors.INVALID_TOKEN_FORMAT,"InvalidTokenFormat",e,`Token is not in proper JWT format - ${t}`,t,!0),InitConfigNotAvailable:(e,t="")=>new rn(nn.InitAPIErrors.INIT_CONFIG_NOT_AVAILABLE,"InitError",e,`[INIT]: ${t}`,`[INIT]: ${t}`)},TracksErrors:{GenericTrack:(e,t="")=>new rn(nn.TracksErrors.GENERIC_TRACK,"GenericTrack",e,`[TRACK]: ${t}`,`[TRACK]: ${t}`),CantAccessCaptureDevice:(e,t,n="")=>new rn(nn.TracksErrors.CANT_ACCESS_CAPTURE_DEVICE,"CantAccessCaptureDevice",e,`User denied permission to access capture device - ${t}`,n),DeviceNotAvailable:(e,t,n="")=>new rn(nn.TracksErrors.DEVICE_NOT_AVAILABLE,"DeviceNotAvailable",e,`[TRACK]: Capture device is no longer available - ${t}`,n),DeviceInUse:(e,t,n="")=>new rn(nn.TracksErrors.DEVICE_IN_USE,"DeviceInUse",e,`[TRACK]: Capture device is in use by another application - ${t}`,n),DeviceLostMidway:(e,t,n="")=>new rn(nn.TracksErrors.DEVICE_LOST_MIDWAY,"DeviceLostMidway",e,`Lost access to capture device midway - ${t}`,n),NothingToReturn:(e,t="")=>new rn(nn.TracksErrors.NOTHING_TO_RETURN,"NothingToReturn",e,"There is no media to return. Please select either video or audio or both.",t),InvalidVideoSettings:(e,t="")=>new rn(nn.TracksErrors.INVALID_VIDEO_SETTINGS,"InvalidVideoSettings",e,"Cannot enable simulcast when no video settings are provided",t),AutoplayBlocked:(e,t="")=>new rn(nn.TracksErrors.AUTOPLAY_ERROR,"AutoplayBlocked",e,"Autoplay blocked because the user didn't interact with the document first",t),CodecChangeNotPermitted:(e,t="")=>new rn(nn.TracksErrors.CODEC_CHANGE_NOT_PERMITTED,"CodecChangeNotPermitted",e,"Codec can't be changed mid call.",t),OverConstrained:(e,t,n="")=>new rn(nn.TracksErrors.OVER_CONSTRAINED,"OverConstrained",e,`[TRACK]: Requested constraints cannot be satisfied with the device hardware - ${t}`,n),NoAudioDetected:(e,t="Please check the mic or use another audio input")=>new rn(nn.TracksErrors.NO_AUDIO_DETECTED,"NoAudioDetected",e,"No audio input detected from microphone",t),SystemDeniedPermission:(e,t,n="")=>new rn(nn.TracksErrors.SYSTEM_DENIED_PERMISSION,"SystemDeniedPermission",e,`Operating System denied permission to access capture device - ${t}`,n)},WebrtcErrors:{CreateOfferFailed:(e,t="")=>new rn(nn.WebrtcErrors.CREATE_OFFER_FAILED,"CreateOfferFailed",e,`[${e.toString()}]: Failed to create offer. `,t),CreateAnswerFailed:(e,t="")=>new rn(nn.WebrtcErrors.CREATE_ANSWER_FAILED,"CreateAnswerFailed",e,`[${e.toString()}]: Failed to create answer. `,t),SetLocalDescriptionFailed:(e,t="")=>new rn(nn.WebrtcErrors.SET_LOCAL_DESCRIPTION_FAILED,"SetLocalDescriptionFailed",e,`[${e.toString()}]: Failed to set offer. `,t),SetRemoteDescriptionFailed:(e,t="")=>new rn(nn.WebrtcErrors.SET_REMOTE_DESCRIPTION_FAILED,"SetRemoteDescriptionFailed",e,`[${e.toString()}]: Failed to set answer. `,t),ICEFailure:(e,t="")=>new rn(nn.WebrtcErrors.ICE_FAILURE,"ICEFailure",e,`[${e.toString()}]: Ice connection state FAILED`,t)},WebsocketMethodErrors:{ServerErrors:(e,t,n)=>new rn(e,"ServerErrors",t,n,n,!0),AlreadyJoined:(e,t="")=>new rn(nn.WebsocketMethodErrors.ALREADY_JOINED,"AlreadyJoined",e,"[JOIN]: You have already joined this room.",t),CannotJoinPreviewInProgress:(e,t="")=>new rn(nn.WebsocketMethodErrors.CANNOT_JOIN_PREVIEW_IN_PROGRESS,"CannotJoinPreviewInProgress",e,"[JOIN]: Cannot join if preview is in progress",t)},GenericErrors:{NotConnected:(e,t="")=>new rn(nn.GenericErrors.NOT_CONNECTED,"NotConnected",e,"Client is not connected",t),Signalling:(e,t)=>new rn(nn.GenericErrors.SIGNALLING,"Signalling",e,`Unknown signalling error: ${e.toString()} ${t} `,t),Unknown:(e,t)=>new rn(nn.GenericErrors.UNKNOWN,"Unknown",e,`Unknown exception: ${t}`,t),NotReady:(e,t="")=>new rn(nn.GenericErrors.NOT_READY,"NotReady",e,t,t),JsonParsingFailed:(e,t,n="")=>new rn(nn.GenericErrors.JSON_PARSING_FAILED,"JsonParsingFailed",e,`Failed to parse JSON message - ${t}`,n),TrackMetadataMissing:(e,t="")=>new rn(nn.GenericErrors.TRACK_METADATA_MISSING,"TrackMetadataMissing",e,"Track Metadata Missing",t),RTCTrackMissing:(e,t="")=>new rn(nn.GenericErrors.RTC_TRACK_MISSING,"RTCTrackMissing",e,"RTC Track missing",t),PeerMetadataMissing:(e,t="")=>new rn(nn.GenericErrors.PEER_METADATA_MISSING,"PeerMetadataMissing",e,"Peer Metadata Missing",t),ValidationFailed:(e,t)=>new rn(nn.GenericErrors.INVALID_ROLE,"ValidationFailed",tn.VALIDATION,e,t?JSON.stringify(t):""),InvalidRole:(e,t)=>new rn(nn.GenericErrors.INVALID_ROLE,"InvalidRole",e,"Invalid role. Join with valid role",t,!0),PreviewAlreadyInProgress:(e,t="")=>new rn(nn.GenericErrors.PREVIEW_IN_PROGRESS,"PreviewAlreadyInProgress",e,"[Preview]: Cannot join if preview is in progress",t),MissingMediaDevices:()=>new rn(nn.GenericErrors.MISSING_MEDIADEVICES,"MissingMediaDevices",tn.JOIN,"navigator.mediaDevices is undefined. 100ms SDK won't work on this website as WebRTC is not supported on HTTP endpoints(missing navigator.mediaDevices). Please ensure you're using the SDK either on localhost or a valid HTTPS endpoint.","",!0),MissingRTCPeerConnection:()=>new rn(nn.GenericErrors.MISSING_RTCPEERCONNECTION,"MissingRTCPeerConnection",tn.JOIN,"RTCPeerConnection which is a core requirement for WebRTC call was not found, this could be due to an unsupported browser or browser extensions blocking WebRTC","",!0)},MediaPluginErrors:{PlatformNotSupported:(e,t="")=>new rn(7001,"PlatformNotSupported",e,"Check HMS Docs to see the list of supported platforms",t),InitFailed:(e,t="")=>new rn(7002,"InitFailed",e,"Plugin init failed",t),ProcessingFailed:(e,t="")=>new rn(7003,"ProcessingFailed",e,"Plugin processing failed",t),AddAlreadyInProgress:(e,t="")=>new rn(7004,"AddAlreadyInProgress",e,"Plugin add already in progress",t),DeviceNotSupported:(e,t="")=>new rn(7005,"DeviceNotSupported",e,"Check HMS Docs to see the list of supported devices",t)},PlaylistErrors:{NoEntryToPlay:(e,t)=>new rn(nn.PlaylistErrors.NO_ENTRY_TO_PLAY,"NoEntryToPlay",e,"Reached end of playlist",t),NoEntryPlaying:(e,t)=>new rn(nn.PlaylistErrors.NO_ENTRY_IS_PLAYING,"NoEntryIsPlaying",e,"No entry is playing at this time",t)}},on="VALIDATIONS";function an(e){return null!=e}var ln=()=>{if(!an(RTCPeerConnection)){let e=sn.GenericErrors.MissingRTCPeerConnection();throw Jt.e(on,e),e}},cn=()=>{if(!an(navigator.mediaDevices)){let e=sn.GenericErrors.MissingMediaDevices();throw Jt.e(on,e),e}};var un,dn="HMSConnection",hn=class{constructor(e,t){this.candidates=new Array,this.role=e,this.signal=t}get iceConnectionState(){return this.nativeConnection.iceConnectionState}get connectionState(){return this.nativeConnection.connectionState}get action(){return this.role===Xt.Publish?tn.PUBLISH:tn.SUBSCRIBE}addTransceiver(e,t){return this.nativeConnection.addTransceiver(e,t)}createOffer(e,t){return Lt(this,null,(function*(){try{let n=yield this.nativeConnection.createOffer(t);return Jt.d(dn,`[role=${this.role}] createOffer offer=${JSON.stringify(n,null,1)}`),function(e){return e.sdp.includes("usedtx=1")?e:{type:e.type,sdp:e.sdp.replace("useinbandfec=1","useinbandfec=1;usedtx=1")}}(function(e,t){var n;let i=(0,Tt.Qc)(e.sdp);if(!(null==(n=i.origin)?void 0:n.username.startsWith("mozilla")))return e;let r=t?Array.from(t.values()):[];return i.media.forEach((e=>{var t,n,i;let s=null==(t=e.msid)?void 0:t.split(" ")[0],o=null==(n=r.find((t=>t.type===e.type&&t.stream_id===s)))?void 0:n.track_id;o&&(e.msid=null==(i=e.msid)?void 0:i.replace(/\s(.+)/,` ${o}`))})),{type:e.type,sdp:(0,Tt.cW)(i)}}(n,e))}catch(e){throw sn.WebrtcErrors.CreateOfferFailed(this.action,e.message)}}))}createAnswer(e=void 0){return Lt(this,null,(function*(){try{let t=yield this.nativeConnection.createAnswer(e);return Jt.d(dn,`[role=${this.role}] createAnswer answer=${JSON.stringify(t,null,1)}`),t}catch(e){throw sn.WebrtcErrors.CreateAnswerFailed(this.action,e.message)}}))}setLocalDescription(e){return Lt(this,null,(function*(){try{Jt.d(dn,`[role=${this.role}] setLocalDescription description=${JSON.stringify(e,null,1)}`),yield this.nativeConnection.setLocalDescription(e)}catch(e){throw sn.WebrtcErrors.SetLocalDescriptionFailed(this.action,e.message)}}))}setRemoteDescription(e){return Lt(this,null,(function*(){try{Jt.d(dn,`[role=${this.role}] setRemoteDescription description=${JSON.stringify(e,null,1)}`),yield this.nativeConnection.setRemoteDescription(e)}catch(e){throw sn.WebrtcErrors.SetRemoteDescriptionFailed(this.action,e.message)}}))}addIceCandidate(e){return Lt(this,null,(function*(){Jt.d(dn,`[role=${this.role}] addIceCandidate candidate=${JSON.stringify(e,null,1)}`),yield this.nativeConnection.addIceCandidate(e)}))}get remoteDescription(){return this.nativeConnection.remoteDescription}getSenders(){return this.nativeConnection.getSenders()}logSelectedIceCandidatePairs(){(this.role===Xt.Publish?this.getSenders():this.getReceivers()).forEach((e=>{var t;let n=null==(t=e.track)?void 0:t.kind;try{if(e.transport){let t=e.transport.iceTransport,i=()=>{let e=t.getSelectedCandidatePair();Jt.d(dn,`${Xt[this.role]} connection`,`selected ${n||"unknown"} candidate pair`,JSON.stringify(e,null,2))};"function"==typeof t.onselectedcandidatepairchange&&(t.onselectedcandidatepairchange=i),i()}}catch(e){Jt.w(dn,`Error in logging selected ice candidate pair for ${Xt[this.role]} connection`,e)}}))}removeTrack(e){this.nativeConnection.removeTrack(e)}setMaxBitrate(e,t){return Lt(this,null,(function*(){let n=this.getSenders().find((e=>{var n;return(null==(n=null==e?void 0:e.track)?void 0:n.id)===t.getTrackIDBeingSent()}));if(n){let t=n.getParameters();t.encodings.length>0&&(t.encodings[0].maxBitrate=1e3*e),yield n.setParameters(t)}else Jt.w(dn,`no sender found to setMaxBitrate for track - ${t.trackId}, sentTrackId - ${t.getTrackIDBeingSent()}`)}))}getStats(){return Lt(this,null,(function*(){return yield this.nativeConnection.getStats()}))}close(){return Lt(this,null,(function*(){this.nativeConnection.close()}))}getReceivers(){return this.nativeConnection.getReceivers()}},pn="renegotiation-callback-id",fn="ion-sfu",mn="SUBSCRIBE_ICE_CONNECTION_CALLBACK_ID",gn="device-change",vn="local-audio-enabled",yn="local-video-enabled",bn="stats-update",_n="track-degraded",wn="track-restored",Sn="track-audio-level-update",Tn="local-audio-silence",En="analytics",kn="audio-plugin-failed",Cn="policy-change",In="local-role-update",Rn="audio-track-update",Pn="audio-track-added",An="audio-track-removed",Nn="autoplay-error",xn=class extends hn{constructor(e,t,n,i){super(Xt.Publish,e),this.observer=n,this.transport=i,this.nativeConnection=new RTCPeerConnection(t),this.nativeConnection.createDataChannel(fn,{protocol:"SCTP"}),this.nativeConnection.onicecandidate=({candidate:t})=>{t&&e.trickle(this.role,t)},this.nativeConnection.oniceconnectionstatechange=()=>{this.observer.onIceConnectionChange(this.nativeConnection.iceConnectionState)},this.nativeConnection.onconnectionstatechange=()=>{this.observer.onConnectionStateChange(this.nativeConnection.connectionState)}}initAfterJoin(){this.nativeConnection.onnegotiationneeded=()=>Lt(this,null,(function*(){Jt.d("HMSPublishConnection","onnegotiationneeded"),yield this.observer.onRenegotiationNeeded()}))}trackUpdate(e){this.transport.trackUpdate(e)}},Dn=class{constructor(e){this.tracks=new Array,this.nativeStream=e,this.id=e.id}},On=class extends Dn{constructor(e,t){super(e),this.audio=!0,this.video=Ht.NONE,this.connection=t}setAudio(e){this.audio!==e&&(this.audio=e,this.syncWithApiChannel(!1))}setVideoLayerLocally(e,t){this.video=e,Jt.d(`[Remote stream] ${t} - ${this.id}`,`Setting layer field to - ${e}`)}setVideoLayer(e,t){this.setVideoLayerLocally(e,t),Jt.d(`[Remote stream] ${t} - ${this.id}`,`Switching to ${e} layer`),this.syncWithApiChannel()}getSimulcastLayer(){return this.video}isAudioSubscribed(){return this.audio}syncWithApiChannel(e=!0){let t={streamId:this.id,audio:this.audio};e&&(t.video=this.video,t.framerate=this.video),this.connection.sendOverApiDataChannel(JSON.stringify(t))}},Ln=e=>e?`{\n    trackId: ${e.id};\n    kind: ${e.kind};\n    enabled: ${e.enabled};\n    muted: ${e.muted};\n    readyState: ${e.readyState};\n  }`:"",Mn=class{constructor(e,t,n){this.logIdentifier="",this.stream=e,this.nativeTrack=t,this.source=n}get enabled(){return this.nativeTrack.enabled}get trackId(){return this.firstTrackId||this.sdpTrackId||this.nativeTrack.id}getMediaTrackSettings(){return this.nativeTrack.getSettings()}setEnabled(e){return Lt(this,null,(function*(){this.nativeTrack.enabled=e}))}setSdpTrackId(e){this.sdpTrackId=e}setFirstTrackId(e){this.firstTrackId=e}cleanup(){var e;null==(e=this.nativeTrack)||e.stop()}toString(){return`{\n      streamId: ${this.stream.id};\n      peerId: ${this.peerId};\n      trackId: ${this.trackId};\n      logIdentifier: ${this.logIdentifier};\n      source: ${this.source};\n      enabled: ${this.enabled};\n      nativeTrack: ${Ln(this.nativeTrack)};\n    }`}};!function(e){e.AUDIO="audio",e.VIDEO="video"}(un||(un={}));var jn,Un=class extends Mn{constructor(e,t,n){if(super(e,t,n),this.type=un.AUDIO,this.audioElement=null,"audio"!==t.kind)throw new Error("Expected 'track' kind = 'audio'")}getVolume(){return this.audioElement?100*this.audioElement.volume:null}setVolume(e){if(e<0||e>100)throw Error("Please pass a valid number between 0-100");this.subscribeToAudio(0!==e&&this.enabled),this.audioElement&&(this.audioElement.volume=e/100)}setAudioElement(e){this.audioElement=e}getAudioElement(){return this.audioElement}getOutputDevice(){return this.outputDevice}cleanup(){super.cleanup(),this.audioElement&&(this.audioElement.srcObject=null,this.audioElement.remove(),this.audioElement=null)}setOutputDevice(e){return Lt(this,null,(function*(){var t;if(this.audioElement)try{"function"==typeof this.audioElement.setSinkId&&(yield null==(t=this.audioElement)?void 0:t.setSinkId(e.deviceId),this.outputDevice=e)}catch(e){Jt.d("audio-track",e)}else Jt.d("audio-track","no audio element to set output")}))}removeSink(){var e;this.audioElement&&(null==(e=window.HMS)?void 0:e.AUDIO_SINK)&&(this.audioElement.srcObject=null,this.subscribeToAudio(!1))}addSink(){var e,t;if(!this.nativeTrack||!this.audioElement||!(null==(e=window.HMS)?void 0:e.AUDIO_SINK))return;let n=this.audioElement.srcObject;n instanceof MediaStream&&(null==(t=n.getAudioTracks()[0])?void 0:t.id)===this.nativeTrack.id||(this.audioElement.srcObject=new MediaStream([this.nativeTrack]),this.subscribeToAudio(!0))}subscribeToAudio(e){this.stream instanceof On&&this.stream.setAudio(e)}},Fn=class extends Un{setEnabled(e){var t=e=>super[e];return Lt(this,null,(function*(){e!==this.enabled&&(yield t("setEnabled").call(this,e),this.subscribeToAudio(e))}))}},Vn=class extends Mn{constructor(e,t,n){if(super(e,t,n),this.type=un.VIDEO,this.sinkCount=0,"video"!==t.kind)throw new Error("Expected 'track' kind = 'video'")}hasSinks(){return this.sinkCount>0}addSink(e){this.addSinkInternal(e,this.nativeTrack)}removeSink(e){null!==e.srcObject&&(e.srcObject=null,this.sinkCount>0&&this.sinkCount--)}addSinkInternal(e,t){var n;let i=e.srcObject;null!==i&&i instanceof MediaStream&&(null==(n=i.getVideoTracks()[0])?void 0:n.id)===t.id||(e.srcObject=new MediaStream([t]),this.sinkCount++)}},Bn=class extends Vn{constructor(){super(...arguments),this._degraded=!1,this._degradedAt=null,this._layerDefinitions=[],this.history=new zn}get degraded(){return this._degraded}get degradedAt(){return this._degradedAt}setEnabled(e){var t=e=>super[e];return Lt(this,null,(function*(){e!==this.enabled&&(yield t("setEnabled").call(this,e))}))}preferLayer(e){!this.shouldSendVideoLayer(e,"preferLayer")||(this.stream.setVideoLayer(e,this.logIdentifier),this.pushInHistory(`uiPreferLayer-${e}`))}getSimulcastLayer(){return this.stream.getSimulcastLayer()}addSink(e){super.addSink(e),this.updateLayer("addSink"),this.pushInHistory("uiSetLayer-high")}removeSink(e){super.removeSink(e),this.updateLayer("removeSink"),this._degraded=!1,this.pushInHistory("uiSetLayer-none")}getSimulcastDefinitions(){return[...this._layerDefinitions]}setSimulcastDefinitons(e){this._layerDefinitions=e}setLayerFromServer(e,t){this._degraded=t,this._degradedAt=t?new Date:this._degradedAt,this.stream.setVideoLayerLocally(e,this.logIdentifier),this.pushInHistory(`sfuLayerUpdate-${e}`)}setDegradedFromSdk(e){this._degraded=e,this._degradedAt=e?new Date:this._degradedAt,this.updateLayer("sdkDegradation"),this.pushInHistory(e?"sdkDegraded-none":"sdkRecovered-high")}updateLayer(e){let t=this.degraded||!this.hasSinks()?Ht.NONE:Ht.HIGH;!this.shouldSendVideoLayer(t,e)||this.stream.setVideoLayer(t,this.logIdentifier)}pushInHistory(e){}shouldSendVideoLayer(e,t){let n=this.getSimulcastLayer();return!(!this.degraded||e!==Ht.NONE)||(n!==e||(Jt.d(`[Remote Track] ${this.logIdentifier}`,`Not sending update, already on layer ${e}, source=${t}`),!1))}},zn=class{constructor(){this.history=[]}push(e){e.time=(new Date).toISOString().split("T")[1],this.history.push(e)}},$n=class extends hn{constructor(e,t,n){super(Xt.Subscribe,e),this.TAG="[HMSSubscribeConnection]",this.remoteStreams=new Map,this.pendingMessageQueue=[],this.handlePendingApiMessages=()=>{this.pendingMessageQueue.length>0&&(Jt.d(this.TAG,"Found pending message queue, sending messages"),this.pendingMessageQueue.forEach((e=>this.sendOverApiDataChannel(e))),this.pendingMessageQueue.length=0)},this.observer=n,this.nativeConnection=new RTCPeerConnection(t),this.initNativeConnectionCallbacks()}initNativeConnectionCallbacks(){this.nativeConnection.oniceconnectionstatechange=()=>{this.observer.onIceConnectionChange(this.nativeConnection.iceConnectionState)},this.nativeConnection.onconnectionstatechange=()=>{this.observer.onConnectionStateChange(this.nativeConnection.connectionState)},this.nativeConnection.ondatachannel=e=>{e.channel.label===fn&&(this.apiChannel=new class{constructor(e,t,n=""){this.TAG="HMSDataChannel",this.nativeChannel=e,this.observer=t,this.metadata=n,e.onmessage=e=>{this.observer.onMessage(e.data)}}get id(){return this.nativeChannel.id}get label(){return this.nativeChannel.label}get readyState(){return this.nativeChannel.readyState}send(e){Jt.d(this.TAG,`[${this.metadata}] Sending [size=${e.length}] message=${e}`),this.nativeChannel.send(e)}close(){this.nativeChannel.close()}}(e.channel,{onMessage:e=>{this.observer.onApiChannelMessage(e)}},`role=${this.role}`),e.channel.onopen=this.handlePendingApiMessages)},this.nativeConnection.onicecandidate=e=>{null!==e.candidate&&this.signal.trickle(this.role,e.candidate)},this.nativeConnection.ontrack=e=>{var t;let n=e.streams[0],i=n.id;if(!this.remoteStreams.has(i)){let e=new On(n,this);this.remoteStreams.set(i,e),n.onremovetrack=t=>{let n=e.tracks.findIndex((e=>e.nativeTrack.id===t.track.id));if(n>=0){let t=e.tracks[n];this.observer.onTrackRemove(t),e.tracks.splice(n,1),0===e.tracks.length&&this.remoteStreams.delete(i)}}}let r=this.remoteStreams.get(i),s=new("audio"===e.track.kind?Fn:Bn)(r,e.track),o=function(e,t){var n;if(!(null==e?void 0:e.sdp)||!t)return;let i=(0,Tt.Qc)(e.sdp).media.find((e=>an(e.mid)&&parseInt(e.mid)===parseInt(t)));return null==(n=null==i?void 0:i.msid)?void 0:n.split(" ")[1]}(this.remoteDescription,null==(t=e.transceiver)?void 0:t.mid);o&&s.setSdpTrackId(o),r.tracks.push(s),this.observer.onTrackAdd(s)}}sendOverApiDataChannel(e){this.apiChannel&&"open"===this.apiChannel.readyState?this.apiChannel.send(e):(Jt.w(this.TAG,`API Data channel not ${this.apiChannel?"open":"present"}, queueing`,e),this.pendingMessageQueue.push(e))}close(){var e=e=>super[e];return Lt(this,null,(function*(){var t;yield e("close").call(this),null==(t=this.apiChannel)||t.close()}))}},qn="InitService",Gn=class{static handleError(e,t){switch(e.status){case 404:throw sn.InitAPIErrors.EndpointUnreachable(tn.INIT,t.message||e.statusText);case 200:break;default:throw sn.InitAPIErrors.ServerErrors(t.code||e.status,tn.INIT,t.message||(null==e?void 0:e.statusText))}}static fetchInitConfig(e){return Lt(this,arguments,(function*({token:e,peerId:t,userAgent:n,initEndpoint:i="https://prod-init.100ms.live",region:r=""}){Jt.d(qn,`fetchInitConfig: initEndpoint=${i} token=${e} peerId=${t} region=${r} `);let s=function(e,t,n,i){try{let r=new URL("/init",e);return i&&i.trim().length>0&&r.searchParams.set("region",i.trim()),r.searchParams.set("peer_id",t),r.searchParams.set("user_agent_v2",n),r.toString()}catch(e){let t=e;throw Jt.e(qn,t.name,t.message),t}}(i,t,n,r);try{let t=yield fetch(s,{headers:{Authorization:`Bearer ${e}`}}),n=yield t.json();return this.handleError(t,n),Jt.d(qn,`config is ${JSON.stringify(n,null,2)}`),function(e){var t;return Dt(xt({},e),{rtcConfiguration:Dt(xt({},e.rtcConfiguration),{iceServers:null==(t=e.rtcConfiguration)?void 0:t.ice_servers})})}(n)}catch(e){let t=e;throw["Failed to fetch","NetworkError"].some((e=>t.message.includes(e)))?sn.InitAPIErrors.EndpointUnreachable(tn.INIT,t.message):t}}))}};!function(e){e.JOIN="join",e.OFFER="offer",e.ANSWER="answer",e.TRICKLE="trickle",e.TRACK_UPDATE="track-update",e.BROADCAST="broadcast",e.ANALYTICS="analytics",e.SERVER_ERROR="on-error",e.SERVER_WARNING="on-warning",e.SDK_NOTIFICATION="sdk-notification",e.LEAVE="leave",e.END_ROOM="end-room",e.PING="ping",e.ROLE_CHANGE_REQUEST="role-change-request",e.ROLE_CHANGE="role-change",e.TRACK_UPDATE_REQUEST="track-update-request",e.PEER_LEAVE_REQUEST="peer-leave-request",e.CHANGE_TRACK_MUTE_STATE_REQUEST="change-track-mute-state-request",e.START_RTMP_OR_RECORDING_REQUEST="rtmp-start",e.STOP_RTMP_AND_RECORDING_REQUEST="rtmp-stop",e.UPDATE_PEER_METADATA="peer-update",e.START_HLS_STREAMING="hls-start",e.STOP_HLS_STREAMING="hls-stop",e.HLS_TIMED_METADATA="hls-timed-metadata",e.SET_METADATA="set-metadata",e.GET_METADATA="get-metadata"}(jn||(jn={}));var Wn=class{constructor(e=1/0){this.capacity=e,this.storage=[]}size(){return this.storage.length}toList(){return this.storage.slice(0)}enqueue(e){this.size()===this.capacity&&this.dequeue(),this.storage.push(e)}dequeue(){return this.storage.shift()}aggregate(e){return e(this.storage)}};function Hn(e){if(e<0)throw Error("`ms` should be a positive integer");return new Promise((t=>setTimeout(t,e)))}var Kn,Jn=class{constructor(){this._volume=1,this._codec=Yt.OPUS,this._maxBitrate=32,this._deviceId="default",this._advanced=[{googEchoCancellation:{exact:!0}},{googExperimentalEchoCancellation:{exact:!0}},{autoGainControl:{exact:!0}},{noiseSuppression:{exact:!0}},{googHighpassFilter:{exact:!0}},{googAudioMirroring:{exact:!0}}]}volume(e){if(!(0<=e&&e<=1))throw Error("volume can only be in range [0.0, 1.0]");return this._volume=e,this}codec(e){return this._codec=e,this}maxBitrate(e){if(e&&e<=0)throw Error("maxBitrate should be >= 1");return this._maxBitrate=e,this}deviceId(e){return this._deviceId=e,this}advanced(e){return this._advanced=e,this}build(){return new Qn(this._volume,this._codec,this._maxBitrate,this._deviceId,this._advanced)}},Qn=class{constructor(e,t,n,i,r){this.volume=e,this.codec=t,this.maxBitrate=n,this.deviceId=i,this.advanced=r}toConstraints(){return{deviceId:this.deviceId,advanced:this.advanced}}toAnalyticsProperties(){return{audio_bitrate:this.maxBitrate,audio_codec:this.codec}}},Yn=class{constructor(){this._width=320,this._height=180,this._codec=Qt.VP8,this._maxFramerate=30,this._maxBitrate=150,this._advanced=[]}setWidth(e){return this._width=e,this}setHeight(e){return this._height=e,this}codec(e){return this._codec=e,this}maxFramerate(e){if(e&&e<=0)throw Error("maxFramerate should be >= 1");return this._maxFramerate=e,this}maxBitrate(e,t=!0){if("number"==typeof e&&e<=0)throw Error("maxBitrate should be >= 1");return this._maxBitrate=e,!this._maxBitrate&&t&&(this._maxBitrate=15e4),this}deviceId(e){return this._deviceId=e,this}advanced(e){return this._advanced=e,this}build(){return new Zn(this._width,this._height,this._codec,this._maxFramerate,this._deviceId,this._advanced,this._maxBitrate)}},Zn=class{constructor(e,t,n,i,r,s,o){this.width=e,this.height=t,this.codec=n,this.maxFramerate=i,this.maxBitrate=o,this.deviceId=r,this.advanced=s}toConstraints(){return{width:this.width,height:this.height,frameRate:this.maxFramerate,deviceId:this.deviceId}}toAnalyticsProperties(){return{width:this.width,height:this.height,video_bitrate:this.maxBitrate,framerate:this.maxFramerate,video_codec:this.codec}}},Xn=class{constructor(){this._video=(new Yn).build(),this._audio=(new Jn).build(),this._screen=(new Yn).build(),this._simulcast=!1}video(e){return this._video=e,this}audio(e){return this._audio=e,this}screen(e){return this._screen=e,this}simulcast(e){return this._simulcast=e,this}build(){if(null===this._audio&&null===this._video)throw sn.TracksErrors.NothingToReturn(tn.TRACK);if(null===this._video&&this._simulcast)throw sn.TracksErrors.InvalidVideoSettings(tn.TRACK,"Cannot enable simulcast when no video settings are provided");return new ei(this._video,this._audio,this._simulcast,this._screen||void 0)}},ei=class{constructor(e,t,n,i=null){this.video=e,this.audio=t,this.simulcast=n,this.screen=i}toAnalyticsProperties(){let e={audio_enabled:null!==this.audio,video_enabled:null!==this.video};return this.audio&&(e=xt(xt({},this.audio.toAnalyticsProperties()),e)),this.video&&(e=xt(xt({},this.video.toAnalyticsProperties()),e)),e}};!function(e){e.ROOM_STATE="room-state",e.PEER_JOIN="on-peer-join",e.PEER_LEAVE="on-peer-leave",e.PEER_LIST="peer-list",e.TRACK_METADATA_ADD="on-track-add",e.TRACK_UPDATE="on-track-update",e.CHANGE_TRACK_MUTE_STATE_UPDATE="on-change-track-mute-state-request",e.ACTIVE_SPEAKERS="active-speakers",e.CONNECTION_QUALITY="on-connection-quality-update",e.SFU_STATS="sfu-stats",e.ON_SFU_TRACK_LAYER_UPDATE="on-track-layer-update",e.BROADCAST="on-broadcast",e.ROLE_CHANGE="on-role-change",e.POLICY_CHANGE="on-policy-change",e.ROLE_CHANGE_REQUEST="on-role-change-request",e.TRACK_UPDATE_REQUEST="on-track-update-request",e.PEER_UPDATE="on-peer-update",e.PEER_LEAVE_REQUEST="on-peer-leave-request",e.UNSUPPORTED="unsupported",e.RTMP_START="on-rtmp-start",e.RTMP_STOP="on-rtmp-stop",e.RECORDING_START="on-record-start",e.RECORDING_STOP="on-record-stop",e.HLS_START="on-hls-start",e.HLS_STOP="on-hls-stop"}(Kn||(Kn={}));var ti=class{constructor({sender:e,message:t,type:n="chat",recipientPeer:i,recipientRoles:r,time:s}){this.sender=e,this.message=t,this.type=n,this.recipientPeer=i,this.recipientRoles=r,this.time=s}toSignalParams(){var e,t;let n=null==(e=this.recipientRoles)?void 0:e.map((e=>e.name)),i=null==(t=this.recipientPeer)?void 0:t.peerId,r={info:{message:this.message,type:this.type}};return(null==n?void 0:n.length)&&(r.roles=n),i&&(r.peer_id=i),r}toString(){var e;return`{\n      sender: ${this.sender};\n      recipientPeer: ${this.recipientPeer};\n      recipientRoles: ${null==(e=this.recipientRoles)?void 0:e.map((e=>e.name))};\n      message: ${this.message};\n      time: ${this.time};\n      type: ${this.type};\n    }`}},ni=class{constructor({peerId:e,name:t,isLocal:n,customerUserId:i,metadata:r,role:s,joinedAt:o}){this.customerUserId="",this.metadata="",this.auxiliaryTracks=[],this.name=t,this.peerId=e,this.isLocal=n,this.customerUserId=i,this.metadata=r,this.joinedAt=o,s&&(this.role=s)}updateRole(e){this.role=e}updateName(e){this.name=e}updateMetadata(e){this.metadata=e}toString(){var e;return`{\n      name: ${this.name};\n      role: ${null==(e=this.role)?void 0:e.name};\n      peerId: ${this.peerId};\n      customerUserId: ${this.customerUserId};\n    }`}},ii=class{};ii.makePeerId=()=>_t();var ri,si=class extends ni{constructor(e){super(Dt(xt({},e),{peerId:ii.makePeerId(),isLocal:!0})),this.isLocal=!0,this.auxiliaryTracks=[]}},oi=class extends ni{constructor(e){super(Dt(xt({},e),{isLocal:!1})),this.isLocal=!1,this.auxiliaryTracks=[],this.fromRoomState=!1,this.fromRoomState=!!e.fromRoomState}},ai=e=>e?new Date(e):void 0;function li(e,t=""){if("chrome"===ut.browserDetails.browser&&"NotAllowedError"===e.name&&e.message.includes("denied by system"))return sn.TracksErrors.SystemDeniedPermission(tn.TRACK,t,e.message);if("firefox"===ut.browserDetails.browser&&"NotFoundError"===e.name){let n=sn.TracksErrors.SystemDeniedPermission(tn.TRACK,t,e.message);return n.description=`Capture device is either blocked at Operating System level or not available - ${t}`,n}switch(e.name){case"OverconstrainedError":return sn.TracksErrors.OverConstrained(tn.TRACK,t,e.constraint);case"NotAllowedError":return sn.TracksErrors.CantAccessCaptureDevice(tn.TRACK,t,e.message);case"NotFoundError":return sn.TracksErrors.DeviceNotAvailable(tn.TRACK,t,e.message);case"NotReadableError":return sn.TracksErrors.DeviceInUse(tn.TRACK,t,e.message);case"TypeError":return sn.TracksErrors.NothingToReturn(tn.TRACK,e.message);default:return function(e,t){let n=e.toLowerCase();return n.includes("device not found")?sn.TracksErrors.DeviceNotAvailable(tn.TRACK,t,e):n.includes("permission denied")?sn.TracksErrors.CantAccessCaptureDevice(tn.TRACK,t,e):sn.TracksErrors.GenericTrack(tn.TRACK,e)}(e.message,t)}}function ci(e,t){let n=li(e,t);return n.addNativeError(e),n}function ui(e){return Lt(this,null,(function*(){try{return(yield navigator.mediaDevices.getUserMedia({audio:!!e&&e.toConstraints()})).getAudioTracks()[0]}catch(e){throw ci(e,ri.AUDIO)}}))}function di(e){return Lt(this,null,(function*(){try{return(yield navigator.mediaDevices.getUserMedia({video:!!e&&e.toConstraints()})).getVideoTracks()[0]}catch(e){throw ci(e,ri.VIDEO)}}))}function hi(e){return"canvas"in e||"MediaStreamAudioDestinationNode"===e.label||""===e.label}!function(e){e.UNKNOWN="unknown(video or audio)",e.AUDIO="audio",e.VIDEO="video",e.AV="audio, video",e.SCREEN="screen"}(ri||(ri={}));var pi,fi,mi;!function(e){e.TRANSFORM="TRANSFORM",e.ANALYZE="ANALYZE"}(pi||(pi={})),function(e){e.PLATFORM_NOT_SUPPORTED="PLATFORM_NOT_SUPPORTED",e.DEVICE_NOT_SUPPORTED="DEVICE_NOT_SUPPORTED"}(fi||(fi={})),function(e){e.CUSTOM="CUSTOM",e.LOCAL="LOCAL",e.HMS="HMS"}(mi||(mi={}));var gi=function(){if(Vt&&window){let e=window.location.hostname;return"localhost"===e||"127.0.0.1"===e?mi.LOCAL:e.includes("app.100ms.live")?mi.HMS:mi.CUSTOM}return mi.CUSTOM}(),vi=Mt().version;function yi(e=St.PROD,t){let n=gi!==mi.LOCAL&&e===St.PROD?"prod":"debug";if(Ft)return Si({os:"web_nodejs",os_version:process.version,sdk:"web",sdk_version:vi,env:n,domain:gi,framework:"node",framework_version:process.version,framework_sdk_version:null==t?void 0:t.sdkVersion});let i=Ut.getOS(),r=Ut.getDevice(),s=Ut.getBrowser(),o=bi(`web_${i.name}`),a=i.version||"",l=bi(`${s.name}_${s.version}`),c=l;return r.type&&(c=`${bi(`${r.vendor}_${r.type}`)}/${l}`),Si({os:o,os_version:a,sdk:"web",sdk_version:vi,device_model:c,env:n,domain:gi,framework:null==t?void 0:t.type,framework_version:null==t?void 0:t.version,framework_sdk_version:null==t?void 0:t.sdkVersion})}function bi(e){return e.replace(/ /g,"_")}var _i,wi,Si=(e,t=",")=>Object.keys(e).filter((t=>!!e[t])).map((t=>`${t}:${e[t]}`)).join(t),Ti=class{constructor({name:e,level:t,properties:n,includesPII:i,timestamp:r}){this.metadata={peer:{},userAgent:yi()},this.name=e,this.level=t,this.includesPII=i||!1,this.properties=n||{},this.timestamp=r||(new Date).getTime(),this.event_id=_t(),this.device_id=(()=>{let e,t=new jt("hms-analytics-deviceId"),n=t.get();return n?e=n:(e=_t(),t.set(e)),e})()}toSignalParams(){return{name:this.name,info:Dt(xt({},this.properties),{timestamp:this.timestamp,domain:gi}),timestamp:(new Date).getTime()}}};!function(e){e[e.VERBOSE=0]="VERBOSE",e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR",e[e.OFF=3]="OFF"}(_i||(_i={})),function(e){e[e.VERBOSE=0]="VERBOSE",e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR",e[e.OFF=3]="OFF"}(wi||(wi={}));var Ei=class{static failure(e,t){let n=wi.ERROR,i=xt({plugin_name:e},t.toAnalyticsProperties());return new Ti({name:"mediaPlugin.failed",level:n,properties:i})}static audioPluginFailure(e,t,n){let i=wi.ERROR,r=xt({plugin_name:e,sampleRate:t},n.toAnalyticsProperties());return new Ti({name:"mediaPlugin.failed",level:i,properties:r})}static audioPluginStats({pluginName:e,duration:t,loadTime:n,sampleRate:i}){let r=wi.INFO;return new Ti({name:"mediaPlugin.stats",level:r,properties:{plugin_name:e,duration:t,load_time:n,sampleRate:i}})}static stats({pluginName:e,duration:t,loadTime:n,avgPreProcessingTime:i,avgProcessingTime:r,inputFrameRate:s,pluginFrameRate:o}){let a=wi.INFO;return new Ti({name:"mediaPlugin.stats",level:a,properties:{plugin_name:e,duration:t,load_time:n,avg_preprocessing_time:i,avg_processing_time:r,input_frame_rate:s,plugin_frame_rate:o}})}},ki="AudioPluginsAnalytics",Ci="AudioPluginsManager",Ii=new class{constructor(){this.storage=new jt("hms-device-selection"),this.remember=!1,this.TAG="HMSDeviceStorage"}setDevices(e){this.devices=e}rememberDevices(e){this.remember=e}updateSelection(e,{deviceId:t,groupId:n}){if(!this.devices||!this.remember)return;let i=this.devices[e].find((e=>this.isSame({deviceId:t,groupId:n},e)));if(!i)return void Jt.w(this.TAG,`Could not find device with deviceId: ${t}, groupId: ${n}`);let r=this.storage.get()||{};r[e]=i,this.storage.set(r)}getSelection(){if(this.remember)return this.storage.get()}cleanup(){this.remember=!1,this.devices=void 0}isSame(e,t){return e.deviceId===t.deviceId&&(e.groupId===t.groupId||!e.groupId)}};function Ri(e,t){return function(n){return n in e&&e[n]!==t[n]}}var Pi,Ai,Ni=class extends Un{constructor(e,t,n,i,r=(new Jn).build()){super(e,t,n),this.eventBus=i,this.handleSettingsChange=e=>Lt(this,null,(function*(){let t=this.stream,n=Ri(e,this.settings);n("maxBitrate")&&e.maxBitrate&&(yield t.setMaxBitrate(e.maxBitrate,this)),n("advanced")&&(yield this.nativeTrack.applyConstraints(e.toConstraints()))})),this.handleDeviceChange=(e,t=!1)=>Lt(this,null,(function*(){Ri(e,this.settings)("deviceId")&&(yield this.replaceTrackWith(e),t||Ii.updateSelection("audioInput",{deviceId:e.deviceId,groupId:this.nativeTrack.getSettings().groupId}))})),e.tracks.push(this),this.settings=r,"default"===r.deviceId&&!hi(t)&&(this.settings=this.buildNewSettings({deviceId:t.getSettings().deviceId})),this.pluginsManager=new class{constructor(e,t){this.pluginAddInProgress=!1,this.hmsTrack=e,this.pluginsMap=new Map,this.analytics=new class{constructor(e){this.eventBus=e,this.initTime={},this.addedTimestamps={},this.pluginAdded={},this.pluginSampleRate={}}added(e,t){this.pluginAdded[e]=!0,this.addedTimestamps[e]=Date.now(),this.initTime[e]=0,this.pluginSampleRate[e]=t}removed(e){if(this.pluginAdded[e]){let t={pluginName:e,duration:Math.floor((Date.now()-this.addedTimestamps[e])/1e3),loadTime:this.initTime[e],sampleRate:this.pluginSampleRate[e]};this.eventBus.analytics.publish(Ei.audioPluginStats(t)),this.clean(e)}}failure(e,t){this.pluginAdded[e]&&(this.eventBus.analytics.publish(Ei.audioPluginFailure(e,this.pluginSampleRate[e],t)),this.clean(e))}initWithTime(e,t){return Lt(this,null,(function*(){if(this.initTime[e])return void Jt.i(ki,`Plugin Already loaded ${e}, time it took: ${this.initTime[e]}`);let n;try{n=yield this.timeInMs(t),Jt.i(ki,`Time taken for Plugin ${e} initialization : ${n}`)}catch(t){let n=sn.MediaPluginErrors.InitFailed(tn.AUDIO_PLUGINS,`failed during initialization of plugin${t.message||t}`);throw Jt.e(ki,n),this.failure(e,n),n}n&&(this.initTime[e]=n)}))}timeInMs(e){return Lt(this,null,(function*(){let t=Date.now();return yield e(),Math.floor(Date.now()-t)}))}clean(e){delete this.addedTimestamps[e],delete this.initTime[e],delete this.pluginAdded[e],delete this.pluginSampleRate[e]}}(t),this.createAudioContext()}getPlugins(){return Array.from(this.pluginsMap.keys())}addPlugin(e){return Lt(this,null,(function*(){var t;let n=null==(t=e.getName)?void 0:t.call(e);if(n){if(this.pluginAddInProgress){let e=sn.MediaPluginErrors.AddAlreadyInProgress(tn.AUDIO_PLUGINS,"Add Plugin is already in Progress");throw this.analytics.added(n,this.audioContext.sampleRate),this.analytics.failure(n,e),Jt.w("can't add another plugin when previous add is in progress"),e}this.pluginAddInProgress=!0;try{yield this.addPluginInternal(e)}finally{this.pluginAddInProgress=!1}}else Jt.w("no name provided by the plugin")}))}addPluginInternal(e){return Lt(this,null,(function*(){var t;let n=null==(t=e.getName)?void 0:t.call(e);if(this.pluginsMap.get(n))Jt.w(Ci,`plugin - ${n} already added.`);else{yield this.validateAndThrow(n,e);try{0===this.pluginsMap.size?yield this.initAudioNodes():this.prevAudioNode&&this.prevAudioNode.disconnect(),this.analytics.added(n,this.audioContext.sampleRate),yield this.analytics.initWithTime(n,(()=>Lt(this,null,(function*(){return e.init()})))),this.pluginsMap.set(n,e),yield this.processPlugin(e),yield this.connectToDestination()}catch(e){throw Jt.e(Ci,"failed to add plugin",e),e}}}))}validatePlugin(e){return e.checkSupport(this.audioContext)}validateAndThrow(e,t){return Lt(this,null,(function*(){let n=this.validatePlugin(t);if(n.isSupported)Jt.i(Ci,`plugin is supported,- ${t.getName()}`);else{if(this.analytics.added(e,this.audioContext.sampleRate),n.errType===fi.PLATFORM_NOT_SUPPORTED){let t=sn.MediaPluginErrors.PlatformNotSupported(tn.AUDIO_PLUGINS,"platform not supported, see docs");throw this.analytics.failure(e,t),yield this.cleanup(),t}if(n.errType===fi.DEVICE_NOT_SUPPORTED){let t=sn.MediaPluginErrors.DeviceNotSupported(tn.AUDIO_PLUGINS,"audio device not supported, see docs");throw this.analytics.failure(e,t),yield this.cleanup(),t}}}))}removePlugin(e){return Lt(this,null,(function*(){yield this.removePluginInternal(e),0===this.pluginsMap.size?(yield this.cleanup(),Jt.i(Ci,"No plugins left, stopping plugins loop"),yield this.hmsTrack.setProcessedTrack(void 0)):yield this.reprocessPlugins()}))}cleanup(){return Lt(this,null,(function*(){var e,t,n;for(let e of this.pluginsMap.values())yield this.removePluginInternal(e);yield this.hmsTrack.setProcessedTrack(void 0),null==(e=this.sourceNode)||e.disconnect(),null==(t=this.prevAudioNode)||t.disconnect(),null==(n=this.outputTrack)||n.stop(),this.sourceNode=void 0,this.destinationNode=void 0,this.prevAudioNode=void 0,this.outputTrack=void 0}))}closeContext(){return Lt(this,null,(function*(){var e;null==(e=this.audioContext)||e.close(),this.audioContext=void 0}))}reprocessPlugins(){return Lt(this,null,(function*(){if(0===this.pluginsMap.size||!this.sourceNode)return;let e=Array.from(this.pluginsMap.values());yield this.cleanup(),yield this.initAudioNodes();for(let t of e)yield this.addPlugin(t)}))}initAudioNodes(){return Lt(this,null,(function*(){if(this.audioContext){if(!this.sourceNode){let e=new MediaStream([this.hmsTrack.nativeTrack]);this.sourceNode=this.audioContext.createMediaStreamSource(e)}if(!this.destinationNode){this.destinationNode=this.audioContext.createMediaStreamDestination(),this.outputTrack=this.destinationNode.stream.getAudioTracks()[0];try{yield this.hmsTrack.setProcessedTrack(this.outputTrack)}catch(e){throw Jt.e(Ci,"error in setting processed track",e),e}}}}))}processPlugin(e){return Lt(this,null,(function*(){try{let t=yield e.processAudioTrack(this.audioContext,this.prevAudioNode||this.sourceNode);this.prevAudioNode&&this.prevAudioNode.connect(t),this.prevAudioNode=t}catch(t){let n=e.getName();Jt.e(Ci,`error in processing plugin ${n}`,t),yield this.removePluginInternal(e)}}))}connectToDestination(){return Lt(this,null,(function*(){try{this.prevAudioNode&&this.destinationNode&&this.prevAudioNode.context===this.destinationNode.context&&this.prevAudioNode.connect(this.destinationNode)}catch(e){Jt.e(Ci,"error in connecting to destination node",e)}}))}removePluginInternal(e){return Lt(this,null,(function*(){var t;let n=null==(t=e.getName)?void 0:t.call(e);this.pluginsMap.get(n)?(Jt.i(Ci,`removing plugin ${n}`),this.pluginsMap.delete(n),e.stop(),this.analytics.removed(n)):Jt.w(Ci,`plugin - ${n} not found to remove.`)}))}createAudioContext(){this.audioContext||(-1!==navigator.userAgent.indexOf("Firefox")?this.audioContext=new AudioContext:this.audioContext=new AudioContext({sampleRate:48e3}))}}(this,i),this.setFirstTrackId(t.id)}replaceTrackWith(e){return Lt(this,null,(function*(){let t=this.nativeTrack,n=this.enabled,i=Boolean(this.audioLevelMonitor);null==t||t.stop();let r=yield ui(e);r.enabled=n;let s=this.stream;yield s.replaceSenderTrack(t,this.processedTrack||r),yield s.replaceStreamTrack(t,r),this.nativeTrack=r,i&&this.initAudioLevelMonitor();try{yield this.pluginsManager.reprocessPlugins()}catch(e){this.eventBus.audioPluginFailed.publish(e)}}))}setEnabled(e){var t=e=>super[e];return Lt(this,null,(function*(){e!==this.enabled&&(e&&hi(this.nativeTrack)&&(yield this.replaceTrackWith(this.settings)),yield t("setEnabled").call(this,e),e&&(this.settings=this.buildNewSettings({deviceId:this.nativeTrack.getSettings().deviceId})),this.eventBus.localAudioEnabled.publish({enabled:e,track:this}),this.stream.trackUpdate(this))}))}isPublishedTrackId(e){return this.publishedTrackId===e}setSettings(e,t=!1){return Lt(this,null,(function*(){let n=this.buildNewSettings(e);yield this.handleDeviceChange(n,t),hi(this.nativeTrack)||(yield this.handleSettingsChange(n)),this.settings=n}))}getPlugins(){return this.pluginsManager.getPlugins()}addPlugin(e){return Lt(this,null,(function*(){return this.pluginsManager.addPlugin(e)}))}removePlugin(e){return Lt(this,null,(function*(){return this.pluginsManager.removePlugin(e)}))}validatePlugin(e){return this.pluginsManager.validatePlugin(e)}setProcessedTrack(e){return Lt(this,null,(function*(){if(!e)return this.processedTrack&&(yield this.stream.replaceSenderTrack(this.processedTrack,this.nativeTrack)),void(this.processedTrack=void 0);e!==this.processedTrack&&(this.processedTrack?yield this.stream.replaceSenderTrack(this.processedTrack,e):yield this.stream.replaceSenderTrack(this.nativeTrack,e),this.processedTrack=e)}))}initAudioLevelMonitor(){this.audioLevelMonitor&&this.destroyAudioLevelMonitor(),Jt.d("HMSLocalAudioTrack","Monitor Audio Level for",this,this.getMediaTrackSettings().deviceId),this.audioLevelMonitor=new class{constructor(e,t,n){this.track=e,this.audioLevelEvent=t,this.silenceEvent=n,this.TAG="[TrackAudioLevelMonitor]",this.audioLevel=0,this.isMonitored=!1,this.interval=100,this.historyInterval=700,this.history=new Wn(this.historyInterval/this.interval),this.detectSilence=()=>Lt(this,null,(function*(){let e=0;for(;this.isMonitored;){if(this.track.enabled){if(!this.isSilentThisInstant())break;if(e++,e>10){this.silenceEvent.publish({track:this.track});break}}yield Hn(30)}}));try{let e=new MediaStream([this.track.nativeTrack]);this.analyserNode=this.createAnalyserNodeForStream(e)}catch(e){Jt.w(this.TAG,"Unable to initialize AudioContext",e)}}start(){this.stop(),this.isMonitored=!0,Jt.d(this.TAG,"Starting track Monitor",`${this.track}`),this.loop().then((()=>Jt.d(this.TAG,"Stopping track Monitor",`${this.track}`)))}stop(){this.analyserNode?(this.sendAudioLevel(0),this.isMonitored=!1):Jt.d(this.TAG,"AudioContext not initialized")}loop(){return Lt(this,null,(function*(){for(;this.isMonitored;)this.sendAudioLevel(this.getMaxAudioLevelOverPeriod()),yield Hn(this.interval)}))}sendAudioLevel(e=0){if(e=e>35?e:0,Math.abs(this.audioLevel-e)>5){this.audioLevel=e;let t={track:this.track,audioLevel:this.audioLevel};this.audioLevelEvent.publish(t)}}getMaxAudioLevelOverPeriod(){if(!this.analyserNode)return void Jt.d(this.TAG,"AudioContext not initialized");let e=this.calculateAudioLevel();return void 0!==e&&this.history.enqueue(e),this.history.aggregate((e=>Math.max(...e)))}calculateAudioLevel(){if(!this.analyserNode)return void Jt.d(this.TAG,"AudioContext not initialized");let e=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(e);let t=.009,n=t;for(let t of e)n=Math.max(n,(t-128)/128);let i=(Math.log(t)-Math.log(n))/Math.log(t);return Math.ceil(Math.min(Math.max(100*i,0),100))}isSilentThisInstant(){if(!this.analyserNode)return void Jt.d(this.TAG,"AudioContext not initialized");let e=new Uint8Array(this.analyserNode.fftSize);return this.analyserNode.getByteTimeDomainData(e),!e.some((e=>128!==e&&0!==e))}createAnalyserNodeForStream(e){let t=new AudioContext,n=t.createAnalyser();return t.createMediaStreamSource(e).connect(n),n}}(this,this.eventBus.trackAudioLevelUpdate,this.eventBus.localAudioSilence),this.audioLevelMonitor.start(),this.audioLevelMonitor.detectSilence()}destroyAudioLevelMonitor(){var e;null==(e=this.audioLevelMonitor)||e.stop(),this.audioLevelMonitor=void 0}cleanup(){var e=e=>super[e];return Lt(this,null,(function*(){var t;e("cleanup").call(this),yield this.pluginsManager.cleanup(),yield this.pluginsManager.closeContext(),null==(t=this.processedTrack)||t.stop(),this.destroyAudioLevelMonitor()}))}getTrackIDBeingSent(){return this.processedTrack?this.processedTrack.id:this.nativeTrack.id}getTrackBeingSent(){return this.processedTrack||this.nativeTrack}buildNewSettings(e){let{volume:t,codec:n,maxBitrate:i,deviceId:r,advanced:s}=xt(xt({},this.settings),e);return new Qn(t,n,i,r,s)}};!function(e){e.TRANSFORM="TRANSFORM",e.ANALYZE="ANALYZE"}(Pi||(Pi={})),function(e){e["2D"]="2d",e.WEBGL="webgl",e.WEBGL2="webgl2"}(Ai||(Ai={}));var xi=class{constructor(){this.total=0,this.count=0}add(e){this.count++,this.total+=e}getAvg(){return Math.floor(this.total/this.count)}reset(){this.total=0,this.count=0}},Di="VideoPluginsAnalytics",Oi=320,Li=240,Mi="VideoPluginsManager",ji="HMSLocalStream",Ui=class extends Dn{constructor(){super(...arguments),this.connection=null}setConnection(e){this.connection=e}addTransceiver(e,t){let n=[];if(e instanceof Ki)if(t.length>0)Jt.v(ji,"Simulcast enabled with layers",t),n.push(...t);else{let t={active:this.nativeStream.active};e.settings.maxBitrate&&!Ft&&(t.maxBitrate=e.settings.maxBitrate),n.push(t)}let i=this.connection.addTransceiver(e.getTrackBeingSent(),{streams:[this.nativeStream],direction:"sendonly",sendEncodings:n});return this.setPreferredCodec(i,e.nativeTrack.kind),i}setMaxBitrate(e,t){return Lt(this,null,(function*(){var n;yield null==(n=this.connection)?void 0:n.setMaxBitrate(e,t)}))}setPreferredCodec(e,t){}replaceTrack(e,t){return Lt(this,null,(function*(){yield this.replaceSenderTrack(e,t),e.stop(),this.replaceStreamTrack(e,t)}))}replaceStreamTrack(e,t){this.nativeStream.addTrack(t),this.nativeStream.removeTrack(e)}replaceSenderTrack(e,t){return Lt(this,null,(function*(){var n;let i=null==(n=this.connection)?void 0:n.getSenders().find((t=>t.track&&t.track.id===e.id));void 0!==i?yield i.replaceTrack(t):Jt.w(ji,`No sender found for trackId=${e.id}`)}))}removeSender(e){let t=0;this.connection.getSenders().forEach((n=>{var i,r;if((null==(i=n.track)?void 0:i.id)===e.trackId||(null==(r=n.track)?void 0:r.id)===e.getTrackIDBeingSent()){this.connection.removeTrack(n),t+=1;let i=this.tracks.indexOf(e);-1!==i?this.tracks.splice(i,1):Jt.e(ji,`Cannot find ${e.trackId} in locally stored tracks`)}})),1!==t&&Jt.e(ji,`Removed ${t} sender's, expected to remove 1`)}trackUpdate(e){var t;null==(t=this.connection)||t.trackUpdate(e)}},Fi=class{static connect(e,t,n=new Date,i=new Date,r){let s=this.eventNameFor("connect",void 0===e),o=e?wi.ERROR:wi.INFO,a=this.getPropertiesWithError(Dt(xt({},t),{[this.KEY_REQUESTED_AT]:null==n?void 0:n.getTime(),[this.KEY_RESPONDED_AT]:null==i?void 0:i.getTime(),endpoint:r}),e);return new Ti({name:s,level:o,properties:a})}static disconnect(e,t){let n=e?wi.ERROR:wi.INFO,i=this.getPropertiesWithError(t,e);return new Ti({name:"disconnected",level:n,properties:i})}static preview(e){var t=e,{error:n}=t,i=Ot(t,["error"]);let r=this.eventNameFor("preview",void 0===n),s=n?wi.ERROR:wi.INFO,o=this.getPropertiesWithError(i,n);return new Ti({name:r,level:s,properties:o})}static join(e){var t=e,{error:n}=t,i=Ot(t,["error"]);let r=this.eventNameFor("join",void 0===n),s=n?wi.ERROR:wi.INFO,o=this.getPropertiesWithError(Dt(xt({},i),{is_preview_called:!!i.is_preview_called}),n);return new Ti({name:r,level:s,properties:o})}static publish({devices:e,settings:t,error:n}){let i=this.eventNameFor("publish",void 0===n),r=n?wi.ERROR:wi.INFO,s=this.getPropertiesWithError({devices:e,audio:null==t?void 0:t.audio,video:null==t?void 0:t.video},n);return new Ti({name:i,level:r,properties:s})}static subscribeFail(e){let t=this.eventNameFor("subscribe",!1),n=wi.ERROR,i=this.getErrorProperties(e);return new Ti({name:t,level:n,properties:i})}static leave(){return new Ti({name:"leave",level:wi.INFO})}static autoplayError(){return new Ti({name:"autoplayError",level:wi.ERROR})}static deviceChange({selection:e,type:t,devices:n,error:i}){let r=this.eventNameFor(i?"publish":`device.${t}`,void 0===i),s=i?wi.ERROR:wi.INFO,o=this.getPropertiesWithError({selection:e,devices:n},i);return new Ti({name:r,level:s,properties:o})}static performance(e){let t=wi.INFO,n=e.toAnalyticsProperties();return new Ti({name:"perf.stats",level:t,properties:n})}static rtcStats(e){let t=wi.INFO,n=e.toAnalyticsProperties();return new Ti({name:"rtc.stats",level:t,properties:n})}static degradationStats(e,t){let n=wi.INFO,i={degradedAt:e.degradedAt,trackId:e.trackId};if(!t&&e.degradedAt instanceof Date){let t=new Date,n=t.valueOf()-e.degradedAt.valueOf();i=Dt(xt({},i),{duration:n,restoredAt:t})}return new Ti({name:"video.degradation.stats",level:n,properties:i})}static audioDetectionFail(e,t){let n=this.getPropertiesWithError({device:t},e),i=wi.ERROR;return new Ti({name:"audiopresence.failed",level:i,properties:n})}static previewNetworkQuality(e){return new Ti({name:"perf.networkquality.preview",level:e.error?wi.ERROR:wi.INFO,properties:e})}static HLSError(e,t=!0){return new Ti({name:`hls.${t?"start":"stop"}.failed`,level:wi.ERROR,properties:this.getPropertiesWithError(e)})}static RTMPError(e,t=!0){return new Ti({name:`rtmp.${t?"start":"stop"}.failed`,level:wi.ERROR,properties:this.getPropertiesWithError(e)})}static eventNameFor(e,t){return`${e}.${t?"success":"failed"}`}static getPropertiesWithError(e,t){let n=this.getErrorProperties(t);return e=xt(xt({},n),e)}static getErrorProperties(e){return e?e instanceof rn?e.toAnalyticsProperties():{error_name:e.name,error_message:e.message,error_description:e.cause}:{}}};Fi.KEY_REQUESTED_AT="requested_at",Fi.KEY_RESPONDED_AT="responded_at";var Vi,Bi={audioContext:null,getAudioContext(){return this.audioContext||(this.audioContext=new AudioContext),this.audioContext},resumeContext(){this.getAudioContext().resume().catch((e=>{Jt.e("AudioContext",e)}))}};!function(e){e.INIT="init_response_time",e.WEBSOCKET_CONNECT="ws_connect_time",e.ON_POLICY_CHANGE="on_policy_change_time",e.LOCAL_TRACKS="local_tracks_time",e.JOIN="join_time",e.PREVIEW="preview_time"}(Vi||(Vi={}));var zi,$i="default",qi="default",Gi=class{constructor(e,t,n,i,r){this.store=e,this.observer=t,this.deviceManager=n,this.eventBus=i,this.analyticsTimer=r,this.TAG="[LocalTrackManager]"}getTracksToPublish(e){return Lt(this,null,(function*(){let t=this.getTrackSettings(e);if(!t)return[];let n=!!t.audio,i=!!t.video,r=[],{videoTrack:s,audioTrack:o}=yield this.updateCurrentLocalTrackSettings(t),a=(null==s?void 0:s.stream)||(null==o?void 0:o.stream),l=Boolean(s&&this.store.getTrackById(s.trackId)),c=Boolean(o&&this.store.getTrackById(o.trackId));if(l&&c)return[];let u={audio:n&&!o&&(!e.isAudioMuted||"empty"),video:i&&!s&&(!e.isVideoMuted||"empty")};this.analyticsTimer.start(Vi.LOCAL_TRACKS);try{Jt.d(this.TAG,"Init Local Tracks",{fetchTrackOptions:u}),r=yield this.getLocalTracks(u,t,a)}catch(e){r=yield this.retryGetLocalTracks(e,t,u,a)}return this.analyticsTimer.end(Vi.LOCAL_TRACKS),s&&i&&!l&&r.push(s),o&&n&&!c&&r.push(o),r}))}getLocalTracks(){return Lt(this,arguments,(function*(e={audio:!0,video:!0},t,n){try{let i=yield this.getNativeLocalTracks(e,t);return this.createHMSLocalTracks(i,t,n)}catch(e){throw this.eventBus.analytics.publish(Fi.publish({devices:this.deviceManager.getDevices(),error:e,settings:t})),e}}))}getNativeLocalTracks(){return Lt(this,arguments,(function*(e={audio:!1,video:!1},t){let n=new ei(!0===e.video?t.video:null,!0===e.audio?t.audio:null,t.simulcast),i=[];return(n.audio||n.video)&&i.push(...yield this.getAVTracks(n)),i.push(...this.getEmptyTracks(e)),i}))}getLocalScreen(e,t){return Lt(this,null,(function*(){let n,i={video:e.toConstraints()};if(t){let e=t.toConstraints();delete e.advanced,i.audio=Dt(xt({},e),{autoGainControl:!1,noiseSuppression:!1,googAutoGainControl:!1,echoCancellation:!1})}try{n=yield navigator.mediaDevices.getDisplayMedia(i)}catch(e){throw ci(e,ri.SCREEN)}let r=[],s=new Ui(n),o=n.getVideoTracks()[0],a=new Ki(s,o,"screen",this.eventBus,e);r.push(a);let l=n.getAudioTracks()[0];if(l){let e=new Ni(s,l,"screen",this.eventBus,t);r.push(e)}return Jt.v(this.TAG,"getLocalScreen",r),r}))}requestPermissions(){return Lt(this,null,(function*(){try{(yield navigator.mediaDevices.getUserMedia({audio:!0,video:!0})).getTracks().forEach((e=>e.stop()))}catch(e){Jt.e(this.TAG,e)}}))}static getEmptyVideoTrack(e){var t,n,i;let r=(null==(t=null==e?void 0:e.getSettings())?void 0:t.width)||320,s=(null==(n=null==e?void 0:e.getSettings())?void 0:n.height)||240;zi||(null==(i=(zi=Object.assign(document.createElement("canvas"),{width:r,height:s})).getContext("2d"))||i.fillRect(0,0,r,s));let o=zi.captureStream(10).getVideoTracks()[0],a=setInterval((()=>{if("ended"===o.readyState)return void clearInterval(a);let e=zi.getContext("2d");if(e){let t=0===e.getImageData(0,0,1,1).data[0]?1:0;e.fillStyle=`rgb(${t}, 0, 0)`,e.fillRect(0,0,1,1)}}),100);return o.onended=()=>{clearInterval(a)},o.enabled=!1,o}static getEmptyAudioTrack(){let e=Bi.getAudioContext(),t=e.createOscillator(),n=e.createMediaStreamDestination();t.connect(n),t.start();let i=n.stream.getAudioTracks()[0];return i.enabled=!1,i}getAVTracks(e){return Lt(this,null,(function*(){try{let t=yield navigator.mediaDevices.getUserMedia({audio:!!e.audio&&e.audio.toConstraints(),video:!!e.video&&e.video.toConstraints()});return t.getVideoTracks().concat(t.getAudioTracks())}catch(t){yield this.deviceManager.init();let n=!(this.deviceManager.hasWebcamPermission||!e.video),i=!(this.deviceManager.hasMicrophonePermission||!e.audio);throw ci(t,this.getErrorType(n,i))}}))}getTrackSettings(e){let t=this.getAudioSettings(e),n=this.getVideoSettings(e);if(!t&&!n)return null;let i=this.getScreenSettings();return(new Xn).video(n).audio(t).screen(i).build()}retryGetLocalTracks(e,t,n,i){return Lt(this,null,(function*(){if(!(e instanceof rn&&e.action===tn.TRACK))return Jt.w(this.TAG,"Fetch AV Tracks failed - unknown exception",e),this.observer.onFailure(e),[];{this.observer.onFailure(e);let r=e.code===nn.TracksErrors.OVER_CONSTRAINED,s=e.message.includes("audio"),o=e.message.includes("video");if(r){let r=(new Xn).video(new Zn).audio(new Qn).build();Jt.w(this.TAG,"Fetch AV Tracks failed with overconstrained error",{fetchTrackOptions:n},{error:e});try{return yield this.getLocalTracks(n,r,i)}catch(e){let r=e instanceof rn?e.nativeError:e,s=e;if("OverconstrainedError"===(null==r?void 0:r.name)){let e=sn.TracksErrors.GenericTrack(tn.TRACK,"Overconstrained error after dropping all constraints");e.addNativeError(r),s=e}return yield this.retryGetLocalTracks(s,t,n,i)}}n.audio=s?"empty":n.audio,n.video=o?"empty":n.video,Jt.w(this.TAG,"Fetch AV Tracks failed",{fetchTrackOptions:n},e);try{return yield this.getLocalTracks(n,t,i)}catch(e){return Jt.w(this.TAG,"Fetch empty tacks failed",e),n.audio=n.audio&&"empty",n.video=n.video&&"empty",this.observer.onFailure(e),yield this.getLocalTracks(n,t,i)}}}))}getErrorType(e,t){return e&&t?ri.AV:e?ri.VIDEO:t?ri.AUDIO:ri.UNKNOWN}getEmptyTracks(e){let t=[];return"empty"===e.audio&&t.push(Gi.getEmptyAudioTrack()),"empty"===e.video&&t.push(Gi.getEmptyVideoTrack()),t}updateCurrentLocalTrackSettings(e){return Lt(this,null,(function*(){let t=this.store.getLocalPeerTracks(),n=t.find((e=>e.type===un.VIDEO&&"regular"===e.source)),i=t.find((e=>e.type===un.AUDIO&&"regular"===e.source)),r=t.find((e=>e.type===un.VIDEO&&"screen"===e.source));return(null==e?void 0:e.video)&&(yield null==n?void 0:n.setSettings(e.video)),(null==e?void 0:e.audio)&&(yield null==i?void 0:i.setSettings(e.audio)),(null==e?void 0:e.screen)&&(yield null==r?void 0:r.setSettings(e.screen)),{videoTrack:n,audioTrack:i}}))}getAudioSettings(e){var t;let n=this.store.getPublishParams();if(!n||!(null==(t=n.allowed)?void 0:t.includes("audio")))return null;let i=this.store.getLocalPeer(),r=null==i?void 0:i.audioTrack,s=(null==r?void 0:r.settings.deviceId)||e.audioInputDeviceId;return(new Jn).codec(n.audio.codec).maxBitrate(n.audio.bitRate).deviceId(s||$i).build()}getVideoSettings(e){var t;let n=this.store.getPublishParams();if(!n||!(null==(t=n.allowed)?void 0:t.includes("video")))return null;let i=this.store.getLocalPeer(),r=null==i?void 0:i.videoTrack,s=(null==r?void 0:r.settings.deviceId)||e.videoDeviceId,o=n.video,{width:a=o.width,height:l=o.height}=this.store.getSimulcastDimensions("regular")||{};return(new Yn).codec(o.codec).maxBitrate(o.bitRate).maxFramerate(o.frameRate).setWidth(a).setHeight(l).deviceId(s||qi).build()}getScreenSettings(){var e;let t=this.store.getPublishParams();if(!t||!(null==(e=t.allowed)?void 0:e.includes("screen")))return null;let n=t.screen,{width:i=n.width,height:r=n.height}=this.store.getSimulcastDimensions("screen")||{};return(new Yn).maxBitrate(n.bitRate,!1).codec(n.codec).maxFramerate(n.frameRate).setWidth(i).setHeight(r).build()}createHMSLocalTracks(e,t,n){let i=e.find((e=>"video"===e.kind)),r=e.find((e=>"audio"===e.kind));n?e.forEach((e=>null==n?void 0:n.nativeStream.addTrack(e))):n=new Ui(new MediaStream(e));let s=[];if(r&&(null==t?void 0:t.audio)){let e=new Ni(n,r,"regular",this.eventBus,t.audio);s.push(e)}if(i&&(null==t?void 0:t.video)){let e=new Ki(n,i,"regular",this.eventBus,t.video);s.push(e)}return s}};function Wi(e,t){return function(n){return n in e&&e[n]!==t[n]}}var Hi,Ki=class extends Vn{constructor(e,t,n,i,r=(new Yn).build()){super(e,t,n),this.eventBus=i,this.buildNewSettings=e=>{let{width:t,height:n,codec:i,maxFramerate:r,maxBitrate:s,deviceId:o,advanced:a}=xt(xt({},this.settings),e);return new Zn(t,n,i,r,o,a,s)},this.handleSettingsChange=e=>Lt(this,null,(function*(){let t=this.stream,n=Wi(e,this.settings);n("maxBitrate")&&e.maxBitrate&&(yield t.setMaxBitrate(e.maxBitrate,this)),(n("width")||n("height")||n("advanced"))&&(yield this.nativeTrack.applyConstraints(e.toConstraints()))})),this.handleDeviceChange=(e,t=!1)=>Lt(this,null,(function*(){if(Wi(e,this.settings)("deviceId")&&"regular"===this.source){if(this.enabled){let t=yield this.replaceTrackWith(e);yield this.replaceSender(t,this.enabled),this.nativeTrack=t}t||Ii.updateSelection("videoInput",{deviceId:e.deviceId,groupId:this.nativeTrack.getSettings().groupId})}})),e.tracks.push(this),this.settings=r,"default"===r.deviceId&&t.enabled&&(this.settings=this.buildNewSettings({deviceId:t.getSettings().deviceId})),this.pluginsManager=new class{constructor(e,t){this.pluginsLoopRunning=!1,this.pluginsLoopState="paused",this.pluginAddInProgress=!1,this.hmsTrack=e,this.pluginsMap=new Map,this.pluginNumFramesToSkip={},this.pluginNumFramesSkipped={},this.analytics=new class{constructor(e){this.eventBus=e,this.initTime={},this.preProcessingAvgs=new xi,this.addedTimestamps={},this.processingAvgs={},this.pluginAdded={},this.pluginInputFrameRate={},this.pluginFrameRate={}}added(e,t,n){this.pluginAdded[e]=!0,this.addedTimestamps[e]=Date.now(),this.initTime[e]=0,this.processingAvgs[e]=new xi,this.pluginInputFrameRate[e]=t,this.pluginFrameRate[e]=n||t}removed(e){var t;if(this.pluginAdded[e]){let n={pluginName:e,duration:Math.floor((Date.now()-this.addedTimestamps[e])/1e3),loadTime:this.initTime[e],avgPreProcessingTime:this.preProcessingAvgs.getAvg(),avgProcessingTime:null==(t=this.processingAvgs[e])?void 0:t.getAvg(),inputFrameRate:this.pluginInputFrameRate[e],pluginFrameRate:this.pluginFrameRate[e]};this.eventBus.analytics.publish(Ei.stats(n)),this.clean(e)}}failure(e,t){this.pluginAdded[e]&&(this.eventBus.analytics.publish(Ei.failure(e,t)),this.clean(e))}initWithTime(e,t){return Lt(this,null,(function*(){if(this.initTime[e])return void Jt.i(Di,`Plugin Already loaded ${e}, time it took: ${this.initTime[e]}`);let n;try{n=yield this.timeInMs(t),Jt.i(Di,`Time taken for Plugin ${e} initialization : ${n}`)}catch(t){let n=sn.MediaPluginErrors.InitFailed(tn.VIDEO_PLUGINS,`failed during initialization of plugin${t.message||t}`);throw Jt.e(Di,n),this.failure(e,n),n}n&&(this.initTime[e]=n)}))}preProcessWithTime(e){return Lt(this,null,(function*(){let t=yield this.timeInMs(e);this.preProcessingAvgs.add(t)}))}processWithTime(e,t){return Lt(this,null,(function*(){var n;let i;try{i=yield this.timeInMs(t)}catch(t){let n=sn.MediaPluginErrors.ProcessingFailed(tn.VIDEO_PLUGINS,`Failed during processing of plugin${t.message||t}`);throw Jt.e(Di,n),this.failure(e,n),n}i&&(null==(n=this.processingAvgs[e])||n.add(i))}))}timeInMs(e){return Lt(this,null,(function*(){let t=Date.now();return yield e(),Math.floor(Date.now()-t)}))}clean(e){delete this.addedTimestamps[e],delete this.initTime[e],delete this.processingAvgs[e],delete this.pluginAdded[e],delete this.pluginInputFrameRate[e],delete this.pluginFrameRate[e]}}(t),this.canvases=new Array}getPlugins(){return Array.from(this.pluginsMap.keys())}addPlugin(e,t){return Lt(this,null,(function*(){var n;if(this.pluginAddInProgress){let t=null==(n=e.getName)?void 0:n.call(e);if(!t||""===t)return void Jt.w("no name provided by the plugin");let i=sn.MediaPluginErrors.AddAlreadyInProgress(tn.VIDEO_PLUGINS,"Add Plugin is already in Progress");throw this.analytics.failure(t,i),Jt.w("can't add another plugin when previous add is in progress"),i}this.pluginAddInProgress=!0;try{yield this.addPluginInternal(e,t)}finally{this.pluginAddInProgress=!1}}))}addPluginInternal(e,t){return Lt(this,null,(function*(){var n,i;let r=null==(n=e.getName)?void 0:n.call(e);if(!r||""===r)return void Jt.w("no name provided by the plugin");if(this.pluginsMap.has(r))return void Jt.w(Mi,`plugin - ${e.getName()} already added.`);let s=this.hmsTrack.getMediaTrackSettings().frameRate||24,o=0;t&&t>0?(Jt.i(Mi,`adding plugin ${e.getName()} with framerate ${t}`),t<s&&(o=Math.ceil(s/t)-1),this.analytics.added(r,s,t)):(Jt.i(Mi,`adding plugin ${e.getName()}`),this.analytics.added(r,s)),Jt.i(Mi,"numFrames to skip processing",o),this.pluginNumFramesToSkip[r]=o,this.pluginNumFramesSkipped[r]=o,this.validateAndThrow(r,e);try{if(yield this.analytics.initWithTime(r,(()=>Lt(this,null,(function*(){return yield e.init()})))),this.pluginsMap.set(r,e),this.pluginsMap.size+1>this.canvases.length)for(let e=this.canvases.length;e<=this.pluginsMap.size;e++)this.canvases[e]=document.createElement("canvas");yield this.startPluginsLoop(null==(i=e.getContextType)?void 0:i.call(e))}catch(t){throw Jt.e(Mi,"failed to add plugin",t),yield this.removePlugin(e),t}}))}validatePlugin(e){return e.checkSupport()}validateAndThrow(e,t){let n=this.validatePlugin(t);if(n.isSupported)Jt.i(Mi,`plugin is supported,- ${t.getName()}`);else{let t;switch(n.errType){case fi.PLATFORM_NOT_SUPPORTED:throw t=sn.MediaPluginErrors.PlatformNotSupported(tn.VIDEO_PLUGINS,"platform not supported, see docs"),this.analytics.failure(e,t),t;case fi.DEVICE_NOT_SUPPORTED:throw t=sn.MediaPluginErrors.DeviceNotSupported(tn.VIDEO_PLUGINS,"video device not supported, see docs"),this.analytics.failure(e,t),t}}}removePlugin(e){return Lt(this,null,(function*(){let t=e.getName();this.pluginsMap.get(t)?(Jt.i(Mi,`removing plugin ${t}`),this.removePluginEntry(t),0===this.pluginsMap.size&&(Jt.i(Mi,"No plugins left, stopping plugins loop"),yield this.stopPluginsLoop()),e.stop(),this.analytics.removed(t)):Jt.w(Mi,`plugin - ${t} not found to remove.`)}))}removePluginEntry(e){this.pluginsMap.delete(e),this.pluginNumFramesToSkip[e]&&delete this.pluginNumFramesToSkip[e],this.pluginNumFramesSkipped[e]&&delete this.pluginNumFramesSkipped[e]}waitForRestart(){return Lt(this,null,(function*(){if(this.pluginsLoopRunning&&"running"!==this.pluginsLoopState)for(;"paused"===this.pluginsLoopState;)yield Hn(100)}))}cleanup(){return Lt(this,null,(function*(){var e;for(let e of this.pluginsMap.values())yield this.removePlugin(e);null==(e=this.outputTrack)||e.stop()}))}initElementsAndStream(e){this.inputCanvas||(this.inputCanvas=document.createElement("canvas")),this.outputCanvas=document.createElement("canvas"),this.inputVideo||(this.inputVideo=document.createElement("video")),this.inputCanvas.getContext("2d"),this.outputCanvas.getContext(e||Ai["2D"]);let t=this.outputCanvas.captureStream();this.outputTrack=t.getVideoTracks()[0]}startPluginsLoop(e){return Lt(this,null,(function*(){if(!this.pluginsLoopRunning){this.initElementsAndStream(e),this.pluginsLoopRunning=!0;try{yield this.hmsTrack.setProcessedTrack(this.outputTrack)}catch(e){throw this.pluginsLoopRunning=!1,Jt.e(Mi,"error in setting processed track",e),e}this.pluginsLoop().then((()=>{Jt.d(Mi,"processLoop stopped")}))}}))}stopPluginsLoop(){return Lt(this,null,(function*(){var e;this.pluginsLoopRunning=!1,yield this.hmsTrack.setProcessedTrack(void 0),this.resetCanvases(),null==(e=this.outputTrack)||e.stop(),this.inputVideo&&(this.inputVideo.srcObject=null,this.inputVideo=void 0)}))}pluginsLoop(){return Lt(this,null,(function*(){for(;this.pluginsLoopRunning;){let e=this.hmsTrack.getMediaTrackSettings().frameRate||24,t=Math.floor(1e3/e);if(!this.hmsTrack.enabled||"ended"===this.hmsTrack.nativeTrack.readyState){"running"===this.pluginsLoopState&&this.resetCanvases(),this.pluginsLoopState="paused",yield Hn(t);continue}let n=0;try{yield this.analytics.preProcessWithTime((()=>Lt(this,null,(function*(){return yield this.doPreProcessing()}))));let e=Date.now();yield this.processFramesThroughPlugins(),n=Math.floor(Date.now()-e),n>t&&(n=t)}catch(e){Jt.e(Mi,"error in plugins loop",e)}this.pluginsLoopState="running",yield Hn(t-n)}}))}doPreProcessing(){return Lt(this,null,(function*(){yield this.addTrackToVideo(),yield this.updateInputCanvas()}))}processFramesThroughPlugins(){return Lt(this,null,(function*(){this.canvases[0]=this.inputCanvas;let e=0;for(let t of this.pluginsMap.values()){let n=t.getName();if(t){try{let i=this.checkIfSkipRequired(n);if(t.getPluginType()===Pi.TRANSFORM){let r=(e,r)=>Lt(this,null,(function*(){try{yield t.processVideoFrame(e,r,i)}catch(e){Jt.e(Mi,`error in processing plugin ${n}`,e)}}));if(i)e===this.pluginsMap.size-1?yield r(this.canvases[e],this.outputCanvas):yield r(this.canvases[e],this.canvases[e+1]);else{let t=this.canvases[e],i=this.canvases[e+1];e===this.pluginsMap.size-1?yield this.analytics.processWithTime(n,(()=>Lt(this,null,(function*(){return r(t,this.outputCanvas)})))):yield this.analytics.processWithTime(n,(()=>Lt(this,null,(function*(){return r(t,i)}))))}}else t.getPluginType()===Pi.ANALYZE&&!i&&(yield this.analytics.processWithTime(n,(()=>Lt(this,null,(function*(){return yield t.processVideoFrame(this.inputCanvas)})))))}catch(e){Jt.e(Mi,`error in processing plugin ${n}`,e),yield this.removePlugin(t)}e++}}}))}addTrackToVideo(){return Lt(this,null,(function*(){var e;if(!this.inputVideo)return;let t=this.inputVideo.srcObject;null!==t&&t instanceof MediaStream&&(null==(e=t.getVideoTracks()[0])?void 0:e.id)===this.hmsTrack.nativeTrack.id||(this.inputVideo.pause(),this.inputVideo.srcObject=new MediaStream([this.hmsTrack.nativeTrack]),this.inputVideo.muted=!0,this.inputVideo.playsInline=!0,yield this.inputVideo.play())}))}updateInputCanvas(){return Lt(this,null,(function*(){if(!this.inputCanvas||!this.inputVideo)return;let{width:e=Oi,height:t=Li}=this.hmsTrack.getMediaTrackSettings();this.inputCanvas.height!==t&&(this.inputCanvas.height=t),this.inputCanvas.width!==e&&(this.inputCanvas.width=e),this.inputCanvas.getContext("2d").drawImage(this.inputVideo,0,0,e,t)}))}resetCanvases(){if(!this.outputCanvas||!this.inputCanvas)return;let e=this.inputCanvas.getContext("2d");e&&(e.fillStyle="rgb(0, 0, 0)",e.fillRect(0,0,this.outputCanvas.width,this.outputCanvas.height)),this.canvases=[]}checkIfSkipRequired(e){let t=!1;return this.pluginNumFramesSkipped[e]<this.pluginNumFramesToSkip[e]?(this.pluginNumFramesSkipped[e]++,t=!0):(t=!1,this.pluginNumFramesSkipped[e]=0),t}}(this,i),this.setFirstTrackId(this.trackId)}setEnabled(e){var t=e=>super[e];return Lt(this,null,(function*(){if(e!==this.enabled){if("regular"===this.source){let t;t=e?yield this.replaceTrackWith(this.settings):yield this.replaceTrackWithBlank(),yield this.replaceSender(t,e),this.nativeTrack=t,e&&(yield this.pluginsManager.waitForRestart(),this.settings=this.buildNewSettings({deviceId:t.getSettings().deviceId}))}yield t("setEnabled").call(this,e),this.eventBus.localVideoEnabled.publish({enabled:e,track:this}),this.stream.trackUpdate(this)}}))}isPublishedTrackId(e){return this.publishedTrackId===e}addSink(e){this.addSinkInternal(e,this.processedTrack||this.nativeTrack)}setSettings(e,t=!1){return Lt(this,null,(function*(){let n=this.buildNewSettings(e);yield this.handleDeviceChange(n,t),this.enabled?(yield this.handleSettingsChange(n),this.settings=n):this.settings=n}))}getPlugins(){return this.pluginsManager.getPlugins()}addPlugin(e,t){return Lt(this,null,(function*(){return this.pluginsManager.addPlugin(e,t)}))}removePlugin(e){return Lt(this,null,(function*(){return this.pluginsManager.removePlugin(e)}))}validatePlugin(e){return this.pluginsManager.validatePlugin(e)}cleanup(){var e=e=>super[e];return Lt(this,null,(function*(){var t;e("cleanup").call(this),yield this.pluginsManager.cleanup(),null==(t=this.processedTrack)||t.stop()}))}setProcessedTrack(e){return Lt(this,null,(function*(){if(this.nativeTrack.enabled)return e?void(e!==this.processedTrack&&(this.processedTrack?yield this.stream.replaceSenderTrack(this.processedTrack,e):yield this.stream.replaceSenderTrack(this.nativeTrack,e),this.processedTrack=e)):(this.processedTrack&&(yield this.stream.replaceSenderTrack(this.processedTrack,this.nativeTrack)),void(this.processedTrack=void 0));this.processedTrack=e}))}getTrackIDBeingSent(){return this.getTrackBeingSent().id}getTrackBeingSent(){return this.enabled&&this.processedTrack||this.nativeTrack}replaceTrackWith(e){return Lt(this,null,(function*(){let t=this.nativeTrack;null==t||t.stop();let n=yield di(e);return"default"===this.settings.deviceId&&(this.settings=this.buildNewSettings({deviceId:this.nativeTrack.getSettings().deviceId})),n}))}replaceTrackWithBlank(){return Lt(this,null,(function*(){let e=this.nativeTrack;return null==e||e.stop(),Gi.getEmptyVideoTrack(e)}))}replaceSender(e,t){return Lt(this,null,(function*(){let n=this.stream;t?yield n.replaceSenderTrack(this.nativeTrack,this.processedTrack||e):yield n.replaceSenderTrack(this.processedTrack||this.nativeTrack,e),yield n.replaceStreamTrack(this.nativeTrack,e)}))}},Ji=class{constructor(e){this.type=e.type,this.source=e.source||"regular",this.description="",e instanceof Mn?(this.mute=!e.enabled,this.track_id=e.publishedTrackId,this.stream_id=e.stream.id):(this.mute=e.mute,this.track_id=e.track_id,this.stream_id=e.stream_id)}};!function(e){e.Disconnected="Disconnected",e.Connecting="Connecting",e.Joined="Joined",e.Preview="Preview",e.Failed="Failed",e.Reconnecting="Reconnecting",e.Leaving="Leaving"}(Hi||(Hi={}));var Qi,Yi;!function(e){e.FLAG_SERVER_SUB_DEGRADATION="subscribeDegradation",e.FLAG_SERVER_SIMULCAST="simulcast",e.FLAG_NON_WEBRTC_DISABLE_OFFER="nonWebRTCDisableOffer"}(Qi||(Qi={})),function(e){e[e.ConnectFailed=0]="ConnectFailed",e[e.SignalDisconnect=1]="SignalDisconnect",e[e.JoinWSMessageFailed=2]="JoinWSMessageFailed",e[e.PublishIceConnectionFailed=3]="PublishIceConnectionFailed",e[e.SubscribeIceConnectionFailed=4]="SubscribeIceConnectionFailed"}(Yi||(Yi={}));var Zi={0:[],1:[],2:[1],3:[1],4:[1]},Xi="[RetryScheduler]",er=new class{constructor(){this.TAG="[HTTPAnalyticsTransport]",this.failedEvents=new jt("client-events"),this.isConnected=!0,this.env=null}setEnv(e){this.env=e,this.flushFailedEvents()}sendEvent(e){if(!this.env)return void this.addEventToStorage(e);let t={event:e.name,payload:e.properties,event_id:String(e.timestamp),peer:e.metadata.peer,timestamp:e.timestamp,device_id:e.device_id},n=this.env===St.PROD?"https://event.100ms.live/v2/client/report":"https://event-nonprod.100ms.live/v2/client/report";fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.metadata.token}`,user_agent_v2:e.metadata.userAgent},body:JSON.stringify(t)}).then((t=>{if(401!==t.status){if(200!==t.status)throw Error(t.statusText);this.removeFromStorage(e)}else this.removeFromStorage(e)})).catch((t=>{Jt.v(this.TAG,"Failed to send event",t,e),this.addEventToStorage(e)}))}flushFailedEvents(){let e=this.failedEvents.get();null==e||e.forEach((e=>this.sendEvent(e)))}addEventToStorage(e){let t=this.failedEvents.get()||[];t.find((t=>t.timestamp===e.timestamp))||(100===t.length&&t.shift(),t.push(e),this.failedEvents.set(t))}removeFromStorage(e){let t=this.failedEvents.get()||[],n=t.findIndex((t=>t.timestamp===e.timestamp));n>-1&&(t.splice(n,1),this.failedEvents.set(t))}},tr=class{constructor(){this.TAG="AnalyticsTransport"}sendEvent(e){try{this.sendSingleEvent(e),this.flushFailedEvents()}catch(e){Jt.w(this.TAG,"sendEvent failed",e)}}flushFailedEvents(e){var t;try{for(Jt.d(this.TAG,"Flushing failed events",this.failedEvents);this.failedEvents.size()>0;){let n=this.failedEvents.dequeue();n&&((null==(t=n.metadata)?void 0:t.peer.peer_id)!==e&&n.metadata.peer.peer_id?er.sendEvent(n):this.sendSingleEvent(n))}}catch(e){Jt.w(this.TAG,"flushFailedEvents failed",e)}}sendSingleEvent(e){try{this.transportProvider.sendEvent(e),Jt.d(this.TAG,"Sent event",e.name,e)}catch(t){throw Jt.w(this.TAG,`${this.transportProvider.TAG}.sendEvent failed, adding to local storage events`,{event:e,error:t}),this.failedEvents.enqueue(e),t}}},nr=class extends Wn{constructor(){super(100),this.localStorage=new jt("hms-analytics"),this.localStorage.clear(),this.initLocalStorageQueue()}enqueue(e){super.enqueue(e),this.localStorage.set(this.storage)}dequeue(){let e=super.dequeue();return this.localStorage.set(this.storage),e}initLocalStorageQueue(){var e;null==(e=this.localStorage.get())||e.forEach((e=>{let t=new Ti(e);super.enqueue(t)}))}},ir=class extends tr{constructor(e){super(),this.transportProvider=e,this.failedEvents=new nr}},rr=(e,t,n,i)=>Lt(void 0,null,(function*(){var r;let s,{peerConnectionType:o,nativeTrack:a}=(e=>{let t=e.stream instanceof Ui;return{peerConnectionType:t?"publish":"subscribe",nativeTrack:t?e.getTrackBeingSent():e.nativeTrack}})(t);try{s=yield null==(r=e[o])?void 0:r.call(e,a)}catch(e){Jt.w("[HMSWebrtcStats]","Error in getting track stats",t,a,e)}let l=sr(s),c=lr("publish"===o?"bytesSent":"bytesReceived",l,i),u=cr("packetsLost",l,i);return(null==l?void 0:l.remote)&&Object.assign(l.remote,{packetsLostRate:cr("packetsLost",l.remote,null==i?void 0:i.remote)}),l&&Object.assign(l,{bitrate:c,packetsLostRate:u,peerId:t.peerId,peerName:n,codec:l.codec})})),sr=e=>{let t,n,i={};null==e||e.forEach((e=>{switch(e.type){case"inbound-rtp":case"outbound-rtp":t=e;break;case"remote-inbound-rtp":n=e;break;case"codec":i[e.id]=e.mimeType}}));let r,s=(null==t?void 0:t.codecId)?i[t.codecId]:void 0;return s&&(r=s.substring(s.indexOf("/")+1)),t&&Object.assign(t,{remote:n,codec:r})},or=(e,t,n)=>{let i=ar(t),r=lr("publish"===e?"bytesSent":"bytesReceived",i,n&&n[e]);return i&&Object.assign(i,{bitrate:r})},ar=e=>{let t;return e.forEach((n=>{"transport"===n.type&&(t=e.get(n.selectedCandidatePairId))})),t||e.forEach((e=>{"candidate-pair"===e.type&&e.selected&&(t=e)})),t},lr=(e,t,n)=>8*cr(e,t,n),cr=(e,t,n)=>{let i=t&&t[e],r=n?n[e]:null;return[t,n,an(i),an(r)].every((e=>!!e))?1e3*ur(i,r,null==t?void 0:t.timestamp,null==n?void 0:n.timestamp):0},ur=(e,t,n,i)=>an(e)&&an(t)&&n&&i?(e-t)/(n-i):0,dr="[HMSTransport]:";function hr(e){if(!e||0===e.length)throw sn.InitAPIErrors.InvalidTokenFormat(tn.INIT,"Token cannot be an empty string or undefined or null");let t=e.split(".");if(3!==t.length)throw sn.InitAPIErrors.InvalidTokenFormat(tn.INIT,"Expected 3 '.' separate fields - header, payload and signature respectively");let n=atob(t[1]);try{let e=JSON.parse(n);return{roomId:e.room_id,userId:e.user_id,role:e.role}}catch(e){throw sn.InitAPIErrors.InvalidTokenFormat(tn.INIT,`couldn't parse to json - ${e.message}`)}}var pr={autoplayFailed:void 0,initialized:!1,autoplayCheckPromise:void 0},fr="AnalyticsEventsService",mr=class extends Et.EventEmitter2{on(e,t){return super.on(e,t)}off(e,t){return super.off(e,t)}emit(e,t){return super.emit(e,t)}listeners(e){return super.listeners(e)}},gr=class{constructor(e){this.audioContext=new AudioContext,this.source=this.audioContext.createMediaElementSource(e),this.source.connect(this.audioContext.destination)}resumeContext(){"suspended"===this.audioContext.state&&(Jt.d(this.TAG,"AudioContext is resumed"),this.audioContext.resume())}getAudioTrack(){return this.destinationNode&&this.source.disconnect(this.destinationNode),this.destinationNode=this.audioContext.createMediaStreamDestination(),this.source.connect(this.destinationNode),this.destinationNode.stream.getAudioTracks()[0]}cleanup(){"closed"!==this.audioContext.state&&this.audioContext.close()}get TAG(){return"AudioContextManager"}},vr=class extends mr{constructor(){super(...arguments),this.audioElement=null,this.seeked=!1}play(e){return Lt(this,null,(function*(){return this.audioElement=this.getAudioElement(),new Promise(((t,n)=>{this.audioElement=this.getAudioElement(),this.audioElement.src=e,this.seeked=!1,this.audioElement.onerror=()=>{let t=`Error loading ${e}`;Jt.e(this.TAG,t),this.stop(),n(t)},this.audioElement.oncanplaythrough=()=>Lt(this,null,(function*(){try{if(!this.audioElement)return;if(this.audioContextManager.resumeContext(),this.track)this.seeked?this.seeked=!1:(yield this.audioElement.play(),t([this.track]));else{yield this.audioElement.play();let e=this.audioContextManager.getAudioTrack();this.track=e,t([e])}}catch(t){Jt.e(this.TAG,"Error playing audio",e,t.message),n(t)}})),this.audioElement.onseeked=()=>{this.seeked=!0}}))}))}getTracks(){return this.track?[this.track.id]:[]}getElement(){return this.audioElement}stop(){var e,t,n;null==(e=this.audioElement)||e.pause(),null==(t=this.audioElement)||t.removeAttribute("src"),this.audioElement=null,null==(n=this.audioContextManager)||n.cleanup(),this.track=void 0}getAudioElement(){if(this.audioElement)return this.audioElement;let e=document.createElement("audio");return e.crossOrigin="anonymous",e.addEventListener("timeupdate",(e=>this.emit("progress",e))),e.addEventListener("ended",(()=>{this.emit("ended",null)})),this.audioContextManager=new gr(e),e}get TAG(){return"PlaylistAudioManager"}},yr=class extends mr{constructor(){super(...arguments),this.videoElement=null,this.canvasContext=null,this.tracks=[],this.DEFAUL_FPS=24,this.seeked=!1,this.drawImage=()=>{var e,t,n;this.videoElement&&!this.videoElement.paused&&!this.videoElement.ended&&(null==(n=this.canvasContext)||n.drawImage(this.videoElement,0,0,null==(e=this.canvas)?void 0:e.width,null==(t=this.canvas)?void 0:t.height),this.timer=setTimeout((()=>{this.drawImage()}),1e3/this.DEFAUL_FPS))}}play(e){return this.videoElement=this.getVideoElement(),this.createCanvas(),new Promise(((t,n)=>{this.videoElement=this.getVideoElement(),this.videoElement.src=e,this.seeked=!1,this.videoElement.onerror=()=>{let t=`Error loading ${e}`;Jt.e(this.TAG,t),this.stop(),n(t)},this.videoElement.oncanplaythrough=()=>Lt(this,null,(function*(){var i,r,s;try{if(!this.videoElement)return;if(this.canvas.width=this.videoElement.videoWidth,this.canvas.height=this.videoElement.videoHeight,0===this.tracks.length){this.clearCanvasAndTracks();let e=this.canvas.captureStream();if(!e)return void Jt.e(this.TAG,"Browser does not support captureStream");this.videoElement.onplay=this.drawImage,this.audioContextManager.resumeContext(),yield this.videoElement.play();let n=this.audioContextManager.getAudioTrack();e.addTrack(n),e.getTracks().forEach((e=>{this.tracks.push(e)})),t(this.tracks)}else this.seeked?(this.seeked=!1,null==(s=this.canvasContext)||s.drawImage(this.videoElement,0,0,null==(i=this.canvas)?void 0:i.width,null==(r=this.canvas)?void 0:r.height)):(yield this.videoElement.play(),t(this.tracks))}catch(t){Jt.e(this.TAG,"Error playing video",e,t.message),n(t)}})),this.videoElement.onseeked=()=>{this.seeked=!0}}))}getTracks(){return this.tracks.map((e=>e.id))}getElement(){return this.videoElement}stop(){var e,t,n;null==(e=this.videoElement)||e.pause(),null==(t=this.videoElement)||t.removeAttribute("src"),this.videoElement=null,null==(n=this.audioContextManager)||n.cleanup(),this.clearCanvasAndTracks()}clearCanvasAndTracks(){var e;this.tracks=[],null==(e=this.canvasContext)||e.clearRect(0,0,this.canvas.width,this.canvas.height),clearTimeout(this.timer)}getVideoElement(){if(this.videoElement)return this.videoElement;let e=document.createElement("video");return e.crossOrigin="anonymous",e.addEventListener("timeupdate",(e=>this.emit("progress",e))),e.addEventListener("ended",(()=>{this.emit("ended",null)})),this.audioContextManager=new gr(e),e}createCanvas(){this.canvas||(this.canvas=document.createElement("canvas"),this.canvasContext=this.canvas.getContext("2d"))}get TAG(){return"PlaylistVideoManager"}},br={list:[],currentIndex:-1,isAutoplayOn:!0},_r={list:[],currentIndex:-1,isAutoplayOn:!0},wr=class extends mr{constructor(e,t){super(),this.sdk=e,this.eventBus=t,this.state={audio:xt({},br),video:xt({},_r)},this.TAG="[PlaylistManager]",this.handlePausePlaylist=e=>Lt(this,[e],(function*({enabled:e,track:t}){var n;if(e)return;let i;"audioplaylist"===t.source&&(i=Zt.audio),"videoplaylist"===t.source&&(i=Zt.video),i&&(null==(n=this.getElement(i))||n.pause())})),this.addTrack=(e,t)=>Lt(this,null,(function*(){yield this.sdk.addTrack(e,t),Jt.d(this.TAG,"Playlist track added",Ln(e))})),this.removeTrack=e=>Lt(this,null,(function*(){yield this.sdk.removeTrack(e),Jt.d(this.TAG,"Playlist track removed",e)})),this.audioManager=new vr,this.videoManager=new yr,this.addListeners()}getList(e=Zt.audio){return this.state[e].list}setList(e){e&&0!==e.length?e.forEach((e=>{this.state[e.type].list.includes(e)||this.state[e.type].list.push(e)})):Jt.w(this.TAG,"Please pass in a list of HMSPlaylistItem's")}clearList(e){return Lt(this,null,(function*(){this.isPlaying(e)&&(yield this.stop(e)),this.state[e].list=[]}))}removeItem(e,t){return Lt(this,null,(function*(){let{list:n,currentIndex:i}=this.state[t],r=n.findIndex((t=>e===t.id));return r>-1&&(i===r&&this.isPlaying(t)&&(yield this.stop(t)),n.splice(r,1),!0)}))}seek(e,t=Zt.audio){let{currentIndex:n}=this.state[t];if(-1===n)throw sn.PlaylistErrors.NoEntryToPlay(tn.PLAYLIST,"No item is currently playing");let i=this.getElement(t);if(i){let t=Math.max(i.currentTime+e,0);i.currentTime=Math.min(t,i.duration)}}seekTo(e,t=Zt.audio){let{currentIndex:n}=this.state[t];if(-1===n)throw sn.PlaylistErrors.NoEntryToPlay(tn.PLAYLIST,"No item is currently playing");if(e<0)throw Error("value cannot be negative");let i=this.getElement(t);i&&(i.currentTime=Math.min(e,i.duration))}setVolume(e,t=Zt.audio){if(e<0||e>100)throw Error("Please pass a valid number between 0-100");let n=this.getElement(t);n&&(n.volume=.01*e)}getVolume(e=Zt.audio){let t=this.getElement(e);return t?100*t.volume:0}getCurrentTime(e=Zt.audio){let t=this.getElement(e);return(null==t?void 0:t.currentTime)||0}getCurrentIndex(e=Zt.audio){return this.state[e].currentIndex}getCurrentProgress(e=Zt.audio){var t;let{list:n,currentIndex:i}=this.state[e],r=null==(t=n[i])?void 0:t.url,s=this.getElement(e);return r&&s?Math.floor(s.currentTime/s.duration*100):0}getCurrentSelection(e=Zt.audio){let{list:t,currentIndex:n}=this.state[e];if(-1!==n)return t[n]}isPlaying(e=Zt.audio){let t=this.getElement(e);return!!t&&!t.paused}setIsAutoplayOn(e=Zt.audio,t){this.state[e].isAutoplayOn=t}getPlaybackRate(e=Zt.audio){let t=this.getElement(e);return t?t.playbackRate:1}setPlaybackRate(e=Zt.audio,t){if(t<.25||t>2)throw Error("Please pass a value between 0.25 and 2.0");let n=this.getElement(e);n&&(n.playbackRate=t)}setEnabled(e,t){return Lt(this,arguments,(function*(e,{id:t,type:n=Zt.audio}){let i=this.state[n].list.findIndex((e=>e.id===t));if(!t||-1===i)return void Jt.w(this.TAG,"Pass a valid id");let r=this.state[n].list[i].url;e?yield this.play(r,n):yield this.pause(r,n),this.state[n].currentIndex=i,this.setDuration(n)}))}playNext(){return Lt(this,arguments,(function*(e=Zt.audio){let{list:t,currentIndex:n}=this.state[e];if(n>=t.length-1)throw sn.PlaylistErrors.NoEntryToPlay(tn.PLAYLIST,"Reached end of playlist");yield this.play(t[n+1].url,e),this.state[e].currentIndex=n+1,this.setDuration(e)}))}playPrevious(){return Lt(this,arguments,(function*(e=Zt.audio){let{list:t,currentIndex:n}=this.state[e];if(n<=0)throw sn.PlaylistErrors.NoEntryToPlay(tn.PLAYLIST,"Reached start of playlist");yield this.play(t[n-1].url,e),this.state[e].currentIndex=n-1,this.setDuration(e)}))}stop(){return Lt(this,arguments,(function*(e=Zt.audio){var t;let n=e===Zt.audio?this.audioManager:this.videoManager;null==(t=n.getElement())||t.pause(),yield this.removeTracks(e),n.stop(),this.state[e].currentIndex=-1}))}cleanup(){this.state={audio:xt({},br),video:xt({},_r)},this.eventBus.localAudioEnabled.unsubscribe(this.handlePausePlaylist),this.eventBus.localVideoEnabled.unsubscribe(this.handlePausePlaylist),this.audioManager.stop(),this.videoManager.stop()}onProgress(e){this.videoManager.on("progress",(()=>{try{e({type:Zt.video,progress:this.getCurrentProgress(Zt.video)})}catch(e){Jt.e(this.TAG,"Error in onProgress callback")}})),this.audioManager.on("progress",(()=>{try{e({type:Zt.audio,progress:this.getCurrentProgress(Zt.audio)})}catch(e){Jt.e(this.TAG,"Error in onProgress callback")}}))}onNewTrackStart(e){this.on("newTrackStart",e)}onPlaylistEnded(e){this.on("playlistEnded",e)}onCurrentTrackEnded(e){this.on("currentTrackEnded",e)}getElement(e=Zt.audio){return e===Zt.audio?this.audioManager.getElement():this.videoManager.getElement()}removeTracks(){return Lt(this,arguments,(function*(e=Zt.audio){let t=(e===Zt.audio?this.audioManager:this.videoManager).getTracks();for(let e of t)yield this.removeTrack(e)}))}play(e){return Lt(this,arguments,(function*(e,t=Zt.audio){let n=t===Zt.audio?this.audioManager:this.videoManager,i=n.getElement();if(this.isItemCurrentlyPlaying(e,t))Jt.w(this.TAG,`The ${t} is currently playing`);else if(null==i?void 0:i.src.includes(e))yield i.play();else{null==i||i.pause();let r=yield n.play(e);for(let e of r)yield this.addTrack(e,t===Zt.audio?"audioplaylist":"videoplaylist")}}))}isItemCurrentlyPlaying(e,t){let n=this.getElement(t);return!(!n||n.paused||!n.src.includes(e))}setDuration(e=Zt.audio){let t=this.getElement(e),{list:n,currentIndex:i}=this.state[e];n[i]&&(n[i].duration=(null==t?void 0:t.duration)||0),this.emit("newTrackStart",n[i])}pause(e){return Lt(this,arguments,(function*(e,t=Zt.audio){let n=this.getElement(t);n&&!n.paused&&n.src.includes(e)?(n.pause(),Jt.d(this.TAG,"paused url",e)):Jt.w(this.TAG,"The passed in url is not currently playing")}))}addListeners(){this.audioManager.on("ended",(()=>this.handleEnded(Zt.audio))),this.videoManager.on("ended",(()=>this.handleEnded(Zt.video))),this.eventBus.localAudioEnabled.subscribe(this.handlePausePlaylist),this.eventBus.localAudioEnabled.subscribe(this.handlePausePlaylist)}handleEnded(){return Lt(this,arguments,(function*(e=Zt.audio){let{list:t,currentIndex:n,isAutoplayOn:i}=this.state[e];n===t.length-1?(yield this.stop(e),this.emit("playlistEnded",e)):i?this.playNext(e):yield this.pause(t[n].url,e),this.emit("currentTrackEnded",t[n])}))}},Sr=class{constructor(e,t){this.eventName=e,this.eventEmitter=t,this.publish=e=>{this.eventEmitter.emit(this.eventName,e)},this.subscribe=e=>{this.eventEmitter.on(this.eventName,e)},this.subscribeOnce=e=>{this.eventEmitter.once(this.eventName,e)},this.unsubscribe=e=>{this.eventEmitter.off(this.eventName,e)},this.waitFor=e=>this.eventEmitter.waitFor(this.eventName,{filter:e}),this.removeAllListeners=()=>{this.eventEmitter.removeAllListeners(this.eventName)}}},Tr={isAudioMuted:!1,isVideoMuted:!1,audioInputDeviceId:"default",audioOutputDeviceId:"default",videoDeviceId:"default"},Er={published:!1,isInitialised:!1,isReconnecting:!1,isPreviewInProgress:!1,deviceManagersInitialised:!1};function kr(e,t){return e===t}Jt.i("adapter",`${ut.browserDetails.browser} v${ut.browserDetails.version}`);var Cr=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return function(){for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];var s=0,o=i.pop(),a=function(e){var t=Array.isArray(e[0])?e[0]:e;if(!t.every((function(e){return"function"==typeof e}))){var n=t.map((function(e){return typeof e})).join(", ");throw new Error("Selector creators expect all input-selectors to be functions, instead received the following types: ["+n+"]")}return t}(i),l=e.apply(void 0,[function(){return s++,o.apply(null,arguments)}].concat(n)),c=e((function(){for(var e=[],t=a.length,n=0;n<t;n++)e.push(a[n].apply(null,arguments));return l.apply(null,e)}));return c.resultFunc=o,c.dependencies=a,c.recomputations=function(){return s},c.resetRecomputations=function(){return s=0},c}}((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kr,n=null,i=null;return function(){return function(e,t,n){if(null===t||null===n||t.length!==n.length)return!1;for(var i=t.length,r=0;r<i;r++)if(!e(t[r],n[r]))return!1;return!0}(t,n,arguments)||(i=e.apply(null,arguments)),n=arguments,i}}));var Ir,Rr=Object.defineProperty,Pr=Object.defineProperties,Ar=Object.getOwnPropertyDescriptors,Nr=Object.getOwnPropertySymbols,xr=Object.prototype.hasOwnProperty,Dr=Object.prototype.propertyIsEnumerable,Or=(e,t,n)=>t in e?Rr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Lr=(e,t)=>{for(var n in t||(t={}))xr.call(t,n)&&Or(e,n,t[n]);if(Nr)for(var n of Nr(t))Dr.call(t,n)&&Or(e,n,t[n]);return e},Mr=(e,t)=>Pr(e,Ar(t)),jr=(e,t,n)=>new Promise(((i,r)=>{var s=e=>{try{a(n.next(e))}catch(e){r(e)}},o=e=>{try{a(n.throw(e))}catch(e){r(e)}},a=e=>e.done?i(e.value):Promise.resolve(e.value).then(s,o);a((n=n.apply(e,t)).next())})),Ur=((e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports))(((e,t)=>{t.exports={version:"0.6.4",license:"MIT",main:"dist/index.cjs.js",module:"dist/index.js",typings:"dist/index.d.ts",files:["dist","src"],engines:{node:">=12"},exports:{".":{require:"./dist/index.cjs.js",import:"./dist/index.js",default:"./dist/index.js"}},scripts:{prestart:"rm -rf dist && yarn types:build",start:'concurrently "yarn dev" "yarn types"',dev:"node ../../scripts/dev","build:only":"node ../../scripts/build",build:"yarn build:only && yarn types:build",types:"tsc -w","types:build":"tsc -p tsconfig.json",format:"prettier --write src/**/*.ts",test:"jest --maxWorkers=1","test:watch":"jest --watch","test:coverage":"jest --coverage",lint:"eslint -c ../../.eslintrc .","lint:fix":"yarn lint --fix",prepare:"yarn build",size:"size-limit",analyze:"size-limit --why",docs:"rm -rf ./docs && typedoc && rm -f ./docs/README.md && mkdir ./docs/home &&mv ./docs/modules.md ./docs/home/content.md && node ../../scripts/docs-store && npx prettier --write './docs/**/*'"},name:"@100mslive/hms-video-store",author:"100ms",sideEffects:!1,dependencies:{"@100mslive/hms-video":"0.5.4",eventemitter2:"^6.4.7",immer:"^9.0.6",reselect:"4.0.0",zustand:"3.5.7"},devDependencies:{"ts-node":"^10.4.0",tslib:"^2.2.0"},description:"This is an addon to the core sdk provided by 100ms. It abstracts away the intricacies of data management and provides a flux based reactive data store where data flows in only one direction.",repository:{type:"git",url:"git+https://github.com/100mslive/hms-video-store.git"},keywords:["video","webrtc","conferencing","100ms"],bugs:{url:"https://github.com/100mslive/hms-video-store/issues"},homepage:"https://github.com/100mslive/hms-video-store#readme",gitHead:"fe00f2f7a62e19cb86e9d7bd8a80bc921909a2bb"}}));!function(e){e.Disconnected="Disconnected",e.Preview="Preview",e.Connecting="Connecting",e.Connected="Connected",e.Reconnecting="Reconnecting",e.Disconnecting="Disconnecting",e.Failed="Failed"}(Ir||(Ir={}));var Fr,Vr,Br,zr,$r=()=>({room:{id:"",isConnected:!1,name:"",peers:[],shareableLink:"",localPeer:"",hasWaitingRoom:!1,roomState:Ir.Disconnected,recording:{browser:{running:!1},server:{running:!1},hls:{running:!1}},rtmp:{running:!1},hls:{running:!1,variants:[]},sessionId:""},peers:{},tracks:{},playlist:{audio:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1},video:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1}},messages:{byID:{},allIDs:[]},speakers:{},connectionQualities:{},settings:{audioInputDeviceId:"",audioOutputDeviceId:"",videoInputDeviceId:""},devices:{audioInput:[],audioOutput:[],videoInput:[]},roles:{},roleChangeRequests:[],errors:[]}),qr=()=>({peerStats:{},trackStats:{},localPeer:{id:""}});!function(e){e.CHAT="chat"}(Fr||(Fr={})),function(e){e.INFO="info",e.ERROR="error"}(Vr||(Vr={})),function(e){e.PEER_JOINED="PEER_JOINED",e.PEER_LEFT="PEER_LEFT",e.PEER_LIST="PEER_LIST",e.NEW_MESSAGE="NEW_MESSAGE",e.ERROR="ERROR",e.RECONNECTING="RECONNECTING",e.RECONNECTED="RECONNECTED",e.TRACK_ADDED="TRACK_ADDED",e.TRACK_REMOVED="TRACK_REMOVED",e.TRACK_MUTED="TRACK_MUTED",e.TRACK_UNMUTED="TRACK_UNMUTED",e.TRACK_DEGRADED="TRACK_DEGRADED",e.TRACK_RESTORED="TRACK_RESTORED",e.TRACK_DESCRIPTION_CHANGED="TRACK_DESCRIPTION_CHANGED",e.ROLE_UPDATED="ROLE_UPDATED",e.CHANGE_TRACK_STATE_REQUEST="CHANGE_TRACK_STATE_REQUEST",e.CHANGE_MULTI_TRACK_STATE_REQUEST="CHANGE_MULTI_TRACK_STATE_REQUEST",e.ROOM_ENDED="ROOM_ENDED",e.REMOVED_FROM_ROOM="REMOVED_FROM_ROOM",e.DEVICE_CHANGE_UPDATE="DEVICE_CHANGE_UPDATE",e.PLAYLIST_TRACK_ENDED="PLAYLIST_TRACK_ENDED",e.NAME_UPDATED="NAME_UPDATED",e.METADATA_UPDATED="METADATA_UPDATED"}(Br||(Br={})),function(e){e.audio="audio",e.video="video"}(zr||(zr={}));var Gr=(e,t)=>{let n=Yr(Object.keys(e),Object.keys(t));for(let i of n){let n=e[i],r=t[i];Hr(n,r)?Object.assign(n,r):Kr(n,r)?delete e[i]:Jr(n,r)&&(e[i]=r)}},Wr=(e,t)=>{e.plugins&&Qr(e.plugins,t.plugins)&&(t.plugins=e.plugins),"video"===e.type&&e.layerDefinitions&&Qr(e.layerDefinitions,t.layerDefinitions)&&(t.layerDefinitions=e.layerDefinitions)},Hr=(e,t)=>e&&t,Kr=(e,t)=>e&&!t,Jr=(e,t)=>!e&&t,Qr=(e,t)=>{if(e===t||0===e.length&&0===(null==t?void 0:t.length))return!0;if(!e||!t||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},Yr=(e,t)=>{let n=new Set;for(let t of e)n.add(t);for(let e of t)n.add(e);return Array.from(n)},Zr=class{static convertPeer(e){var t,n,i;return{id:e.peerId,name:e.name,roleName:null==(t=e.role)?void 0:t.name,isLocal:e.isLocal,videoTrack:null==(n=e.videoTrack)?void 0:n.trackId,audioTrack:null==(i=e.audioTrack)?void 0:i.trackId,auxiliaryTracks:e.auxiliaryTracks.map((e=>e.trackId)),customerUserId:e.customerUserId,customerDescription:e.metadata,metadata:e.metadata,joinedAt:e.joinedAt}}static convertTrack(e,t){let n={id:e.trackId,source:e.source,type:e.type,enabled:e.enabled,displayEnabled:e.enabled,peerId:e.peerId||t};return this.enrichTrack(n,e),n}static enrichTrack(e,t){let n=t.getMediaTrackSettings();t instanceof Fn&&(e.volume=t.getVolume()||0),Zr.updateDeviceID(e,t),"video"===e.type&&("screen"===e.source?e.displaySurface=n.displaySurface:"regular"===e.source&&(e.facingMode=n.facingMode),e.height=n.height,e.width=n.width,Zr.enrichVideoTrack(e,t)),Zr.enrichPluginsDetails(e,t)}static updateDeviceID(e,t){var n;e.deviceID=t instanceof Ki||t instanceof Ni?t.settings.deviceId:null==(n=t.getMediaTrackSettings())?void 0:n.deviceId}static enrichVideoTrack(e,t){t instanceof Bn&&(e.layer=t.getSimulcastLayer(),e.degraded=t.degraded,Qr(t.getSimulcastDefinitions(),e.layerDefinitions)||(e.layerDefinitions=t.getSimulcastDefinitions()))}static enrichPluginsDetails(e,t){(t instanceof Ki||t instanceof Ni)&&(Qr(t.getPlugins(),e.plugins)||(e.plugins=t.getPlugins()))}static convertRoom(e){var t,n;let{recording:i,rtmp:r,hls:s}=Zr.convertRecordingStreamingState(null==e?void 0:e.recording,null==e?void 0:e.rtmp,null==e?void 0:e.hls);return{id:e.id,name:e.name,localPeer:null!=(n=null==(t=e.localPeer)?void 0:t.peerId)?n:"",hasWaitingRoom:e.hasWaitingRoom,shareableLink:e.shareableLink,recording:i,rtmp:r,hls:s,sessionId:e.sessionId,startedAt:e.startedAt,joinedAt:e.joinedAt,peerCount:e.peerCount}}static convertMessage(e){var t,n,i,r,s,o,a;return{sender:null==(t=e.sender)?void 0:t.peerId,senderName:null==(n=e.sender)?void 0:n.name,senderRole:null==(r=null==(i=e.sender)?void 0:i.role)?void 0:r.name,senderUserId:null==(s=e.sender)?void 0:s.customerUserId,recipientPeer:null==(o=e.recipientPeer)?void 0:o.peerId,recipientRoles:null==(a=e.recipientRoles)?void 0:a.map((e=>e.name)),time:e.time,type:e.type,message:e.message}}static convertRoles(e){let t={};return e&&e.forEach((e=>{t[e.name]=e})),t}static convertRoleChangeRequest(e){var t;return{requestedBy:null==(t=e.requestedBy)?void 0:t.peerId,roleName:e.role.name,token:e.token}}static convertException(e){return{code:e.code,action:e.action,name:e.name,message:e.message,description:e.description,isTerminal:e.isTerminal,nativeError:e.nativeError,timestamp:new Date}}static convertDeviceChangeUpdate(e){let t={devices:e.devices,selection:e.selection,type:e.type};return e.error&&(t.error=this.convertException(e.error)),t}static convertPlaylist(e){return{audio:this.getConvertedPlaylistType(e,zr.audio),video:this.getConvertedPlaylistType(e,zr.video)}}static convertPlaylistItem(e,t){let n=t.type,i=e.getCurrentSelection(n),r=e.isPlaying(n),s=t.url===(null==i?void 0:i.url);return Mr(Lr({},t),{type:t.type,selected:s,playing:s&&r})}static getConvertedPlaylistType(e,t){let n={},i=e.getCurrentSelection(t),r=e.getCurrentProgress(t),s=e.getVolume(t),o=e.getList(t),a=e.getCurrentIndex(t);return e.getList(t).forEach((t=>{n[t.id]=Zr.convertPlaylistItem(e,t)})),{list:n,selection:{id:null==i?void 0:i.id,hasPrevious:a>0,hasNext:a<o.length-1},progress:r,volume:s,currentTime:e.getCurrentTime(t),playbackRate:e.getPlaybackRate(t)}}static convertRecordingStreamingState(e,t,n){var i;return{recording:{browser:Lr({running:!1},null==e?void 0:e.browser),server:Lr({running:!1},null==e?void 0:e.server),hls:Lr({running:!1},null==e?void 0:e.hls)},rtmp:Lr({running:!1},t),hls:{variants:(null==(i=null==n?void 0:n.variants)?void 0:i.map((e=>e)))||[],running:!!(null==n?void 0:n.running),error:null==n?void 0:n.error}}}};function Xr(e,t,n=ns){let i,r;if(t)for(let s of t.auxiliaryTracks){let t=e[s];n(t)&&(r=es(t)?t:r,i=ts(t)?t:i)}return{video:i,audio:r}}function es(e){return e&&"audio"===e.type}function ts(e){return e&&"video"===e.type}function ns(e){return e&&"screen"===e.source}function is(e){return e&&"audioplaylist"===e.source}function rs(e){return e&&"videoplaylist"===e.source}function ss(e){return!!e&&Boolean(null==e?void 0:e.degraded)}function os(e,t){return!(!t||!e.tracks[t])&&e.tracks[t].enabled}var as=e=>e.room,ls=(Cr(as,(e=>e.id)),e=>e.peers),cs=e=>e.messages.byID,us=e=>e.messages.allIDs,ds=e=>e.tracks,hs=e=>e.settings,ps=e=>e.appData,fs=e=>e.speakers,ms=Cr([as],(e=>e&&e.isConnected)),gs=(Cr([ms,as],((e,t)=>e?void 0!==t.peerCount?t.peerCount||1:t.peers.length:Math.max(void 0!==t.peerCount?t.peerCount:t.peers.length-1,0))),Cr([as,ls],((e,t)=>e.peers.map((e=>t[e]))))),vs=Cr(ds,(e=>Object.values(e))),ys=Cr(as,ls,((e,t)=>t[e.localPeer])),bs=Cr(as,(e=>e.localPeer)),_s=(Cr(ys,(e=>null==e?void 0:e.name)),Cr(ys,(e=>null==e?void 0:e.roleName)),Cr(ys,(e=>null==e?void 0:e.audioTrack))),ws=Cr(ys,(e=>null==e?void 0:e.videoTrack)),Ss=Cr(ys,(e=>null==e?void 0:e.auxiliaryTracks)),Ts=Cr([_s,ws,Ss],((e,t,n)=>{let i=[...n];return e&&i.unshift(e),t&&i.unshift(t),i})),Es=Cr(gs,(e=>e.filter((e=>!e.isLocal)))),ks=Cr(ls,fs,((e,t)=>{let n=Object.entries(t).sort(((e,t)=>{var n,i;let r=(null==(n=e[1])?void 0:n.audioLevel)||0;return((null==(i=t[1])?void 0:i.audioLevel)||0)>r?1:-1}));if(n.length>0&&n[0][1].audioLevel&&n[0][1].audioLevel>0){let t=n[0][1].peerID;if(t in e)return e[t]}return null})),Cs=e=>{let t=ys(e);return os(e,null==t?void 0:t.audioTrack)},Is=e=>{let t=ys(e);return os(e,null==t?void 0:t.videoTrack)},Rs=e=>{let t=ys(e);return function(e,t){return!(!t||!e.tracks[t])&&e.tracks[t].displayEnabled}(e,null==t?void 0:t.videoTrack)},Ps=Cr(ys,ds,((e,t)=>{let{video:n,audio:i}=Xr(t,e);return!(!n&&!i)})),As=Cr(ls,ds,((e,t)=>{let n;for(let i in e){let r=e[i],{video:s,audio:o}=Xr(t,r);if(s)return r;o&&!n&&(n=r)}return n})),Ns=Cr(As,(e=>!!e)),xs=(Cr(ls,ds,((e,t)=>{for(let n in e){let i=e[n],{audio:r,video:s}=Xr(t,i);if(!s&&r)return i}})),Cr(ls,ds,((e,t)=>{let n=[],i=[];for(let r in e){let s=e[r],{video:o,audio:a}=Xr(t,s);o?n.push(s):a&&i.push(s)}return n.concat(i)})),Cr(ls,ds,((e,t)=>{for(let n in t){let i=t[n];if(rs(i)&&ts(i)&&i.peerId)return e[i.peerId]}})),Cr(ls,ds,((e,t)=>{for(let n in t){let i=t[n];if(is(i)&&i.peerId)return e[i.peerId]}})),Cr(vs,(e=>e.filter(ss))),Cr(us,(e=>e.length))),Ds=(Cr(cs,(e=>Object.values(e).filter((e=>!e.read)).length)),Cr(us,cs,((e,t)=>{let n=[];return e.forEach((e=>{n.push(t[e])})),n}))),Os=Cr([as],(e=>e&&e.roomState)),Ls=(Cr(Os,(e=>e===Ir.Preview)),Cr(as,(e=>e.roomState!==Ir.Disconnected))),Ms=e=>e.roles,js=(Cr([Ms],(e=>Object.keys(e))),Cr([ys,Ms],((e,t)=>(null==e?void 0:e.roleName)?t[e.roleName]:null))),Us=(Cr([js],(e=>{var t;return!!(null==(t=null==e?void 0:e.subscribeParams)?void 0:t.subscribeToRoles)&&e.subscribeParams.subscribeToRoles.length>0})),Cr(js,(e=>null==e?void 0:e.permissions))),Fs=(Cr(as,(e=>e.recording)),Cr(as,(e=>e.rtmp)),Cr(as,(e=>e.hls)),Cr(as,(e=>e.sessionId)),Cr(as,(e=>e.startedAt)),(e=zr.audio)=>t=>t.playlist[e].list),Vs=(e=zr.audio)=>t=>t.playlist[e].selection,Bs=(e=zr.audio)=>t=>t.playlist[e].progress,zs=(e=zr.audio)=>t=>t.playlist[e].currentTime,$s=(e=zr.audio)=>t=>t.playlist[e].playbackRate,qs=(e=zr.audio)=>t=>t.playlist[e].volume,Gs=(e=zr.audio)=>Cr(Fs(e),(e=>Object.values(e))),Ws=(e=zr.audio)=>Cr(Fs(e),Vs(e),((e,t)=>{if(t.id)return e[t.id]})),Hs={selection:Vs(zr.audio),progress:Bs(zr.audio),currentTime:zs(zr.audio),playbackRate:$s(zr.audio),volume:qs(zr.audio),list:Gs(zr.audio),selectedItem:Ws(zr.audio)},Ks={selection:Vs(zr.video),progress:Bs(zr.video),currentTime:zs(zr.video),playbackRate:$s(zr.video),volume:qs(zr.video),list:Gs(zr.video),selectedItem:Ws(zr.video)};function Js(e){return t=>n=>e(n,t)}var Qs="HMS-Store:",Ys=class{static v(e,...t){this.log(Bt.VERBOSE,e,...t)}static d(...e){this.log(Bt.DEBUG,...e)}static i(...e){this.log(Bt.INFO,...e)}static w(...e){this.log(Bt.WARN,...e)}static e(...e){this.log(Bt.ERROR,...e)}static time(e){this.log(Bt.TIME,"[HMSPerformanceTiming]",e)}static timeEnd(e){this.log(Bt.TIMEEND,"[HMSPerformanceTiming]",e,e)}static cleanUp(){performance.clearMarks(),performance.clearMeasures()}static log(e,...t){if(!(this.level.valueOf()>e.valueOf()))switch(e){case Bt.VERBOSE:console.log(Qs,...t);break;case Bt.DEBUG:console.debug(Qs,...t);break;case Bt.INFO:console.info(Qs,...t);break;case Bt.WARN:console.warn(Qs,...t);break;case Bt.ERROR:console.error(Qs,...t);break;case Bt.TIME:performance.mark(t[1]);break;case Bt.TIMEEND:{let e=t[0],n=t[1];try{let t=performance.measure(n,n);this.log(Bt.DEBUG,e,n,null==t?void 0:t.duration),performance.clearMarks(n),performance.clearMeasures(n)}catch(t){this.log(Bt.DEBUG,e,n,t)}break}}}};Ys.level=Bt.VERBOSE;var Zs=(e,t)=>t,Xs=(e,t)=>t,eo=(e,t)=>t,to=Cr([ls,Zs],((e,t)=>t?e[t]:null)),no=Cr([ds,Xs],((e,t)=>t?e[t]:null)),io=Cr([ds,Xs],((e,t)=>{if(!t)return null;let n=e[t];return"video"===(null==n?void 0:n.type)?n:null})),ro=Cr([ds,Xs],((e,t)=>{if(!t)return null;let n=e[t];return"audio"===(null==n?void 0:n.type)?n:null})),so=Cr([ds,Xs],((e,t)=>{if(!t)return null;let n=e[t];return"audio"===(null==n?void 0:n.type)&&"screen"===(null==n?void 0:n.source)?n:null})),oo=Cr([ds,Xs],((e,t)=>{if(!t)return null;let n=e[t];return"video"===(null==n?void 0:n.type)&&"screen"===(null==n?void 0:n.source)?n:null})),ao=Js(to),lo=(Js(Cr([ps,(e,t)=>t],((e,t)=>{if(e)return t?e[t]:e}))),Js(Cr(to,(e=>null==e?void 0:e.name))),Js(no)),co=Js(io),uo=(Js(ro),Js(so),Js(oo),Js(((e,t)=>{let n=to(e,t);if(n&&n.videoTrack&&""!==n.videoTrack)return e.tracks[n.videoTrack]})),Js(((e,t)=>{let n=to(e,t);if(n&&n.audioTrack&&""!==n.audioTrack)return e.tracks[n.audioTrack]}))),ho=(Js(((e,t)=>{let n=to(e,t);return(null==n?void 0:n.auxiliaryTracks.map((t=>e.tracks[t])))||[]})),(e,t)=>t?e.speakers[t]:null),po=(Js(Cr(ho,(e=>(null==e?void 0:e.audioLevel)||0))),Js(Cr(((e,t)=>{let n=uo(t)(e);return ho(e,null==n?void 0:n.id)}),(e=>(null==e?void 0:e.audioLevel)||0))),Js(((e,t)=>{if(t)return e.connectionQualities[t]})),Js(((e,t)=>{let n=to(e,t);if(n){let t=null==n?void 0:n.auxiliaryTracks.find((t=>es(e.tracks[t])));return t?e.tracks[t]:void 0}})),Js(Cr(ds,to,((e,t)=>{let n=null==t?void 0:t.auxiliaryTracks.find((t=>{let n=e[t];return rs(n)&&ts(n)}));return n?e[n]:void 0}))),Js(Cr(ds,to,((e,t)=>{let n=null==t?void 0:t.auxiliaryTracks.find((t=>{let n=e[t];return rs(n)&&es(n)}));return n?e[n]:void 0}))),Js(Cr(ds,to,((e,t)=>{let n=null==t?void 0:t.auxiliaryTracks.find((t=>{let n=e[t];return is(n)&&es(n)}));return n?e[n]:void 0}))),Js(Cr(ds,to,((e,t)=>Xr(e,t))))),fo=e=>Cr(po(e),(e=>e.video)),mo=e=>Cr(po(e),(e=>e.audio)),go=(Js(((e,t)=>{let n=to(e,t);return os(e,null==n?void 0:n.audioTrack)})),Js(((e,t)=>{let n=to(e,t);return os(e,null==n?void 0:n.videoTrack)})),Js(((e,t)=>{if(t&&e.tracks[t])return 0===e.tracks[t].volume}))),vo=(Js(((e,t)=>{let n=to(e,t);return go(null==n?void 0:n.audioTrack)(e)})),Js(((e,t)=>{let n=mo(t)(e);return go(null==n?void 0:n.id)(e)})),Js(((e,t)=>{let n=no(e,t);if(n)return"audio"!==n.type?void Ys.w("Please pass audio track here"):n.volume}))),yo=(Js(((e,t)=>{let n=to(e,t);return vo(null==n?void 0:n.audioTrack)(e)})),Js(((e,t)=>{let n=mo(t)(e);return vo(null==n?void 0:n.id)(e)})),Js(((e,t)=>{let n=no(e,t);if(n)return"video"!==n.type?void Ys.w("Please pass video track here"):n.layer})),Cr([Ds,bs,Zs],((e,t,n)=>{if(n)return e.filter((e=>{var i;return!(!e.recipientPeer&&!(null==(i=e.recipientRoles)?void 0:i.length)||e.sender&&![t,n].includes(e.sender))&&[t,n].includes(e.recipientPeer)}))}))),bo=Cr([Ds,eo],((e,t)=>{if(t)return e.filter((e=>{var n,i;return!!(null==(n=e.recipientRoles)?void 0:n.length)&&(null==(i=e.recipientRoles)?void 0:i.includes(t))}))})),_o=Cr(Ds,(e=>e.filter((e=>{var t;return!e.recipientPeer&&!(null==(t=e.recipientRoles)?void 0:t.length)})))),wo=Cr([bo,eo],(e=>e?e.filter((e=>!e.read)).length:0)),So=Cr([yo,Zs],(e=>e?e.filter((e=>!e.read)).length:0)),To=(Cr(_o,(e=>e.filter((e=>!e.read)).length)),Js(yo),Js(bo),Js(wo),Js(So),Cr([ls,ds],((e,t)=>Object.values(e).map((e=>{var n;return{peer:e,isAudioEnabled:!!e.audioTrack&&(null==(n=t[e.audioTrack])?void 0:n.enabled)}})))),Cr([e=>e.roleChangeRequests[0]||null,ls,Ms],((e,t,n)=>e?{requestedBy:e.requestedBy?t[e.requestedBy]:void 0,role:n[e.roleName],token:e.token}:null)),Cr([js],(e=>{var t;let n=!1,i=!1,r=!1;return(null==(t=null==e?void 0:e.publishParams)?void 0:t.allowed)&&(n=e.publishParams.allowed.includes("video"),i=e.publishParams.allowed.includes("audio"),r=e.publishParams.allowed.includes("screen")),{video:n,audio:i,screen:r}})));Cr([ws,ds],((e,t)=>{let n=null;return e&&(n=t[e]),(null==n?void 0:n.plugins)||[]})),Cr([_s,ds],((e,t)=>{let n=null;return e&&(n=t[e]),(null==n?void 0:n.plugins)||[]}));var Eo=class{constructor(e,t,n,i){this.playlistManager=e,this.syncPlaylistState=n,this.store=i,this.type=t}play(e){return jr(this,null,(function*(){e?yield this.playlistManager.setEnabled(!0,{id:e,type:this.type}):Ys.w("Please pass id to play")}))}pause(){return jr(this,null,(function*(){let e=this.type===zr.audio?Hs:Ks,t=this.store.getState(e.selection);t.id?yield this.playlistManager.setEnabled(!1,{id:t.id,type:this.type}):Ys.w("No item is currently playing to pause")}))}playNext(){return jr(this,null,(function*(){yield this.playlistManager.playNext(this.type)}))}playPrevious(){return jr(this,null,(function*(){yield this.playlistManager.playPrevious(this.type)}))}seek(e){this.playlistManager.seek(e,this.type),this.syncPlaylistState(`seekOn${this.type}Playlist`)}seekTo(e){this.playlistManager.seekTo(e,this.type),this.syncPlaylistState(`seekToOn${this.type}Playlist`)}setVolume(e){this.playlistManager.setVolume(e,this.type),this.syncPlaylistState(`setVolumeOn${this.type}Playlist`)}setList(e){this.playlistManager.setList(e),this.syncPlaylistState(`setListOn${this.type}Playlist`)}stop(){return jr(this,null,(function*(){yield this.playlistManager.stop(this.type),this.syncPlaylistState(`stop${this.type}Playlist`)}))}setIsAutoplayOn(e){this.playlistManager.setIsAutoplayOn(this.type,e)}setPlaybackRate(e){this.playlistManager.setPlaybackRate(this.type,e),this.syncPlaylistState(`set${this.type}PlaybackRate`)}removeItem(e){return jr(this,null,(function*(){let t=yield this.playlistManager.removeItem(e,this.type);return t&&this.syncPlaylistState(`remove${this.type}PlaylistItem`),t}))}clearList(){return jr(this,null,(function*(){yield this.playlistManager.clearList(this.type),this.syncPlaylistState(`clear${this.type}Playlist`)}))}},ko={[qt.PEER_JOINED]:Br.PEER_JOINED,[qt.PEER_LEFT]:Br.PEER_LEFT,[qt.ROLE_UPDATED]:Br.ROLE_UPDATED,[qt.NAME_UPDATED]:Br.NAME_UPDATED,[qt.METADATA_UPDATED]:Br.METADATA_UPDATED},Co={[Gt.TRACK_ADDED]:Br.TRACK_ADDED,[Gt.TRACK_REMOVED]:Br.TRACK_REMOVED,[Gt.TRACK_MUTED]:Br.TRACK_MUTED,[Gt.TRACK_UNMUTED]:Br.TRACK_UNMUTED,[Gt.TRACK_DEGRADED]:Br.TRACK_DEGRADED,[Gt.TRACK_RESTORED]:Br.TRACK_RESTORED,[Gt.TRACK_DESCRIPTION_CHANGED]:Br.TRACK_DESCRIPTION_CHANGED},Io="hmsNotification",Ro=e=>Vt?`${e} ${document.title}`:e,Po=(e,t,n)=>{var i,r;let s=Ao(n,t);null==(i=e.getWebrtcInternals())||i.start();let o=null==(r=e.getWebrtcInternals())?void 0:r.onStatsChange((e=>No(t,e,n)));return()=>{s(),o&&o()}},Ao=(e,t)=>{let n,i,r;return e.getState(bs)?t.namedSetState((t=>{t.localPeer.id=e.getState(bs)}),"localpeer-id"):n=e.subscribe((e=>{e&&t.namedSetState((t=>{t.localPeer.id=e}),"localpeer-id")}),bs),e.getState(ws)?t.namedSetState((t=>{t.localPeer.videoTrack=e.getState(ws)}),"localpeer-videotrack-id"):i=e.subscribe((e=>{e&&t.namedSetState((t=>{t.localPeer.videoTrack=e}),"localpeer-videotrack-id")}),ws),e.getState(_s)?t.namedSetState((t=>{t.localPeer.videoTrack=e.getState(_s)}),"localpeer-audiotrack-id"):r=e.subscribe((e=>{e&&t.namedSetState((t=>{t.localPeer.videoTrack=e}),"localpeer-audiotrack-id")}),_s),()=>{null==n||n(),null==i||i(),null==r||r()}},No=(e,t,n)=>{let i=n.getState(ds);e.namedSetState((e=>{let r={},s=Object.keys(i);for(let e of s){let n=t.getTrackStats(e);n&&(r[e]=n)}Gr(e.trackStats,r);let o={[n.getState(bs)]:t.getLocalPeerStats()};Gr(e.peerStats,o)}),"webrtc-stats")},xo=(e,t="resetState")=>{e.namedSetState((e=>{Object.assign(e,{peerStats:{},trackStats:{},localPeer:{id:""}})}),t)},Do=e=>e.trackStats,Oo=e=>e.peerStats,Lo=Cr([Oo,e=>e.localPeer.id],((e,t)=>e[t])),Mo=(Cr(Lo,(e=>{var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.packetsLost})),Cr(Lo,(e=>{var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.jitter})),Cr(Lo,(e=>{var t;return null==(t=null==e?void 0:e.publish)?void 0:t.bitrate})),Cr(Lo,(e=>{var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.bitrate})),Cr(Lo,(e=>{var t;return null==(t=null==e?void 0:e.publish)?void 0:t.availableOutgoingBitrate})),Cr(Lo,(e=>{var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.availableIncomingBitrate})),Cr(Lo,(e=>{var t;return null==(t=null==e?void 0:e.publish)?void 0:t.bytesSent})),Cr(Lo,(e=>{var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.bytesReceived})),Cr([Oo,(e,t)=>t],((e,t)=>t?e[t]:void 0))),jo=Cr([Do,(e,t)=>t],((e,t)=>t?e[t]:void 0)),Uo=(Js(Mo),Js(jo),Js(Cr(jo,(e=>null==e?void 0:e.bitrate))),Js(Cr(jo,(e=>null==e?void 0:e.bytesReceived))),Js(Cr(jo,(e=>null==e?void 0:e.framesPerSecond))),Js(Cr(jo,(e=>null==e?void 0:e.jitter))),Js(Cr(jo,(e=>null==e?void 0:e.packetsLost))),Cr([Do,e=>e.localPeer.audioTrack],((e,t)=>t?e[t]:void 0))),Fo=Cr([Do,e=>e.localPeer.videoTrack],((e,t)=>t?e[t]:void 0)),Vo=(Cr(Uo,(e=>null==e?void 0:e.bitrate)),Cr(Fo,(e=>null==e?void 0:e.bitrate)),Cr(Uo,(e=>null==e?void 0:e.bytesSent)),Cr(Fo,(e=>null==e?void 0:e.bytesSent)),Cr(Fo,(e=>null==e?void 0:e.framesPerSecond)),Cr(Fo,(e=>null==e?void 0:e.qualityLimitationReason)),class{constructor(e,t,n){this.getStats=()=>(this.stats||(this.stats=new class{constructor(e,t){this.hmsStore=e,this.sdk=t,this.store=Vo.createNewHMSStore(Ro("HMSStatsStore"),qr),this.getState=this.store.getState,this.subscribe=this.store.subscribe,this.getPublishPeerConnection=()=>new Promise((e=>{var t,n;"Connected"===this.hmsStore.getState(Os)?e(null==(n=null==(t=this.sdk)?void 0:t.getWebrtcInternals())?void 0:n.getPublishPeerConnection()):this.hmsStore.subscribe((t=>{var n,i;"Connected"===t&&e(null==(i=null==(n=this.sdk)?void 0:n.getWebrtcInternals())?void 0:i.getPublishPeerConnection())}),Os)})),this.getSubscribePeerConnection=()=>new Promise((e=>{var t,n;"Connected"===this.hmsStore.getState(Os)?e(null==(n=null==(t=this.sdk)?void 0:t.getWebrtcInternals())?void 0:n.getSubscribePeerConnection()):this.hmsStore.subscribe((t=>{var n,i;"Connected"===t&&e(null==(i=null==(n=this.sdk)?void 0:n.getWebrtcInternals())?void 0:i.getSubscribePeerConnection())}),Os)})),this.sdk&&((e,t,n)=>{let i;n.getState(Os)===Ir.Connected&&(i=Po(e,t,n)),n.subscribe((r=>{[Ir.Connected,Ir.Reconnecting].includes(r)?i||(i=Po(e,t,n)):[Ir.Disconnected,Ir.Failed].includes(r)&&i&&(xo(t,r),i(),i=void 0)}),Os)})(this.sdk,this.store,this.hmsStore)}}(this.store,this.sdk)),this.stats),this.store=e||Vo.createNewHMSStore(Ro("HMSStore"),$r),this.notifications=n||new class{constructor(e){this.id=0,this.onNotification=(e,t)=>{let n=n=>{if(t){let e;if(e=Array.isArray(t)?t.includes(n.type):t===n.type,!e)return}e(n)};return this.eventEmitter.addListener(Io,n),()=>{this.eventEmitter.removeListener(Io,n)}},this.store=e,this.eventEmitter=new Et.EventEmitter2({maxListeners:Object.keys(Br).length})}sendPlaylistTrackEnded(e){let t=this.createNotification(Br.PLAYLIST_TRACK_ENDED,e,Vr.INFO);this.emitEvent(t)}sendDeviceChange(e){var t;let n=this.createNotification(Br.DEVICE_CHANGE_UPDATE,e,e.error?Vr.ERROR:Vr.INFO,`Selected ${e.type} device - ${null==(t=e.selection)?void 0:t.label}`);this.emitEvent(n)}sendLeaveRoom(e){var t;let n=null==(t=e.requestedBy)?void 0:t.name,i=this.createNotification(e.roomEnded||!n?Br.ROOM_ENDED:Br.REMOVED_FROM_ROOM,e,Vr.INFO,`${e.roomEnded?"Room ended":"Removed from room"} ${n?`by ${n}`:""}`);this.emitEvent(i)}sendPeerList(e){let t=this.createNotification(Br.PEER_LIST,e,Vr.INFO);this.emitEvent(t)}sendPeerUpdate(e,t){let n=this.store.getState(ao(null==t?void 0:t.id))||t,i=ko[e];if(i){let e=this.createNotification(i,n,Vr.INFO);this.emitEvent(e)}}sendTrackUpdate(e,t){let n=this.store.getState(lo(t)),i=Co[e];if(i){let e=this.createNotification(i,n,Vr.INFO);this.emitEvent(e)}}sendMessageReceived(e){let t=this.createNotification(Br.NEW_MESSAGE,e,Vr.INFO);this.emitEvent(t)}sendError(e){let t=this.createNotification(Br.ERROR,e,Vr.ERROR);this.emitEvent(t)}sendReconnecting(e){let t=this.createNotification(Br.RECONNECTING,e,Vr.ERROR);this.emitEvent(t)}sendReconnected(){let e=this.createNotification(Br.RECONNECTED,null,Vr.INFO);this.emitEvent(e)}sendChangeTrackStateRequest(e){let t=this.createNotification(Br.CHANGE_TRACK_STATE_REQUEST,e,Vr.INFO);this.emitEvent(t)}sendChangeMultiTrackStateRequest(e){let t=this.createNotification(Br.CHANGE_MULTI_TRACK_STATE_REQUEST,e,Vr.INFO);this.emitEvent(t)}emitEvent(e){this.eventEmitter.emit(Io,e)}createNotification(e,t,n,i=""){return this.id++,{id:this.id,type:e,message:i,data:t,severity:n}}}(this.store),t?this.actions=t:(this.sdk=new class{constructor(){this.TAG="[HMSSdk]:",this.transportState=Hi.Disconnected,this.analyticsTimer=new class{constructor(){this.eventPerformanceMeasures={}}start(e){performance.mark(e)}end(e){var t;try{this.eventPerformanceMeasures[e]=performance.measure(e,e),Jt.d("[HMSPerformanceTiming]",e,null==(t=this.eventPerformanceMeasures[e])?void 0:t.duration)}catch(t){Jt.w("[AnalyticsTimer]",`Error in measuring performance for event ${e}`,{error:t})}}getTimeTaken(e){var t;return null==(t=this.eventPerformanceMeasures[e])?void 0:t.duration}getTimes(...e){return e.reduce(((e,t)=>Dt(xt({},e),{[t]:this.getTimeTaken(t)})),{})}cleanUp(){this.eventPerformanceMeasures={}}},this.sdkState=xt({},Er),this.handleAutoplayError=e=>{var t,n;null==(n=null==(t=this.errorListener)?void 0:t.onError)||n.call(t,e)},this.observer={onNotification:e=>{e.method!==Kn.PEER_LEAVE_REQUEST?(e.method===Kn.POLICY_CHANGE&&this.analyticsTimer.end(Vi.ON_POLICY_CHANGE),this.notificationManager.handleNotification(e,this.sdkState.isReconnecting)):this.handlePeerLeaveRequest(e.params)},onTrackAdd:e=>{this.notificationManager.handleTrackAdd(e)},onTrackRemove:e=>{this.notificationManager.handleTrackRemove(e)},onTrackDegrade:e=>{var t,n;Jt.d(this.TAG,"Sending Track Update Track Degraded",e),null==(n=this.listener)||n.onTrackUpdate(Gt.TRACK_DEGRADED,e,null==(t=this.store)?void 0:t.getPeerByTrackId(e.trackId))},onTrackRestore:e=>{var t,n;Jt.d(this.TAG,"Sending Track Update Track Restored",e),null==(n=this.listener)||n.onTrackUpdate(Gt.TRACK_RESTORED,e,null==(t=this.store)?void 0:t.getPeerByTrackId(e.trackId))},onFailure:e=>{var t;null==(t=this.errorListener)||t.onError(e)},onStateChange:(e,t)=>Lt(this,null,(function*(){var n,i,r,s;switch(e){case Hi.Preview:case Hi.Joined:this.transportState===Hi.Reconnecting&&(null==(n=this.listener)||n.onReconnected());break;case Hi.Failed:yield this.leave(),null==(r=null==(i=this.errorListener)?void 0:i.onError)||r.call(i,t),this.sdkState.isReconnecting=!1;break;case Hi.Reconnecting:this.sdkState.isReconnecting=!0,null==(s=this.listener)||s.onReconnecting(t)}this.transportState=e,Jt.d(this.TAG,"Transport State Change",this.transportState)}))},this.handlePeerLeaveRequest=e=>{var t;let n=e.requested_by?this.store.getPeerById(e.requested_by):void 0,i={roomEnded:e.room_end,reason:e.reason,requestedBy:n};null==(t=this.listener)||t.onRemovedFromRoom(i),this.internalLeave(!1)},this.handleDeviceChange=e=>{var t,n,i,r,s,o;if(Jt.d(this.TAG,"Device Change event",e),null==(n=null==(t=this.deviceChangeListener)?void 0:t.onDeviceChange)||n.call(t,e),e.error&&e.type){let t=e.type.includes("audio")?null==(i=this.localPeer)?void 0:i.audioTrack:null==(r=this.localPeer)?void 0:r.videoTrack;null==(s=this.errorListener)||s.onError(e.error),[nn.TracksErrors.CANT_ACCESS_CAPTURE_DEVICE,nn.TracksErrors.DEVICE_IN_USE,nn.TracksErrors.DEVICE_NOT_AVAILABLE].includes(e.error.code)&&t&&(t.setEnabled(!1),null==(o=this.listener)||o.onTrackUpdate(Gt.TRACK_MUTED,t,this.localPeer))}},this.handleAudioPluginError=e=>{var t;Jt.e(this.TAG,"Audio Plugin Error event",e),null==(t=this.errorListener)||t.onError(e)},this.handleLocalRoleUpdate=e=>Lt(this,[e],(function*({oldRole:e,newRole:t}){var n;yield this.transport.handleLocalRoleUpdate({oldRole:e,newRole:t}),yield null==(n=this.roleChangeManager)?void 0:n.handleLocalPeerRoleUpdate({oldRole:e,newRole:t})})),this.getScreenshareSettings=e=>{let{screen:t}=this.store.getPublishParams(),n=this.store.getSimulcastDimensions("screen");return{video:(new Yn).maxBitrate(t.bitRate,!1).codec(t.codec).maxFramerate(t.frameRate).setWidth((null==n?void 0:n.width)||t.width).setHeight((null==n?void 0:n.height)||t.height).build(),audio:e?void 0:(new Jn).build()}},this.sendAudioPresenceFailed=()=>{let e=sn.TracksErrors.NoAudioDetected(tn.PREVIEW);this.sendAnalyticsEvent(Fi.audioDetectionFail(e,this.deviceManager.getCurrentSelection().audioInput))},this.sendJoinAnalyticsEvent=(e=!1,t)=>{this.eventBus.analytics.publish(Fi.join(Dt(xt({error:t},this.analyticsTimer.getTimes(Vi.INIT,Vi.WEBSOCKET_CONNECT,Vi.ON_POLICY_CHANGE,Vi.LOCAL_TRACKS)),{time:this.analyticsTimer.getTimeTaken(Vi.JOIN),is_preview_called:e})))},this.sendPreviewAnalyticsEvent=e=>{this.eventBus.analytics.publish(Fi.preview(Dt(xt({error:e},this.analyticsTimer.getTimes(Vi.INIT,Vi.WEBSOCKET_CONNECT,Vi.ON_POLICY_CHANGE,Vi.LOCAL_TRACKS)),{time:this.analyticsTimer.getTimeTaken(Vi.PREVIEW)})))},this.sendAnalyticsEvent=e=>{this.analyticsEventsService.queue(e).flush()}}initStoreAndManagers(){if(this.sdkState.isInitialised)return this.notificationManager.setListener(this.listener),void this.audioSinkManager.setListener(this.listener);this.sdkState.isInitialised=!0,this.store=new class{constructor(){this.comparator=new class{constructor(e){this.store=e,this.primitiveComparator=(e,t)=>e===t?0:Number(e)-Number(t),this.stringComparator=(e,t)=>e===t?0:e<t?-1:1}getPeerComparators(){return{videoEnabled:(e,t)=>{var n,i;return this.primitiveComparator(Boolean(null==(n=e.videoTrack)?void 0:n.enabled),Boolean(null==(i=t.videoTrack)?void 0:i.enabled))},audioEnabled:(e,t)=>{var n,i;return this.primitiveComparator(Boolean(null==(n=e.audioTrack)?void 0:n.enabled),Boolean(null==(i=t.audioTrack)?void 0:i.enabled))},screenShare:(e,t)=>this.primitiveComparator(e.auxiliaryTracks.some((e=>"screen"===e.source)),t.auxiliaryTracks.some((e=>"screen"===e.source))),audioLevel:(e,t)=>{var n,i;return this.primitiveComparator((null==(n=this.store.getSpeakers().find((t=>t.peer&&t.peer.peerId===(null==e?void 0:e.peerId))))?void 0:n.audioLevel)||-1,(null==(i=this.store.getSpeakers().find((e=>e.peer&&e.peer.peerId===(null==t?void 0:t.peerId))))?void 0:i.audioLevel)||-1)},rolePriority:(e,t)=>{var n,i;return this.primitiveComparator((null==(n=t.role)?void 0:n.priority)||0,(null==(i=e.role)?void 0:i.priority)||0)}}}getTrackComparators(){return{video:(e,t)=>this.primitiveComparator(e.type===un.VIDEO,t.type===un.VIDEO),audio:(e,t)=>this.primitiveComparator(e.type===un.AUDIO,t.type===un.AUDIO),enabled:(e,t)=>this.primitiveComparator(Boolean(e.enabled),Boolean(t.enabled)),peerAudioLevel:(e,t)=>{let n=this.store.getPeerByTrackId(e.trackId),i=this.store.getPeerByTrackId(t.trackId);return this.getPeerComparators().audioLevel(n,i)},audioLevel:(e,t)=>{var n,i;return this.primitiveComparator((null==(n=this.store.getSpeakers().find((t=>t.track.trackId===e.trackId)))?void 0:n.audioLevel)||0,(null==(i=this.store.getSpeakers().find((e=>e.track.trackId===t.trackId)))?void 0:i.audioLevel)||0)},screenShare:(e,t)=>this.primitiveComparator("screen"===e.source,"screen"===t.source),rolePriority:(e,t)=>{var n,i,r,s;return this.primitiveComparator((null==(i=null==(n=this.store.getPeerByTrackId(t.trackId))?void 0:n.role)?void 0:i.priority)||0,(null==(s=null==(r=this.store.getPeerByTrackId(e.trackId))?void 0:r.role)?void 0:s.priority)||0)}}}}(this),this.knownRoles={},this.peers={},this.tracks={},this.peerTrackStates={},this.speakers=[],this.videoLayers=null,this.screenshareLayers=null,this.roleDetailsArrived=!1,this.env=St.PROD,this.userAgent=yi(this.env)}getConfig(){return this.config}getEnv(){return this.env}getPublishParams(){return this.publishParams}getComparator(){return this.comparator}getRoom(){return this.room}getPolicyForRole(e){return this.knownRoles[e]}getKnownRoles(){return this.knownRoles}getLocalPeer(){if(this.localPeerId&&this.peers[this.localPeerId])return this.peers[this.localPeerId]}getRemotePeers(){return Object.values(this.peers).filter((e=>!e.isLocal))}getPeers(){return Object.values(this.peers)}getPeerById(e){if(this.peers[e])return this.peers[e]}getTracksMap(){return this.tracks}getTracks(){return Object.values(this.tracks)}getVideoTracks(){return this.getTracks().filter((e=>e.type===un.VIDEO))}getRemoteVideoTracks(){return this.getTracks().filter((e=>e instanceof Bn))}getAudioTracks(){return this.getTracks().filter((e=>e.type===un.AUDIO))}getPeerTracks(e){let t=e?this.peers[e]:void 0,n=[];return(null==t?void 0:t.videoTrack)&&n.push(t.videoTrack),(null==t?void 0:t.audioTrack)&&n.push(t.audioTrack),n.concat((null==t?void 0:t.auxiliaryTracks)||[])}getLocalPeerTracks(){return this.getPeerTracks(this.localPeerId)}getTrackById(e){var t,n;let i=this.tracks[e];if(i)return i;let r=this.getLocalPeer();if(r){if(null==(t=r.audioTrack)?void 0:t.isPublishedTrackId(e))return r.audioTrack;if(null==(n=r.videoTrack)?void 0:n.isPublishedTrackId(e))return r.videoTrack}}getPeerByTrackId(e){let t=this.tracks[e];return t.peerId?this.peers[t.peerId]:void 0}getSpeakers(){return this.speakers}getSpeakerPeers(){return this.speakers.map((e=>e.peer))}getUserAgent(){return this.userAgent}createAndSetUserAgent(e){this.userAgent=yi(this.env,e)}setRoom(e){this.room=e}setKnownRoles(e){this.knownRoles=e,this.roleDetailsArrived=!0,this.updatePeersPolicy()}hasRoleDetailsArrived(){return this.roleDetailsArrived}setConfig(e){var t,n,i;if(Ii.rememberDevices(Boolean(e.rememberDeviceSelection)),e.rememberDeviceSelection){let r=Ii.getSelection();r&&(e.settings||(e.settings={}),(null==(t=r.audioInput)?void 0:t.deviceId)&&(e.settings.audioInputDeviceId=e.settings.audioInputDeviceId||r.audioInput.deviceId),(null==(n=r.audioOutput)?void 0:n.deviceId)&&(e.settings.audioOutputDeviceId=e.settings.audioOutputDeviceId||r.audioOutput.deviceId),(null==(i=r.videoInput)?void 0:i.deviceId)&&(e.settings.videoDeviceId=e.settings.videoDeviceId||r.videoInput.deviceId))}this.config=e,this.setEnv()}setPublishParams(e){this.publishParams=e}addPeer(e){this.peers[e.peerId]=e,e.isLocal&&(this.localPeerId=e.peerId)}addTrack(e){this.tracks[e.trackId]=e}getTrackState(e){return this.peerTrackStates[e]}setTrackState(e){this.peerTrackStates[e.trackInfo.track_id]=e}removePeer(e){this.localPeerId===e&&(this.localPeerId=void 0),delete this.peers[e]}removeTrack(e){delete this.tracks[e]}updateSpeakers(e){this.speakers=e}updateAudioOutputVolume(e){this.getAudioTracks().forEach((t=>t.setVolume(e)))}updateAudioOutputDevice(e){return Lt(this,null,(function*(){let t=[];this.getAudioTracks().forEach((n=>{t.push(n.setOutputDevice(e))})),yield Promise.all(t)}))}getSubscribeDegradationParams(){var e,t;let n=null==(t=null==(e=this.getLocalPeer())?void 0:e.role)?void 0:t.subscribeParams.subscribeDegradation;if(n&&Object.keys(n).length>0)return n}getSimulcastLayers(e){var t,n;return"screen"===e?(null==(t=this.screenshareLayers)?void 0:t.layers)||[]:(null==(n=this.videoLayers)?void 0:n.layers)||[]}getSimulcastDimensions(e){let t="screen"===e?this.screenshareLayers:this.videoLayers;return{width:null==t?void 0:t.width,height:null==t?void 0:t.height}}convertSimulcastLayers(e){return Dt(xt({},e),{layers:(e.layers||[]).map((e=>Dt(xt({},e),{maxBitrate:1e3*e.maxBitrate})))})}setVideoSimulcastLayers(e){this.videoLayers=this.convertSimulcastLayers(e)}setScreenshareSimulcastLayers(e){this.screenshareLayers=this.convertSimulcastLayers(e)}getSimulcastDefinitionsForPeer(e,t){var n;if(!e.role)return[];let i,r=this.getPolicyForRole(e.role.name).publishParams;"regular"===t?i=r.videoSimulcastLayers:"screen"===t&&(i=r.screenSimulcastLayers);let s=null==i?void 0:i.width,o=null==i?void 0:i.height;return(null==(n=null==i?void 0:i.layers)?void 0:n.map((e=>({layer:en[e.rid],resolution:{width:s&&e.scaleResolutionDownBy?s/e.scaleResolutionDownBy:void 0,height:o&&e.scaleResolutionDownBy?o/e.scaleResolutionDownBy:void 0}}))))||[]}cleanUp(){let e=this.getTracks();for(let t of e)t.cleanup();this.room=void 0,this.config=void 0,this.localPeerId=void 0,this.roleDetailsArrived=!1}setErrorListener(e){this.errorListener=e}updatePeersPolicy(){this.getPeers().forEach((e=>{var t;e.role?e.role=this.getPolicyForRole(e.role.name):null==(t=this.errorListener)||t.onError(sn.GenericErrors.InvalidRole(tn.VALIDATION,""))}))}setEnv(){var e;let t=(null==(e=this.config)?void 0:e.initEndpoint).split("https://")[1],n=St.PROD;t.startsWith(St.PROD)?n=St.PROD:t.startsWith(St.QA)?n=St.QA:t.startsWith(St.DEV)&&(n=St.DEV),this.env=n,er.setEnv(n)}},this.eventBus=new class{constructor(){this.eventEmitter=new Et.EventEmitter2,this.deviceChange=new Sr(gn,this.eventEmitter),this.localAudioEnabled=new Sr(vn,this.eventEmitter),this.localVideoEnabled=new Sr(yn,this.eventEmitter),this.statsUpdate=new Sr(bn,this.eventEmitter),this.trackDegraded=new Sr(_n,this.eventEmitter),this.trackRestored=new Sr(wn,this.eventEmitter),this.trackAudioLevelUpdate=new Sr(Sn,this.eventEmitter),this.audioPluginFailed=new Sr(kn,this.eventEmitter),this.localAudioSilence=new Sr(Tn,this.eventEmitter),this.analytics=new Sr(En,this.eventEmitter),this.policyChange=new Sr(Cn,this.eventEmitter),this.localRoleUpdate=new Sr(In,this.eventEmitter),this.audioTrackUpdate=new Sr(Rn,this.eventEmitter),this.audioTrackAdded=new Sr(Pn,this.eventEmitter),this.audioTrackRemoved=new Sr(An,this.eventEmitter),this.autoplayError=new Sr(Nn,this.eventEmitter)}},this.networkTestManager=new class{constructor(e,t){this.eventBus=e,this.listener=t,this.TAG="NetworkTestManager",this.controller=new AbortController,this.start=e=>Lt(this,null,(function*(){var t;if(!e)return;let{url:n,timeout:i,scoreMap:r}=e,s=this.controller.signal,o=Date.now(),a=0,l=Hn(i).then((()=>{this.controller.abort()}));try{let e=null==(t=(yield fetch(`${n}?${Date.now()}`,{signal:s})).body)?void 0:t.getReader();if(!e)throw Error("unable to process request");let i=()=>Lt(this,null,(function*(){if(e)try{let t=!1;for(;!t;){let{value:n,done:i}=yield e.read();t=i,n&&(a+=n.byteLength,this.sendScore({scoreMap:r,downloadedSize:a,startTime:o}))}}catch(e){Jt.e(this.TAG,e)}}));return Promise.race([i(),l]).then((()=>{this.sendScore({scoreMap:r,downloadedSize:a,startTime:o,finished:!0})})).catch((e=>{Jt.e(this.TAG,e),this.updateScoreToListener(0),this.eventBus.analytics.publish(Fi.previewNetworkQuality({error:e.message}))}))}catch(e){Jt.e(this.TAG,e),"AbortError"!==e.name&&(this.updateScoreToListener(0),this.eventBus.analytics.publish(Fi.previewNetworkQuality({error:e.message})))}})),this.stop=()=>{this.controller.signal.aborted||this.controller.abort()},this.sendScore=({scoreMap:e,downloadedSize:t,startTime:n,finished:i=!1})=>{let r=t/1024/((Date.now()-n)/1e3)*8,s=-1;for(let t in e){let n=e[t];r>=n.low&&(!n.high||r<=n.high)&&(s=Number(t))}this.updateScoreToListener(s),i&&this.eventBus.analytics.publish(Fi.previewNetworkQuality({score:s,downLink:r.toFixed(2)}))}}updateScoreToListener(e){var t,n;e!==this.score&&(this.score=e,null==(n=null==(t=this.listener)?void 0:t.onNetworkQuality)||n.call(t,e))}}(this.eventBus,this.listener),this.playlistManager=new wr(this,this.eventBus),this.notificationManager=new class{constructor(e,t,n,i,r){this.store=e,this.listener=n,this.audioListener=i,this.connectionQualityListener=r,this.TAG="[HMSNotificationManager]",this.hasConsistentRoomStateArrived=!1,this.ignoreNotification=e=>{if(e===Kn.PEER_LIST)this.hasConsistentRoomStateArrived=!0;else if(e===Kn.ROOM_STATE)return this.hasConsistentRoomStateArrived;return!1},this.handleTrackAdd=e=>{this.trackManager.handleTrackAdd(e)},this.handleTrackRemove=e=>{this.trackManager.handleTrackRemove(e)},this.updateLocalPeer=({name:e,metadata:t})=>{let n=this.store.getLocalPeer();this.peerManager.handlePeerInfoUpdate({peer:n,name:e,data:t})},this.trackManager=new class{constructor(e,t,n){this.store=e,this.eventBus=t,this.listener=n,this.tracksToProcess=new Map,this.handleTrackAdd=e=>{Jt.d(this.TAG,"ONTRACKADD",`${e}`),this.store.addTrack(e),this.tracksToProcess.set(e.trackId,e),this.processPendingTracks()},this.handleTrackRemove=e=>{var t;Jt.d(this.TAG,"ONTRACKREMOVE",`${e}`);let n=this.store.getTrackState(e.trackId);if(!n)return;e.type===un.AUDIO&&this.eventBus.audioTrackRemoved.publish(e);let i=this.store.getPeerById(n.peerId);!i||(this.removePeerTracks(i,e),this.store.removeTrack(e.trackId),null==(t=this.listener)||t.onTrackUpdate(Gt.TRACK_REMOVED,e,i))},this.handleTrackLayerUpdate=e=>{var t,n;for(let i in e.tracks){let r=e.tracks[i],s=this.store.getTrackById(i);if(!s)continue;let o=this.store.getPeerByTrackId(i);if(o&&s instanceof Bn){let e=this.isTrackDegraded(r.expected_layer,r.current_layer);s.setLayerFromServer(r.current_layer,e),e?null==(t=this.listener)||t.onTrackUpdate(Gt.TRACK_DEGRADED,s,o):null==(n=this.listener)||n.onTrackUpdate(Gt.TRACK_RESTORED,s,o)}}},this.handleTrackUpdate=e=>{var t,n;let i=this.store.getPeerById(e.peer.peer_id);if(i)for(let r in e.tracks){let s=Object.assign({},null==(t=this.store.getTrackState(r))?void 0:t.trackInfo),o=e.tracks[r],a=this.store.getTrackById(r);if(this.store.setTrackState({peerId:e.peer.peer_id,trackInfo:xt(xt({},s),o)}),!a||this.tracksToProcess.has(r))this.processPendingTracks();else{a.setEnabled(!o.mute);let e=this.processTrackUpdate(a,s,o);e&&(null==(n=this.listener)||n.onTrackUpdate(e,a,i))}}}}get TAG(){return`[${this.constructor.name}]`}isTrackDegraded(e,t){let n=e=>{switch(e){case Ht.HIGH:return 3;case Ht.MEDIUM:return 2;case Ht.LOW:return 1;case Ht.NONE:return 0}};return n(t)<n(e)}handleTrackMetadataAdd(e){Jt.d(this.TAG,"TRACK_METADATA_ADD",JSON.stringify(e,null,2));for(let t in e.tracks)this.store.setTrackState({peerId:e.peer.peer_id,trackInfo:e.tracks[t]});this.processPendingTracks()}processPendingTracks(){new Map(this.tracksToProcess).forEach((e=>{var t;let n=this.store.getTrackState(e.trackId);if(!n)return;let i=this.store.getPeerById(n.peerId);!i||(e.source=n.trackInfo.source,e.peerId=i.peerId,e.logIdentifier=i.name,e.setEnabled(!n.trackInfo.mute),this.addAudioTrack(i,e),this.addVideoTrack(i,e),e.type===un.AUDIO?this.eventBus.audioTrackAdded.publish({track:e,peer:i}):null==(t=this.listener)||t.onTrackUpdate(Gt.TRACK_ADDED,e,i),this.tracksToProcess.delete(e.trackId))}))}removePeerTracks(e,t){var n,i;let r=e.auxiliaryTracks.indexOf(t);r>-1?e.auxiliaryTracks.splice(r,1):t.type===un.AUDIO&&(null==(n=e.audioTrack)?void 0:n.trackId)===t.trackId?e.audioTrack=void 0:t.type===un.VIDEO&&(null==(i=e.videoTrack)?void 0:i.trackId)===t.trackId&&(e.videoTrack=void 0)}addAudioTrack(e,t){t.type===un.AUDIO&&(e.audioTrack||"regular"!==t.source?e.auxiliaryTracks.push(t):e.audioTrack=t)}addVideoTrack(e,t){if(t.type!==un.VIDEO)return;let n=t,i=this.store.getSimulcastDefinitionsForPeer(e,n.source);n.setSimulcastDefinitons(i),e.videoTrack||"regular"!==t.source?e.auxiliaryTracks.push(n):e.videoTrack=n}processTrackUpdate(e,t,n){let i;return e.setEnabled(!n.mute),t.mute!==n.mute?(i=n.mute?Gt.TRACK_MUTED:Gt.TRACK_UNMUTED,e.type===un.AUDIO&&this.eventBus.audioTrackUpdate.publish({track:e,enabled:!n.mute})):t.description!==n.description&&(i=Gt.TRACK_DESCRIPTION_CHANGED),i}}(this.store,t,this.listener),this.peerManager=new class{constructor(e,t,n){this.store=e,this.trackManager=t,this.listener=n,this.handlePeerList=e=>{var t,n;if(0===e.length)return void(null==(t=this.listener)||t.onPeerUpdate(qt.PEER_LIST,[]));let i=[],r=new Set(e.map((e=>e.peer_id)));this.store.getRemotePeers().forEach((({peerId:e,fromRoomState:t})=>{!r.has(e)&&t&&this.store.removePeer(e)}));for(let t of e)i.push(this.makePeer(t));null==(n=this.listener)||n.onPeerUpdate(qt.PEER_LIST,i),this.trackManager.processPendingTracks()},this.handlePeerJoin=e=>{var t;let n=this.makePeer(e);null==(t=this.listener)||t.onPeerUpdate(qt.PEER_JOINED,n),this.trackManager.processPendingTracks()},this.handlePeerLeave=e=>{var t,n,i,r;let s=this.store.getPeerById(e.peer_id);this.store.removePeer(e.peer_id),Jt.d(this.TAG,"PEER_LEAVE",e.peer_id,`remainingPeers=${this.store.getPeers().length}`),s&&(s.audioTrack&&(null==(t=this.listener)||t.onTrackUpdate(Gt.TRACK_REMOVED,s.audioTrack,s)),s.videoTrack&&(null==(n=this.listener)||n.onTrackUpdate(Gt.TRACK_REMOVED,s.videoTrack,s)),null==(i=s.auxiliaryTracks)||i.forEach((e=>{var t;null==(t=this.listener)||t.onTrackUpdate(Gt.TRACK_REMOVED,e,s)})),null==(r=this.listener)||r.onPeerUpdate(qt.PEER_LEFT,s))}}get TAG(){return`[${this.constructor.name}]`}handleNotification(e,t){switch(e){case Kn.PEER_JOIN:{let e=t;this.handlePeerJoin(e);break}case Kn.PEER_LEAVE:{let e=t;this.handlePeerLeave(e);break}case Kn.PEER_UPDATE:this.handlePeerUpdate(t)}}handlePeerUpdate(e){var t;let n=this.store.getPeerById(e.peer_id);if(n){if(n.role&&n.role.name!==e.role){let i=this.store.getPolicyForRole(e.role);n.updateRole(i),null==(t=this.listener)||t.onPeerUpdate(qt.ROLE_UPDATED,n)}this.handlePeerInfoUpdate(xt({peer:n},e.info))}}handlePeerInfoUpdate({peer:e,name:t,data:n}){var i,r;!e||(t&&e.name!==t&&(e.updateName(t),null==(i=this.listener)||i.onPeerUpdate(qt.NAME_UPDATED,e)),n&&e.metadata!==n&&(e.updateMetadata(n),null==(r=this.listener)||r.onPeerUpdate(qt.METADATA_UPDATED,e)))}makePeer(e){let t=new oi({peerId:e.peer_id,name:e.info.name,customerUserId:e.info.user_id,metadata:e.info.data,role:this.store.getPolicyForRole(e.role),joinedAt:ai(e.joined_at),fromRoomState:!!e.is_from_room_state});this.store.addPeer(t),Jt.d(this.TAG,"adding to the peerList",t.toString());for(let t in e.tracks)this.store.setTrackState({peerId:e.peer_id,trackInfo:e.tracks[t]});return t}}(this.store,this.trackManager,this.listener),this.peerListManager=new class{constructor(e,t,n,i){this.store=e,this.peerManager=t,this.trackManager=n,this.listener=i,this.handleInitialPeerList=e=>{let t=Object.values(e.peers);this.peerManager.handlePeerList(t)},this.handleReconnectPeerList=e=>{this.handleRepeatedPeerList(e.peers)},this.handlePreviewRoomState=e=>{if(!this.store.hasRoleDetailsArrived())return;let t=e.peers;null!=t?(Object.keys(t).forEach((e=>{t[e].tracks={},t[e].is_from_room_state=!0})),this.handleRepeatedPeerList(t)):0===e.peer_count&&this.handleRepeatedPeerList({})},this.handleRepeatedPeerList=e=>{let t=this.store.getRemotePeers(),n=Object.values(e),i=t.filter((t=>!e[t.peerId]));Jt.d(this.TAG,`${i}`),i.forEach((e=>{var t;let n={peer_id:e.peerId,role:(null==(t=e.role)?void 0:t.name)||"",info:{name:e.name,data:e.metadata||"",user_id:e.customerUserId||""},tracks:{}};this.peerManager.handlePeerLeave(n)})),n.forEach((e=>{let t=this.store.getPeerById(e.peer_id),n=Object.values(e.tracks);t?(this.store.getPeerTracks(t.peerId).forEach((n=>{var i;e.tracks[n.trackId]||(this.removePeerTrack(t,n.trackId),null==(i=this.listener)||i.onTrackUpdate(Gt.TRACK_REMOVED,n,t))})),n.forEach((e=>{this.store.getTrackById(e.track_id)||this.store.setTrackState({peerId:t.peerId,trackInfo:e})})),this.trackManager.handleTrackUpdate({peer:{info:e.info,peer_id:e.peer_id},tracks:e.tracks}),this.peerManager.handlePeerUpdate(e)):this.peerManager.handlePeerJoin(e)}))}}get TAG(){return`[${this.constructor.name}]`}handleNotification(e,t,n){if(e===Kn.PEER_LIST){let e=t;n?(Jt.d(this.TAG,"RECONNECT_PEER_LIST event",JSON.stringify(e,null,2)),this.handleReconnectPeerList(e)):(Jt.d(this.TAG,"PEER_LIST event",JSON.stringify(e,null,2)),this.handleInitialPeerList(e))}else if(e===Kn.ROOM_STATE){let e=t;this.handlePreviewRoomState(e)}}removePeerTrack(e,t){var n,i;if((null==(n=e.audioTrack)?void 0:n.trackId)===t)e.audioTrack=void 0;else if((null==(i=e.videoTrack)?void 0:i.trackId)===t)e.videoTrack=void 0;else{let n=e.auxiliaryTracks.findIndex((e=>e.trackId===t));n>=0&&e.auxiliaryTracks.splice(n,1)}}}(this.store,this.peerManager,this.trackManager,this.listener),this.broadcastManager=new class{constructor(e,t){this.store=e,this.listener=t}get TAG(){return`[${this.constructor.name}]`}handleNotification(e,t){e===Kn.BROADCAST&&this.handleBroadcast(t)}handleBroadcast(e){var t;let n=e.peer,i=e.info,r=e.roles,s=this.getSender(n),o=e.private?this.store.getLocalPeer():void 0,a=[];if(null==r?void 0:r.length){let e=this.store.getKnownRoles();for(let t of r)e[t]&&a.push(e[t])}let l=new ti(Dt(xt({},i),{sender:s,recipientRoles:a,recipientPeer:o,time:new Date(e.timestamp)}));Jt.d(this.TAG,`Received Message from sender=${null==n?void 0:n.peer_id}: ${l}`),null==(t=this.listener)||t.onMessageReceived(l)}getSender(e){let t=e?this.store.getPeerById(e.peer_id):void 0;return!t&&e&&(t=new ni({peerId:e.peer_id,name:e.info.name,isLocal:!1,customerUserId:e.info.user_id,metadata:e.info.data})),t}}(this.store,this.listener),this.policyChangeManager=new class{constructor(e,t){this.store=e,this.eventBus=t}handlePolicyChange(e){var t;let n=this.store.getLocalPeer();if(n&&!n.role){let t=e.known_roles[e.name];n.updateRole(t)}this.store.setKnownRoles(e.known_roles),this.store.getRoom().templateId=e.template_id;let i=null==(t=e.known_roles[e.name])?void 0:t.publishParams;if(this.store.setPublishParams(i),this.setSimulcastLayers(i),(null==n?void 0:n.role)&&n.role.name!==e.name){let t=this.store.getPolicyForRole(e.name),i=n.role;n.updateRole(t),this.eventBus.localRoleUpdate.publish({oldRole:i,newRole:t})}this.eventBus.policyChange.publish(e)}setSimulcastLayers(e){if(e&&Object.keys(e).length>0){let{videoSimulcastLayers:t,screenSimulcastLayers:n}=e;this.store.setVideoSimulcastLayers(t),this.store.setScreenshareSimulcastLayers(n)}}}(this.store,t),this.requestManager=new class{constructor(e,t){this.store=e,this.listener=t}handleNotification(e,t){switch(e){case Kn.ROLE_CHANGE_REQUEST:this.handleRoleChangeRequest(t);break;case Kn.TRACK_UPDATE_REQUEST:this.handleTrackUpdateRequest(t);break;case Kn.CHANGE_TRACK_MUTE_STATE_UPDATE:this.handleChangeTrackStateRequest(t);break;default:return}}handleRoleChangeRequest(e){var t;let n={requestedBy:e.requested_by?this.store.getPeerById(e.requested_by):void 0,role:this.store.getPolicyForRole(e.role),token:e.token};null==(t=this.listener)||t.onRoleChangeRequest(n)}handleTrackUpdateRequest(e){let{requested_by:t,track_id:n,mute:i}=e,r=t?this.store.getPeerById(t):void 0,s=this.store.getLocalPeerTracks().find((e=>e.publishedTrackId===n));if(!s)return;let o=()=>{var e;null==(e=this.listener)||e.onChangeTrackStateRequest({requestedBy:r,track:s,enabled:!i})};if(i){if(s.enabled===!i)return;s.setEnabled(!i).then(o)}else o()}handleChangeTrackStateRequest(e){var t;let{type:n,source:i,value:r,requested_by:s}=e,o=s?this.store.getPeerById(s):void 0,a=!r,l=this.getTracksToBeUpdated({type:n,source:i,enabled:a});if(0!==l.length)if(a)null==(t=this.listener)||t.onChangeMultiTrackStateRequest({requestedBy:o,tracks:l,type:n,source:i,enabled:!0});else{let e=[];for(let t of l)e.push(t.setEnabled(!1));Promise.all(e).then((()=>{var e;null==(e=this.listener)||e.onChangeMultiTrackStateRequest({requestedBy:o,tracks:l,enabled:!1})}))}}getTracksToBeUpdated({type:e,source:t,enabled:n}){let i=this.store.getLocalPeerTracks();return e&&(i=i.filter((t=>t.type===e))),t&&(i=i.filter((e=>e.source===t))),i.filter((e=>e.enabled!==n))}}(this.store,this.listener),this.activeSpeakerManager=new class{constructor(e,t,n){this.store=e,this.listener=t,this.audioListener=n}handleActiveSpeakers(e){var t,n,i;let r=e["speaker-list"],s=r.map((e=>({audioLevel:e.level,peer:this.store.getPeerById(e.peer_id),track:this.store.getTrackById(e.track_id)})));null==(t=this.audioListener)||t.onAudioLevelUpdate(s),this.store.updateSpeakers(s);let o=r[0];if(o){let e=this.store.getPeerById(o.peer_id);null==(n=this.listener)||n.onPeerUpdate(qt.BECAME_DOMINANT_SPEAKER,e)}else null==(i=this.listener)||i.onPeerUpdate(qt.RESIGNED_DOMINANT_SPEAKER,null)}}(this.store,this.listener,this.audioListener),this.connectionQualityManager=new class{constructor(e){this.listener=e}handleQualityUpdate(e){var t;let n=e.peers.map((e=>({peerID:e.peer_id,downlinkQuality:e.downlink_score})));null==(t=this.listener)||t.onConnectionQualityUpdate(n)}}(this.connectionQualityListener),this.roomUpdateManager=new class{constructor(e,t){this.store=e,this.listener=t,this.TAG="RoomUpdateManager"}handleNotification(e,t){switch(e){case Kn.PEER_LIST:this.onRoomState(t.room);break;case Kn.RTMP_START:this.onRTMPStart(t);break;case Kn.RTMP_STOP:this.onRTMPStop(t);break;case Kn.RECORDING_START:this.onRecordingStart(t);break;case Kn.RECORDING_STOP:this.onRecordingStop(t);break;case Kn.ROOM_STATE:this.handlePreviewRoomState(t);break;default:this.onHLS(e,t)}}handlePreviewRoomState(e){let{room:t}=e;this.onRoomState(t,e.peer_count)}onRoomState(e,t){var n,i,r;let{recording:s,streaming:o,session_id:a,started_at:l,name:c}=e,u=this.store.getRoom();u.peerCount=t,u.name=c,u.recording.server.running=!!(null==s?void 0:s.sfu.enabled),u.recording.browser.running=!!(null==s?void 0:s.browser.enabled),u.rtmp.running=!!(null==(n=null==o?void 0:o.rtmp)?void 0:n.enabled),u.rtmp.startedAt=ai(null==(i=null==o?void 0:o.rtmp)?void 0:i.started_at),u.recording.server.startedAt=ai(null==s?void 0:s.sfu.started_at),u.recording.browser.startedAt=ai(null==s?void 0:s.browser.started_at),u.recording.hls=this.getPeerListHLSRecording(s),u.hls=this.convertHls(null==o?void 0:o.hls),u.sessionId=a,u.startedAt=ai(l),null==(r=this.listener)||r.onRoomUpdate($t.RECORDING_STATE_UPDATED,u)}onRTMPStart(e){var t;this.setRTMPStatus(!(null==(t=e.error)?void 0:t.code),e)}onRTMPStop(e){this.setRTMPStatus(!1,e)}onRecordingStart(e){var t;this.setRecordingStatus(!(null==(t=e.error)?void 0:t.code),e)}onRecordingStop(e){this.setRecordingStatus(!1,e)}onHLS(e,t){var n,i;if(![Kn.HLS_START,Kn.HLS_STOP].includes(e))return;let r=this.store.getRoom();t.enabled=e===Kn.HLS_START&&!(null==(n=t.error)?void 0:n.code),r.hls=this.convertHls(t),r.recording.hls=this.getHLSRecording(t),null==(i=this.listener)||i.onRoomUpdate($t.HLS_STREAMING_STATE_UPDATED,r)}convertHls(e){var t;let n={running:!!(null==e?void 0:e.enabled),variants:[],error:this.toSdkError(null==e?void 0:e.error)};return null==(t=null==e?void 0:e.variants)||t.forEach((e=>{n.variants.push({meetingURL:e.meeting_url,url:e.url,metadata:e.metadata,startedAt:ai(e.started_at)})})),n}getHLSRecording(e){var t,n,i;let r={running:!1};return(null==e?void 0:e.hls_recording)&&(r={running:!!(null==e?void 0:e.enabled),singleFilePerLayer:!!(null==(t=e.hls_recording)?void 0:t.single_file_per_layer),hlsVod:!!(null==(n=e.hls_recording)?void 0:n.hls_vod),startedAt:ai(null==(i=null==e?void 0:e.variants)?void 0:i[0].started_at),error:this.toSdkError(e.error)}),r}getPeerListHLSRecording(e){var t,n;let i=null==e?void 0:e.hls;return{running:!!(null==i?void 0:i.enabled),startedAt:ai(null==i?void 0:i.started_at),singleFilePerLayer:!!(null==(t=null==i?void 0:i.config)?void 0:t.single_file_per_layer),hlsVod:!!(null==(n=null==i?void 0:i.config)?void 0:n.hls_vod)}}setRecordingStatus(e,t){var n;let i,r=this.store.getRoom();"sfu"===t.type?(r.recording.server={running:e,startedAt:e?ai(t.started_at):void 0,error:this.toSdkError(t.error)},i=$t.SERVER_RECORDING_STATE_UPDATED):(r.recording.browser={running:e,startedAt:e?ai(t.started_at):void 0,error:this.toSdkError(t.error)},i=$t.BROWSER_RECORDING_STATE_UPDATED),null==(n=this.listener)||n.onRoomUpdate(i,r)}setRTMPStatus(e,t){var n;let i=this.store.getRoom();i.rtmp={running:e,startedAt:e?ai(t.started_at):void 0,error:this.toSdkError(t.error)},null==(n=this.listener)||n.onRoomUpdate($t.RTMP_STREAMING_STATE_UPDATED,i)}toSdkError(e){if(!(null==e?void 0:e.code))return;let t=e.message||"error in streaming/recording",n=new rn(e.code,"ServerErrors",tn.NONE,t,t);return Jt.e(this.TAG,"error in streaming/recording",n),n}}(this.store,this.listener)}setListener(e){this.listener=e,this.trackManager.listener=e,this.peerManager.listener=e,this.peerListManager.listener=e,this.broadcastManager.listener=e,this.requestManager.listener=e,this.activeSpeakerManager.listener=e,this.roomUpdateManager.listener=e}setAudioListener(e){this.audioListener=e,this.activeSpeakerManager.audioListener=e}setConnectionQualityListener(e){this.connectionQualityListener=e,this.connectionQualityManager.listener=e}handleNotification(e,t=!1){var n,i;let r=e.method,s=e.params;[Kn.ACTIVE_SPEAKERS,Kn.SFU_STATS,Kn.CONNECTION_QUALITY].includes(r)||Jt.d(this.TAG,`Received notification - ${r}`,{notification:s}),r===Kn.SFU_STATS&&(null==(n=window.HMS)?void 0:n.ON_SFU_STATS)&&"function"==typeof(null==(i=window.HMS)?void 0:i.ON_SFU_STATS)&&window.HMS.ON_SFU_STATS(e.params),!this.ignoreNotification(r)&&(this.roomUpdateManager.handleNotification(r,s),this.peerManager.handleNotification(r,s),this.requestManager.handleNotification(r,s),this.peerListManager.handleNotification(r,s,t),this.broadcastManager.handleNotification(r,s),this.handleIsolatedMethods(r,s))}handleIsolatedMethods(e,t){switch(e){case Kn.TRACK_METADATA_ADD:this.trackManager.handleTrackMetadataAdd(t);break;case Kn.TRACK_UPDATE:this.trackManager.handleTrackUpdate(t);break;case Kn.ON_SFU_TRACK_LAYER_UPDATE:this.trackManager.handleTrackLayerUpdate(t);break;case Kn.ACTIVE_SPEAKERS:this.activeSpeakerManager.handleActiveSpeakers(t);break;case Kn.CONNECTION_QUALITY:this.connectionQualityManager.handleQualityUpdate(t);break;case Kn.POLICY_CHANGE:this.policyChangeManager.handlePolicyChange(t)}}}(this.store,this.eventBus,this.listener,this.audioListener),this.deviceManager=new class{constructor(e,t){this.store=e,this.eventBus=t,this.audioInput=[],this.audioOutput=[],this.videoInput=[],this.hasWebcamPermission=!1,this.hasMicrophonePermission=!1,this.TAG="[Device Manager]:",this.initialized=!1,this.videoInputChanged=!1,this.audioInputChanged=!1,this.updateOutputDevice=e=>Lt(this,null,(function*(){let t=this.audioOutput.find((t=>t.deviceId===e));return t&&(this.outputDevice=t,yield this.store.updateAudioOutputDevice(t),Ii.updateSelection("audioOutput",{deviceId:t.deviceId,groupId:t.groupId})),t})),this.getCurrentSelection=()=>{var e,t;let n=this.store.getLocalPeer(),i=this.createIdentifier(null==(e=null==n?void 0:n.audioTrack)?void 0:e.getMediaTrackSettings()),r=this.createIdentifier(null==(t=null==n?void 0:n.videoTrack)?void 0:t.getMediaTrackSettings()),s=this.audioInput.find((e=>this.createIdentifier(e)===i)),o=this.videoInput.find((e=>this.createIdentifier(e)===r));return{audioInput:s,videoInput:o,audioOutput:this.outputDevice}},this.computeChange=(e,t)=>e.length!==t.length||t.some((t=>!e.includes(this.createIdentifier(t)))),this.enumerateDevices=()=>Lt(this,null,(function*(){try{let e=yield navigator.mediaDevices.enumerateDevices(),t=this.videoInput.map(this.createIdentifier),n=this.audioInput.map(this.createIdentifier);this.audioInput=[],this.audioOutput=[],this.videoInput=[],e.forEach((e=>{"audioinput"===e.kind&&e.label?(this.hasMicrophonePermission=!0,this.audioInput.push(e)):"audiooutput"===e.kind?this.audioOutput.push(e):"videoinput"===e.kind&&e.label&&(this.hasWebcamPermission=!0,this.videoInput.push(e))})),this.videoInputChanged=this.computeChange(t,this.videoInput),this.audioInputChanged=this.computeChange(n,this.audioInput),Ii.setDevices({videoInput:[...this.videoInput],audioInput:[...this.audioInput],audioOutput:[...this.audioOutput]}),this.logDevices("Enumerate Devices")}catch(e){Jt.e(this.TAG,"Failed enumerating devices",e)}})),this.handleDeviceChange=()=>Lt(this,null,(function*(){yield this.enumerateDevices(),this.eventBus.analytics.publish(Fi.deviceChange({selection:this.getCurrentSelection(),type:"list",devices:this.getDevices()})),this.logDevices("After Device Change");let e=this.store.getLocalPeer();yield this.setOutputDevice(!0),yield this.handleAudioInputDeviceChange(null==e?void 0:e.audioTrack),yield this.handleVideoInputDeviceChange(null==e?void 0:e.videoTrack)})),this.handleAudioInputDeviceChange=e=>Lt(this,null,(function*(){if(!e)return void Jt.d(this.TAG,"No Audio track on local peer");if(!this.audioInputChanged)return void Jt.d(this.TAG,"No Change in AudioInput Device");let t=this.getNewAudioInputDevice();if(!t||!t.deviceId)return void Jt.w(this.TAG,"Audio device not found");let{settings:n}=e,i=(new Jn).codec(n.codec).maxBitrate(n.maxBitrate).deviceId(t.deviceId).build();try{yield e.setSettings(i,!0),this.eventBus.deviceChange.publish({devices:this.getDevices(),selection:t,type:"audioInput"}),this.logDevices("Audio Device Change Success")}catch(e){Jt.e(this.TAG,"[Audio Device Change]",e),this.eventBus.analytics.publish(Fi.deviceChange({selection:{audioInput:t},devices:this.getDevices(),error:e})),this.eventBus.deviceChange.publish({error:e,selection:t,type:"audioInput",devices:this.getDevices()})}})),this.handleVideoInputDeviceChange=e=>Lt(this,null,(function*(){if(!e)return void Jt.d(this.TAG,"No video track on local peer");if(!this.videoInputChanged)return void Jt.d(this.TAG,"No Change in VideoInput Device");let t=this.videoInput[0];if(!t||!t.deviceId)return void Jt.w(this.TAG,"Video device not found");let{settings:n}=e,i=(new Yn).codec(n.codec).maxBitrate(n.maxBitrate).maxFramerate(n.maxFramerate).setWidth(n.width).setHeight(n.height).deviceId(t.deviceId).build();try{yield e.setSettings(i,!0),this.eventBus.deviceChange.publish({devices:this.getDevices(),selection:t,type:"video"}),this.logDevices("Video Device Change Success")}catch(e){Jt.e(this.TAG,"[Video Device Change]",e),this.eventBus.analytics.publish(Fi.deviceChange({selection:{videoInput:t},devices:this.getDevices(),error:e})),this.eventBus.deviceChange.publish({error:e,type:"video",selection:t,devices:this.getDevices()})}}));let n=({enabled:e,track:t})=>e&&"regular"===t.source;this.eventBus.localVideoEnabled.waitFor(n).then((()=>Lt(this,null,(function*(){yield this.enumerateDevices(),this.videoInputChanged&&this.eventBus.deviceChange.publish({devices:this.getDevices()})})))),this.eventBus.localAudioEnabled.waitFor(n).then((()=>Lt(this,null,(function*(){yield this.enumerateDevices(),this.audioInputChanged&&this.eventBus.deviceChange.publish({devices:this.getDevices()})}))))}init(e=!1){return Lt(this,null,(function*(){this.initialized&&!e||(!this.initialized&&navigator.mediaDevices.addEventListener("devicechange",this.handleDeviceChange),this.initialized=!0,yield this.enumerateDevices(),this.logDevices("Init"),yield this.setOutputDevice(),this.eventBus.deviceChange.publish({devices:this.getDevices()}),this.eventBus.analytics.publish(Fi.deviceChange({selection:this.getCurrentSelection(),type:"list",devices:this.getDevices()})))}))}getDevices(){return{audioInput:this.audioInput,audioOutput:this.audioOutput,videoInput:this.videoInput}}cleanUp(){this.initialized=!1,this.audioInput=[],this.audioOutput=[],this.videoInput=[],this.outputDevice=void 0,navigator.mediaDevices.removeEventListener("devicechange",this.handleDeviceChange)}createIdentifier(e){return e?`${e.deviceId}${e.groupId}`:""}getNewAudioInputDevice(){let e=this.audioInput.find((e=>"default"===e.deviceId));return e?this.audioInput.find((t=>t.label!==e.label&&e.label.includes(t.label))):this.audioInput[0]}setOutputDevice(e=!1){return Lt(this,null,(function*(){let t=this.getNewAudioInputDevice(),n=this.createIdentifier(this.outputDevice);this.outputDevice=this.getAudioOutputDeviceMatchingInput(t),this.outputDevice||(this.outputDevice=this.audioOutput.find((e=>this.createIdentifier(e)===n)),this.outputDevice||(this.outputDevice=this.audioOutput.find((e=>"default"===e.deviceId))||this.audioOutput[0])),yield this.store.updateAudioOutputDevice(this.outputDevice),e&&n!==this.createIdentifier(this.outputDevice)&&this.eventBus.deviceChange.publish({selection:this.outputDevice,type:"audioOutput",devices:this.getDevices()})}))}getAudioOutputDeviceMatchingInput(e){var t,n;let i=(null==(n=null==(t=this.store.getConfig())?void 0:t.settings)?void 0:n.speakerAutoSelectionBlacklist)||[];if("all"===i)return;let r=(null==e?void 0:e.label.toLowerCase())||"";return!i.some((e=>r.includes(e.toLowerCase())))&&(null==e?void 0:e.groupId)?this.audioOutput.find((t=>"default"!==e.deviceId&&t.label===e.label)):void 0}logDevices(e=""){Jt.d(this.TAG,e,JSON.stringify({videoInput:[...this.videoInput],audioInput:[...this.audioInput],audioOutput:[...this.audioOutput],selected:this.getCurrentSelection()},null,4))}}(this.store,this.eventBus),this.audioSinkManager=new class{constructor(e,t,n){this.store=e,this.deviceManager=t,this.eventBus=n,this.autoPausedTracks=new Set,this.TAG="[AudioSinkManager]:",this.volume=100,this.state=xt({},pr),this.handleAudioPaused=e=>{var t;let n=null==(t=e.target.srcObject)?void 0:t.getAudioTracks()[0];if(!(null==n?void 0:n.enabled))return;Jt.d(this.TAG,"Audio Paused",e.target.id);let i=this.store.getTrackById(e.target.id);i&&("mobile"===Ut.getDevice().type?setTimeout((()=>Lt(this,null,(function*(){i&&(yield this.playAudioFor(i))}))),500):this.autoPausedTracks.add(i))},this.handleTrackUpdate=({track:e,enabled:t})=>{var n;(null==(n=window.HMS)?void 0:n.AUDIO_SINK)&&(t?(e.addSink(),this.playAudioFor(e)):e.removeSink()),Jt.d(this.TAG,"Track updated",`${e}`)},this.handleTrackAdd=e=>Lt(this,[e],(function*({track:e,peer:t}){var n,i,r;let s=document.createElement("audio");s.style.display="none",s.id=e.trackId,s.addEventListener("pause",this.handleAudioPaused),e.setAudioElement(s),e.setVolume(this.volume),Jt.d(this.TAG,"Audio track added",`${e}`),null==(n=this.audioSink)||n.append(s),this.outputDevice&&(yield e.setOutputDevice(this.outputDevice)),(null==(i=window.HMS)?void 0:i.AUDIO_SINK)?e.enabled?e.addSink():e.removeSink():s.srcObject=new MediaStream([e.nativeTrack]),null==(r=this.listener)||r.onTrackUpdate(Gt.TRACK_ADDED,e,t),yield this.handleAutoplayError(e)})),this.handleAutoplayError=e=>Lt(this,null,(function*(){void 0===this.state.autoplayFailed&&(this.state.autoplayCheckPromise||(this.state.autoplayCheckPromise=new Promise((t=>{this.playAudioFor(e).then(t)}))),yield this.state.autoplayCheckPromise),this.state.autoplayFailed?this.autoPausedTracks.add(e):yield this.playAudioFor(e)})),this.handleAudioDeviceChange=e=>{e.error||!e.selection||"video"===e.type||this.unpauseAudioTracks()},this.handleTrackRemove=e=>{this.autoPausedTracks.delete(e);let t=document.getElementById(e.trackId);t&&(t.removeEventListener("pause",this.handleAudioPaused),t.srcObject=null,t.remove(),e.setAudioElement(null)),this.audioSink&&0===this.audioSink.childElementCount&&(this.state.autoplayCheckPromise=void 0,this.state.autoplayFailed=void 0),Jt.d(this.TAG,"Audio track removed",`${e}`)},this.unpauseAudioTracks=()=>Lt(this,null,(function*(){let e=[];this.autoPausedTracks.forEach((t=>{e.push(this.playAudioFor(t))})),yield Promise.all(e)})),this.eventBus.audioTrackAdded.subscribe(this.handleTrackAdd),this.eventBus.audioTrackRemoved.subscribe(this.handleTrackRemove),this.eventBus.audioTrackUpdate.subscribe(this.handleTrackUpdate),this.eventBus.deviceChange.subscribe(this.handleAudioDeviceChange)}setListener(e){this.listener=e}get outputDevice(){return this.deviceManager.outputDevice}getVolume(){return this.volume}setVolume(e){this.store.updateAudioOutputVolume(e),this.volume=e}unblockAutoplay(){return Lt(this,null,(function*(){this.autoPausedTracks.size>0&&this.unpauseAudioTracks()}))}init(e){if(this.state.initialized)return;this.state.initialized=!0;let t=document.createElement("div");t.id=`HMS-SDK-audio-sink-${_t()}`,(e&&document.getElementById(e)||document.body).append(t),this.audioSink=t}cleanUp(){var e;null==(e=this.audioSink)||e.remove(),this.audioSink=void 0,this.eventBus.audioTrackAdded.unsubscribe(this.handleTrackAdd),this.eventBus.audioTrackRemoved.unsubscribe(this.handleTrackRemove),this.eventBus.audioTrackUpdate.unsubscribe(this.handleTrackUpdate),this.eventBus.deviceChange.unsubscribe(this.handleAudioDeviceChange),this.autoPausedTracks=new Set,this.state=xt({},pr)}playAudioFor(e){return Lt(this,null,(function*(){let t=e.getAudioElement();if(t)try{yield t.play(),this.state.autoplayFailed=!1,this.autoPausedTracks.delete(e),Jt.d(this.TAG,"Played track",`${e}`)}catch(t){this.autoPausedTracks.add(e),Jt.e(this.TAG,"Failed to play track",`${e}`,t);let n=t;if(!this.state.autoplayFailed&&"NotAllowedError"===n.name){this.state.autoplayFailed=!0;let e=sn.TracksErrors.AutoplayBlocked(tn.AUTOPLAY,"");e.addNativeError(n),this.eventBus.analytics.publish(Fi.autoplayError()),this.eventBus.autoplayError.publish(e)}}else Jt.w(this.TAG,"No audio element found on track",e.trackId)}))}}(this.store,this.deviceManager,this.eventBus),this.audioOutput=new class{constructor(e,t){this.deviceManager=e,this.audioSinkManager=t}getVolume(){return this.audioSinkManager.getVolume()}setVolume(e){if(e<0||e>100)throw Error("Please pass a valid number between 0-100");this.audioSinkManager.setVolume(e)}getDevice(){return this.deviceManager.outputDevice}setDevice(e){return this.deviceManager.updateOutputDevice(e)}unblockAutoplay(){return Lt(this,null,(function*(){yield this.audioSinkManager.unblockAutoplay()}))}}(this.deviceManager,this.audioSinkManager),this.audioSinkManager.setListener(this.listener),this.eventBus.autoplayError.subscribe(this.handleAutoplayError),this.localTrackManager=new Gi(this.store,this.observer,this.deviceManager,this.eventBus,this.analyticsTimer),this.analyticsEventsService=new class{constructor(e){this.store=e,this.bufferSize=100,this.transport=null,this.pendingEvents=[],this.level=_i.INFO}setTransport(e){this.transport=e}reset(){this.transport=null,this.pendingEvents=[]}queue(e){if(e.level>=this.level&&(this.pendingEvents.push(e),this.pendingEvents.length>this.bufferSize)){let e=this.pendingEvents.shift();Jt.d(fr,"Max buffer size reached","Removed event to accommodate new events",e)}return this}flushFailedClientEvents(){er.flushFailedEvents()}flush(){var e;try{for(;this.pendingEvents.length>0;){let t=this.pendingEvents.shift();t&&(t.metadata.peer.peer_id=null==(e=this.store.getLocalPeer())?void 0:e.peerId,t.metadata.userAgent=this.store.getUserAgent(),this.transport&&this.transport.transportProvider.isConnected?this.transport.sendEvent(t):this.sendClientEventOnHTTP(t))}}catch(e){Jt.w(fr,"Flush Failed",e)}}sendClientEventOnHTTP(e){var t,n,i,r;let s=this.store.getRoom(),o=this.store.getLocalPeer();e.metadata.token=null==(t=this.store.getConfig())?void 0:t.authToken,e.metadata.peer={session_id:s.sessionId,room_id:s.id,room_name:s.name,template_id:s.templateId,joined_at:null==(n=s.joinedAt)?void 0:n.getTime(),session_started_at:null==(i=s.startedAt)?void 0:i.getTime(),role:null==(r=null==o?void 0:o.role)?void 0:r.name,user_name:null==o?void 0:o.name,user_data:null==o?void 0:o.metadata},er.sendEvent(e)}}(this.store),this.transport=new class{constructor(e,t,n,i,r,s,o){var a,l;this.observer=e,this.deviceManager=t,this.store=n,this.localTrackManager=i,this.eventBus=r,this.analyticsEventsService=s,this.analyticsTimer=o,this.state=Hi.Disconnected,this.trackStates=new Map,this.publishConnection=null,this.subscribeConnection=null,this.maxSubscribeBitrate=0,this.joinRetryCount=0,this.callbacks=new Map,this.signalObserver={onOffer:e=>Lt(this,null,(function*(){try{if(!this.subscribeConnection)return;yield this.subscribeConnection.setRemoteDescription(e),Jt.d(dr,`[SUBSCRIBE] Adding ${this.subscribeConnection.candidates.length} ice-candidates`,this.subscribeConnection.candidates);for(let e of this.subscribeConnection.candidates)yield this.subscribeConnection.addIceCandidate(e);this.subscribeConnection.candidates.length=0;let t=yield this.subscribeConnection.createAnswer();yield this.subscribeConnection.setLocalDescription(t),this.signal.answer(t),Jt.d(dr,"[role=SUBSCRIBE] onOffer renegotiation DONE ✅")}catch(e){let t;throw Jt.d(dr,"[role=SUBSCRIBE] onOffer renegotiation FAILED ❌"),this.state=Hi.Failed,t=e instanceof rn?e:sn.GenericErrors.Unknown(tn.PUBLISH,e.message),this.eventBus.analytics.publish(Fi.subscribeFail(t)),t}})),onTrickle:e=>Lt(this,null,(function*(){let t=e.target===Xt.Publish?this.publishConnection:this.subscribeConnection;(null==t?void 0:t.remoteDescription)?yield t.addIceCandidate(e.candidate):null==t||t.candidates.push(e.candidate)})),onNotification:e=>this.observer.onNotification(e),onServerError:e=>Lt(this,null,(function*(){yield this.observer.onStateChange(Hi.Failed,e)})),onFailure:e=>{this.joinParameters&&this.retryScheduler.schedule({category:Yi.SignalDisconnect,error:e,task:this.retrySignalDisconnectTask,originalState:this.state})},onOffline:e=>Lt(this,null,(function*(){Jt.d(dr,"socket offline",Hi[this.state]);try{this.state!==Hi.Leaving&&this.joinParameters&&this.retryScheduler.schedule({category:Yi.SignalDisconnect,error:sn.WebSocketConnectionErrors.WebSocketConnectionLost(tn.RECONNECT_SIGNAL,e),task:this.retrySignalDisconnectTask,originalState:this.state})}catch(e){console.error(e)}})),onOnline:()=>{var e;Jt.d(dr,"socket online",Hi[this.state]),this.analyticsSignalTransport.flushFailedEvents(null==(e=this.store.getLocalPeer())?void 0:e.peerId)},onNetworkOnline:()=>{this.analyticsEventsService.flushFailedClientEvents()}},this.signal=new class{constructor(e){this.TAG="[SIGNAL]: ",this.pongResponseTimes=new Wn(5),this.isJoinCompleted=!1,this.pendingTrickle=[],this.socket=null,this.callbacks=new Map,this._isConnected=!1,this.id=0,this.onCloseHandler=()=>{},this.offlineListener=()=>{Jt.d(this.TAG,"Window network offline"),this.setIsConnected(!1,"Window network offline")},this.onlineListener=()=>{Jt.d(this.TAG,"Window network online"),this.observer.onNetworkOnline()},this.observer=e,window.addEventListener("offline",this.offlineListener),window.addEventListener("online",this.onlineListener),this.onMessageHandler=this.onMessageHandler.bind(this)}get isConnected(){return this._isConnected}setIsConnected(e,t=""){Jt.d(this.TAG,`isConnected set id: ${this.id}, oldValue: ${this._isConnected}, newValue: ${e}`),this._isConnected!==e&&(this._isConnected&&!e?(this._isConnected=e,this.observer.onOffline(t)):!this._isConnected&&e&&(this._isConnected=e,this.observer.onOnline()))}getPongResponseTimes(){return this.pongResponseTimes.toList()}internalCall(e,t){return Lt(this,null,(function*(){var n;let i=_t(),r={method:e,params:t,id:i,jsonrpc:"2.0"};null==(n=this.socket)||n.send(JSON.stringify(r));try{return yield new Promise(((e,t)=>{this.callbacks.set(i,{resolve:e,reject:t})}))}catch(t){let n=t;throw sn.WebsocketMethodErrors.ServerErrors(Number(n.code),function(e){switch(e){case jn.JOIN:return tn.JOIN;case jn.OFFER:return tn.PUBLISH;case jn.ANSWER:return tn.SUBSCRIBE;case jn.TRACK_UPDATE:return tn.TRACK;default:return tn.NONE}}(e),n.message)}}))}notify(e,t){var n;let i={method:e,params:t};null==(n=this.socket)||n.send(JSON.stringify(i))}open(e){return new Promise(((t,n)=>{let i=!1;this.socket&&(this.socket.close(),this.socket.removeEventListener("close",this.onCloseHandler),this.socket.removeEventListener("message",this.onMessageHandler)),this.socket=new WebSocket(e);let r=e=>{Jt.e(this.TAG,"Error from websocket",e),i=!0,n(sn.WebSocketConnectionErrors.FailedToConnect(tn.JOIN,`Error opening websocket connection - ${e}`))};this.onCloseHandler=e=>{Jt.e(`Websocket closed code=${e.code}`),i?this.setIsConnected(!1,`code: ${e.code}${1e3!==e.code?", unexpected websocket close":""}`):(i=!0,n(sn.WebSocketConnectionErrors.AbnormalClose(tn.JOIN,`Error opening websocket connection - websocket closed unexpectedly with code=${e.code}`)))},this.socket.addEventListener("error",r);let s=()=>{var e,n;i=!0,t(),this.setIsConnected(!0),this.id++,null==(e=this.socket)||e.removeEventListener("open",s),null==(n=this.socket)||n.removeEventListener("error",r),this.pingPongLoop(this.id)};this.socket.addEventListener("open",s),this.socket.addEventListener("close",this.onCloseHandler),this.socket.addEventListener("message",this.onMessageHandler)}))}close(){return Lt(this,null,(function*(){window.removeEventListener("offline",this.offlineListener),window.removeEventListener("online",this.onlineListener),this.socket?(this.socket.close(1e3,"Normal Close"),this.setIsConnected(!1,"code: 1000, normal websocket close"),this.socket.removeEventListener("close",this.onCloseHandler),this.socket.removeEventListener("message",this.onMessageHandler)):this.setIsConnected(!1,"websocket not connected yet")}))}join(e,t,n,i,r){return Lt(this,null,(function*(){if(!this.isConnected)throw sn.WebSocketConnectionErrors.WebSocketConnectionLost(tn.JOIN,"Failed to send join over WS connection");let s={name:e,disableVidAutoSub:n,data:t,offer:r,server_sub_degrade:i},o=yield this.internalCall(jn.JOIN,s);return this.isJoinCompleted=!0,this.pendingTrickle.forEach((({target:e,candidate:t})=>this.trickle(e,t))),this.pendingTrickle.length=0,Jt.d(this.TAG,`join: response=${JSON.stringify(o,null,1)}`),o}))}trickle(e,t){this.isJoinCompleted?this.notify(jn.TRICKLE,{target:e,candidate:t}):this.pendingTrickle.push({target:e,candidate:t})}offer(e,t){return Lt(this,null,(function*(){return yield this.call(jn.OFFER,{desc:e,tracks:Object.fromEntries(t)})}))}answer(e){this.notify(jn.ANSWER,{desc:e})}trackUpdate(e){this.notify(jn.TRACK_UPDATE,{version:"1.0",tracks:Object.fromEntries(e)})}broadcast(e){return Lt(this,null,(function*(){return yield this.call(jn.BROADCAST,xt({version:"1.0"},e.toSignalParams()))}))}leave(){this.notify(jn.LEAVE,{version:"1.0"})}endRoom(e,t){return Lt(this,null,(function*(){yield this.call(jn.END_ROOM,{lock:e,reason:t})}))}sendEvent(e){if(!this.isConnected)throw Error(`${this.TAG} not connected. Could not send event ${e}`);this.notify(jn.ANALYTICS,e.toSignalParams())}ping(e){let t=Date.now(),n=new Promise((n=>{setTimeout((()=>{n(Date.now()-t)}),e+1)})),i=this.internalCall(jn.PING,{timestamp:t}).then((()=>Date.now()-t)).catch((()=>Date.now()-t));return Promise.race([n,i])}requestRoleChange(e){return Lt(this,null,(function*(){yield this.call(jn.ROLE_CHANGE_REQUEST,e)}))}acceptRoleChangeRequest(e){return Lt(this,null,(function*(){yield this.call(jn.ROLE_CHANGE,e)}))}requestTrackStateChange(e){return Lt(this,null,(function*(){yield this.call(jn.TRACK_UPDATE_REQUEST,e)}))}requestMultiTrackStateChange(e){return Lt(this,null,(function*(){yield this.call(jn.CHANGE_TRACK_MUTE_STATE_REQUEST,e)}))}removePeer(e){return Lt(this,null,(function*(){yield this.call(jn.PEER_LEAVE_REQUEST,e)}))}startRTMPOrRecording(e){return Lt(this,null,(function*(){yield this.call(jn.START_RTMP_OR_RECORDING_REQUEST,xt({version:"1.0"},e))}))}stopRTMPAndRecording(){return Lt(this,null,(function*(){yield this.call(jn.STOP_RTMP_AND_RECORDING_REQUEST,{version:"1.0"})}))}startHLSStreaming(e){return Lt(this,null,(function*(){yield this.call(jn.START_HLS_STREAMING,xt({version:"1.0"},e))}))}stopHLSStreaming(e){return Lt(this,null,(function*(){yield this.call(jn.STOP_HLS_STREAMING,xt({version:"1.0"},e))}))}sendHLSTimedMetadata(e){return Lt(this,null,(function*(){yield this.call(jn.HLS_TIMED_METADATA,xt({version:"1.0"},e))}))}updatePeer(e){return Lt(this,null,(function*(){yield this.call(jn.UPDATE_PEER_METADATA,xt({version:"1.0"},e))}))}setSessionMetadata(e){return Lt(this,null,(function*(){yield this.call(jn.SET_METADATA,xt({version:"1.0"},e))}))}getSessionMetadata(){return this.call(jn.GET_METADATA,{version:"1.0"})}onMessageHandler(e){let t=e.data,n=JSON.parse(t);if(n.id)this.handleResponseWithId(n);else{if(!n.method)throw Error(`WebSocket message has no 'method' or 'id' field, message=${n}`);this.handleResponseWithMethod(n)}}handleResponseWithId(e){let t=e,n=t.id;if(this.callbacks.has(n)){let e=this.callbacks.get(n);this.callbacks.delete(n),t.result?e.resolve(t.result):e.reject(t.error)}else this.observer.onNotification(t)}handleResponseWithMethod(e){switch(e.method){case jn.OFFER:this.observer.onOffer(e.params);break;case jn.TRICKLE:this.observer.onTrickle(e.params);break;case jn.SERVER_ERROR:this.observer.onServerError(sn.WebsocketMethodErrors.ServerErrors(Number(e.params.code),tn.NONE,e.params.message));break;case jn.SERVER_WARNING:Jt.w(this.TAG,e.params);break;default:this.observer.onNotification(e)}}pingPongLoop(e){return Lt(this,null,(function*(){var t,n;let i=(null==(t=window.HMS)?void 0:t.PING_TIMEOUT)||12e3;if(this.isConnected){let t=yield this.ping(i);this.pongResponseTimes.enqueue(t),t>i?(Jt.d(this.TAG,`Pong timeout ${e}, pageHidden=${"undefined"!=typeof document&&document.hidden}`),this.id===e&&this.setIsConnected(!1,"ping pong failure")):setTimeout((()=>this.pingPongLoop(e)),(null==(n=window.HMS)?void 0:n.PING_INTERVAL)||1e3)}}))}call(e,t){return Lt(this,null,(function*(){let n=sn.WebsocketMethodErrors.ServerErrors(500,e,`Default ${e} error`);for(let i=0;i<3;i++)try{return Jt.d(this.TAG,`Try number ${i+1} sending ${e}`,t),yield this.internalCall(e,t)}catch(r){if(n=r,Jt.e(this.TAG,`Failed sending ${e}`,{method:e,try:i+1,params:t,error:n}),5!==parseInt(""+n.code/100)&&429!==n.code)break;let s=1e3*(2+2*Math.random());yield Hn(s)}throw Jt.e(`Sending ${e} over WS failed after 3 retries`,{method:e,params:t,error:n}),n}))}}(this.signalObserver),this.analyticsSignalTransport=new ir(this.signal),this.publishConnectionObserver={onRenegotiationNeeded:()=>Lt(this,null,(function*(){yield this.performPublishRenegotiation()})),onIceConnectionChange:e=>Lt(this,null,(function*(){("disconnected"===e?Jt.w.bind(Jt):Jt.d.bind(Jt))(dr,`Publish ice connection state change: ${e}`)})),onConnectionStateChange:e=>Lt(this,null,(function*(){var t;("disconnected"===e?Jt.w.bind(Jt):Jt.d.bind(Jt))(dr,`Publish connection state change: ${e}`),"connected"===e&&(null==(t=this.publishConnection)||t.logSelectedIceCandidatePairs()),"failed"===e&&(yield this.handleIceConnectionFailure(Xt.Publish))}))},this.subscribeConnectionObserver={onApiChannelMessage:e=>{this.observer.onNotification(JSON.parse(e))},onTrackAdd:e=>{Jt.d(dr,"[Subscribe] onTrackAdd",Ln(e.nativeTrack)),this.observer.onTrackAdd(e)},onTrackRemove:e=>{Jt.d(dr,"[Subscribe] onTrackRemove",Ln(e.nativeTrack)),this.observer.onTrackRemove(e)},onIceConnectionChange:e=>Lt(this,null,(function*(){if(("disconnected"===e?Jt.w.bind(Jt):Jt.d.bind(Jt))(dr,`Subscribe ice connection state change: ${e}`),"connected"===e){let e=this.callbacks.get(mn);this.callbacks.delete(mn),e&&e.promise.resolve(!0)}})),onConnectionStateChange:e=>Lt(this,null,(function*(){var t;if(("disconnected"===e?Jt.w.bind(Jt):Jt.d.bind(Jt))(dr,`Subscribe connection state change: ${e}`),"failed"===e&&(yield this.handleIceConnectionFailure(Xt.Subscribe)),"connected"===e){null==(t=this.subscribeConnection)||t.logSelectedIceCandidatePairs();let e=this.callbacks.get(mn);this.callbacks.delete(mn),e&&e.promise.resolve(!0)}}))},this.handleLocalRoleUpdate=e=>Lt(this,[e],(function*({oldRole:e,newRole:t}){this.doesRoleNeedWebRTC(e)||!this.doesRoleNeedWebRTC(t)||(Jt.i(dr,"Local peer role updated to webrtc role, creating PeerConnections and performing inital publish negotiation ⏳"),this.createPeerConnections(),yield this.negotiateOnFirstPublish())})),this.retryPublishIceFailedTask=()=>Lt(this,null,(function*(){if(this.publishConnection&&("connected"!==this.publishConnection.iceConnectionState||"connected"!==this.publishConnection.connectionState)){let e=new Promise(((e,t)=>{this.callbacks.set(pn,{promise:{resolve:e,reject:t},action:tn.RESTART_ICE,extra:{}})}));yield this.performPublishRenegotiation({iceRestart:!0}),yield e}return!0})),this.retrySubscribeIceFailedTask=()=>Lt(this,null,(function*(){if(this.subscribeConnection&&("connected"!==this.subscribeConnection.iceConnectionState||"connected"!==this.subscribeConnection.connectionState)){let e=new Promise(((e,t)=>{this.callbacks.set(mn,{promise:{resolve:e,reject:t},action:tn.RESTART_ICE,extra:{}})})),t=new Promise((e=>{setTimeout(e,6e4,!1)}));return Promise.race([e,t])}return!0})),this.retrySignalDisconnectTask=()=>Lt(this,null,(function*(){if(Jt.d(dr,"retrySignalDisconnectTask",{signalConnected:this.signal.isConnected}),!this.signal.isConnected)try{yield this.internalConnect(this.joinParameters.authToken,this.joinParameters.endpoint,this.joinParameters.peerId)}catch(e){}let e=this.store.getRoom().joinedAt?this.signal.isConnected&&(yield this.retryPublishIceFailedTask()):this.signal.isConnected;return this.signal.trackUpdate(this.trackStates),e})),this.webrtcInternals=new class{constructor(e,t,n,i){this.store=e,this.eventBus=t,this.publishConnection=n,this.subscribeConnection=i,this.TAG="[HMSWebrtcInternals]",this.interval=1e3,this.isMonitored=!1,this.handleStatsUpdate=()=>Lt(this,null,(function*(){var e;yield null==(e=this.hmsStats)?void 0:e.updateStats(),this.eventBus.statsUpdate.publish(this.hmsStats)}))}getPublishPeerConnection(){return this.publishConnection}getSubscribePeerConnection(){return this.subscribeConnection}getCurrentStats(){return this.hmsStats}onStatsChange(e){return this.eventBus.statsUpdate.subscribe(e),()=>{this.eventBus.statsUpdate.unsubscribe(e)}}setPeerConnections({publish:e,subscribe:t}){var n,i;this.publishConnection=e,this.subscribeConnection=t,this.hmsStats=new class{constructor(e,t){var n;this.getStats=e,this.store=t,this.TAG="[HMSWebrtcStats]",this.peerStats={},this.trackStats={},this.localPeerID=null==(n=this.store.getLocalPeer())?void 0:n.peerId}getLocalPeerStats(){return this.peerStats[this.localPeerID]}getTrackStats(e){return this.trackStats[e]}updateStats(){return Lt(this,null,(function*(){yield this.updateLocalPeerStats(),yield this.updateTrackStats()}))}updateLocalPeerStats(){return Lt(this,null,(function*(){var e,t,n,i,r,s;let o,a=this.getLocalPeerStats();try{o=yield null==(t=(e=this.getStats).publish)?void 0:t.call(e)}catch(e){Jt.w(this.TAG,"Error in getting publish stats",e)}let l,c=o&&or("publish",o,a);try{l=yield null==(i=(n=this.getStats).subscribe)?void 0:i.call(n)}catch(e){Jt.w(this.TAG,"Error in getting subscribe stats",e)}let u=l&&or("subscribe",l,a),{packetsLost:d,jitter:h}=(e=>{let t={packetsLost:0,jitter:0};return null==e||e.forEach((e=>{e.packetsLost&&(t.packetsLost+=e.packetsLost),e.jitter>t.jitter&&(t.jitter=e.jitter)})),t})(l),p=ur(d,null==(r=null==a?void 0:a.subscribe)?void 0:r.packetsLost,null==u?void 0:u.timestamp,null==(s=null==a?void 0:a.subscribe)?void 0:s.timestamp),f=u&&Object.assign(u,{packetsLostRate:p,jitter:h,packetsLost:d});this.peerStats[this.localPeerID]={publish:c,subscribe:f}}))}updateTrackStats(){return Lt(this,null,(function*(){var e;let t=this.store.getTracksMap(),n=((e,t)=>Array.from(new Set(e.concat(t))))(Object.keys(this.trackStats),Object.keys(t));for(let i of n){let n=t[i];if(n){let t=n.peerId&&(null==(e=this.store.getPeerById(n.peerId))?void 0:e.name),r=this.getTrackStats(n.trackId),s=yield rr(this.getStats,n,t,r);s&&(this.trackStats[i]=s)}else delete this.trackStats[i]}}))}}({publish:null==(n=this.publishConnection)?void 0:n.getStats.bind(this.publishConnection),subscribe:null==(i=this.subscribeConnection)?void 0:i.getStats.bind(this.subscribeConnection)},this.store)}start(){return Lt(this,null,(function*(){this.isMonitored?Jt.d(this.TAG,"Already started"):(this.stop(),this.isMonitored=!0,Jt.d(this.TAG,"Starting Webrtc Stats Monitor"),this.startLoop().then((()=>Jt.d(this.TAG,"Stopping Webrtc Stats Monitor"))).catch((e=>Jt.e(this.TAG,e.message))))}))}stop(){this.isMonitored=!1}startLoop(){return Lt(this,null,(function*(){for(;this.isMonitored;)yield this.handleStatsUpdate(),yield Hn(this.interval)}))}cleanUp(){this.stop(),this.eventBus.statsUpdate.removeAllListeners()}}(this.store,this.eventBus,null==(a=this.publishConnection)?void 0:a.nativeConnection,null==(l=this.subscribeConnection)?void 0:l.nativeConnection),this.retryScheduler=new class{constructor(e,t){this.onStateChange=e,this.sendEvent=t,this.inProgress=new Map,this.retryTaskIds=[]}schedule(e){return Lt(this,arguments,(function*({category:e,error:t,task:n,originalState:i,maxFailedRetries:r=5,changeState:s=!0}){yield this.scheduleTask({category:e,error:t,changeState:s,task:n,originalState:i,maxFailedRetries:r})}))}reset(){this.retryTaskIds.forEach((e=>clearTimeout(e))),this.retryTaskIds=[],this.inProgress.clear()}scheduleTask(e){return Lt(this,arguments,(function*({category:e,error:t,changeState:n,task:i,originalState:r,maxFailedRetries:s=5,failedRetryCount:o=0}){if(Jt.d(Xi,"schedule: ",{category:Yi[e],error:t}),0===o){let n=this.inProgress.get(e);if(n)return Jt.d(Xi,`schedule: Already a task for ${Yi[e]} scheduled, waiting for its completion`),void(yield n.promise);let i=new class{constructor(e){this.promise=new Promise(((t,n)=>{this.resolve=t,this.reject=n,e(t,n)}))}}(((e,t)=>{}));this.inProgress.set(e,i),this.sendEvent(t,e)}let a=!1,l=Zi[e];for(let t in l){let n=l[parseInt(t)];try{let t=this.inProgress.get(n);t&&(Jt.d(Xi,`schedule: Suspending retry task of ${Yi[e]}, waiting for ${Yi[n]} to recover`),yield t.promise,Jt.d(Xi,`schedule: Resuming retry task ${Yi[e]} as it's dependency ${Yi[n]} is recovered`))}catch(t){Jt.d(Xi,`schedule: Stopping retry task of ${Yi[e]} as it's dependency ${Yi[n]} failed to recover`),a=!0;break}}if(o>=s||a){if(t.description+=`. [${Yi[e]}] Could not recover after ${o} tries`,a&&(t.description+=` Could not recover all of it's required dependencies - [${l.map((e=>Yi[e])).toString()}]`),t.isTerminal=!0,this.inProgress.delete(e),this.sendEvent(t,e),this.reset(),!n)throw t;return void this.onStateChange(Hi.Failed,t)}n&&this.onStateChange(Hi.Reconnecting,t);let c,u=this.getDelayForRetryCount(e,o);Jt.i(Xi,`schedule: [${Yi[e]}] [failedRetryCount=${o}] Scheduling retry task in ${u}ms`);try{c=yield this.setTimeoutPromise(i,u)}catch(t){c=!1,Jt.w(Xi,`[${Yi[e]}] Un-caught exception ${t.name} in retry-task, initiating retry`,t)}if(c){let t=this.inProgress.get(e);this.inProgress.delete(e),null==t||t.resolve(o),n&&0===this.inProgress.size&&this.onStateChange(r),Jt.i(Xi,`schedule: [${Yi[e]}] [failedRetryCount=${o}] Recovered ♻️`)}else yield this.scheduleTask({category:e,error:t,changeState:n,task:i,originalState:r,maxFailedRetries:s,failedRetryCount:o+1})}))}getBaseDelayForTask(e,t){return e===Yi.JoinWSMessageFailed?2:Math.pow(2,t)}getDelayForRetryCount(e,t){let n=this.getBaseDelayForTask(e,t),i=e===Yi.JoinWSMessageFailed?2*Math.random():Math.random();return Math.round(1e3*Math.min(n+i,60))}setTimeoutPromise(e,t){return Lt(this,null,(function*(){return new Promise(((n,i)=>{let r=window.setTimeout((()=>Lt(this,null,(function*(){try{let t=yield e();t&&this.retryTaskIds.splice(this.retryTaskIds.indexOf(r),1),n(t)}catch(e){i(e)}}))),t);this.retryTaskIds.push(r)}))}))}}(((e,t)=>Lt(this,null,(function*(){e!==this.state&&(this.state=e,yield this.observer.onStateChange(this.state,t))}))),this.sendErrorAnalyticsEvent.bind(this)),this.eventBus.statsUpdate.subscribe((e=>{var t,n;let i=(null==(n=null==(t=e.getLocalPeerStats())?void 0:t.subscribe)?void 0:n.bitrate)||0;this.maxSubscribeBitrate=Math.max(this.maxSubscribeBitrate,i)}))}getLocalScreen(e,t){return Lt(this,null,(function*(){try{return yield this.localTrackManager.getLocalScreen(e,t)}catch(n){throw this.eventBus.analytics.publish(Fi.publish({error:n,devices:this.deviceManager.getDevices(),settings:new ei(e,t,!1)})),n}}))}getWebrtcInternals(){return this.webrtcInternals}isFlagEnabled(e){var t;let n=null==(t=this.initConfig)?void 0:t.config;return((null==n?void 0:n.enabledFlags)||[]).includes(e)}preview(e,t,n,i,r=!1){return Lt(this,null,(function*(){let s=yield this.connect(e,t,n,i,r);return this.state=Hi.Preview,this.observer.onStateChange(this.state),s}))}join(e,t,n,i,r=!1){return Lt(this,null,(function*(){Jt.d(dr,"join: started ⏰");try{(!this.signal.isConnected||!this.initConfig)&&(yield this.connect(e,i,t,n,r)),this.validateNotDisconnected("connect");let s=this.isFlagEnabled(Qi.FLAG_SERVER_SUB_DEGRADATION);this.initConfig&&(yield this.waitForLocalRoleAvailability(),yield this.createConnectionsAndNegotiateJoin(n,r,s),yield this.initRtcStatsMonitor(),Jt.d(dr,"✅ join: Negotiated over PUBLISH connection"))}catch(t){Jt.e(dr,`join: failed ❌ [token=${e}]`,t),this.state=Hi.Failed;let n=t;throw n.isTerminal=n.isTerminal||500===n.code,yield this.observer.onStateChange(this.state,n),n}Jt.i(dr,"✅ join: successful"),this.state=Hi.Joined,this.observer.onStateChange(this.state)}))}connect(e,t,n,i,r=!1){return Lt(this,null,(function*(){this.setTransportStateForConnect(),this.joinParameters=new class{constructor(e,t,n="",i="",r="https://prod-init.100ms.live/init",s=!1){this.authToken=e,this.peerId=t,this.peerName=n,this.data=i,this.endpoint=r,this.autoSubscribeVideo=s}}(e,n,i.name,i.metaData,t,r);try{return yield this.internalConnect(e,t,n)}catch(i){if(!(i instanceof rn&&([nn.WebSocketConnectionErrors.WEBSOCKET_CONNECTION_LOST,nn.WebSocketConnectionErrors.FAILED_TO_CONNECT,nn.WebSocketConnectionErrors.ABNORMAL_CLOSE,nn.InitAPIErrors.ENDPOINT_UNREACHABLE].includes(i.code)||i.code.toString().startsWith("5")||i.code.toString().startsWith("429"))))throw i;{let r=()=>Lt(this,null,(function*(){return yield this.internalConnect(e,t,n),Boolean(this.initConfig&&this.initConfig.endpoint)}));yield this.retryScheduler.schedule({category:Yi.ConnectFailed,error:i,task:r,originalState:this.state,maxFailedRetries:5,changeState:!1})}}}))}leave(e){return Lt(this,null,(function*(){var t,n,i,r;this.retryScheduler.reset(),this.joinParameters=void 0,Jt.d(dr,"leaving in transport");try{if(this.state=Hi.Leaving,null==(t=this.webrtcInternals)||t.cleanUp(),null==(n=this.trackDegradationController)||n.cleanUp(),yield null==(i=this.publishConnection)?void 0:i.close(),yield null==(r=this.subscribeConnection)?void 0:r.close(),e)try{this.signal.leave(),Jt.d(dr,"signal leave done")}catch(e){Jt.w(dr,"failed to send leave on websocket to server",e)}this.analyticsEventsService.flushFailedClientEvents(),this.analyticsEventsService.reset(),yield this.signal.close()}catch(e){this.eventBus.analytics.publish(Fi.disconnect(e)),Jt.e(dr,"leave: FAILED ❌",e)}finally{this.state=Hi.Disconnected,this.observer.onStateChange(this.state)}}))}publish(e){return Lt(this,null,(function*(){for(let t of e)try{yield this.publishTrack(t)}catch(e){this.eventBus.analytics.publish(Fi.publish({devices:this.deviceManager.getDevices(),error:e}))}}))}unpublish(e){return Lt(this,null,(function*(){for(let t of e)yield this.unpublishTrack(t)}))}sendMessage(e){return Lt(this,null,(function*(){return yield this.signal.broadcast(e)}))}trackUpdate(e){let t=Array.from(this.trackStates.values()).find((t=>e.type===t.type&&e.source===t.source));if(t){let n=new Ji(Dt(xt({},t),{mute:!e.enabled}));this.trackStates.set(t.track_id,n),Jt.d(dr,"Track Update",this.trackStates,e),this.signal.trackUpdate(new Map([[t.track_id,n]]))}}changeRole(e,t,n=!1){return Lt(this,null,(function*(){yield this.signal.requestRoleChange({requested_for:e.peerId,role:t,force:n})}))}acceptRoleChange(e){return Lt(this,null,(function*(){yield this.signal.acceptRoleChangeRequest({role:e.role.name,token:e.token})}))}endRoom(e,t){return Lt(this,null,(function*(){yield this.signal.endRoom(e,t)}))}removePeer(e,t){return Lt(this,null,(function*(){yield this.signal.removePeer({requested_for:e,reason:t})}))}startRTMPOrRecording(e){return Lt(this,null,(function*(){var t;let n={meeting_url:e.meetingURL,record:e.record};(null==(t=e.rtmpURLs)?void 0:t.length)&&(n.rtmp_urls=e.rtmpURLs),e.resolution&&(n.resolution=e.resolution),yield this.signal.startRTMPOrRecording(n)}))}stopRTMPOrRecording(){return Lt(this,null,(function*(){yield this.signal.stopRTMPAndRecording()}))}startHLSStreaming(e){return Lt(this,null,(function*(){let t={};e&&e.variants&&e.variants.length>0&&(t.variants=e.variants.map((e=>{let t={meeting_url:e.meetingURL};return e.metadata&&(t.metadata=e.metadata),t}))),(null==e?void 0:e.recording)&&(t.hls_recording={single_file_per_layer:e.recording.singleFilePerLayer,hls_vod:e.recording.hlsVod}),yield this.signal.startHLSStreaming(t)}))}stopHLSStreaming(e){return Lt(this,null,(function*(){var t;if(e){let n={variants:null==(t=null==e?void 0:e.variants)?void 0:t.map((e=>{let t={meeting_url:e.meetingURL};return e.metadata&&(t.metadata=e.metadata),t}))};yield this.signal.stopHLSStreaming(n)}yield this.signal.stopHLSStreaming()}))}sendHLSTimedMetadata(e){return Lt(this,null,(function*(){if(e.length>0){let t={metadata_objs:e};yield this.signal.sendHLSTimedMetadata(t)}}))}changeName(e){return Lt(this,null,(function*(){yield this.signal.updatePeer({name:e})}))}changeMetadata(e){return Lt(this,null,(function*(){yield this.signal.updatePeer({data:e})}))}getSessionMetadata(){return this.signal.getSessionMetadata()}setSessionMetadata(e){return Lt(this,null,(function*(){yield this.signal.setSessionMetadata({data:e})}))}changeTrackState(e){return Lt(this,null,(function*(){yield this.signal.requestTrackStateChange(e)}))}changeMultiTrackState(e){return Lt(this,null,(function*(){yield this.signal.requestMultiTrackStateChange(e)}))}publishTrack(e){return Lt(this,null,(function*(){e.publishedTrackId=e.getTrackIDBeingSent(),Jt.d(dr,`⏳ publishTrack: trackId=${e.trackId}, toPublishTrackId=${e.publishedTrackId}`,`${e}`),this.trackStates.set(e.publishedTrackId,new Ji(e));let t=new Promise(((e,t)=>{this.callbacks.set(pn,{promise:{resolve:e,reject:t},action:tn.PUBLISH,extra:{}})})),n=e.stream;n.setConnection(this.publishConnection);let i=this.store.getSimulcastLayers(e.source);n.addTransceiver(e,i),Jt.time(`publish-${e.trackId}-${e.type}`),yield t,Jt.timeEnd(`publish-${e.trackId}-${e.type}`),this.store.addTrack(e);let r=e.settings.maxBitrate;r&&(yield n.setMaxBitrate(r,e).then((()=>{Jt.d(dr,`Setting maxBitrate for ${e.source} ${e.type} to ${r} kpbs`)})).catch((e=>Jt.w(dr,"Failed setting maxBitrate",e)))),Jt.d(dr,`✅ publishTrack: trackId=${e.trackId}`,`${e}`,this.callbacks)}))}unpublishTrack(e){return Lt(this,null,(function*(){if(Jt.d(dr,`⏳ unpublishTrack: trackId=${e.trackId}`,`${e}`),e.publishedTrackId&&this.trackStates.has(e.publishedTrackId))this.trackStates.delete(e.publishedTrackId);else{let t=Array.from(this.trackStates.values()).find((t=>e.type===t.type&&e.source===t.source));t&&this.trackStates.delete(t.track_id)}let t=new Promise(((e,t)=>{this.callbacks.set(pn,{promise:{resolve:e,reject:t},action:tn.UNPUBLISH,extra:{}})}));e.stream.removeSender(e),yield t,yield e.cleanup(),this.store.removeTrack(e.trackId),Jt.d(dr,`✅ unpublishTrack: trackId=${e.trackId}`,this.callbacks)}))}waitForLocalRoleAvailability(){if(!this.store.hasRoleDetailsArrived())return new Promise((e=>{this.eventBus.policyChange.subscribeOnce((()=>e()))}))}createConnectionsAndNegotiateJoin(e,t=!1,n=!0){return Lt(this,null,(function*(){let i=this.doesLocalPeerNeedWebRTC();i&&this.createPeerConnections(),yield this.negotiateJoinWithRetry({name:e.name,data:e.metaData,autoSubscribeVideo:t,serverSubDegrade:n,isWebRTC:i})}))}createPeerConnections(){this.initConfig&&(this.publishConnection||(this.publishConnection=new xn(this.signal,this.initConfig.rtcConfiguration,this.publishConnectionObserver,this)),this.subscribeConnection||(this.subscribeConnection=new $n(this.signal,this.initConfig.rtcConfiguration,this.subscribeConnectionObserver)))}negotiateJoinWithRetry(e){return Lt(this,arguments,(function*({name:e,data:t,autoSubscribeVideo:n,serverSubDegrade:i,isWebRTC:r=!0}){try{yield this.negotiateJoin({name:e,data:t,autoSubscribeVideo:n,serverSubDegrade:i,isWebRTC:r})}catch(s){Jt.e(dr,"Join negotiation failed ❌",s);let o=s instanceof rn?s:sn.WebsocketMethodErrors.ServerErrors(500,tn.JOIN,`Websocket join error - ${s.message}`);if(5!==parseInt(""+o.code/100)&&429!==o.code)throw s;{this.joinRetryCount=0,o.isTerminal=!1;let s=()=>Lt(this,null,(function*(){return this.joinRetryCount++,yield this.negotiateJoin({name:e,data:t,autoSubscribeVideo:n,serverSubDegrade:i,isWebRTC:r})}));yield this.retryScheduler.schedule({category:Yi.JoinWSMessageFailed,error:o,task:s,originalState:Hi.Joined,maxFailedRetries:3,changeState:!1})}}}))}negotiateJoin(e){return Lt(this,arguments,(function*({name:e,data:t,autoSubscribeVideo:n,serverSubDegrade:i,isWebRTC:r=!0}){return r?yield this.negotiateJoinWebRTC({name:e,data:t,autoSubscribeVideo:n,serverSubDegrade:i}):yield this.negotiateJoinNonWebRTC({name:e,data:t,autoSubscribeVideo:n,serverSubDegrade:i})}))}negotiateJoinWebRTC(e){return Lt(this,arguments,(function*({name:e,data:t,autoSubscribeVideo:n,serverSubDegrade:i}){if(Jt.d(dr,"⏳ join: Negotiating over PUBLISH connection"),!this.publishConnection)return Jt.e(dr,"Publish peer connection not found, cannot negotiate"),!1;let r=yield this.publishConnection.createOffer();yield this.publishConnection.setLocalDescription(r);let s=yield this.signal.join(e,t,!n,i,r);yield this.publishConnection.setRemoteDescription(s);for(let e of this.publishConnection.candidates)yield this.publishConnection.addIceCandidate(e);return this.publishConnection.initAfterJoin(),!!s}))}negotiateJoinNonWebRTC(e){return Lt(this,arguments,(function*({name:e,data:t,autoSubscribeVideo:n,serverSubDegrade:i}){return Jt.d(dr,"⏳ join: Negotiating Non-WebRTC"),!!(yield this.signal.join(e,t,!n,i))}))}negotiateOnFirstPublish(){return Lt(this,null,(function*(){if(Jt.d(dr,"⏳ Negotiating offer over PUBLISH connection"),!this.publishConnection)return Jt.e(dr,"Publish peer connection not found, cannot negotiate"),!1;let e=yield this.publishConnection.createOffer(this.trackStates);yield this.publishConnection.setLocalDescription(e);let t=yield this.signal.offer(e,this.trackStates);yield this.publishConnection.setRemoteDescription(t);for(let e of this.publishConnection.candidates)yield this.publishConnection.addIceCandidate(e);return this.publishConnection.initAfterJoin(),!!t}))}performPublishRenegotiation(e){return Lt(this,null,(function*(){Jt.d(dr,"⏳ [role=PUBLISH] onRenegotiationNeeded START",this.trackStates);let t=this.callbacks.get(pn);if(t){if(!this.publishConnection)return void Jt.e(dr,"Publish peer connection not found, cannot renegotiate");try{let n=yield this.publishConnection.createOffer(this.trackStates,e);yield this.publishConnection.setLocalDescription(n),Jt.time("renegotiation-offer-exchange");let i=yield this.signal.offer(n,this.trackStates);this.callbacks.delete(pn),Jt.timeEnd("renegotiation-offer-exchange"),yield this.publishConnection.setRemoteDescription(i),t.promise.resolve(!0),Jt.d(dr,"[role=PUBLISH] onRenegotiationNeeded DONE ✅")}catch(e){let n;n=e instanceof rn?e:sn.GenericErrors.Unknown(tn.PUBLISH,e.message),t.promise.reject(n),Jt.d(dr,"[role=PUBLISH] onRenegotiationNeeded FAILED ❌")}}}))}handleIceConnectionFailure(e){return Lt(this,null,(function*(){e===Xt.Publish?this.retryScheduler.schedule({category:Yi.PublishIceConnectionFailed,error:sn.WebrtcErrors.ICEFailure(tn.PUBLISH),task:this.retryPublishIceFailedTask,originalState:Hi.Joined}):this.retryScheduler.schedule({category:Yi.SubscribeIceConnectionFailed,error:sn.WebrtcErrors.ICEFailure(tn.SUBSCRIBE),task:this.retrySubscribeIceFailedTask,originalState:Hi.Joined,maxFailedRetries:1})}))}internalConnect(e,t,n){return Lt(this,null,(function*(){Jt.d(dr,"connect: started ⏰");let i=new Date;try{return this.analyticsTimer.start(Vi.INIT),this.initConfig=yield Gn.fetchInitConfig({token:e,peerId:n,userAgent:this.store.getUserAgent(),initEndpoint:t}),this.analyticsTimer.end(Vi.INIT),this.validateNotDisconnected("post init"),yield this.openSignal(e,n),Jt.d(dr,"Adding Analytics Transport: JsonRpcSignal"),this.analyticsEventsService.setTransport(this.analyticsSignalTransport),this.analyticsEventsService.flush(),this.initConfig}catch(e){throw this.state!==Hi.Reconnecting&&this.eventBus.analytics.publish(Fi.connect(e,this.getAdditionalAnalyticsProperties(),i,new Date,t)),Jt.d(dr,"❌ internal connect: failed",e),e}}))}validateNotDisconnected(e){if(this.state===Hi.Disconnected)throw Jt.w(dr,"aborting join as transport state is disconnected"),sn.GenericErrors.ValidationFailed(`leave called before join could complete - stage=${e}`)}openSignal(e,t){return Lt(this,null,(function*(){if(!this.initConfig)throw sn.InitAPIErrors.InitConfigNotAvailable(tn.INIT,"Init Config not found");Jt.d(dr,"⏳ internal connect: connecting to ws endpoint",this.initConfig.endpoint);let n=new URL(this.initConfig.endpoint);n.searchParams.set("peer",t),n.searchParams.set("token",e),n.searchParams.set("user_agent_v2",this.store.getUserAgent()),this.endpoint=n.toString(),this.analyticsTimer.start(Vi.WEBSOCKET_CONNECT),yield this.signal.open(this.endpoint),this.analyticsTimer.end(Vi.WEBSOCKET_CONNECT),this.analyticsTimer.start(Vi.ON_POLICY_CHANGE),Jt.d(dr,"✅ internal connect: connected to ws endpoint")}))}initRtcStatsMonitor(){return Lt(this,null,(function*(){var e,t,n,i;null==(n=this.webrtcInternals)||n.setPeerConnections({publish:null==(e=this.publishConnection)?void 0:e.nativeConnection,subscribe:null==(t=this.subscribeConnection)?void 0:t.nativeConnection}),this.store.getSubscribeDegradationParams()&&(this.isFlagEnabled(Qi.FLAG_SERVER_SUB_DEGRADATION)||(yield null==(i=this.webrtcInternals)?void 0:i.start(),this.trackDegradationController=new class{constructor(e,t){this.store=e,this.eventBus=t,this.TAG="[TrackDegradationController]",this.MAX_RECOVER_GRACE_PERIOD=120,this.recoverAttemptCount=0,this.packetsLost=0;let n=this.store.getSubscribeDegradationParams();this.PACKETS_LOST_THRESHOLD=n.packetLossThreshold,this.MIN_DEGRADE_GRACE_PERIOD=n.degradeGracePeriodSeconds,this.MIN_RECOVER_GRACE_PERIOD=n.recoverGracePeriodSeconds,this.degradeGracePeriod=this.MIN_DEGRADE_GRACE_PERIOD,this.recoverGracePeriod=this.MIN_RECOVER_GRACE_PERIOD}get isAttemptingRecover(){return Boolean(this.recoveringTrack)}handleRtcStatsChange(e){let t=e>this.packetsLost+this.PACKETS_LOST_THRESHOLD;this.packetsLost=e,t?this.degrade():this.recover()}degrade(){if(!(this.degradeGracePeriod>0))return this.isAttemptingRecover?this.cancelRecovery():(Jt.d(this.TAG,"Packet loss increased, Degrading",{packetsLost:this.packetsLost}),this.degradeActiveTracksByHalf(),this.degradeGracePeriod=this.MIN_DEGRADE_GRACE_PERIOD,void(this.recoverGracePeriod=this.MIN_RECOVER_GRACE_PERIOD));this.degradeGracePeriod--}recover(){this.degradeGracePeriod=this.MIN_DEGRADE_GRACE_PERIOD,this.recoverGracePeriod>0?this.recoverGracePeriod--:(this.recoveringTrack=this.getActiveTracks(!0).find((e=>e.degraded)),this.recoveringTrack&&(Jt.d(this.TAG,"Packet lost stable, recovering track",this.recoveringTrack),this.recoveringTrack.setDegradedFromSdk(!1),this.eventBus.trackRestored.publish(this.recoveringTrack),this.recoverGracePeriod=this.MIN_RECOVER_GRACE_PERIOD))}cleanUp(){this.eventBus.trackDegraded.removeAllListeners(),this.eventBus.trackRestored.removeAllListeners()}degradeActiveTracksByHalf(){let e=this.getActiveTracks(!1);if(!e.length)return;Jt.d(this.TAG,{activeTracks:[...e]});let t=Math.ceil(e.length/2);for(;t--;){let t=e.pop();t.setDegradedFromSdk(!0),this.eventBus.trackDegraded.publish(t)}}getActiveTracks(e){return this.store.getRemoteVideoTracks().filter((t=>t.hasSinks()&&(!t.degraded||e))).sort(((e,t)=>{let n=this.store.getComparator().getTrackComparators();return-1*(n.screenShare(e,t)||n.rolePriority(e,t)||n.peerAudioLevel(e,t)||this.store.getComparator().stringComparator(e.trackId,t.trackId))})).slice(0)}cancelRecovery(){this.recoveringTrack&&(this.recoveringTrack.setDegradedFromSdk(!0),this.eventBus.trackDegraded.publish(this.recoveringTrack)),this.recoveringTrack=void 0,this.recoverAttemptCount++,this.recoverGracePeriod=this.getDelayForRecoverCount(this.recoverAttemptCount),this.degradeGracePeriod=this.MIN_DEGRADE_GRACE_PERIOD,Jt.d(this.TAG,"Recover Attempt Failed",{count:this.recoverAttemptCount,delay:this.recoverGracePeriod})}getDelayForRecoverCount(e){let t=this.MIN_RECOVER_GRACE_PERIOD+this.MIN_RECOVER_GRACE_PERIOD*e;return Math.min(t,this.MAX_RECOVER_GRACE_PERIOD)}}(this.store,this.eventBus),this.eventBus.statsUpdate.subscribe((e=>{var t,n,i;null==(i=this.trackDegradationController)||i.handleRtcStatsChange((null==(n=null==(t=e.getLocalPeerStats())?void 0:t.subscribe)?void 0:n.packetsLost)||0)}))),this.eventBus.trackDegraded.subscribe((e=>{this.eventBus.analytics.publish(Fi.degradationStats(e,!0)),this.observer.onTrackDegrade(e)})),this.eventBus.trackRestored.subscribe((e=>{this.eventBus.analytics.publish(Fi.degradationStats(e,!1)),this.observer.onTrackRestore(e)})))}))}doesRoleNeedWebRTC(e){var t,n;if(!this.isFlagEnabled(Qi.FLAG_NON_WEBRTC_DISABLE_OFFER))return!0;let i=Boolean(e.publishParams.allowed&&(null==(t=e.publishParams.allowed)?void 0:t.length)>0),r=Boolean(e.subscribeParams.subscribeToRoles&&(null==(n=e.subscribeParams.subscribeToRoles)?void 0:n.length)>0);return i||r}doesLocalPeerNeedWebRTC(){var e;let t=null==(e=this.store.getLocalPeer())?void 0:e.role;return!t||this.doesRoleNeedWebRTC(t)}setTransportStateForConnect(){if(this.state===Hi.Failed&&(this.state=Hi.Disconnected),this.state!==Hi.Disconnected&&this.state!==Hi.Reconnecting)throw sn.WebsocketMethodErrors.AlreadyJoined(tn.JOIN,`Cannot join a meeting in ${this.state} state`);this.state===Hi.Disconnected&&(this.state=Hi.Connecting,this.observer.onStateChange(this.state))}sendErrorAnalyticsEvent(e,t){let n,i=this.getAdditionalAnalyticsProperties();switch(t){case Yi.ConnectFailed:n=Fi.connect(e,i);break;case Yi.SignalDisconnect:n=Fi.disconnect(e,i);break;case Yi.JoinWSMessageFailed:n=Fi.join({error:e,time:this.analyticsTimer.getTimeTaken(Vi.JOIN),init_response_time:this.analyticsTimer.getTimeTaken(Vi.INIT),ws_connect_time:this.analyticsTimer.getTimeTaken(Vi.WEBSOCKET_CONNECT),on_policy_change_time:this.analyticsTimer.getTimeTaken(Vi.ON_POLICY_CHANGE),local_tracks_time:this.analyticsTimer.getTimeTaken(Vi.LOCAL_TRACKS),retries_join:this.joinRetryCount});break;case Yi.PublishIceConnectionFailed:n=Fi.publish({error:e});break;case Yi.SubscribeIceConnectionFailed:n=Fi.subscribeFail(e)}this.eventBus.analytics.publish(n)}getAdditionalAnalyticsProperties(){var e,t,n,i,r,s,o,a;let l=(()=>{if(!Vt||void 0===navigator.connection)return;let e=navigator.connection;return{downlink:e.downlink,downlinkMax:e.downlinkMax,effectiveType:e.effectiveType,rtt:e.rtt,saveData:e.saveData,type:e.type}})(),c="undefined"!=typeof document&&document.hidden,u=this.store.getRemoteVideoTracks().filter((e=>e.degraded)).length;return{network_info:l,document_hidden:c,num_degraded_tracks:u,bitrate:{publish:null==(i=null==(n=null==(t=null==(e=this.getWebrtcInternals())?void 0:e.getCurrentStats())?void 0:t.getLocalPeerStats())?void 0:n.publish)?void 0:i.bitrate,subscribe:null==(a=null==(o=null==(s=null==(r=this.getWebrtcInternals())?void 0:r.getCurrentStats())?void 0:s.getLocalPeerStats())?void 0:o.subscribe)?void 0:a.bitrate},max_sub_bitrate:this.maxSubscribeBitrate,recent_pong_response_times:this.signal.getPongResponseTimes(),transport_state:this.state}}}(this.observer,this.deviceManager,this.store,this.localTrackManager,this.eventBus,this.analyticsEventsService,this.analyticsTimer),this.eventBus.analytics.subscribe(this.sendAnalyticsEvent),this.eventBus.deviceChange.subscribe(this.handleDeviceChange),this.eventBus.audioPluginFailed.subscribe(this.handleAudioPluginError)}validateJoined(e){if(!this.localPeer)throw sn.GenericErrors.NotConnected(tn.VALIDATION,`Not connected - ${e}`)}refreshDevices(){return Lt(this,null,(function*(){this.validateJoined("refreshDevices"),yield this.deviceManager.init(!0)}))}getWebrtcInternals(){var e;return null==(e=this.transport)?void 0:e.getWebrtcInternals()}getPlaylistManager(){return this.playlistManager}getRecordingState(){var e;return null==(e=this.store.getRoom())?void 0:e.recording}getRTMPState(){var e;return null==(e=this.store.getRoom())?void 0:e.rtmp}getHLSState(){var e;return null==(e=this.store.getRoom())?void 0:e.hls}get localPeer(){var e;return null==(e=this.store)?void 0:e.getLocalPeer()}preview(e,t){return Lt(this,null,(function*(){if(cn(),ln(),this.sdkState.isPreviewInProgress)return Promise.reject(sn.GenericErrors.PreviewAlreadyInProgress(tn.PREVIEW,"Preview already called"));this.analyticsTimer.start(Vi.PREVIEW),this.setUpPreview(e,t),e.alwaysRequestPermissions&&this.localTrackManager.requestPermissions().then((()=>Lt(this,null,(function*(){yield this.initDeviceManagers()}))));let n=!1,i=!1,r=setTimeout((()=>{var e,t;(!n||!i)&&(null==(t=null==(e=this.listener)?void 0:e.onNetworkQuality)||t.call(e,-1))}),3e3);return new Promise(((s,o)=>{this.eventBus.policyChange.subscribeOnce((()=>Lt(this,null,(function*(){var n;let i=yield this.localTrackManager.getTracksToPublish(e.settings||Tr);i.forEach((e=>this.setLocalPeerTrack(e))),(null==(n=this.localPeer)?void 0:n.audioTrack)&&this.initPreviewTrackAudioLevelMonitor(),yield this.initDeviceManagers(),this.sdkState.isPreviewInProgress=!1,this.analyticsTimer.end(Vi.PREVIEW),t.onPreview(this.store.getRoom(),i),this.sendPreviewAnalyticsEvent(),s()})))),this.transport.preview(e.authToken,e.initEndpoint,this.localPeer.peerId,{name:e.userName,metaData:e.metaData||""},e.autoVideoSubscribe).then((t=>{var s;n=!0,clearTimeout(r),t&&e.captureNetworkQualityInPreview&&this.networkTestManager.start(null==(s=t.config)?void 0:s.networkHealth).then((()=>{i=!0}))})).catch((e=>{var t;this.analyticsTimer.end(Vi.PREVIEW),null==(t=this.errorListener)||t.onError(e),this.sendPreviewAnalyticsEvent(e),this.sdkState.isPreviewInProgress=!1,o(e)}))}))}))}join(e,t){return Lt(this,null,(function*(){var n,i,r,s;if(cn(),ln(),this.sdkState.isPreviewInProgress)throw sn.GenericErrors.NotReady(tn.JOIN,"Preview is in progress, can't join");this.analyticsTimer.start(Vi.JOIN);let o=this.transportState===Hi.Preview,{roomId:a,userId:l,role:c}=hr(e.authToken);null==(n=this.networkTestManager)||n.stop(),null==(r=null==(i=this.localPeer)?void 0:i.audioTrack)||r.destroyAudioLevelMonitor(),this.listener=t,this.commonSetup(e,a,t),this.removeDevicesFromConfig(e),this.store.setConfig(e),this.store.createAndSetUserAgent(this.frameworkInfo),this.localPeer?(this.localPeer.name=e.userName,this.localPeer.role=this.store.getPolicyForRole(c),this.localPeer.customerUserId=l,this.localPeer.metadata=e.metaData):this.createAndAddLocalPeerToStore(e,c,l),this.roleChangeManager=new class{constructor(e,t,n,i,r){this.store=e,this.transport=t,this.publish=n,this.removeAuxiliaryTrack=i,this.listener=r,this.handleLocalPeerRoleUpdate=e=>Lt(this,[e],(function*({oldRole:e,newRole:t}){var n,i;let r=this.store.getLocalPeer();if(!r)return;let s=new Set(e.publishParams.allowed||[]),o=new Set(t.publishParams.allowed||[]),a=this.removeTrack(s,o,"video"),l=this.removeTrack(s,o,"audio"),c=this.removeTrack(s,o,"screen");yield this.removeVideoTracks(a),yield this.removeAudioTrack(l),yield this.removeScreenTracks(c),this.store.setPublishParams(t.publishParams);let u=(null==(n=this.store.getConfig())?void 0:n.settings)||{isAudioMuted:!0,isVideoMuted:!0,audioInputDeviceId:"default",videoDeviceId:"default",audioOutputDeviceId:"default"};yield this.publish(Dt(xt({},u),{isAudioMuted:!0,isVideoMuted:!0})),null==(i=this.listener)||i.onPeerUpdate(qt.ROLE_UPDATED,r)}))}removeVideoTracks(e){return Lt(this,null,(function*(){var t;if(!e)return;let n=this.store.getLocalPeer();(null==n?void 0:n.videoTrack)&&(yield this.transport.unpublish([n.videoTrack]),null==(t=this.listener)||t.onTrackUpdate(Gt.TRACK_REMOVED,n.videoTrack,n),n.videoTrack=void 0),yield this.removeAuxTracks((e=>"screen"!==e.source&&"video"===e.type))}))}removeAudioTrack(e){return Lt(this,null,(function*(){var t;if(!e)return;let n=this.store.getLocalPeer();(null==n?void 0:n.audioTrack)&&(yield this.transport.unpublish([n.audioTrack]),null==(t=this.listener)||t.onTrackUpdate(Gt.TRACK_REMOVED,n.audioTrack,n),n.audioTrack=void 0),yield this.removeAuxTracks((e=>"screen"!==e.source&&"audio"===e.type))}))}removeScreenTracks(e){return Lt(this,null,(function*(){!e||(yield this.removeAuxTracks((e=>"screen"===e.source)))}))}removeAuxTracks(e){return Lt(this,null,(function*(){let t=this.store.getLocalPeer();if(null==t?void 0:t.auxiliaryTracks){let n=[...t.auxiliaryTracks];for(let t of n)e(t)&&(yield this.removeAuxiliaryTrack(t.trackId))}}))}removeTrack(e,t,n){return e.has(n)&&!t.has(n)}}(this.store,this.transport,this.publish.bind(this),this.removeTrack.bind(this),this.listener),this.eventBus.localRoleUpdate.subscribe(this.handleLocalRoleUpdate),Jt.d(this.TAG,"SDK Store",this.store),Jt.d(this.TAG,`⏳ Joining room ${a}`),Jt.time(`join-room-${a}`);try{yield this.transport.join(e.authToken,this.localPeer.peerId,{name:e.userName,metaData:e.metaData},e.initEndpoint,e.autoVideoSubscribe),Jt.d(this.TAG,`✅ Joined room ${a}`),Bi.resumeContext(),yield this.notifyJoin(),this.sendJoinAnalyticsEvent(o),[this.store.getPublishParams(),!this.sdkState.published,!Ft].every((e=>!!e))&&this.publish(e.settings||Tr).catch((e=>{var t;Jt.e(this.TAG,"Error in publish",e),null==(t=this.listener)||t.onError(e)}))}catch(e){throw this.analyticsTimer.end(Vi.JOIN),null==(s=this.listener)||s.onError(e),this.sendJoinAnalyticsEvent(o,e),Jt.e(this.TAG,"Unable to join room",e),e}Jt.timeEnd(`join-room-${a}`)}))}stringifyMetadata(e){e.metaData&&"string"!=typeof e.metaData?e.metaData=JSON.stringify(e.metaData):e.metaData||(e.metaData="")}cleanUp(){var e,t;this.cleanDeviceManagers(),this.eventBus.analytics.unsubscribe(this.sendAnalyticsEvent),this.analyticsTimer.cleanUp(),Ii.cleanup(),this.playlistManager.cleanup(),Jt.cleanUp(),this.sdkState=xt({},Er),this.localPeer&&(null==(e=this.localPeer.audioTrack)||e.cleanup(),this.localPeer.audioTrack=void 0,null==(t=this.localPeer.videoTrack)||t.cleanup(),this.localPeer.videoTrack=void 0),this.store.cleanUp(),this.listener=void 0,this.roleChangeManager&&this.eventBus.localRoleUpdate.unsubscribe(this.roleChangeManager.handleLocalPeerRoleUpdate)}leave(){return this.internalLeave()}internalLeave(e=!0){return Lt(this,null,(function*(){var t,n;let i=this.store.getRoom();if(i){let r=i.id;null==(t=this.networkTestManager)||t.stop(),Jt.d(this.TAG,`⏳ Leaving room ${r}`),yield null==(n=this.transport)?void 0:n.leave(e),this.cleanUp(),Jt.d(this.TAG,`✅ Left room ${r}`)}}))}getLocalPeer(){return this.store.getLocalPeer()}getPeers(){let e=this.store.getPeers();return e.length<50&&Jt.d(this.TAG,`Got peers(${e.length})`,e.toString()),e}getAudioOutput(){return this.audioOutput}sendMessage(e,t){this.sendMessageInternal({message:t,type:e})}sendBroadcastMessage(e,t){return Lt(this,null,(function*(){return yield this.sendMessageInternal({message:e,type:t})}))}sendGroupMessage(e,t,n){return Lt(this,null,(function*(){let i=this.store.getKnownRoles();if(0===(t.filter((e=>i[e.name]))||[]).length)throw sn.GenericErrors.ValidationFailed("No valid role is present",t);return yield this.sendMessageInternal({message:e,recipientRoles:t,type:n})}))}sendDirectMessage(e,t,n){return Lt(this,null,(function*(){var i;if(!this.store.getPeerById(t.peerId))throw sn.GenericErrors.ValidationFailed("Invalid peer - peer not present in the room",t);if((null==(i=this.localPeer)?void 0:i.peerId)===t.peerId)throw sn.GenericErrors.ValidationFailed("Cannot send message to self");return yield this.sendMessageInternal({message:e,recipientPeer:t,type:n})}))}sendMessageInternal(e){return Lt(this,arguments,(function*({recipientRoles:e,recipientPeer:t,type:n="chat",message:i}){if(""===i.replace(/\u200b/g," ").trim())throw Jt.w(this.TAG,"sendMessage","Ignoring empty message send"),sn.GenericErrors.ValidationFailed("Empty message not allowed");let r=new ti({sender:this.localPeer,type:n,message:i,recipientPeer:t,recipientRoles:e,time:new Date});Jt.d(this.TAG,"Sending Message: ",r);let s=yield this.transport.sendMessage(r);return r.time=new Date(s.timestamp),r}))}startScreenShare(e){return Lt(this,arguments,(function*(e,t={audioOnly:!1,videoOnly:!1}){var n,i,r;let s=this.store.getPublishParams();if(!s)return;let{allowed:o}=s;if(!o||!o.includes("screen"))return void Jt.e(this.TAG,`Role ${null==(n=this.localPeer)?void 0:n.role} cannot share screen`);if(null==(r=null==(i=this.localPeer)?void 0:i.auxiliaryTracks)?void 0:r.find((e=>"screen"===e.source)))throw Error("Cannot share multiple screens");let a=yield this.getScreenshareTracks(e,t);if(!this.localPeer)return Jt.d(this.TAG,"Screenshared when not connected"),void a.forEach((e=>{e.cleanup()}));yield this.transport.publish(a),a.forEach((e=>{var t,n,i;e.peerId=null==(t=this.localPeer)?void 0:t.peerId,null==(n=this.localPeer)||n.auxiliaryTracks.push(e),null==(i=this.listener)||i.onTrackUpdate(Gt.TRACK_ADDED,e,this.localPeer)}))}))}stopEndedScreenshare(e){return Lt(this,null,(function*(){Jt.d(this.TAG,"✅ Screenshare ended natively"),yield this.stopScreenShare(),e()}))}stopScreenShare(){return Lt(this,null,(function*(){var e;Jt.d(this.TAG,"✅ Screenshare ended from app");let t=null==(e=this.localPeer)?void 0:e.auxiliaryTracks.filter((e=>"screen"===e.source));if(t)for(let e of t)yield this.removeTrack(e.trackId)}))}addTrack(e,t="regular"){return Lt(this,null,(function*(){var n,i,r,s;if(!e)return void Jt.w(this.TAG,"Please pass a valid MediaStreamTrack");if(!this.localPeer)throw sn.GenericErrors.NotConnected(tn.VALIDATION,"No local peer present, cannot addTrack");if(this.localPeer.auxiliaryTracks.find((t=>t.trackId===e.id)))return;let o=e.kind,a=new MediaStream([e]),l=new Ui(a),c=new("audio"===o?Ni:Ki)(l,e,t,this.eventBus);this.setPlaylistSettings({track:e,hmsTrack:c,source:t}),yield null==(n=this.transport)?void 0:n.publish([c]),c.peerId=null==(i=this.localPeer)?void 0:i.peerId,null==(r=this.localPeer)||r.auxiliaryTracks.push(c),null==(s=this.listener)||s.onTrackUpdate(Gt.TRACK_ADDED,c,this.localPeer)}))}removeTrack(e){return Lt(this,null,(function*(){var t;if(!this.localPeer)throw sn.GenericErrors.NotConnected(tn.VALIDATION,"No local peer present, cannot removeTrack");let n=this.localPeer.auxiliaryTracks.findIndex((t=>t.trackId===e));if(n>-1){let e=this.localPeer.auxiliaryTracks[n];yield this.transport.unpublish([e]),"audioplaylist"===e.source?this.playlistManager.stop(Zt.audio):"videoplaylist"===e.source&&this.playlistManager.stop(Zt.video),this.localPeer.auxiliaryTracks.splice(n,1),null==(t=this.listener)||t.onTrackUpdate(Gt.TRACK_REMOVED,e,this.localPeer)}else Jt.w(this.TAG,`No track found for ${e}`)}))}setAnalyticsLevel(e){this.analyticsEventsService.level=e}setLogLevel(e){Jt.level=e}addAudioListener(e){this.audioListener=e,this.notificationManager.setAudioListener(e)}addConnectionQualityListener(e){this.notificationManager.setConnectionQualityListener(e)}changeRole(e,t,n=!1){return Lt(this,null,(function*(){var i;!e.role||e.role.name===t||(yield null==(i=this.transport)?void 0:i.changeRole(e,t,n))}))}acceptChangeRole(e){return Lt(this,null,(function*(){var t;yield null==(t=this.transport)?void 0:t.acceptRoleChange(e)}))}endRoom(e,t){return Lt(this,null,(function*(){var n;if(!this.localPeer)throw sn.GenericErrors.NotConnected(tn.VALIDATION,"No local peer present, cannot end room");yield null==(n=this.transport)?void 0:n.endRoom(e,t),yield this.leave()}))}removePeer(e,t){return Lt(this,null,(function*(){var n;if(!this.localPeer)throw sn.GenericErrors.NotConnected(tn.VALIDATION,"No local peer present, cannot remove peer");if(!this.store.getPeerById(e.peerId))throw sn.GenericErrors.ValidationFailed("Invalid peer, given peer not present in room",e);yield null==(n=this.transport)?void 0:n.removePeer(e.peerId,t)}))}startRTMPOrRecording(e){return Lt(this,null,(function*(){var t;if(!this.localPeer)throw sn.GenericErrors.NotConnected(tn.VALIDATION,"No local peer present, cannot start streaming or recording");try{yield null==(t=this.transport)?void 0:t.startRTMPOrRecording(e)}catch(e){throw this.sendAnalyticsEvent(Fi.RTMPError(e)),e}}))}stopRTMPAndRecording(){return Lt(this,null,(function*(){var e;if(!this.localPeer)throw sn.GenericErrors.NotConnected(tn.VALIDATION,"No local peer present, cannot stop streaming or recording");try{yield null==(e=this.transport)?void 0:e.stopRTMPOrRecording()}catch(e){throw this.sendAnalyticsEvent(Fi.RTMPError(e,!1)),e}}))}startHLSStreaming(e){return Lt(this,null,(function*(){var t;if(!this.localPeer)throw sn.GenericErrors.NotConnected(tn.VALIDATION,"No local peer present, cannot start HLS streaming");try{yield null==(t=this.transport)?void 0:t.startHLSStreaming(e)}catch(e){throw this.sendAnalyticsEvent(Fi.HLSError(e)),e}}))}stopHLSStreaming(e){return Lt(this,null,(function*(){var t;if(!this.localPeer)throw sn.GenericErrors.NotConnected(tn.VALIDATION,"No local peer present, cannot stop HLS streaming");try{yield null==(t=this.transport)?void 0:t.stopHLSStreaming(e)}catch(e){throw this.sendAnalyticsEvent(Fi.HLSError(e,!1)),e}}))}sendHLSTimedMetadata(e){return Lt(this,null,(function*(){var t;this.validateJoined("sendHLSTimedMetadata"),yield null==(t=this.transport)?void 0:t.sendHLSTimedMetadata(e)}))}changeName(e){return Lt(this,null,(function*(){var t;this.validateJoined("changeName"),yield null==(t=this.transport)?void 0:t.changeName(e),this.notificationManager.updateLocalPeer({name:e})}))}changeMetadata(e){return Lt(this,null,(function*(){var t;this.validateJoined("changeMetadata"),yield null==(t=this.transport)?void 0:t.changeMetadata(e),this.notificationManager.updateLocalPeer({metadata:e})}))}setSessionMetadata(e){return Lt(this,null,(function*(){yield this.transport.setSessionMetadata(e)}))}getSessionMetadata(){return Lt(this,null,(function*(){return(yield this.transport.getSessionMetadata()).data}))}getRoles(){return Object.values(this.store.getKnownRoles())}changeTrackState(e,t){return Lt(this,null,(function*(){var n;if(e.type===un.VIDEO&&"regular"!==e.source)return void Jt.w(this.TAG,"Muting non-regular video tracks is currently not supported");if(e.enabled===t)return void Jt.w(this.TAG,`Aborting change track state, track already has enabled - ${t}`,e);if(!this.store.getTrackById(e.trackId))throw sn.GenericErrors.ValidationFailed("No track found for change track state",e);let i=this.store.getPeerByTrackId(e.trackId);if(!i)throw sn.GenericErrors.ValidationFailed("No peer found for change track state",e);yield null==(n=this.transport)?void 0:n.changeTrackState({requested_for:i.peerId,track_id:e.trackId,stream_id:e.stream.id,mute:!t})}))}changeMultiTrackState(e){return Lt(this,null,(function*(){var t;if("boolean"!=typeof e.enabled)throw sn.GenericErrors.ValidationFailed("Pass a boolean for enabled");let{enabled:n,roles:i,type:r,source:s}=e;yield null==(t=this.transport)?void 0:t.changeMultiTrackState({value:!n,type:r,source:s,roles:null==i?void 0:i.map((e=>null==e?void 0:e.name))})}))}setFrameworkInfo(e){this.frameworkInfo=e}publish(e){return Lt(this,null,(function*(){let t=yield this.localTrackManager.getTracksToPublish(e);yield this.setAndPublishTracks(t),this.sdkState.published=!0}))}setAndPublishTracks(e){return Lt(this,null,(function*(){var t;for(let n of e)yield this.transport.publish([n]),this.setLocalPeerTrack(n),null==(t=this.listener)||t.onTrackUpdate(Gt.TRACK_ADDED,n,this.localPeer);yield this.initDeviceManagers()}))}setLocalPeerTrack(e){var t;switch(e.peerId=null==(t=this.localPeer)?void 0:t.peerId,e.type){case un.AUDIO:this.localPeer.audioTrack=e;break;case un.VIDEO:this.localPeer.videoTrack=e}}initDeviceManagers(){return Lt(this,null,(function*(){var e,t,n,i,r;this.sdkState.deviceManagersInitialised||(this.sdkState.deviceManagersInitialised=!0,yield this.deviceManager.init(),(yield this.deviceManager.updateOutputDevice(null==(t=null==(e=this.store.getConfig())?void 0:e.settings)?void 0:t.audioOutputDeviceId))||(yield this.deviceManager.updateOutputDevice(null==(i=null==(n=Ii.getSelection())?void 0:n.audioOutput)?void 0:i.deviceId)),this.audioSinkManager.init(null==(r=this.store.getConfig())?void 0:r.audioSinkElementId))}))}cleanDeviceManagers(){this.eventBus.deviceChange.unsubscribe(this.handleDeviceChange),this.eventBus.audioPluginFailed.unsubscribe(this.handleAudioPluginError),this.eventBus.autoplayError.unsubscribe(this.handleAutoplayError),this.deviceManager.cleanUp(),this.audioSinkManager.cleanUp()}initPreviewTrackAudioLevelMonitor(){var e;let t=null==(e=this.localPeer)?void 0:e.audioTrack;null==t||t.initAudioLevelMonitor(),this.eventBus.trackAudioLevelUpdate.subscribe((e=>{var n;let i=e&&e.track.trackId===(null==t?void 0:t.trackId)?[{audioLevel:e.audioLevel,peer:this.localPeer,track:t}]:[];this.store.updateSpeakers(i),null==(n=this.audioListener)||n.onAudioLevelUpdate(i)})),this.eventBus.localAudioSilence.subscribe(this.sendAudioPresenceFailed)}notifyJoin(){var e;let t=this.store.getLocalPeer(),n=this.store.getRoom();return n.joinedAt=new Date,t&&(t.joinedAt=n.joinedAt),(null==t?void 0:t.role)?(this.analyticsTimer.end(Vi.JOIN),void(null==(e=this.listener)||e.onJoin(n))):new Promise((e=>{this.eventBus.policyChange.subscribeOnce((()=>{var t;this.analyticsTimer.end(Vi.JOIN),null==(t=this.listener)||t.onJoin(n),e()}))}))}setUpPreview(e,t){this.listener=t,this.sdkState.isPreviewInProgress=!0;let{roomId:n,userId:i,role:r}=hr(e.authToken);this.commonSetup(e,n,t),this.store.setConfig(e),this.store.createAndSetUserAgent(this.frameworkInfo),this.createAndAddLocalPeerToStore(e,r,i),Jt.d(this.TAG,"SDK Store",this.store)}setPlaylistSettings(e){return Lt(this,arguments,(function*({track:e,hmsTrack:t,source:n}){if("videoplaylist"===n){let n={};if("audio"===e.kind)n.maxBitrate=64;else{n.maxBitrate=1e3;let{width:t,height:i}=e.getSettings();n.width=t,n.height=i}yield t.setSettings(n)}else"audioplaylist"===n&&(yield t.setSettings({maxBitrate:64}))}))}createAndAddLocalPeerToStore(e,t,n){let i=this.store.getPolicyForRole(t),r=new si({name:e.userName||"",customerUserId:n,metadata:e.metaData||"",role:i});this.store.addPeer(r)}commonSetup(e,t,n){this.stringifyMetadata(e),e.initEndpoint||(e.initEndpoint="https://prod-init.100ms.live"),this.errorListener=n,this.deviceChangeListener=n,this.initStoreAndManagers(),this.store.setErrorListener(this.errorListener),this.store.getRoom()||this.store.setRoom(new class{constructor(e,t){this.id=e,this.store=t,this.recording={server:{running:!1},browser:{running:!1},hls:{running:!1}},this.rtmp={running:!1},this.hls={running:!1,variants:[]}}get localPeer(){return this.store.getLocalPeer()}get peers(){return this.store.getPeers()}}(t,this.store))}removeDevicesFromConfig(e){this.store.getConfig()&&e.settings&&(delete e.settings.audioOutputDeviceId,delete e.settings.videoDeviceId,delete e.settings.audioInputDeviceId)}getScreenshareTracks(e,t){return Lt(this,null,(function*(){let{video:n,audio:i}=this.getScreenshareSettings(t.videoOnly),[r,s]=yield this.transport.getLocalScreen(n,i),o=()=>{this.stopEndedScreenshare(e)},a=[];if(t.audioOnly){if(r.nativeTrack.stop(),!s)throw Error("Select share audio when sharing screen");a.push(s),s.nativeTrack.onended=o}else a.push(r),r.nativeTrack.onended=o,s&&a.push(s);return a}))}},this.actions=new class{constructor(e,t,n){this.hmsSDKTracks={},this.hmsSDKPeers={},this.isRoomJoinCalled=!1,this.ignoredMessageTypes=[],this.setProgress=({type:e,progress:t})=>{this.setState((n=>{n.playlist[e].progress=t,n.playlist[e].currentTime=this.sdk.getPlaylistManager().getCurrentTime(e)}),"playlistProgress")},this.syncPlaylistState=e=>{this.setState((e=>{Object.assign(e.playlist,Zr.convertPlaylist(this.sdk.getPlaylistManager()))}),e)},this.sendPeerUpdateNotification=(e,t)=>{let n=this.store.getState(ao(t.peerId)),i=ko[e]||"peerUpdate";this.syncRoomState(i),n||(n=this.store.getState(ao(t.peerId))),this.hmsNotifications.sendPeerUpdate(e,n)},this.setState=(e,t)=>this.store.namedSetState(e,t),this.store=e,this.sdk=t,this.hmsNotifications=n}refreshDevices(){return jr(this,null,(function*(){yield this.sdk.refreshDevices()}))}unblockAudio(){return jr(this,null,(function*(){yield this.sdk.getAudioOutput().unblockAutoplay()}))}setVolume(e,t){t?this.setTrackVolume(e,t):(this.sdk.getAudioOutput().setVolume(e),this.syncRoomState("setOutputVolume"))}setAudioOutputDevice(e){return jr(this,null,(function*(){(yield this.sdk.getAudioOutput().setDevice(e))&&this.setState((t=>{t.settings.audioOutputDeviceId=e}),"setAudioOutputDevice")}))}setPreferredLayer(e,t){let n=this.hmsSDKTracks[e];n?n instanceof Bn?(n.preferLayer(t),this.updateVideoLayer(e,"setPreferredLayer")):Ys.w(`track ${e} is not an video track`):this.logPossibleInconsistency(`track ${e} not present, unable to set preffer layer`)}preview(e){return jr(this,null,(function*(){if(this.isRoomJoinCalled)return void this.logPossibleInconsistency("attempting to call preview after join was called");let t=this.store.getState(Os);if(t!==Ir.Preview&&t!==Ir.Connecting)try{this.setState((e=>{e.room.roomState=Ir.Connecting}),"connecting"),yield this.sdkPreviewWithListeners(e)}catch(e){throw Ys.e("Cannot show preview. Failed to connect to room - ",e),e}else this.logPossibleInconsistency("attempting to call preview while room is in preview/connecting")}))}join(e){return jr(this,null,(function*(){if(this.isRoomJoinCalled)this.logPossibleInconsistency("room join is called again");else try{this.isRoomJoinCalled=!0,this.setState((e=>{e.room.roomState=Ir.Connecting}),"join"),yield this.sdkJoinWithListeners(e)}catch(e){throw this.isRoomJoinCalled=!1,Ys.e("Failed to connect to room - ",e),e}}))}leave(){return jr(this,null,(function*(){if(!this.store.getState(Ls))return void this.logPossibleInconsistency("room leave is called when no room is connected");let e=this.store.getState(Os);return this.setState((e=>{e.room.roomState=Ir.Disconnecting}),"leaving"),this.sdk.leave().then((()=>{this.resetState("leave"),Ys.i("left room")})).catch((t=>{Ys.e("error in leaving room - ",t),this.setState((t=>{t.room.roomState=e}),"revertLeave")}))}))}setScreenShareEnabled(e,t){return jr(this,null,(function*(){let n={audioOnly:!1,videoOnly:!1};"object"==typeof t?Object.assign(n,t):"boolean"==typeof t&&(n.audioOnly=t);try{e?yield this.startScreenShare(n):yield this.stopScreenShare()}catch(e){throw this.hmsNotifications.sendError(Zr.convertException(e)),e}}))}addTrack(e,t="regular"){return jr(this,null,(function*(){yield this.sdk.addTrack(e,t),this.syncRoomState("addTrack")}))}removeTrack(e){return jr(this,null,(function*(){yield this.sdk.removeTrack(e),this.syncRoomState("removeTrack")}))}setLocalAudioEnabled(e){return jr(this,null,(function*(){let t=this.store.getState(_s);t&&(yield this.setEnabledTrack(t,e))}))}setLocalVideoEnabled(e){return jr(this,null,(function*(){let t=this.store.getState(ws);t&&(yield this.setEnabledTrack(t,e))}))}setEnabledTrack(e,t){return jr(this,null,(function*(){var n;if((null==(n=this.store.getState().tracks[e])?void 0:n.enabled)===t)return void this.logPossibleInconsistency(`local track[${e}] enabled state - ${t}`);this.setState((n=>{n.tracks[e]?n.tracks[e].displayEnabled=t:this.logPossibleInconsistency("track id not found for setEnabled")}),"displayEnabled");try{yield this.setEnabledSDKTrack(e,t),this.syncRoomState("setEnabled")}catch(n){throw this.setState((n=>{n.tracks[e].displayEnabled=!t}),"rollbackDisplayEnabled"),this.hmsNotifications.sendError(Zr.convertException(n)),n}let i=t?Gt.TRACK_UNMUTED:Gt.TRACK_MUTED;this.hmsNotifications.sendTrackUpdate(i,e)}))}setAudioSettings(e){return jr(this,null,(function*(){let t=this.store.getState(_s);t&&(yield this.setSDKLocalAudioTrackSettings(t,e),this.syncRoomState("setAudioSettings"))}))}setVideoSettings(e){return jr(this,null,(function*(){let t=this.store.getState(ws);t&&(yield this.setSDKLocalVideoTrackSettings(t,e),this.syncRoomState("setVideoSettings"))}))}sendMessage(e){this.sendBroadcastMessage(e)}sendBroadcastMessage(e,t){return jr(this,null,(function*(){let n=yield this.sdk.sendBroadcastMessage(e,t);this.updateMessageInStore(n,{message:e,type:t})}))}sendGroupMessage(e,t,n){return jr(this,null,(function*(){let i=this.store.getState(Ms),r=t.map((e=>i[e])),s=yield this.sdk.sendGroupMessage(e,r,n);this.updateMessageInStore(s,{message:e,recipientRoles:t,type:n})}))}sendDirectMessage(e,t,n){return jr(this,null,(function*(){let i=this.hmsSDKPeers[t],r=yield this.sdk.sendDirectMessage(e,i,n);this.updateMessageInStore(r,{message:e,recipientPeer:i.peerId,type:n})}))}updateMessageInStore(e,t){if(!e)throw Ys.w("sendMessage","Failed to send message",t),Error(`sendMessage Failed - ${JSON.stringify(t)}`);let n=Zr.convertMessage(e);return n.read=!0,n.senderName="You",n.ignored=this.ignoredMessageTypes.includes(n.type),this.putMessageInStore(n),n}setMessageRead(e,t){this.setState((n=>{t?n.messages.byID[t]?n.messages.byID[t].read=e:this.logPossibleInconsistency("no message with id is found"):n.messages.allIDs.forEach((t=>{n.messages.byID[t].read=e}))}),"setMessageRead")}attachVideo(e,t){return jr(this,null,(function*(){if(this.localAndVideoUnmuting(e))return new Promise((n=>{let i=this.store.subscribe((r=>jr(this,null,(function*(){r&&(yield this.attachVideoInternal(e,t),i(),n())}))),Is)}));yield this.attachVideoInternal(e,t)}))}detachVideo(e,t){return jr(this,null,(function*(){let n=this.hmsSDKTracks[e];"video"===(null==n?void 0:n.type)?(n.removeSink(t),this.updateVideoLayer(e,"detachVideo")):(t&&(t.srcObject=null),this.logPossibleInconsistency("no video track found to remove sink"))}))}addPluginToVideoTrack(e,t){return jr(this,null,(function*(){return this.addRemoveVideoPlugin(e,"add",t)}))}addPluginToAudioTrack(e){return jr(this,null,(function*(){return this.addRemoveAudioPlugin(e,"add")}))}validateVideoPluginSupport(e){let t={isSupported:!1};if(!e)return Ys.w("no plugin passed in for checking support"),t.errMsg="no plugin passed in for checking support",t;let n=this.store.getState(ws);if(!n)return Ys.w("video Track not added to local peer yet"),t.errMsg="call this function only after local peer has video track",t;let i=this.hmsSDKTracks[n];return i?t=i.validatePlugin(e):(Ys.w(`track ${n} not present, unable to validate plugin`),t.errMsg=`track ${n} not present, unable to validate plugin`),t}validateAudioPluginSupport(e){let t={isSupported:!1};if(!e)return Ys.w('no plugin passed in for checking support"'),t.errMsg='no plugin passed in for checking support"',t;let n=this.store.getState(_s);if(!n)return Ys.w("audio track not added to local peer yet"),t.errMsg="call this function only after local peer has audio track",t;let i=this.hmsSDKTracks[n];return i?t=i.validatePlugin(e):(Ys.w(`track ${n} not present, unable to validate plugin`),t.errMsg=`track ${n} not present, unable to validate plugin`),t}removePluginFromVideoTrack(e){return jr(this,null,(function*(){return this.addRemoveVideoPlugin(e,"remove")}))}removePluginFromAudioTrack(e){return jr(this,null,(function*(){return this.addRemoveAudioPlugin(e,"remove")}))}changeRole(e,t,n=!1){return jr(this,null,(function*(){let i=this.hmsSDKPeers[e];i?yield this.sdk.changeRole(i,t,n):this.logPossibleInconsistency(`Unknown peer ID given ${e} for changerole`)}))}acceptChangeRole(e){return jr(this,null,(function*(){let t=e.requestedBy?this.hmsSDKPeers[e.requestedBy.id]:void 0;t||Ys.w(`peer for which role change is requested no longer available - ${e.requestedBy}`);let n={requestedBy:t,role:e.role,token:e.token};yield this.sdk.acceptChangeRole(n),this.removeRoleChangeRequest(e)}))}initAppData(e){this.setState((t=>{t.appData=e}),"initAppData")}setAppData(e,t,n){let i="Object"===(null==t?void 0:t.constructor.name);this.setState((r=>{if(r.appData)n&&i?Object.assign(r.appData[e],t):r.appData[e]=t;else{let n={[e]:t};r.appData=n}}),`setAppData-${e}`)}rejectChangeRole(e){this.removeRoleChangeRequest(e)}endRoom(e,t){return jr(this,null,(function*(){let n=this.store.getState(Us);if(!(null==n?void 0:n.endRoom))return void Ys.w("You are not allowed to perform this action - endRoom");let i=this.store.getState(Os);this.setState((e=>{e.room.roomState=Ir.Disconnecting}),"endingRoom");try{yield this.sdk.endRoom(e,t),this.resetState("endRoom")}catch(e){Ys.e("error in ending room - ",e),this.setState((e=>{e.room.roomState=i}),"revertEndRoom")}}))}removePeer(e,t){return jr(this,null,(function*(){let n=this.hmsSDKPeers[e];n&&!n.isLocal?yield this.sdk.removePeer(n,t):this.logPossibleInconsistency(`No remote peer found for peerID - ${e}`)}))}startRTMPOrRecording(e){return jr(this,null,(function*(){yield this.sdk.startRTMPOrRecording(e)}))}stopRTMPAndRecording(){return jr(this,null,(function*(){yield this.sdk.stopRTMPAndRecording()}))}startHLSStreaming(e){return jr(this,null,(function*(){yield this.sdk.startHLSStreaming(e)}))}stopHLSStreaming(e){return jr(this,null,(function*(){yield this.sdk.stopHLSStreaming(e)}))}sendHLSTimedMetadata(e){return jr(this,null,(function*(){yield this.sdk.sendHLSTimedMetadata(e)}))}changeName(e){return jr(this,null,(function*(){yield this.sdk.changeName(e)}))}changeMetadata(e){return jr(this,null,(function*(){"string"!=typeof e&&(e=JSON.stringify(e)),yield this.sdk.changeMetadata(e)}))}setSessionMetadata(e){return jr(this,null,(function*(){yield this.sdk.setSessionMetadata(e),this.setState((t=>{t.sessionMetadata=e}),"setSessionMetadata")}))}populateSessionMetadata(){return jr(this,null,(function*(){let e=yield this.sdk.getSessionMetadata();this.setState((t=>{t.sessionMetadata=e}),"populateSessionMetadata")}))}setRemoteTrackEnabled(e,t){return jr(this,null,(function*(){if("string"==typeof e){let n=this.hmsSDKTracks[e];n&&function(e){return e instanceof Fn||e instanceof Bn}(n)?yield this.sdk.changeTrackState(n,t):this.logPossibleInconsistency(`No remote track with ID ${e} found for change track state`)}else Array.isArray(e)&&e.forEach((e=>this.setRemoteTrackEnabled(e,t)))}))}setRemoteTracksEnabled(e){return jr(this,null,(function*(){let t={enabled:e.enabled,type:e.type,source:e.source};if(e.roles){let n=this.store.getState(Ms);t.roles=e.roles.map((e=>n[e]))}yield this.sdk.changeMultiTrackState(t)}))}setLogLevel(e){Ys.level=e,this.sdk.setLogLevel(e)}setFrameworkInfo(e){this.sdk.setFrameworkInfo(e)}ignoreMessageTypes(e,t=!1){if(t)this.ignoredMessageTypes=e;else for(let t of e)this.ignoredMessageTypes.includes(t)||this.ignoredMessageTypes.push(t)}resetState(e="resetState"){this.isRoomJoinCalled=!1,this.hmsSDKTracks={},Ys.cleanUp(),this.setState((e=>{Object.assign(e,$r())}),e)}sdkJoinWithListeners(e){return jr(this,null,(function*(){yield this.sdk.join(e,{onJoin:this.onJoin.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this),onTrackUpdate:this.onTrackUpdate.bind(this),onMessageReceived:this.onMessageReceived.bind(this),onError:this.onError.bind(this),onReconnected:this.onReconnected.bind(this),onReconnecting:this.onReconnecting.bind(this),onRoleChangeRequest:this.onRoleChangeRequest.bind(this),onRoleUpdate:this.onRoleUpdate.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onChangeTrackStateRequest:this.onChangeTrackStateRequest.bind(this),onChangeMultiTrackStateRequest:this.onChangeMultiTrackStateRequest.bind(this),onRemovedFromRoom:this.onRemovedFromRoom.bind(this),onNetworkQuality:this.onNetworkQuality.bind(this)}),this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)}),this.sdk.addConnectionQualityListener({onConnectionQualityUpdate:this.onConnectionQualityUpdate.bind(this)})}))}onRemovedFromRoom(e){var t;let n=this.store.getState(ao(null==(t=e.requestedBy)?void 0:t.peerId));this.hmsNotifications.sendLeaveRoom(Mr(Lr({},e),{requestedBy:n||void 0}));let i=e.roomEnded||!n?"roomEnded":"removedFromRoom";Ys.i(`resetting state after peer removed ${i}`,e),this.resetState(i)}onDeviceChange(e){let t=e.devices;if(!t)return;let n=this.store.getState(ys);if(this.setState((e=>{Qr(e.devices.audioInput,t.audioInput)||(e.devices.audioInput=t.audioInput),Qr(e.devices.videoInput,t.videoInput)||(e.devices.videoInput=t.videoInput),Qr(e.devices.audioOutput,t.audioOutput)||(e.devices.audioOutput=t.audioOutput),this.hmsSDKPeers[null==n?void 0:n.id]&&Object.assign(e.settings,this.getMediaSettings(this.hmsSDKPeers[null==n?void 0:n.id]))}),"deviceChange"),e.selection){let t=Zr.convertDeviceChangeUpdate(e);this.hmsNotifications.sendDeviceChange(t)}}sdkPreviewWithListeners(e){return jr(this,null,(function*(){yield this.sdk.preview(e,{onPreview:this.onPreview.bind(this),onError:this.onError.bind(this),onReconnected:this.onReconnected.bind(this),onReconnecting:this.onReconnecting.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this),onNetworkQuality:this.onNetworkQuality.bind(this)}),this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)})}))}onNetworkQuality(e){this.setState((t=>{var n;let i=t.room.localPeer||(null==(n=this.sdk.getLocalPeer())?void 0:n.peerId);i&&(t.connectionQualities[i]={peerID:i,downlinkQuality:e})}),"ConnectionQuality")}startScreenShare(e){return jr(this,null,(function*(){this.store.getState(Ps)?this.logPossibleInconsistency("start screenshare is called while it's on"):(yield this.sdk.startScreenShare((()=>this.syncRoomState("screenshareStopped")),e),this.syncRoomState("startScreenShare"))}))}stopScreenShare(){return jr(this,null,(function*(){this.store.getState(Ps)?(yield this.sdk.stopScreenShare(),this.syncRoomState("stopScreenShare")):this.logPossibleInconsistency("stop screenshare is called while it's not on")}))}attachVideoInternal(e,t){return jr(this,null,(function*(){let n=this.hmsSDKTracks[e];n&&"video"===n.type?(n.addSink(t),this.updateVideoLayer(e,"attachVideo")):this.logPossibleInconsistency("no video track found to add sink")}))}syncRoomState(e){e=`${e}_fullSync`,Ys.time(`store-sync-${e}`);let t={},n=[],i={},r={},s={},o=this.sdk.getPeers();for(let e of o){let o=Zr.convertPeer(e);t[o.id]=o,n.push(o.id),this.hmsSDKPeers[o.id]=e;let a=[e.audioTrack,e.videoTrack,...e.auxiliaryTracks];for(let e of a){if(!e)continue;let t=Zr.convertTrack(e);i[t.id]=t,r[e.trackId]=e}o.isLocal&&Object.assign(s,this.getMediaSettings(e))}let a=this.sdk.getRecordingState(),l=this.sdk.getRTMPState(),c=this.sdk.getHLSState();this.setState((e=>{e.room.peers=n;let o=e.peers,u=e.tracks;((e,t)=>{let n=Yr(Object.keys(e),Object.keys(t));for(let i of n){let n=e[i],r=t[i];Hr(n,r)?(Qr(n.auxiliaryTracks,r.auxiliaryTracks)&&(r.auxiliaryTracks=n.auxiliaryTracks),Object.assign(n,r)):Kr(n,r)?delete e[i]:Jr(n,r)&&(e[i]=r)}})(o,t),((e,t)=>{let n=Yr(Object.keys(e),Object.keys(t));for(let i of n){let n=e[i],r=t[i];Hr(n,r)?(Wr(n,r),Object.assign(n,r)):Kr(n,r)?delete e[i]:Jr(n,r)&&(e[i]=r)}})(u,i),Object.assign(e.settings,s),this.hmsSDKTracks=r,Object.assign(e.roles,Zr.convertRoles(this.sdk.getRoles())),Object.assign(e.playlist,Zr.convertPlaylist(this.sdk.getPlaylistManager())),Object.assign(e.room,Zr.convertRecordingStreamingState(a,l,c))}),e),Ys.timeEnd(`store-sync-${e}`)}onPreview(e){this.setState((t=>{Object.assign(t.room,Zr.convertRoom(e)),t.room.roomState=Ir.Preview}),"previewStart"),this.syncRoomState("previewSync")}onJoin(e){let t=this.sdk.getPlaylistManager();this.audioPlaylist=new Eo(t,zr.audio,this.syncPlaylistState.bind(this),this.store),this.videoPlaylist=new Eo(t,zr.video,this.syncRoomState.bind(this),this.store),this.syncRoomState("joinSync"),this.setState((t=>{Object.assign(t.room,Zr.convertRoom(e)),t.room.isConnected=!0,t.room.roomState=Ir.Connected}),"joined"),t.onProgress(this.setProgress),t.onNewTrackStart((e=>{this.syncPlaylistState(`${e.type}PlaylistUpdate`)})),t.onPlaylistEnded((e=>{this.syncPlaylistState(`${e}PlaylistEnded`)})),t.onCurrentTrackEnded((e=>{this.hmsNotifications.sendPlaylistTrackEnded(Zr.convertPlaylistItem(t,e)),this.syncPlaylistState(`${e.type}PlaylistItemEnded`)}))}onRoomUpdate(e,t){this.setState((e=>{Object.assign(e.room,Zr.convertRoom(t))}),e)}onPeerUpdate(e,t){if(![qt.BECAME_DOMINANT_SPEAKER,qt.RESIGNED_DOMINANT_SPEAKER].includes(e)){if(Array.isArray(t)){this.syncRoomState("peersJoined");let e=[];for(let n of t){let t=this.store.getState(ao(n.peerId));t&&e.push(t)}return void this.hmsNotifications.sendPeerList(e)}this.sendPeerUpdateNotification(e,t)}}onTrackUpdate(e,t,n){if(e===Gt.TRACK_REMOVED)this.hmsNotifications.sendTrackUpdate(e,t.trackId),this.handleTrackRemove(t,n);else{let n=Co[e]||"trackUpdate";this.syncRoomState(n),this.hmsNotifications.sendTrackUpdate(e,t.trackId)}}onMessageReceived(e){let t=Zr.convertMessage(e);t.read=!1,t.ignored=this.ignoredMessageTypes.includes(t.type),this.putMessageInStore(t),this.hmsNotifications.sendMessageReceived(t)}putMessageInStore(e){e.ignored||this.setState((t=>{e.id=String(this.store.getState(xs)+1),t.messages.byID[e.id]=e,t.messages.allIDs.push(e.id)}),"newMessage")}onAudioLevelUpdate(e){this.setState((t=>{let n={};e.forEach((e=>{if(!e.track||!e.peer)return;let i=e.track.trackId;n[i]=e.audioLevel,t.speakers[i]||(t.speakers[i]={audioLevel:e.audioLevel,peerID:e.peer.peerId,trackID:i})}));let i=Object.entries(t.speakers);for(let[e,r]of i)r.audioLevel=n[e]||0,0===r.audioLevel&&delete t.speakers[e]}),"audioLevel")}onConnectionQualityUpdate(e){this.setState((t=>{let n=new Set;e.forEach((e=>{let i=e.peerID;!i||(n.add(i),t.connectionQualities[i]?Object.assign(t.connectionQualities[i],e):t.connectionQualities[i]=e)}));let i=Object.keys(t.connectionQualities);for(let e of i)n.has(e)||delete t.connectionQualities[e]}),"connectionQuality")}onChangeTrackStateRequest(e){var t;let n=this.store.getState(ao(null==(t=e.requestedBy)?void 0:t.peerId)),i=this.getStoreLocalTrackIDfromSDKTrack(e.track),r=this.store.getState(lo(i));if(!r)return this.logPossibleInconsistency(`Not found track for which track state change was requested, ${e.track}`);e.enabled||this.syncRoomState("changeTrackStateRequest"),this.hmsNotifications.sendChangeTrackStateRequest({requestedBy:n||void 0,track:r,enabled:e.enabled})}onChangeMultiTrackStateRequest(e){var t;let n=this.store.getState(ao(null==(t=e.requestedBy)?void 0:t.peerId));e.enabled||this.syncRoomState("changeMultiTrackStateRequest");let i=[],r=this.store.getState(ds);for(let t of e.tracks){let e=this.getStoreLocalTrackIDfromSDKTrack(t);e&&r[e]&&i.push(r[e])}this.hmsNotifications.sendChangeMultiTrackStateRequest({requestedBy:n||void 0,tracks:i,enabled:e.enabled,type:e.type,source:e.source})}onReconnected(){this.syncRoomState("reconnectedSync"),this.hmsNotifications.sendReconnected(),this.setState((e=>{e.room.roomState=e.room.isConnected?Ir.Connected:Ir.Preview}),"reconnected")}onReconnecting(e){let t=Zr.convertException(e);Ys.e("Reconnection: received error from sdk",t),this.hmsNotifications.sendReconnecting(t),this.setState((e=>{e.room.roomState=Ir.Reconnecting,e.errors.push(t)}),"reconnecting")}onError(e){let t=Zr.convertException(e);t.isTerminal?(this.leave().then((()=>Ys.e("error from SDK, left room."))),this.setState((e=>{e.room.roomState=Ir.Failed,e.errors.push(t)}),"errorTerminal")):this.store.getState().errors.length<50&&this.setState((e=>{e.errors.push(t)}),"error"),this.syncRoomState("errorSync"),this.hmsNotifications.sendError(t),Ys.e("received error from sdk",t instanceof rn?`${t}`:t)}updateVideoLayer(e,t){let n=this.hmsSDKTracks[e];if(n&&n instanceof Bn){let i=this.store.getState(co(e));((null==i?void 0:i.layer)!==n.getSimulcastLayer()||(null==i?void 0:i.degraded)!==n.degraded)&&this.setState((t=>{let i=t.tracks[e];i.layer=n.getSimulcastLayer(),i.degraded=n.degraded}),t)}}handleTrackRemove(e,t){this.setState((n=>{let i=n.peers[t.peerId],r=n.tracks,s=e.trackId;if(this.isSameStoreSDKTrack(s,null==i?void 0:i.audioTrack))null==i||delete i.audioTrack;else if(this.isSameStoreSDKTrack(s,null==i?void 0:i.videoTrack))null==i||delete i.videoTrack;else{let e=null==i?void 0:i.auxiliaryTracks.indexOf(s);e>-1&&this.isSameStoreSDKTrack(s,null==i?void 0:i.auxiliaryTracks[e])&&(null==i||i.auxiliaryTracks.splice(e,1))}delete r[s],delete this.hmsSDKTracks[s]}),"trackRemoved")}setEnabledSDKTrack(e,t){return jr(this,null,(function*(){let n=this.hmsSDKTracks[e];n?yield n.setEnabled(t):this.logPossibleInconsistency(`track ${e} not present, unable to enabled/disable`)}))}setSDKLocalVideoTrackSettings(e,t){return jr(this,null,(function*(){let n=this.hmsSDKTracks[e];n?yield n.setSettings(t):this.logPossibleInconsistency(`local track ${e} not present, unable to set settings`)}))}setSDKLocalAudioTrackSettings(e,t){return jr(this,null,(function*(){let n=this.hmsSDKTracks[e];n?yield n.setSettings(t):this.logPossibleInconsistency(`local track ${e} not present, unable to set settings`)}))}getMediaSettings(e){var t;let n=this.store.getState(hs),i=e.audioTrack,r=e.videoTrack;return{audioInputDeviceId:(null==i?void 0:i.settings.deviceId)||n.audioInputDeviceId,videoInputDeviceId:(null==r?void 0:r.settings.deviceId)||n.videoInputDeviceId,audioOutputDeviceId:null==(t=this.sdk.getAudioOutput().getDevice())?void 0:t.deviceId}}setTrackVolume(e,t){let n=this.hmsSDKTracks[t];n?n instanceof Un?(n.setVolume(e),this.setState((n=>{let i=n.tracks[t];i&&"audio"===i.type&&(i.volume=e)}),"trackVolume")):Ys.w(`track ${t} is not an audio track`):this.logPossibleInconsistency(`track ${t} not present, unable to set volume`)}localAndVideoUnmuting(e){if(this.store.getState(ys).videoTrack!==e)return!1;let t=this.store.getState(Rs),n=this.store.getState(Is);return t&&!n}logPossibleInconsistency(e){Ys.w("possible inconsistency detected - ",e)}addRemoveVideoPlugin(e,t,n){return jr(this,null,(function*(){if(!e)return void Ys.w("Invalid plugin received in store");let i=this.store.getState(ws);if(i){let r=this.hmsSDKTracks[i];r?("add"===t?yield r.addPlugin(e,n):"remove"===t&&(yield r.removePlugin(e)),this.syncRoomState(`${t}VideoPlugin`)):this.logPossibleInconsistency(`track ${i} not present, unable to remove plugin`)}}))}addRemoveAudioPlugin(e,t){return jr(this,null,(function*(){if(!e)return void Ys.w("Invalid plugin received in store");let n=this.store.getState(_s);if(n){let i=this.hmsSDKTracks[n];i?("add"===t?yield i.addPlugin(e):"remove"===t&&(yield i.removePlugin(e)),this.syncRoomState(`${t}AudioPlugin`)):this.logPossibleInconsistency(`track ${n} not present, unable to remove plugin`)}}))}isSameStoreSDKTrack(e,t){var n;return!!t&&(null==(n=this.hmsSDKTracks[t])?void 0:n.trackId)===e}onRoleChangeRequest(e){this.setState((t=>{0===t.roleChangeRequests.length&&t.roleChangeRequests.push(Zr.convertRoleChangeRequest(e))}),"roleChangeRequest")}removeRoleChangeRequest(e){this.setState((t=>{let n=t.roleChangeRequests.findIndex((t=>t.token===e.token));-1!==n&&t.roleChangeRequests.splice(n,1)}),"removeRoleChangeRequest")}onRoleUpdate(){this.syncRoomState("roleUpdate")}getStoreLocalTrackIDfromSDKTrack(e){return this.store.getState(Ts).find((t=>this.hmsSDKTracks[t].trackId===e.trackId))}}(this.store,this.sdk,this.notifications)),this.actions.setFrameworkInfo({type:"js",sdkVersion:Ur().version}),this.initialTriggerOnSubscribe=!1,Vt&&(window.__hms=this)}triggerOnSubscribe(){this.initialTriggerOnSubscribe||(Vo.makeStoreTriggerOnSubscribe(this.store),this.initialTriggerOnSubscribe=!0)}getStore(){return this.store}getHMSActions(){return this.actions}getActions(){return this.actions}getNotifications(){return{onNotification:this.notifications.onNotification}}static createNewHMSStore(e,t){let n=oe((()=>t())),i=n.setState;n.setState=e=>{let t="function"==typeof e?se(e):e;i(t)};let r=n.getState;n.getState=e=>e?e(r()):r(),Vo.compareWithShallowCheckInSubscribe(n);let s=Vo.setUpDevtools(n,e);return Mr(Lr({},n),{namedSetState:s})}static makeStoreTriggerOnSubscribe(e){let t=e.subscribe;e.subscribe=(n,i,r)=>(n(e.getState(i),void 0),t(n,i,r))}static compareWithShallowCheckInSubscribe(e){let t=e.subscribe;e.subscribe=(e,n,i)=>(n||(n=e=>e),t(e,n,i=i||ae))}static setUpDevtools(e,t){let n;try{n=window.__REDUX_DEVTOOLS_EXTENSION__||window.top.__REDUX_DEVTOOLS_EXTENSION__}catch(e){}if(!n)return t=>{e.setState(t)};let i=n.connect(Vo.devtoolsOptions(t));i.prefix=t?`${t} > `:"";let r=e.setState;return e.setState=t=>{r(t),i.send(`${i.prefix}setState`,e.getState())},i.subscribe(Vo.devtoolsSubscribe(i,e,r)),i.send("setUpStore",e.getState()),(t,n)=>{r(t);let s=n||`${i.prefix}action`;i.send(s,e.getState())}}static devtoolsOptions(e){return{name:e,actionsBlacklist:["audioLevel","playlistProgress","connectionQuality"]}}static devtoolsSubscribe(e,t,n){return i=>{var r,s,o,a;if("DISPATCH"===i.type&&i.state)["JUMP_TO_ACTION","JUMP_TO_STATE"].includes(i.payload.type)?n(JSON.parse(i.state)):t.setState(JSON.parse(i.state));else if("DISPATCH"===i.type&&"COMMIT"===(null==(r=i.payload)?void 0:r.type))e.init(t.getState());else if("DISPATCH"===i.type&&"IMPORT_STATE"===(null==(s=i.payload)?void 0:s.type)){let r=null==(o=i.payload.nextLiftedState)?void 0:o.actionsById;((null==(a=i.payload.nextLiftedState)?void 0:a.computedStates)||[]).forEach((({state:i},s)=>{let o=r[s]||`${e.prefix}setState`;0===s?e.init(i):(n(i),e.send(o,t.getState()))}))}}}})},5783:(e,t,n)=>{"use strict";n.d(t,{dx:()=>f,cw:()=>g,_U:()=>m});var i=n(7294),r=n(725);function s(e){let t;const n=new Set,i=(e,i)=>{const r="function"==typeof e?e(t):e;if(r!==t){const e=t;t=i?r:Object.assign({},t,r),n.forEach((n=>n(t,e)))}},r=()=>t,s={setState:i,getState:r,subscribe:(e,i,s)=>i||s?((e,i=r,s=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let o=i(t);function a(){const n=i(t);if(!s(o,n)){const t=o;e(o=n,t)}}return n.add(a),()=>n.delete(a)})(e,i,s):(n.add(e),()=>n.delete(e)),destroy:()=>n.clear()};return t=e(i,r,s),s}const o="undefined"==typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?i.useEffect:i.useLayoutEffect;function a(e){const t="function"==typeof e?s(e):e,n=(e=t.getState,n=Object.is)=>{const[,r]=(0,i.useReducer)((e=>e+1),0),s=t.getState(),a=(0,i.useRef)(s),l=(0,i.useRef)(e),c=(0,i.useRef)(n),u=(0,i.useRef)(!1),d=(0,i.useRef)();let h;void 0===d.current&&(d.current=e(s));let p=!1;(a.current!==s||l.current!==e||c.current!==n||u.current)&&(h=e(s),p=!n(d.current,h)),o((()=>{p&&(d.current=h),a.current=s,l.current=e,c.current=n,u.current=!1}));const f=(0,i.useRef)(s);o((()=>{const e=()=>{try{const e=t.getState(),n=l.current(e);c.current(d.current,n)||(a.current=e,d.current=n,r())}catch(e){u.current=!0,r()}},n=t.subscribe(e);return t.getState()!==f.current&&e(),n}),[]);const m=p?h:d.current;return(0,i.useDebugValue)(m),m};return Object.assign(n,t),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const e=[n,t];return{next(){const t=e.length<=0;return{value:e.shift(),done:t}}}},n}function l(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(let i=0;i<n.length;i++)if(!Object.prototype.hasOwnProperty.call(t,n[i])||!Object.is(e[n[i]],t[n[i]]))return!1;return!0}var c=n(3273);const u="It seems like you forgot to add your component within a top level HMSRoomProvider, please refer to 100ms react docs(https://docs.100ms.live/javascript/v2/features/integration#react-hooks) to check on the required steps for using this hook.";const d="undefined"!=typeof window,h=(0,i.createContext)(null);let p;const f=({children:e,actions:t,store:s,notifications:o,stats:l,isHMSStatsOn:c=!1,leaveOnUnload:u=!0})=>{if(!p){const e=()=>{throw new Error("modifying store is not allowed")};if(t&&s)p={actions:t,store:a(Object.assign(Object.assign({},s),{setState:e,destroy:e}))},o&&(p.notifications=o),l&&(p.statsStore=a({getState:l.getState,subscribe:l.subscribe,setState:e,destroy:e}));else{const t=new r.pE;if(p={actions:t.getActions(),store:a(Object.assign(Object.assign({},t.getStore()),{setState:e,destroy:e})),notifications:t.getNotifications()},c){const n=t.getStats();p.statsStore=a({getState:n.getState,subscribe:n.subscribe,setState:e,destroy:e})}}p.actions.setFrameworkInfo({type:"react-web",version:i.version,sdkVersion:n(7437).i8})}return(0,i.useEffect)((()=>{d&&u&&(window.addEventListener("beforeunload",(()=>p.actions.leave())),window.addEventListener("onunload",(()=>p.actions.leave())))}),[u]),i.createElement(h.Provider,{value:p},e)},m=function(e){return(t,n=l)=>{t||c.Z.w("fetching full store without passing any selector may have a heavy performance impact on your website.");const r=(0,i.useContext)(e);if(!r)throw new Error(u);return(0,r.store)(t,n)}}(h),g=(function(e){}(h),()=>{const e=(0,i.useContext)(h);if(!e)throw new Error(u);return e.actions})},3273:(e,t,n)=>{"use strict";var i,r;n.d(t,{Z:()=>s}),(r=i||(i={}))[r.VERBOSE=0]="VERBOSE",r[r.DEBUG=1]="DEBUG",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.NONE=5]="NONE";class s{static v(e,...t){this.log(i.VERBOSE,e,...t)}static d(e,...t){this.log(i.DEBUG,e,...t)}static i(e,...t){this.log(i.INFO,e,...t)}static w(e,...t){this.log(i.WARN,e,...t)}static e(e,...t){this.log(i.ERROR,e,...t)}static log(e,t,...n){if(!(this.level.valueOf()>e.valueOf()))switch(e){case i.VERBOSE:console.log("HMSui-components: ",t,...n);break;case i.DEBUG:console.debug("HMSui-components: ",t,...n);break;case i.INFO:console.info("HMSui-components: ",t,...n);break;case i.WARN:console.warn("HMSui-components: ",t,...n);break;case i.ERROR:console.error("HMSui-components: ",t,...n)}}}s.level=i.VERBOSE},4444:(e,t,n)=>{"use strict";n.d(t,{BH:()=>_,DV:()=>V,GJ:()=>U,L:()=>u,LL:()=>x,P0:()=>v,Pz:()=>b,Sg:()=>w,UG:()=>E,UI:()=>z,US:()=>a,Wl:()=>L,Yr:()=>R,ZR:()=>N,aH:()=>y,b$:()=>C,cI:()=>O,dS:()=>X,eu:()=>A,g5:()=>s,gK:()=>Z,gQ:()=>K,h$:()=>c,hl:()=>P,hu:()=>r,m9:()=>te,ne:()=>J,p$:()=>h,pd:()=>H,q4:()=>g,r3:()=>F,ru:()=>k,tV:()=>d,uI:()=>T,ug:()=>ee,vZ:()=>$,w1:()=>I,w9:()=>j,xO:()=>G,xb:()=>B,z$:()=>S,zd:()=>W});const i={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},r=function(e,t){if(!e)throw s(t)},s=function(e){return new Error("Firebase Database ("+i.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},o=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&i+1<e.length&&56320==(64512&e.charCodeAt(i+1))?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++i)),t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128)}return t},a={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){const r=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,l=a?e[t+2]:0,c=r>>2,u=(3&r)<<4|o>>4;let d=(15&o)<<2|l>>6,h=63&l;a||(h=64,s||(d=64)),i.push(n[c],n[u],n[d],n[h])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(o(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,i=0;for(;n<e.length;){const r=e[n++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){const s=e[n++];t[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){const s=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(s>>10)),t[i++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){const r=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0;++t;const o=t<e.length?n[e.charAt(t)]:64;++t;const a=t<e.length?n[e.charAt(t)]:64;if(++t,null==r||null==s||null==o||null==a)throw new l;const c=r<<2|s>>4;if(i.push(c),64!==o){const e=s<<4&240|o>>2;if(i.push(e),64!==a){const e=o<<6&192|a;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class l extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const c=function(e){const t=o(e);return a.encodeByteArray(t,!0)},u=function(e){return c(e).replace(/\./g,"")},d=function(e){try{return a.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function h(e){return p(void 0,e)}function p(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=p(e[n],t[n]));return e}const f=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,m=()=>{try{return f()||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&d(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},g=e=>{var t,n;return null===(n=null===(t=m())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},v=e=>{const t=g(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]},y=()=>{var e;return null===(e=m())||void 0===e?void 0:e.config},b=e=>{var t;return null===(t=m())||void 0===t?void 0:t[`_${e}`]};class _{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function w(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",i=e.iat||0,r=e.sub||e.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},e);return[u(JSON.stringify({alg:"none",type:"JWT"})),u(JSON.stringify(s)),""].join(".")}function S(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function T(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(S())}function E(){var e;const t=null===(e=m())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}function k(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function C(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function I(){const e=S();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function R(){return!0===i.NODE_CLIENT||!0===i.NODE_ADMIN}function P(){try{return"object"==typeof indexedDB}catch(e){return!1}}function A(){return new Promise(((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var e;t((null===(e=r.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}class N extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,N.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,x.prototype.create)}}class x{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,r=this.errors[e],s=r?function(e,t){return e.replace(D,((e,n)=>{const i=t[n];return null!=i?String(i):`<${n}?>`}))}(r,n):"Error",o=`${this.serviceName}: ${s} (${i}).`;return new N(i,o,n)}}const D=/\{\$([^}]+)}/g;function O(e){return JSON.parse(e)}function L(e){return JSON.stringify(e)}const M=function(e){let t={},n={},i={},r="";try{const s=e.split(".");t=O(d(s[0])||""),n=O(d(s[1])||""),r=s[2],i=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:i,signature:r}},j=function(e){const t=M(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},U=function(e){const t=M(e).claims;return"object"==typeof t&&!0===t.admin};function F(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function V(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function B(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function z(e,t,n){const i={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=t.call(n,e[r],r,e));return i}function $(e,t){if(e===t)return!0;const n=Object.keys(e),i=Object.keys(t);for(const r of n){if(!i.includes(r))return!1;const n=e[r],s=t[r];if(q(n)&&q(s)){if(!$(n,s))return!1}else if(n!==s)return!1}for(const e of i)if(!n.includes(e))return!1;return!0}function q(e){return null!==e&&"object"==typeof e}function G(e){const t=[];for(const[n,i]of Object.entries(e))Array.isArray(i)?i.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function W(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}})),t}function H(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class K{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"==typeof e)for(let i=0;i<16;i++)n[i]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let i=0;i<16;i++)n[i]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){const t=n[e-3]^n[e-8]^n[e-14]^n[e-16];n[e]=4294967295&(t<<1|t>>>31)}let i,r,s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],l=this.chain_[3],c=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(i=l^o&(a^l),r=1518500249):(i=o^a^l,r=1859775393):e<60?(i=o&a|l&(o|a),r=2400959708):(i=o^a^l,r=3395469782);const t=(s<<5|s>>>27)+i+c+r+n[e]&4294967295;c=l,l=a,a=4294967295&(o<<30|o>>>2),o=s,s=t}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let i=0;const r=this.buf_;let s=this.inbuf_;for(;i<t;){if(0===s)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if("string"==typeof e){for(;i<t;)if(r[s]=e.charCodeAt(i),++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}else for(;i<t;)if(r[s]=e[i],++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let i=24;i>=0;i-=8)e[n]=this.chain_[t]>>i&255,++n;return e}}function J(e,t){const n=new Q(e,t);return n.subscribe.bind(n)}class Q{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");i=function(e,t){if("object"!=typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===i.next&&(i.next=Y),void 0===i.error&&(i.error=Y),void 0===i.complete&&(i.complete=Y);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}})),this.observers.push(i),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function Y(){}function Z(e,t){return`${e} failed: ${t} argument `}const X=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);if(s>=55296&&s<=56319){const t=s-55296;i++,r(i<e.length,"Surrogate pair missing trail surrogate.");s=65536+(t<<10)+(e.charCodeAt(i)-56320)}s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):s<65536?(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t},ee=function(e){let t=0;for(let n=0;n<e.length;n++){const i=e.charCodeAt(n);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,n++):t+=3}return t};function te(e){return e&&e._delegate?e._delegate:e}},2599:(e,t,n)=>{"use strict";function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},i.apply(this,arguments)}var r;n.d(t,{Ep:()=>c,J0:()=>o,PP:()=>s,RQ:()=>A,WK:()=>L,X3:()=>O,Zn:()=>C,Zq:()=>R,aU:()=>r,cP:()=>u,fp:()=>h,pC:()=>P}),function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(r||(r={}));function s(e){void 0===e&&(e={});let t,{initialEntries:n=["/"],initialIndex:i,v5Compat:s=!1}=e;t=n.map(((e,t)=>m(e,"string"==typeof e?null:e.state,0===t?"default":void 0)));let o=p(null==i?t.length-1:i),d=r.Pop,h=null;function p(e){return Math.min(Math.max(e,0),t.length-1)}function f(){return t[o]}function m(e,n,i){void 0===n&&(n=null);let r=l(t?f().pathname:"/",e,n,i);return a("/"===r.pathname.charAt(0),"relative pathnames are not supported in memory history: "+JSON.stringify(e)),r}function g(e){return"string"==typeof e?e:c(e)}return{get index(){return o},get action(){return d},get location(){return f()},createHref:g,createURL:e=>new URL(g(e),"http://localhost"),encodeLocation(e){let t="string"==typeof e?u(e):e;return{pathname:t.pathname||"",search:t.search||"",hash:t.hash||""}},push(e,n){d=r.Push;let i=m(e,n);o+=1,t.splice(o,t.length,i),s&&h&&h({action:d,location:i,delta:1})},replace(e,n){d=r.Replace;let i=m(e,n);t[o]=i,s&&h&&h({action:d,location:i,delta:0})},go(e){d=r.Pop;let n=p(o+e),i=t[n];o=n,h&&h({action:d,location:i,delta:e})},listen:e=>(h=e,()=>{h=null})}}function o(e,t){if(!1===e||null==e)throw new Error(t)}function a(e,t){if(!e){"undefined"!=typeof console&&console.warn(t);try{throw new Error(t)}catch(e){}}}function l(e,t,n,r){return void 0===n&&(n=null),i({pathname:"string"==typeof e?e:e.pathname,search:"",hash:""},"string"==typeof t?u(t):t,{state:n,key:t&&t.key||r||Math.random().toString(36).substr(2,8)})}function c(e){let{pathname:t="/",search:n="",hash:i=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),i&&"#"!==i&&(t+="#"===i.charAt(0)?i:"#"+i),t}function u(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let i=e.indexOf("?");i>=0&&(t.search=e.substr(i),e=e.substr(0,i)),e&&(t.pathname=e)}return t}var d;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(d||(d={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function h(e,t,n){void 0===n&&(n="/");let i=C(("string"==typeof t?u(t):t).pathname||"/",n);if(null==i)return null;let r=p(e);!function(e){e.sort(((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every(((e,n)=>e===t[n]));return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((e=>e.childrenIndex)),t.routesMeta.map((e=>e.childrenIndex)))))}(r);let s=null;for(let e=0;null==s&&e<r.length;++e)s=T(r[e],k(i));return s}function p(e,t,n,i){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===i&&(i="");let r=(e,r,s)=>{let a={relativePath:void 0===s?e.path||"":s,caseSensitive:!0===e.caseSensitive,childrenIndex:r,route:e};a.relativePath.startsWith("/")&&(o(a.relativePath.startsWith(i),'Absolute route path "'+a.relativePath+'" nested under path "'+i+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),a.relativePath=a.relativePath.slice(i.length));let l=A([i,a.relativePath]),c=n.concat(a);e.children&&e.children.length>0&&(o(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+l+'".'),p(e.children,t,c,l)),(null!=e.path||e.index)&&t.push({path:l,score:S(l,e.index),routesMeta:c})};return e.forEach(((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let n of f(e.path))r(e,t,n);else r(e,t)})),t}function f(e){let t=e.split("/");if(0===t.length)return[];let[n,...i]=t,r=n.endsWith("?"),s=n.replace(/\?$/,"");if(0===i.length)return r?[s,""]:[s];let o=f(i.join("/")),a=[];return a.push(...o.map((e=>""===e?s:[s,e].join("/")))),r&&a.push(...o),a.map((t=>e.startsWith("/")&&""===t?"/":t))}const m=/^:\w+$/,g=3,v=2,y=1,b=10,_=-2,w=e=>"*"===e;function S(e,t){let n=e.split("/"),i=n.length;return n.some(w)&&(i+=_),t&&(i+=v),n.filter((e=>!w(e))).reduce(((e,t)=>e+(m.test(t)?g:""===t?y:b)),i)}function T(e,t){let{routesMeta:n}=e,i={},r="/",s=[];for(let e=0;e<n.length;++e){let o=n[e],a=e===n.length-1,l="/"===r?t:t.slice(r.length)||"/",c=E({path:o.relativePath,caseSensitive:o.caseSensitive,end:a},l);if(!c)return null;Object.assign(i,c.params);let u=o.route;s.push({params:i,pathname:A([r,c.pathname]),pathnameBase:N(A([r,c.pathnameBase])),route:u}),"/"!==c.pathnameBase&&(r=A([r,c.pathnameBase]))}return s}function E(e,t){"string"==typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,i]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);a("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let i=[],r="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/\/:(\w+)/g,((e,t)=>(i.push(t),"/([^\\/]+)")));e.endsWith("*")?(i.push("*"),r+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":""!==e&&"/"!==e&&(r+="(?:(?=\\/|$))");let s=new RegExp(r,t?void 0:"i");return[s,i]}(e.path,e.caseSensitive,e.end),r=t.match(n);if(!r)return null;let s=r[0],o=s.replace(/(.)\/+$/,"$1"),l=r.slice(1);return{params:i.reduce(((e,t,n)=>{if("*"===t){let e=l[n]||"";o=s.slice(0,s.length-e.length).replace(/(.)\/+$/,"$1")}return e[t]=function(e,t){try{return decodeURIComponent(e)}catch(n){return a(!1,'The value for the URL param "'+t+'" will not be decoded because the string "'+e+'" is a malformed URL segment. This is probably due to a bad percent encoding ('+n+")."),e}}(l[n]||"",t),e}),{}),pathname:s,pathnameBase:o,pattern:e}}function k(e){try{return decodeURI(e)}catch(t){return a(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function C(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,i=e.charAt(n);return i&&"/"!==i?null:e.slice(n)||"/"}function I(e,t,n,i){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(i)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function R(e){return e.filter(((e,t)=>0===t||e.route.path&&e.route.path.length>0))}function P(e,t,n,r){let s;void 0===r&&(r=!1),"string"==typeof e?s=u(e):(s=i({},e),o(!s.pathname||!s.pathname.includes("?"),I("?","pathname","search",s)),o(!s.pathname||!s.pathname.includes("#"),I("#","pathname","hash",s)),o(!s.search||!s.search.includes("#"),I("#","search","hash",s)));let a,l=""===e||""===s.pathname,c=l?"/":s.pathname;if(r||null==c)a=n;else{let e=t.length-1;if(c.startsWith("..")){let t=c.split("/");for(;".."===t[0];)t.shift(),e-=1;s.pathname=t.join("/")}a=e>=0?t[e]:"/"}let d=function(e,t){void 0===t&&(t="/");let{pathname:n,search:i="",hash:r=""}="string"==typeof e?u(e):e,s=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)})),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:s,search:x(i),hash:D(r)}}(s,a),h=c&&"/"!==c&&c.endsWith("/"),p=(l||"."===c)&&n.endsWith("/");return d.pathname.endsWith("/")||!h&&!p||(d.pathname+="/"),d}const A=e=>e.join("/").replace(/\/\/+/g,"/"),N=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),x=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",D=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";class O extends Error{}function L(e){return null!=e&&"number"==typeof e.status&&"string"==typeof e.statusText&&"boolean"==typeof e.internal&&"data"in e}const M=["post","put","patch","delete"],j=(new Set(M),["get",...M]);new Set(j),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred")},749:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});n(7294);const i=n.p+"044332d92dfd3c518390a7410ca4bed1.svg"},6782:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});n(7294);const i=n.p+"7e22f396bf3bd9b199d43a8deaa4d483.svg"},6387:(e,t,n)=>{var i;!function(r){var s=Object.hasOwnProperty,o=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},a="object"==typeof process&&"function"==typeof process.nextTick,l="function"==typeof Symbol,c="object"==typeof Reflect,u="function"==typeof setImmediate?setImmediate:setTimeout,d=l?c&&"function"==typeof Reflect.ownKeys?Reflect.ownKeys:function(e){var t=Object.getOwnPropertyNames(e);return t.push.apply(t,Object.getOwnPropertySymbols(e)),t}:Object.keys;function h(){this._events={},this._conf&&p.call(this,this._conf)}function p(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners!==r&&(this._maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this._newListener=e.newListener),e.removeListener&&(this._removeListener=e.removeListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),e.ignoreErrors&&(this.ignoreErrors=e.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function f(e,t){var n="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(n+=" Event name: "+t+"."),"undefined"!=typeof process&&process.emitWarning){var i=new Error(n);i.name="MaxListenersExceededWarning",i.emitter=this,i.count=e,process.emitWarning(i)}else console.error(n),console.trace&&console.trace()}var m=function(e,t,n){var i=arguments.length;switch(i){case 0:return[];case 1:return[e];case 2:return[e,t];case 3:return[e,t,n];default:for(var r=new Array(i);i--;)r[i]=arguments[i];return r}};function g(e,t){for(var n={},i=e.length,s=t?t.length:0,o=0;o<i;o++)n[e[o]]=o<s?t[o]:r;return n}function v(e,t,n){var i,r;if(this._emitter=e,this._target=t,this._listeners={},this._listenersCount=0,(n.on||n.off)&&(i=n.on,r=n.off),t.addEventListener?(i=t.addEventListener,r=t.removeEventListener):t.addListener?(i=t.addListener,r=t.removeListener):t.on&&(i=t.on,r=t.off),!i&&!r)throw Error("target does not implement any known event API");if("function"!=typeof i)throw TypeError("on method must be a function");if("function"!=typeof r)throw TypeError("off method must be a function");this._on=i,this._off=r;var s=e._observers;s?s.push(this):e._observers=[this]}function y(e,t,n,i){var o=Object.assign({},t);if(!e)return o;if("object"!=typeof e)throw TypeError("options must be an object");var a,l,c,u=Object.keys(e),d=u.length;function h(e){throw Error('Invalid "'+a+'" option value'+(e?". Reason: "+e:""))}for(var p=0;p<d;p++){if(a=u[p],!i&&!s.call(t,a))throw Error('Unknown "'+a+'" option');(l=e[a])!==r&&(c=n[a],o[a]=c?c(l,h):l)}return o}function b(e,t){return"function"==typeof e&&e.hasOwnProperty("prototype")||t("value must be a constructor"),e}function _(e){var t="value must be type of "+e.join("|"),n=e.length,i=e[0],r=e[1];return 1===n?function(e,n){if(typeof e===i)return e;n(t)}:2===n?function(e,n){var s=typeof e;if(s===i||s===r)return e;n(t)}:function(i,r){for(var s=typeof i,o=n;o-- >0;)if(s===e[o])return i;r(t)}}Object.assign(v.prototype,{subscribe:function(e,t,n){var i=this,r=this._target,s=this._emitter,o=this._listeners,a=function(){var i=m.apply(null,arguments),o={data:i,name:t,original:e};n?!1!==n.call(r,o)&&s.emit.apply(s,[o.name].concat(i)):s.emit.apply(s,[t].concat(i))};if(o[e])throw Error("Event '"+e+"' is already listening");this._listenersCount++,s._newListener&&s._removeListener&&!i._onNewListener?(this._onNewListener=function(n){n===t&&null===o[e]&&(o[e]=a,i._on.call(r,e,a))},s.on("newListener",this._onNewListener),this._onRemoveListener=function(n){n===t&&!s.hasListeners(n)&&o[e]&&(o[e]=null,i._off.call(r,e,a))},o[e]=null,s.on("removeListener",this._onRemoveListener)):(o[e]=a,i._on.call(r,e,a))},unsubscribe:function(e){var t,n,i,r=this,s=this._listeners,o=this._emitter,a=this._off,l=this._target;if(e&&"string"!=typeof e)throw TypeError("event must be a string");function c(){r._onNewListener&&(o.off("newListener",r._onNewListener),o.off("removeListener",r._onRemoveListener),r._onNewListener=null,r._onRemoveListener=null);var e=E.call(o,r);o._observers.splice(e,1)}if(e){if(!(t=s[e]))return;a.call(l,e,t),delete s[e],--this._listenersCount||c()}else{for(i=(n=d(s)).length;i-- >0;)e=n[i],a.call(l,e,s[e]);this._listeners={},this._listenersCount=0,c()}}});var w=_(["function"]),S=_(["object","function"]);function T(e,t,n){var i,r,s,o=0,a=new e((function(l,c,u){function d(){r&&(r=null),o&&(clearTimeout(o),o=0)}n=y(n,{timeout:0,overload:!1},{timeout:function(e,t){return("number"!=typeof(e*=1)||e<0||!Number.isFinite(e))&&t("timeout must be a positive number"),e}}),i=!n.overload&&"function"==typeof e.prototype.cancel&&"function"==typeof u;var h=function(e){d(),l(e)},p=function(e){d(),c(e)};i?t(h,p,u):(r=[function(e){p(e||Error("canceled"))}],t(h,p,(function(e){if(s)throw Error("Unable to subscribe on cancel event asynchronously");if("function"!=typeof e)throw TypeError("onCancel callback must be a function");r.push(e)})),s=!0),n.timeout>0&&(o=setTimeout((function(){var e=Error("timeout");e.code="ETIMEDOUT",o=0,a.cancel(e),c(e)}),n.timeout))}));return i||(a.cancel=function(e){if(r){for(var t=r.length,n=1;n<t;n++)r[n](e);r[0](e),r=null}}),a}function E(e){var t=this._observers;if(!t)return-1;for(var n=t.length,i=0;i<n;i++)if(t[i]._target===e)return i;return-1}function k(e,t,n,i,r){if(!n)return null;if(0===i){var s=typeof t;if("string"===s){var o,a,l=0,c=0,u=this.delimiter,h=u.length;if(-1!==(a=t.indexOf(u))){o=new Array(5);do{o[l++]=t.slice(c,a),c=a+h}while(-1!==(a=t.indexOf(u,c)));o[l++]=t.slice(c),t=o,r=l}else t=[t],r=1}else"object"===s?r=t.length:(t=[t],r=1)}var p,f,m,g,v,y,b,_=null,w=t[i],S=t[i+1];if(i===r)n._listeners&&("function"==typeof n._listeners?(e&&e.push(n._listeners),_=[n]):(e&&e.push.apply(e,n._listeners),_=[n]));else{if("*"===w){for(a=(y=d(n)).length;a-- >0;)"_listeners"!==(p=y[a])&&(b=k(e,t,n[p],i+1,r))&&(_?_.push.apply(_,b):_=b);return _}if("**"===w){for((v=i+1===r||i+2===r&&"*"===S)&&n._listeners&&(_=k(e,t,n,r,r)),a=(y=d(n)).length;a-- >0;)"_listeners"!==(p=y[a])&&("*"===p||"**"===p?(n[p]._listeners&&!v&&(b=k(e,t,n[p],r,r))&&(_?_.push.apply(_,b):_=b),b=k(e,t,n[p],i,r)):b=k(e,t,n[p],p===S?i+2:i,r),b&&(_?_.push.apply(_,b):_=b));return _}n[w]&&(_=k(e,t,n[w],i+1,r))}if((f=n["*"])&&k(e,t,f,i+1,r),m=n["**"])if(i<r)for(m._listeners&&k(e,t,m,r,r),a=(y=d(m)).length;a-- >0;)"_listeners"!==(p=y[a])&&(p===S?k(e,t,m[p],i+2,r):p===w?k(e,t,m[p],i+1,r):((g={})[p]=m[p],k(e,t,{"**":g},i+1,r)));else m._listeners?k(e,t,m,r,r):m["*"]&&m["*"]._listeners&&k(e,t,m["*"],r,r);return _}function C(e,t,n){var i,r,s=0,o=0,a=this.delimiter,l=a.length;if("string"==typeof e)if(-1!==(i=e.indexOf(a))){r=new Array(5);do{r[s++]=e.slice(o,i),o=i+l}while(-1!==(i=e.indexOf(a,o)));r[s++]=e.slice(o)}else r=[e],s=1;else r=e,s=e.length;if(s>1)for(i=0;i+1<s;i++)if("**"===r[i]&&"**"===r[i+1])return;var c,u=this.listenerTree;for(i=0;i<s;i++)if(u=u[c=r[i]]||(u[c]={}),i===s-1)return u._listeners?("function"==typeof u._listeners&&(u._listeners=[u._listeners]),n?u._listeners.unshift(t):u._listeners.push(t),!u._listeners.warned&&this._maxListeners>0&&u._listeners.length>this._maxListeners&&(u._listeners.warned=!0,f.call(this,u._listeners.length,c))):u._listeners=t,!0;return!0}function I(e,t,n,i){for(var r,s,o,a,l=d(e),c=l.length,u=e._listeners;c-- >0;)r=e[s=l[c]],o="_listeners"===s?n:n?n.concat(s):[s],a=i||"symbol"==typeof s,u&&t.push(a?o:o.join(this.delimiter)),"object"==typeof r&&I.call(this,r,t,o,a);return t}function R(e){for(var t,n,i,r=d(e),s=r.length;s-- >0;)(t=e[n=r[s]])&&(i=!0,"_listeners"===n||R(t)||delete e[n]);return i}function P(e,t,n){this.emitter=e,this.event=t,this.listener=n}function A(e,t,n){if(!0===n)s=!0;else if(!1===n)i=!0;else{if(!n||"object"!=typeof n)throw TypeError("options should be an object or true");var i=n.async,s=n.promisify,o=n.nextTick,l=n.objectify}if(i||o||s){var c=t,d=t._origin||t;if(o&&!a)throw Error("process.nextTick is not supported");s===r&&(s="AsyncFunction"===t.constructor.name),t=function(){var e=arguments,t=this,n=this.event;return s?o?Promise.resolve():new Promise((function(e){u(e)})).then((function(){return t.event=n,c.apply(t,e)})):(o?process.nextTick:u)((function(){t.event=n,c.apply(t,e)}))},t._async=!0,t._origin=d}return[t,l?new P(this,e,t):this]}function N(e){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,p.call(this,e)}P.prototype.off=function(){return this.emitter.off(this.event,this.listener),this},N.EventEmitter2=N,N.prototype.listenTo=function(e,t,n){if("object"!=typeof e)throw TypeError("target musts be an object");var i=this;function s(t){if("object"!=typeof t)throw TypeError("events must be an object");var r,s=n.reducers,o=E.call(i,e);r=-1===o?new v(i,e,n):i._observers[o];for(var a,l=d(t),c=l.length,u="function"==typeof s,h=0;h<c;h++)a=l[h],r.subscribe(a,t[a]||a,u?s:s&&s[a])}return n=y(n,{on:r,off:r,reducers:r},{on:w,off:w,reducers:S}),o(t)?s(g(t)):s("string"==typeof t?g(t.split(/\s+/)):t),this},N.prototype.stopListeningTo=function(e,t){var n=this._observers;if(!n)return!1;var i,r=n.length,s=!1;if(e&&"object"!=typeof e)throw TypeError("target should be an object");for(;r-- >0;)i=n[r],e&&i._target!==e||(i.unsubscribe(t),s=!0);return s},N.prototype.delimiter=".",N.prototype.setMaxListeners=function(e){e!==r&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},N.prototype.getMaxListeners=function(){return this._maxListeners},N.prototype.event="",N.prototype.once=function(e,t,n){return this._once(e,t,!1,n)},N.prototype.prependOnceListener=function(e,t,n){return this._once(e,t,!0,n)},N.prototype._once=function(e,t,n,i){return this._many(e,1,t,n,i)},N.prototype.many=function(e,t,n,i){return this._many(e,t,n,!1,i)},N.prototype.prependMany=function(e,t,n,i){return this._many(e,t,n,!0,i)},N.prototype._many=function(e,t,n,i,r){var s=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");function o(){return 0==--t&&s.off(e,o),n.apply(this,arguments)}return o._origin=n,this._on(e,o,i,r)},N.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||h.call(this);var e,t,n,i,r,s,o=arguments[0],a=this.wildcard;if("newListener"===o&&!this._newListener&&!this._events.newListener)return!1;if(a&&(e=o,"newListener"!==o&&"removeListener"!==o&&"object"==typeof o)){if(n=o.length,l)for(i=0;i<n;i++)if("symbol"==typeof o[i]){s=!0;break}s||(o=o.join(this.delimiter))}var c,u=arguments.length;if(this._all&&this._all.length)for(i=0,n=(c=this._all.slice()).length;i<n;i++)switch(this.event=o,u){case 1:c[i].call(this,o);break;case 2:c[i].call(this,o,arguments[1]);break;case 3:c[i].call(this,o,arguments[1],arguments[2]);break;default:c[i].apply(this,arguments)}if(a)c=[],k.call(this,c,e,this.listenerTree,0,n);else{if("function"==typeof(c=this._events[o])){switch(this.event=o,u){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(u-1),r=1;r<u;r++)t[r-1]=arguments[r];c.apply(this,t)}return!0}c&&(c=c.slice())}if(c&&c.length){if(u>3)for(t=new Array(u-1),r=1;r<u;r++)t[r-1]=arguments[r];for(i=0,n=c.length;i<n;i++)switch(this.event=o,u){case 1:c[i].call(this);break;case 2:c[i].call(this,arguments[1]);break;case 3:c[i].call(this,arguments[1],arguments[2]);break;default:c[i].apply(this,t)}return!0}if(!this.ignoreErrors&&!this._all&&"error"===o)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},N.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||h.call(this);var e,t,n,i,r,s,o=arguments[0],a=this.wildcard;if("newListener"===o&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(a&&(e=o,"newListener"!==o&&"removeListener"!==o&&"object"==typeof o)){if(i=o.length,l)for(r=0;r<i;r++)if("symbol"==typeof o[r]){t=!0;break}t||(o=o.join(this.delimiter))}var c,u=[],d=arguments.length;if(this._all)for(r=0,i=this._all.length;r<i;r++)switch(this.event=o,d){case 1:u.push(this._all[r].call(this,o));break;case 2:u.push(this._all[r].call(this,o,arguments[1]));break;case 3:u.push(this._all[r].call(this,o,arguments[1],arguments[2]));break;default:u.push(this._all[r].apply(this,arguments))}if(a?(c=[],k.call(this,c,e,this.listenerTree,0)):c=this._events[o],"function"==typeof c)switch(this.event=o,d){case 1:u.push(c.call(this));break;case 2:u.push(c.call(this,arguments[1]));break;case 3:u.push(c.call(this,arguments[1],arguments[2]));break;default:for(n=new Array(d-1),s=1;s<d;s++)n[s-1]=arguments[s];u.push(c.apply(this,n))}else if(c&&c.length){if(c=c.slice(),d>3)for(n=new Array(d-1),s=1;s<d;s++)n[s-1]=arguments[s];for(r=0,i=c.length;r<i;r++)switch(this.event=o,d){case 1:u.push(c[r].call(this));break;case 2:u.push(c[r].call(this,arguments[1]));break;case 3:u.push(c[r].call(this,arguments[1],arguments[2]));break;default:u.push(c[r].apply(this,n))}}else if(!this.ignoreErrors&&!this._all&&"error"===o)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(u)},N.prototype.on=function(e,t,n){return this._on(e,t,!1,n)},N.prototype.prependListener=function(e,t,n){return this._on(e,t,!0,n)},N.prototype.onAny=function(e){return this._onAny(e,!1)},N.prototype.prependAny=function(e){return this._onAny(e,!0)},N.prototype.addListener=N.prototype.on,N.prototype._onAny=function(e,t){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},N.prototype._on=function(e,t,n,i){if("function"==typeof e)return this._onAny(e,t),this;if("function"!=typeof t)throw new Error("on only accepts instances of Function");this._events||h.call(this);var s,o=this;return i!==r&&(t=(s=A.call(this,e,t,i))[0],o=s[1]),this._newListener&&this.emit("newListener",e,t),this.wildcard?(C.call(this,e,t,n),o):(this._events[e]?("function"==typeof this._events[e]&&(this._events[e]=[this._events[e]]),n?this._events[e].unshift(t):this._events[e].push(t),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,f.call(this,this._events[e].length,e))):this._events[e]=t,o)},N.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var n,i=[];if(this.wildcard){var r="string"==typeof e?e.split(this.delimiter):e.slice();if(!(i=k.call(this,null,r,this.listenerTree,0)))return this}else{if(!this._events[e])return this;n=this._events[e],i.push({_listeners:n})}for(var s=0;s<i.length;s++){var a=i[s];if(n=a._listeners,o(n)){for(var l=-1,c=0,u=n.length;c<u;c++)if(n[c]===t||n[c].listener&&n[c].listener===t||n[c]._origin&&n[c]._origin===t){l=c;break}if(l<0)continue;return this.wildcard?a._listeners.splice(l,1):this._events[e].splice(l,1),0===n.length&&(this.wildcard?delete a._listeners:delete this._events[e]),this._removeListener&&this.emit("removeListener",e,t),this}(n===t||n.listener&&n.listener===t||n._origin&&n._origin===t)&&(this.wildcard?delete a._listeners:delete this._events[e],this._removeListener&&this.emit("removeListener",e,t))}return this.listenerTree&&R(this.listenerTree),this},N.prototype.offAny=function(e){var t,n=0,i=0;if(e&&this._all&&this._all.length>0){for(n=0,i=(t=this._all).length;n<i;n++)if(e===t[n])return t.splice(n,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(t=this._all,this._removeListener)for(n=0,i=t.length;n<i;n++)this.emit("removeListenerAny",t[n]);this._all=[]}return this},N.prototype.removeListener=N.prototype.off,N.prototype.removeAllListeners=function(e){if(e===r)return!this._events||h.call(this),this;if(this.wildcard){var t,n=k.call(this,null,e,this.listenerTree,0);if(!n)return this;for(t=0;t<n.length;t++)n[t]._listeners=null;this.listenerTree&&R(this.listenerTree)}else this._events&&(this._events[e]=null);return this},N.prototype.listeners=function(e){var t,n,i,s,o,a=this._events;if(e===r){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!a)return[];for(s=(t=d(a)).length,i=[];s-- >0;)"function"==typeof(n=a[t[s]])?i.push(n):i.push.apply(i,n);return i}if(this.wildcard){if(!(o=this.listenerTree))return[];var l=[],c="string"==typeof e?e.split(this.delimiter):e.slice();return k.call(this,l,c,o,0),l}return a&&(n=a[e])?"function"==typeof n?[n]:n:[]},N.prototype.eventNames=function(e){var t=this._events;return this.wildcard?I.call(this,this.listenerTree,[],null,e):t?d(t):[]},N.prototype.listenerCount=function(e){return this.listeners(e).length},N.prototype.hasListeners=function(e){if(this.wildcard){var t=[],n="string"==typeof e?e.split(this.delimiter):e.slice();return k.call(this,t,n,this.listenerTree,0),t.length>0}var i=this._events,s=this._all;return!!(s&&s.length||i&&(e===r?d(i).length:i[e]))},N.prototype.listenersAny=function(){return this._all?this._all:[]},N.prototype.waitFor=function(e,t){var n=this,i=typeof t;return"number"===i?t={timeout:t}:"function"===i&&(t={filter:t}),T((t=y(t,{timeout:0,filter:r,handleError:!1,Promise,overload:!1},{filter:w,Promise:b})).Promise,(function(i,r,s){function o(){var s=t.filter;if(!s||s.apply(n,arguments))if(n.off(e,o),t.handleError){var a=arguments[0];a?r(a):i(m.apply(null,arguments).slice(1))}else i(m.apply(null,arguments))}s((function(){n.off(e,o)})),n._on(e,o,!1)}),{timeout:t.timeout,overload:t.overload})};var x=N.prototype;Object.defineProperties(N,{defaultMaxListeners:{get:function(){return x._maxListeners},set:function(e){if("number"!=typeof e||e<0||Number.isNaN(e))throw TypeError("n must be a non-negative number");x._maxListeners=e},enumerable:!0},once:{value:function(e,t,n){return T((n=y(n,{Promise,timeout:0,overload:!1},{Promise:b})).Promise,(function(n,i,r){var s;if("function"==typeof e.addEventListener)return s=function(){n(m.apply(null,arguments))},r((function(){e.removeEventListener(t,s)})),void e.addEventListener(t,s,{once:!0});var o,a=function(){o&&e.removeListener("error",o),n(m.apply(null,arguments))};"error"!==t&&(o=function(n){e.removeListener(t,a),i(n)},e.once("error",o)),r((function(){o&&e.removeListener("error",o),e.removeListener(t,a)})),e.once(t,a)}),{timeout:n.timeout,overload:n.overload})},writable:!0,configurable:!0}}),Object.defineProperties(x,{_maxListeners:{value:10,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),(i=function(){return N}.call(t,n,t,e))===r||(e.exports=i)}()},2545:(e,t,n)=>{"use strict";var i=n(9864),r={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},s={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},o={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},a={};function l(e){return i.isMemo(e)?o:a[e.$$typeof]||r}a[i.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},a[i.Memo]=o;var c=Object.defineProperty,u=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols,h=Object.getOwnPropertyDescriptor,p=Object.getPrototypeOf,f=Object.prototype;e.exports=function e(t,n,i){if("string"!=typeof n){if(f){var r=p(n);r&&r!==f&&e(t,r,i)}var o=u(n);d&&(o=o.concat(d(n)));for(var a=l(t),m=l(n),g=0;g<o.length;++g){var v=o[g];if(!(s[v]||i&&i[v]||m&&m[v]||a&&a[v])){var y=h(n,v);try{c(t,v,y)}catch(e){}}}}return t}},4448:(e,t,n)=>{"use strict";var i=n(7294),r=n(3840);function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,a={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(a[e]=t,e=0;e<t.length;e++)o.add(t[e])}var u=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function m(e,t,n,i,r,s,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=o}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){g[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){g[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){g[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){g[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){g[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var v=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,n,i){var r=g.hasOwnProperty(t)?g[t]:null;(null!==r?0!==r.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null==t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!d.call(f,e)||!d.call(p,e)&&(h.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(v,y);g[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(v,y);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(v,y);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var _=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),S=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),k=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),I=Symbol.for("react.context"),R=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),N=Symbol.for("react.memo"),x=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var D=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var O=Symbol.iterator;function L(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=O&&e[O]||e["@@iterator"])?e:null}var M,j=Object.assign;function U(e){if(void 0===M)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);M=t&&t[1]||""}return"\n"+M+e}var F=!1;function V(e,t){if(!e||F)return"";F=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var i=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){i=e}e.call(t.prototype)}else{try{throw Error()}catch(e){i=e}e()}}catch(t){if(t&&i&&"string"==typeof t.stack){for(var r=t.stack.split("\n"),s=i.stack.split("\n"),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(1!==o||1!==a)do{if(o--,0>--a||r[o]!==s[a]){var l="\n"+r[o].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=o&&0<=a);break}}}finally{F=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?U(e):""}function B(e){switch(e.tag){case 5:return U(e.type);case 16:return U("Lazy");case 13:return U("Suspense");case 19:return U("SuspenseList");case 0:case 2:case 15:return e=V(e.type,!1);case 11:return e=V(e.type.render,!1);case 1:return e=V(e.type,!0);default:return""}}function z(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case T:return"Fragment";case S:return"Portal";case k:return"Profiler";case E:return"StrictMode";case P:return"Suspense";case A:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case I:return(e.displayName||"Context")+".Consumer";case C:return(e._context.displayName||"Context")+".Provider";case R:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case N:return null!==(t=e.displayName||null)?t:z(e.type)||"Memo";case x:t=e._payload,e=e._init;try{return z(e(t))}catch(e){}}return null}function $(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return z(t);case 8:return t===E?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}function q(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function G(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function W(e){e._valueTracker||(e._valueTracker=function(e){var t=G(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var r=n.get,s=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function H(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=G(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function K(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function J(e,t){var n=t.checked;return j({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Q(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=q(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Y(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function Z(e,t){Y(e,t);var n=q(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,q(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function X(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&K(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+q(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function ie(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(s(91));return j({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(s(92));if(te(n)){if(1<n.length)throw Error(s(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:q(n)}}function se(e,t){var n=q(t.value),i=q(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ae(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ae(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,de=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction((function(){return ue(e,t)}))}:ue);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=me(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(pe).forEach((function(e){fe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]}))}));var ve=j({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(s(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(s(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(s(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _e=null;function we(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Se=null,Te=null,Ee=null;function ke(e){if(e=br(e)){if("function"!=typeof Se)throw Error(s(280));var t=e.stateNode;t&&(t=wr(t),Se(e.stateNode,e.type,t))}}function Ce(e){Te?Ee?Ee.push(e):Ee=[e]:Te=e}function Ie(){if(Te){var e=Te,t=Ee;if(Ee=Te=null,ke(e),t)for(e=0;e<t.length;e++)ke(t[e])}}function Re(e,t){return e(t)}function Pe(){}var Ae=!1;function Ne(e,t,n){if(Ae)return e(t,n);Ae=!0;try{return Re(e,t,n)}finally{Ae=!1,(null!==Te||null!==Ee)&&(Pe(),Ie())}}function xe(e,t){var n=e.stateNode;if(null===n)return null;var i=wr(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(s(231,t,typeof n));return n}var De=!1;if(u)try{var Oe={};Object.defineProperty(Oe,"passive",{get:function(){De=!0}}),window.addEventListener("test",Oe,Oe),window.removeEventListener("test",Oe,Oe)}catch(ue){De=!1}function Le(e,t,n,i,r,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(e){this.onError(e)}}var Me=!1,je=null,Ue=!1,Fe=null,Ve={onError:function(e){Me=!0,je=e}};function Be(e,t,n,i,r,s,o,a,l){Me=!1,je=null,Le.apply(Ve,arguments)}function ze(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!=(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function $e(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function qe(e){if(ze(e)!==e)throw Error(s(188))}function Ge(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=ze(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var o=r.alternate;if(null===o){if(null!==(i=r.return)){n=i;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return qe(r),e;if(o===i)return qe(r),t;o=o.sibling}throw Error(s(188))}if(n.return!==i.return)n=r,i=o;else{for(var a=!1,l=r.child;l;){if(l===n){a=!0,n=r,i=o;break}if(l===i){a=!0,i=r,n=o;break}l=l.sibling}if(!a){for(l=o.child;l;){if(l===n){a=!0,n=o,i=r;break}if(l===i){a=!0,i=o,n=r;break}l=l.sibling}if(!a)throw Error(s(189))}}if(n.alternate!==i)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}(e))?We(e):null}function We(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=We(e);if(null!==t)return t;e=e.sibling}return null}var He=r.unstable_scheduleCallback,Ke=r.unstable_cancelCallback,Je=r.unstable_shouldYield,Qe=r.unstable_requestPaint,Ye=r.unstable_now,Ze=r.unstable_getCurrentPriorityLevel,Xe=r.unstable_ImmediatePriority,et=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,nt=r.unstable_LowPriority,it=r.unstable_IdlePriority,rt=null,st=null;var ot=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(at(e)/lt|0)|0},at=Math.log,lt=Math.LN2;var ct=64,ut=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,s=e.pingedLanes,o=268435455&n;if(0!==o){var a=o&~r;0!==a?i=dt(a):0!==(s&=o)&&(i=dt(s))}else 0!==(o=n&~r)?i=dt(o):0!==s&&(i=dt(s));if(0===i)return 0;if(0!==t&&t!==i&&0==(t&r)&&((r=i&-i)>=(s=t&-t)||16===r&&0!=(4194240&s)))return t;if(0!=(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-ot(t)),i|=e[n],t&=~r;return i}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ct;return 0==(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function vt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-ot(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var bt=0;function _t(e){return 1<(e&=-e)?4<e?0!=(268435455&e)?16:536870912:4:1}var wt,St,Tt,Et,kt,Ct=!1,It=[],Rt=null,Pt=null,At=null,Nt=new Map,xt=new Map,Dt=[],Ot="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lt(e,t){switch(e){case"focusin":case"focusout":Rt=null;break;case"dragenter":case"dragleave":Pt=null;break;case"mouseover":case"mouseout":At=null;break;case"pointerover":case"pointerout":Nt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":xt.delete(t.pointerId)}}function Mt(e,t,n,i,r,s){return null===e||e.nativeEvent!==s?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},null!==t&&(null!==(t=br(t))&&St(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function jt(e){var t=yr(e.target);if(null!==t){var n=ze(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=$e(n)))return e.blockedOn=t,void kt(e.priority,(function(){Tt(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ut(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Jt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=br(n))&&St(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);_e=i,n.target.dispatchEvent(i),_e=null,t.shift()}return!0}function Ft(e,t,n){Ut(e)&&n.delete(t)}function Vt(){Ct=!1,null!==Rt&&Ut(Rt)&&(Rt=null),null!==Pt&&Ut(Pt)&&(Pt=null),null!==At&&Ut(At)&&(At=null),Nt.forEach(Ft),xt.forEach(Ft)}function Bt(e,t){e.blockedOn===t&&(e.blockedOn=null,Ct||(Ct=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Vt)))}function zt(e){function t(t){return Bt(t,e)}if(0<It.length){Bt(It[0],e);for(var n=1;n<It.length;n++){var i=It[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==Rt&&Bt(Rt,e),null!==Pt&&Bt(Pt,e),null!==At&&Bt(At,e),Nt.forEach(t),xt.forEach(t),n=0;n<Dt.length;n++)(i=Dt[n]).blockedOn===e&&(i.blockedOn=null);for(;0<Dt.length&&null===(n=Dt[0]).blockedOn;)jt(n),null===n.blockedOn&&Dt.shift()}var $t=_.ReactCurrentBatchConfig,qt=!0;function Gt(e,t,n,i){var r=bt,s=$t.transition;$t.transition=null;try{bt=1,Ht(e,t,n,i)}finally{bt=r,$t.transition=s}}function Wt(e,t,n,i){var r=bt,s=$t.transition;$t.transition=null;try{bt=4,Ht(e,t,n,i)}finally{bt=r,$t.transition=s}}function Ht(e,t,n,i){if(qt){var r=Jt(e,t,n,i);if(null===r)qi(e,t,i,Kt,n),Lt(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return Rt=Mt(Rt,e,t,n,i,r),!0;case"dragenter":return Pt=Mt(Pt,e,t,n,i,r),!0;case"mouseover":return At=Mt(At,e,t,n,i,r),!0;case"pointerover":var s=r.pointerId;return Nt.set(s,Mt(Nt.get(s)||null,e,t,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,xt.set(s,Mt(xt.get(s)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(Lt(e,i),4&t&&-1<Ot.indexOf(e)){for(;null!==r;){var s=br(r);if(null!==s&&wt(s),null===(s=Jt(e,t,n,i))&&qi(e,t,i,Kt,n),s===r)break;r=s}null!==r&&i.stopPropagation()}else qi(e,t,i,null,n)}}var Kt=null;function Jt(e,t,n,i){if(Kt=null,null!==(e=yr(e=we(i))))if(null===(t=ze(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=$e(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Kt=e,null}function Qt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ze()){case Xe:return 1;case et:return 4;case tt:case nt:return 16;case it:return 536870912;default:return 16}default:return 16}}var Yt=null,Zt=null,Xt=null;function en(){if(Xt)return Xt;var e,t,n=Zt,i=n.length,r="value"in Yt?Yt.value:Yt.textContent,s=r.length;for(e=0;e<i&&n[e]===r[e];e++);var o=i-e;for(t=1;t<=o&&n[i-t]===r[s-t];t++);return Xt=r.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function sn(e){function t(t,n,i,r,s){for(var o in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=s,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(r):r[o]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return j(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var on,an,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=sn(cn),dn=j({},cn,{view:0,detail:0}),hn=sn(dn),pn=j({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(on=e.screenX-ln.screenX,an=e.screenY-ln.screenY):an=on=0,ln=e),on)},movementY:function(e){return"movementY"in e?e.movementY:an}}),fn=sn(pn),mn=sn(j({},pn,{dataTransfer:0})),gn=sn(j({},dn,{relatedTarget:0})),vn=sn(j({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=j({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=sn(yn),_n=sn(j({},cn,{data:0})),wn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Tn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function En(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Tn[e])&&!!t[e]}function kn(){return En}var Cn=j({},dn,{key:function(e){if(e.key){var t=wn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Sn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),In=sn(Cn),Rn=sn(j({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Pn=sn(j({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kn})),An=sn(j({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Nn=j({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),xn=sn(Nn),Dn=[9,13,27,32],On=u&&"CompositionEvent"in window,Ln=null;u&&"documentMode"in document&&(Ln=document.documentMode);var Mn=u&&"TextEvent"in window&&!Ln,jn=u&&(!On||Ln&&8<Ln&&11>=Ln),Un=String.fromCharCode(32),Fn=!1;function Vn(e,t){switch(e){case"keyup":return-1!==Dn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Bn(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var zn=!1;var $n={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function qn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!$n[e.type]:"textarea"===t}function Gn(e,t,n,i){Ce(i),0<(t=Wi(t,"onChange")).length&&(n=new un("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Wn=null,Hn=null;function Kn(e){Ui(e,0)}function Jn(e){if(H(_r(e)))return e}function Qn(e,t){if("change"===e)return t}var Yn=!1;if(u){var Zn;if(u){var Xn="oninput"in document;if(!Xn){var ei=document.createElement("div");ei.setAttribute("oninput","return;"),Xn="function"==typeof ei.oninput}Zn=Xn}else Zn=!1;Yn=Zn&&(!document.documentMode||9<document.documentMode)}function ti(){Wn&&(Wn.detachEvent("onpropertychange",ni),Hn=Wn=null)}function ni(e){if("value"===e.propertyName&&Jn(Hn)){var t=[];Gn(t,Hn,e,we(e)),Ne(Kn,t)}}function ii(e,t,n){"focusin"===e?(ti(),Hn=n,(Wn=t).attachEvent("onpropertychange",ni)):"focusout"===e&&ti()}function ri(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Jn(Hn)}function si(e,t){if("click"===e)return Jn(t)}function oi(e,t){if("input"===e||"change"===e)return Jn(t)}var ai="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function li(e,t){if(ai(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!d.call(t,r)||!ai(e[r],t[r]))return!1}return!0}function ci(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ui(e,t){var n,i=ci(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ci(i)}}function di(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?di(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hi(){for(var e=window,t=K();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(!n)break;t=K((e=t.contentWindow).document)}return t}function pi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fi(e){var t=hi(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&di(n.ownerDocument.documentElement,n)){if(null!==i&&pi(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=void 0===i.end?s:Math.min(i.end,r),!e.extend&&s>i&&(r=i,i=s,s=r),r=ui(n,s);var o=ui(n,i);r&&o&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),s>i?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mi=u&&"documentMode"in document&&11>=document.documentMode,gi=null,vi=null,yi=null,bi=!1;function _i(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;bi||null==gi||gi!==K(i)||("selectionStart"in(i=gi)&&pi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},yi&&li(yi,i)||(yi=i,0<(i=Wi(vi,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=gi)))}function wi(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Si={animationend:wi("Animation","AnimationEnd"),animationiteration:wi("Animation","AnimationIteration"),animationstart:wi("Animation","AnimationStart"),transitionend:wi("Transition","TransitionEnd")},Ti={},Ei={};function ki(e){if(Ti[e])return Ti[e];if(!Si[e])return e;var t,n=Si[e];for(t in n)if(n.hasOwnProperty(t)&&t in Ei)return Ti[e]=n[t];return e}u&&(Ei=document.createElement("div").style,"AnimationEvent"in window||(delete Si.animationend.animation,delete Si.animationiteration.animation,delete Si.animationstart.animation),"TransitionEvent"in window||delete Si.transitionend.transition);var Ci=ki("animationend"),Ii=ki("animationiteration"),Ri=ki("animationstart"),Pi=ki("transitionend"),Ai=new Map,Ni="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xi(e,t){Ai.set(e,t),l(t,[e])}for(var Di=0;Di<Ni.length;Di++){var Oi=Ni[Di];xi(Oi.toLowerCase(),"on"+(Oi[0].toUpperCase()+Oi.slice(1)))}xi(Ci,"onAnimationEnd"),xi(Ii,"onAnimationIteration"),xi(Ri,"onAnimationStart"),xi("dblclick","onDoubleClick"),xi("focusin","onFocus"),xi("focusout","onBlur"),xi(Pi,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Li="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mi=new Set("cancel close invalid load scroll toggle".split(" ").concat(Li));function ji(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,r,o,a,l,c){if(Be.apply(this,arguments),Me){if(!Me)throw Error(s(198));var u=je;Me=!1,je=null,Ue||(Ue=!0,Fe=u)}}(i,t,void 0,e),e.currentTarget=null}function Ui(e,t){t=0!=(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var s=void 0;if(t)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&r.isPropagationStopped())break e;ji(r,a,c),s=l}else for(o=0;o<i.length;o++){if(l=(a=i[o]).instance,c=a.currentTarget,a=a.listener,l!==s&&r.isPropagationStopped())break e;ji(r,a,c),s=l}}}if(Ue)throw e=Fe,Ue=!1,Fe=null,e}function Fi(e,t){var n=t[mr];void 0===n&&(n=t[mr]=new Set);var i=e+"__bubble";n.has(i)||($i(t,e,2,!1),n.add(i))}function Vi(e,t,n){var i=0;t&&(i|=4),$i(n,e,i,t)}var Bi="_reactListening"+Math.random().toString(36).slice(2);function zi(e){if(!e[Bi]){e[Bi]=!0,o.forEach((function(t){"selectionchange"!==t&&(Mi.has(t)||Vi(t,!1,e),Vi(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Bi]||(t[Bi]=!0,Vi("selectionchange",!1,t))}}function $i(e,t,n,i){switch(Qt(t)){case 1:var r=Gt;break;case 4:r=Wt;break;default:r=Ht}n=r.bind(null,t,n,e),r=void 0,!De||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function qi(e,t,n,i,r){var s=i;if(0==(1&t)&&0==(2&t)&&null!==i)e:for(;;){if(null===i)return;var o=i.tag;if(3===o||4===o){var a=i.stateNode.containerInfo;if(a===r||8===a.nodeType&&a.parentNode===r)break;if(4===o)for(o=i.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;o=o.return}for(;null!==a;){if(null===(o=yr(a)))return;if(5===(l=o.tag)||6===l){i=s=o;continue e}a=a.parentNode}}i=i.return}Ne((function(){var i=s,r=we(n),o=[];e:{var a=Ai.get(e);if(void 0!==a){var l=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=In;break;case"focusin":c="focus",l=gn;break;case"focusout":c="blur",l=gn;break;case"beforeblur":case"afterblur":l=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Pn;break;case Ci:case Ii:case Ri:l=vn;break;case Pi:l=An;break;case"scroll":l=hn;break;case"wheel":l=xn;break;case"copy":case"cut":case"paste":l=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Rn}var u=0!=(4&t),d=!u&&"scroll"===e,h=u?null!==a?a+"Capture":null:a;u=[];for(var p,f=i;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==h&&(null!=(m=xe(f,h))&&u.push(Gi(f,m,p)))),d)break;f=f.return}0<u.length&&(a=new l(a,c,null,n,r),o.push({event:a,listeners:u}))}}if(0==(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||n===_e||!(c=n.relatedTarget||n.fromElement)||!yr(c)&&!c[fr])&&(l||a)&&(a=r.window===r?r:(a=r.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=i,null!==(c=(c=n.relatedTarget||n.toElement)?yr(c):null)&&(c!==(d=ze(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=i),l!==c)){if(u=fn,m="onMouseLeave",h="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=Rn,m="onPointerLeave",h="onPointerEnter",f="pointer"),d=null==l?a:_r(l),p=null==c?a:_r(c),(a=new u(m,f+"leave",l,n,r)).target=d,a.relatedTarget=p,m=null,yr(r)===i&&((u=new u(h,f+"enter",c,n,r)).target=p,u.relatedTarget=d,m=u),d=m,l&&c)e:{for(h=c,f=0,p=u=l;p;p=Hi(p))f++;for(p=0,m=h;m;m=Hi(m))p++;for(;0<f-p;)u=Hi(u),f--;for(;0<p-f;)h=Hi(h),p--;for(;f--;){if(u===h||null!==h&&u===h.alternate)break e;u=Hi(u),h=Hi(h)}u=null}else u=null;null!==l&&Ki(o,a,l,u,!1),null!==c&&null!==d&&Ki(o,d,c,u,!0)}if("select"===(l=(a=i?_r(i):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var g=Qn;else if(qn(a))if(Yn)g=oi;else{g=ri;var v=ii}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(g=si);switch(g&&(g=g(e,i))?Gn(o,g,n,r):(v&&v(e,a,i),"focusout"===e&&(v=a._wrapperState)&&v.controlled&&"number"===a.type&&ee(a,"number",a.value)),v=i?_r(i):window,e){case"focusin":(qn(v)||"true"===v.contentEditable)&&(gi=v,vi=i,yi=null);break;case"focusout":yi=vi=gi=null;break;case"mousedown":bi=!0;break;case"contextmenu":case"mouseup":case"dragend":bi=!1,_i(o,n,r);break;case"selectionchange":if(mi)break;case"keydown":case"keyup":_i(o,n,r)}var y;if(On)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else zn?Vn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(jn&&"ko"!==n.locale&&(zn||"onCompositionStart"!==b?"onCompositionEnd"===b&&zn&&(y=en()):(Zt="value"in(Yt=r)?Yt.value:Yt.textContent,zn=!0)),0<(v=Wi(i,b)).length&&(b=new _n(b,e,null,n,r),o.push({event:b,listeners:v}),y?b.data=y:null!==(y=Bn(n))&&(b.data=y))),(y=Mn?function(e,t){switch(e){case"compositionend":return Bn(t);case"keypress":return 32!==t.which?null:(Fn=!0,Un);case"textInput":return(e=t.data)===Un&&Fn?null:e;default:return null}}(e,n):function(e,t){if(zn)return"compositionend"===e||!On&&Vn(e,t)?(e=en(),Xt=Zt=Yt=null,zn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return jn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=Wi(i,"onBeforeInput")).length&&(r=new _n("onBeforeInput","beforeinput",null,n,r),o.push({event:r,listeners:i}),r.data=y))}Ui(o,t)}))}function Gi(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Wi(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,s=r.stateNode;5===r.tag&&null!==s&&(r=s,null!=(s=xe(e,n))&&i.unshift(Gi(e,s,r)),null!=(s=xe(e,t))&&i.push(Gi(e,s,r))),e=e.return}return i}function Hi(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Ki(e,t,n,i,r){for(var s=t._reactName,o=[];null!==n&&n!==i;){var a=n,l=a.alternate,c=a.stateNode;if(null!==l&&l===i)break;5===a.tag&&null!==c&&(a=c,r?null!=(l=xe(n,s))&&o.unshift(Gi(n,l,a)):r||null!=(l=xe(n,s))&&o.push(Gi(n,l,a))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Ji=/\r\n?/g,Qi=/\u0000|\uFFFD/g;function Yi(e){return("string"==typeof e?e:""+e).replace(Ji,"\n").replace(Qi,"")}function Zi(e,t,n){if(t=Yi(t),Yi(e)!==t&&n)throw Error(s(425))}function Xi(){}var er=null,tr=null;function nr(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ir="function"==typeof setTimeout?setTimeout:void 0,rr="function"==typeof clearTimeout?clearTimeout:void 0,sr="function"==typeof Promise?Promise:void 0,or="function"==typeof queueMicrotask?queueMicrotask:void 0!==sr?function(e){return sr.resolve(null).then(e).catch(ar)}:ir;function ar(e){setTimeout((function(){throw e}))}function lr(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return e.removeChild(r),void zt(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);zt(t)}function cr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ur(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var dr=Math.random().toString(36).slice(2),hr="__reactFiber$"+dr,pr="__reactProps$"+dr,fr="__reactContainer$"+dr,mr="__reactEvents$"+dr,gr="__reactListeners$"+dr,vr="__reactHandles$"+dr;function yr(e){var t=e[hr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[fr]||n[hr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ur(e);null!==e;){if(n=e[hr])return n;e=ur(e)}return t}n=(e=n).parentNode}return null}function br(e){return!(e=e[hr]||e[fr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function _r(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(s(33))}function wr(e){return e[pr]||null}var Sr=[],Tr=-1;function Er(e){return{current:e}}function kr(e){0>Tr||(e.current=Sr[Tr],Sr[Tr]=null,Tr--)}function Cr(e,t){Tr++,Sr[Tr]=e.current,e.current=t}var Ir={},Rr=Er(Ir),Pr=Er(!1),Ar=Ir;function Nr(e,t){var n=e.type.contextTypes;if(!n)return Ir;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,s={};for(r in n)s[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function xr(e){return null!=(e=e.childContextTypes)}function Dr(){kr(Pr),kr(Rr)}function Or(e,t,n){if(Rr.current!==Ir)throw Error(s(168));Cr(Rr,t),Cr(Pr,n)}function Lr(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!=typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in t))throw Error(s(108,$(e)||"Unknown",r));return j({},n,i)}function Mr(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ir,Ar=Rr.current,Cr(Rr,e),Cr(Pr,Pr.current),!0}function jr(e,t,n){var i=e.stateNode;if(!i)throw Error(s(169));n?(e=Lr(e,t,Ar),i.__reactInternalMemoizedMergedChildContext=e,kr(Pr),kr(Rr),Cr(Rr,e)):kr(Pr),Cr(Pr,n)}var Ur=null,Fr=!1,Vr=!1;function Br(e){null===Ur?Ur=[e]:Ur.push(e)}function zr(){if(!Vr&&null!==Ur){Vr=!0;var e=0,t=bt;try{var n=Ur;for(bt=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Ur=null,Fr=!1}catch(t){throw null!==Ur&&(Ur=Ur.slice(e+1)),He(Xe,zr),t}finally{bt=t,Vr=!1}}return null}var $r=[],qr=0,Gr=null,Wr=0,Hr=[],Kr=0,Jr=null,Qr=1,Yr="";function Zr(e,t){$r[qr++]=Wr,$r[qr++]=Gr,Gr=e,Wr=t}function Xr(e,t,n){Hr[Kr++]=Qr,Hr[Kr++]=Yr,Hr[Kr++]=Jr,Jr=e;var i=Qr;e=Yr;var r=32-ot(i)-1;i&=~(1<<r),n+=1;var s=32-ot(t)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,Qr=1<<32-ot(t)+r|n<<r|i,Yr=s+e}else Qr=1<<s|n<<r|i,Yr=e}function es(e){null!==e.return&&(Zr(e,1),Xr(e,1,0))}function ts(e){for(;e===Gr;)Gr=$r[--qr],$r[qr]=null,Wr=$r[--qr],$r[qr]=null;for(;e===Jr;)Jr=Hr[--Kr],Hr[Kr]=null,Yr=Hr[--Kr],Hr[Kr]=null,Qr=Hr[--Kr],Hr[Kr]=null}var ns=null,is=null,rs=!1,ss=null;function os(e,t){var n=xc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function as(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ns=e,is=cr(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ns=e,is=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Jr?{id:Qr,overflow:Yr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=xc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ns=e,is=null,!0);default:return!1}}function ls(e){return 0!=(1&e.mode)&&0==(128&e.flags)}function cs(e){if(rs){var t=is;if(t){var n=t;if(!as(e,t)){if(ls(e))throw Error(s(418));t=cr(n.nextSibling);var i=ns;t&&as(e,t)?os(i,n):(e.flags=-4097&e.flags|2,rs=!1,ns=e)}}else{if(ls(e))throw Error(s(418));e.flags=-4097&e.flags|2,rs=!1,ns=e}}}function us(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ns=e}function ds(e){if(e!==ns)return!1;if(!rs)return us(e),rs=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!nr(e.type,e.memoizedProps)),t&&(t=is)){if(ls(e))throw hs(),Error(s(418));for(;t;)os(e,t),t=cr(t.nextSibling)}if(us(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){is=cr(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}is=null}}else is=ns?cr(e.stateNode.nextSibling):null;return!0}function hs(){for(var e=is;e;)e=cr(e.nextSibling)}function ps(){is=ns=null,rs=!1}function fs(e){null===ss?ss=[e]:ss.push(e)}var ms=_.ReactCurrentBatchConfig;function gs(e,t){if(e&&e.defaultProps){for(var n in t=j({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var vs=Er(null),ys=null,bs=null,_s=null;function ws(){_s=bs=ys=null}function Ss(e){var t=vs.current;kr(vs),e._currentValue=t}function Ts(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function Es(e,t){ys=e,_s=bs=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!=(e.lanes&t)&&(_a=!0),e.firstContext=null)}function ks(e){var t=e._currentValue;if(_s!==e)if(e={context:e,memoizedValue:t,next:null},null===bs){if(null===ys)throw Error(s(308));bs=e,ys.dependencies={lanes:0,firstContext:e}}else bs=bs.next=e;return t}var Cs=null;function Is(e){null===Cs?Cs=[e]:Cs.push(e)}function Rs(e,t,n,i){var r=t.interleaved;return null===r?(n.next=n,Is(t)):(n.next=r.next,r.next=n),t.interleaved=n,Ps(e,i)}function Ps(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var As=!1;function Ns(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function xs(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ds(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Os(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!=(2&Pl)){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,Ps(e,n)}return null===(r=i.interleaved)?(t.next=t,Is(i)):(t.next=r.next,r.next=t),i.interleaved=t,Ps(e,n)}function Ls(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!=(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Ms(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,s=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===s?r=s=o:s=s.next=o,n=n.next}while(null!==n);null===s?r=s=t:s=s.next=t}else r=s=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function js(e,t,n,i){var r=e.updateQueue;As=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(null!==a){r.shared.pending=null;var l=a,c=l.next;l.next=null,null===o?s=c:o.next=c,o=l;var u=e.alternate;null!==u&&((a=(u=u.updateQueue).lastBaseUpdate)!==o&&(null===a?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(null!==s){var d=r.baseState;for(o=0,u=c=l=null,a=s;;){var h=a.lane,p=a.eventTime;if((i&h)===h){null!==u&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=e,m=a;switch(h=t,p=n,m.tag){case 1:if("function"==typeof(f=m.payload)){d=f.call(p,d,h);break e}d=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null==(h="function"==typeof(f=m.payload)?f.call(p,d,h):f))break e;d=j({},d,h);break e;case 2:As=!0}}null!==a.callback&&0!==a.lane&&(e.flags|=64,null===(h=r.effects)?r.effects=[a]:h.push(a))}else p={eventTime:p,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===u?(c=u=p,l=d):u=u.next=p,o|=h;if(null===(a=a.next)){if(null===(a=r.shared.pending))break;a=(h=a).next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}if(null===u&&(l=d),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,null!==(t=r.shared.interleaved)){r=t;do{o|=r.lane,r=r.next}while(r!==t)}else null===s&&(r.shared.lanes=0);jl|=o,e.lanes=o,e.memoizedState=d}}function Us(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!=typeof r)throw Error(s(191,r));r.call(i)}}}var Fs=(new i.Component).refs;function Vs(e,t,n,i){n=null==(n=n(i,t=e.memoizedState))?t:j({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Bs={isMounted:function(e){return!!(e=e._reactInternals)&&ze(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=tc(),r=nc(e),s=Ds(i,r);s.payload=t,null!=n&&(s.callback=n),null!==(t=Os(e,s,r))&&(ic(t,e,r,i),Ls(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=tc(),r=nc(e),s=Ds(i,r);s.tag=1,s.payload=t,null!=n&&(s.callback=n),null!==(t=Os(e,s,r))&&(ic(t,e,r,i),Ls(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tc(),i=nc(e),r=Ds(n,i);r.tag=2,null!=t&&(r.callback=t),null!==(t=Os(e,r,i))&&(ic(t,e,i,n),Ls(t,e,i))}};function zs(e,t,n,i,r,s,o){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,s,o):!t.prototype||!t.prototype.isPureReactComponent||(!li(n,i)||!li(r,s))}function $s(e,t,n){var i=!1,r=Ir,s=t.contextType;return"object"==typeof s&&null!==s?s=ks(s):(r=xr(t)?Ar:Rr.current,s=(i=null!=(i=t.contextTypes))?Nr(e,r):Ir),t=new t(n,s),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Bs,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=s),t}function qs(e,t,n,i){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&Bs.enqueueReplaceState(t,t.state,null)}function Gs(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs=Fs,Ns(e);var s=t.contextType;"object"==typeof s&&null!==s?r.context=ks(s):(s=xr(t)?Ar:Rr.current,r.context=Nr(e,s)),r.state=e.memoizedState,"function"==typeof(s=t.getDerivedStateFromProps)&&(Vs(e,t,s,n),r.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof r.getSnapshotBeforeUpdate||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||(t=r.state,"function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&Bs.enqueueReplaceState(r,r.state,null),js(e,n,r,i),r.state=e.memoizedState),"function"==typeof r.componentDidMount&&(e.flags|=4194308)}function Ws(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var i=n.stateNode}if(!i)throw Error(s(147,e));var r=i,o=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=r.refs;t===Fs&&(t=r.refs={}),null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!=typeof e)throw Error(s(284));if(!n._owner)throw Error(s(290,e))}return e}function Hs(e,t){throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Ks(e){return(0,e._init)(e._payload)}function Js(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Oc(e,t)).index=0,e.sibling=null,e}function o(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,i){return null===t||6!==t.tag?((t=Uc(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function c(e,t,n,i){var s=n.type;return s===T?d(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===s||"object"==typeof s&&null!==s&&s.$$typeof===x&&Ks(s)===t.type)?((i=r(t,n.props)).ref=Ws(e,t,n),i.return=e,i):((i=Lc(n.type,n.key,n.props,null,e.mode,i)).ref=Ws(e,t,n),i.return=e,i)}function u(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Fc(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function d(e,t,n,i,s){return null===t||7!==t.tag?((t=Mc(n,e.mode,i,s)).return=e,t):((t=r(t,n)).return=e,t)}function h(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=Uc(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case w:return(n=Lc(t.type,t.key,t.props,null,e.mode,n)).ref=Ws(e,null,t),n.return=e,n;case S:return(t=Fc(t,e.mode,n)).return=e,t;case x:return h(e,(0,t._init)(t._payload),n)}if(te(t)||L(t))return(t=Mc(t,e.mode,n,null)).return=e,t;Hs(e,t)}return null}function p(e,t,n,i){var r=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==r?null:l(e,t,""+n,i);if("object"==typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===r?c(e,t,n,i):null;case S:return n.key===r?u(e,t,n,i):null;case x:return p(e,t,(r=n._init)(n._payload),i)}if(te(n)||L(n))return null!==r?null:d(e,t,n,i,null);Hs(e,n)}return null}function f(e,t,n,i,r){if("string"==typeof i&&""!==i||"number"==typeof i)return l(t,e=e.get(n)||null,""+i,r);if("object"==typeof i&&null!==i){switch(i.$$typeof){case w:return c(t,e=e.get(null===i.key?n:i.key)||null,i,r);case S:return u(t,e=e.get(null===i.key?n:i.key)||null,i,r);case x:return f(e,t,n,(0,i._init)(i._payload),r)}if(te(i)||L(i))return d(t,e=e.get(n)||null,i,r,null);Hs(t,i)}return null}function m(r,s,a,l){for(var c=null,u=null,d=s,m=s=0,g=null;null!==d&&m<a.length;m++){d.index>m?(g=d,d=null):g=d.sibling;var v=p(r,d,a[m],l);if(null===v){null===d&&(d=g);break}e&&d&&null===v.alternate&&t(r,d),s=o(v,s,m),null===u?c=v:u.sibling=v,u=v,d=g}if(m===a.length)return n(r,d),rs&&Zr(r,m),c;if(null===d){for(;m<a.length;m++)null!==(d=h(r,a[m],l))&&(s=o(d,s,m),null===u?c=d:u.sibling=d,u=d);return rs&&Zr(r,m),c}for(d=i(r,d);m<a.length;m++)null!==(g=f(d,r,m,a[m],l))&&(e&&null!==g.alternate&&d.delete(null===g.key?m:g.key),s=o(g,s,m),null===u?c=g:u.sibling=g,u=g);return e&&d.forEach((function(e){return t(r,e)})),rs&&Zr(r,m),c}function g(r,a,l,c){var u=L(l);if("function"!=typeof u)throw Error(s(150));if(null==(l=u.call(l)))throw Error(s(151));for(var d=u=null,m=a,g=a=0,v=null,y=l.next();null!==m&&!y.done;g++,y=l.next()){m.index>g?(v=m,m=null):v=m.sibling;var b=p(r,m,y.value,c);if(null===b){null===m&&(m=v);break}e&&m&&null===b.alternate&&t(r,m),a=o(b,a,g),null===d?u=b:d.sibling=b,d=b,m=v}if(y.done)return n(r,m),rs&&Zr(r,g),u;if(null===m){for(;!y.done;g++,y=l.next())null!==(y=h(r,y.value,c))&&(a=o(y,a,g),null===d?u=y:d.sibling=y,d=y);return rs&&Zr(r,g),u}for(m=i(r,m);!y.done;g++,y=l.next())null!==(y=f(m,r,g,y.value,c))&&(e&&null!==y.alternate&&m.delete(null===y.key?g:y.key),a=o(y,a,g),null===d?u=y:d.sibling=y,d=y);return e&&m.forEach((function(e){return t(r,e)})),rs&&Zr(r,g),u}return function e(i,s,o,l){if("object"==typeof o&&null!==o&&o.type===T&&null===o.key&&(o=o.props.children),"object"==typeof o&&null!==o){switch(o.$$typeof){case w:e:{for(var c=o.key,u=s;null!==u;){if(u.key===c){if((c=o.type)===T){if(7===u.tag){n(i,u.sibling),(s=r(u,o.props.children)).return=i,i=s;break e}}else if(u.elementType===c||"object"==typeof c&&null!==c&&c.$$typeof===x&&Ks(c)===u.type){n(i,u.sibling),(s=r(u,o.props)).ref=Ws(i,u,o),s.return=i,i=s;break e}n(i,u);break}t(i,u),u=u.sibling}o.type===T?((s=Mc(o.props.children,i.mode,l,o.key)).return=i,i=s):((l=Lc(o.type,o.key,o.props,null,i.mode,l)).ref=Ws(i,s,o),l.return=i,i=l)}return a(i);case S:e:{for(u=o.key;null!==s;){if(s.key===u){if(4===s.tag&&s.stateNode.containerInfo===o.containerInfo&&s.stateNode.implementation===o.implementation){n(i,s.sibling),(s=r(s,o.children||[])).return=i,i=s;break e}n(i,s);break}t(i,s),s=s.sibling}(s=Fc(o,i.mode,l)).return=i,i=s}return a(i);case x:return e(i,s,(u=o._init)(o._payload),l)}if(te(o))return m(i,s,o,l);if(L(o))return g(i,s,o,l);Hs(i,o)}return"string"==typeof o&&""!==o||"number"==typeof o?(o=""+o,null!==s&&6===s.tag?(n(i,s.sibling),(s=r(s,o)).return=i,i=s):(n(i,s),(s=Uc(o,i.mode,l)).return=i,i=s),a(i)):n(i,s)}}var Qs=Js(!0),Ys=Js(!1),Zs={},Xs=Er(Zs),eo=Er(Zs),to=Er(Zs);function no(e){if(e===Zs)throw Error(s(174));return e}function io(e,t){switch(Cr(to,t),Cr(eo,e),Cr(Xs,Zs),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}kr(Xs),Cr(Xs,t)}function ro(){kr(Xs),kr(eo),kr(to)}function so(e){no(to.current);var t=no(Xs.current),n=le(t,e.type);t!==n&&(Cr(eo,e),Cr(Xs,n))}function oo(e){eo.current===e&&(kr(Xs),kr(eo))}var ao=Er(0);function lo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var co=[];function uo(){for(var e=0;e<co.length;e++)co[e]._workInProgressVersionPrimary=null;co.length=0}var ho=_.ReactCurrentDispatcher,po=_.ReactCurrentBatchConfig,fo=0,mo=null,go=null,vo=null,yo=!1,bo=!1,_o=0,wo=0;function So(){throw Error(s(321))}function To(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ai(e[n],t[n]))return!1;return!0}function Eo(e,t,n,i,r,o){if(fo=o,mo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ho.current=null===e||null===e.memoizedState?aa:la,e=n(i,r),bo){o=0;do{if(bo=!1,_o=0,25<=o)throw Error(s(301));o+=1,vo=go=null,t.updateQueue=null,ho.current=ca,e=n(i,r)}while(bo)}if(ho.current=oa,t=null!==go&&null!==go.next,fo=0,vo=go=mo=null,yo=!1,t)throw Error(s(300));return e}function ko(){var e=0!==_o;return _o=0,e}function Co(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===vo?mo.memoizedState=vo=e:vo=vo.next=e,vo}function Io(){if(null===go){var e=mo.alternate;e=null!==e?e.memoizedState:null}else e=go.next;var t=null===vo?mo.memoizedState:vo.next;if(null!==t)vo=t,go=e;else{if(null===e)throw Error(s(310));e={memoizedState:(go=e).memoizedState,baseState:go.baseState,baseQueue:go.baseQueue,queue:go.queue,next:null},null===vo?mo.memoizedState=vo=e:vo=vo.next=e}return vo}function Ro(e,t){return"function"==typeof t?t(e):t}function Po(e){var t=Io(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var i=go,r=i.baseQueue,o=n.pending;if(null!==o){if(null!==r){var a=r.next;r.next=o.next,o.next=a}i.baseQueue=r=o,n.pending=null}if(null!==r){o=r.next,i=i.baseState;var l=a=null,c=null,u=o;do{var d=u.lane;if((fo&d)===d)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:e(i,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=h,a=i):c=c.next=h,mo.lanes|=d,jl|=d}u=u.next}while(null!==u&&u!==o);null===c?a=i:c.next=l,ai(i,t.memoizedState)||(_a=!0),t.memoizedState=i,t.baseState=a,t.baseQueue=c,n.lastRenderedState=i}if(null!==(e=n.interleaved)){r=e;do{o=r.lane,mo.lanes|=o,jl|=o,r=r.next}while(r!==e)}else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ao(e){var t=Io(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,o=t.memoizedState;if(null!==r){n.pending=null;var a=r=r.next;do{o=e(o,a.action),a=a.next}while(a!==r);ai(o,t.memoizedState)||(_a=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,i]}function No(){}function xo(e,t){var n=mo,i=Io(),r=t(),o=!ai(i.memoizedState,r);if(o&&(i.memoizedState=r,_a=!0),i=i.queue,qo(Lo.bind(null,n,i,e),[e]),i.getSnapshot!==t||o||null!==vo&&1&vo.memoizedState.tag){if(n.flags|=2048,Fo(9,Oo.bind(null,n,i,r,t),void 0,null),null===Al)throw Error(s(349));0!=(30&fo)||Do(n,t,r)}return r}function Do(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=mo.updateQueue)?(t={lastEffect:null,stores:null},mo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Oo(e,t,n,i){t.value=n,t.getSnapshot=i,Mo(t)&&jo(e)}function Lo(e,t,n){return n((function(){Mo(t)&&jo(e)}))}function Mo(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!ai(e,n)}catch(e){return!0}}function jo(e){var t=Ps(e,1);null!==t&&ic(t,e,1,-1)}function Uo(e){var t=Co();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ro,lastRenderedState:e},t.queue=e,e=e.dispatch=na.bind(null,mo,e),[t.memoizedState,e]}function Fo(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=mo.updateQueue)?(t={lastEffect:null,stores:null},mo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Vo(){return Io().memoizedState}function Bo(e,t,n,i){var r=Co();mo.flags|=e,r.memoizedState=Fo(1|t,n,void 0,void 0===i?null:i)}function zo(e,t,n,i){var r=Io();i=void 0===i?null:i;var s=void 0;if(null!==go){var o=go.memoizedState;if(s=o.destroy,null!==i&&To(i,o.deps))return void(r.memoizedState=Fo(t,n,s,i))}mo.flags|=e,r.memoizedState=Fo(1|t,n,s,i)}function $o(e,t){return Bo(8390656,8,e,t)}function qo(e,t){return zo(2048,8,e,t)}function Go(e,t){return zo(4,2,e,t)}function Wo(e,t){return zo(4,4,e,t)}function Ho(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ko(e,t,n){return n=null!=n?n.concat([e]):null,zo(4,4,Ho.bind(null,t,e),n)}function Jo(){}function Qo(e,t){var n=Io();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&To(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Yo(e,t){var n=Io();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&To(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Zo(e,t,n){return 0==(21&fo)?(e.baseState&&(e.baseState=!1,_a=!0),e.memoizedState=n):(ai(n,t)||(n=mt(),mo.lanes|=n,jl|=n,e.baseState=!0),t)}function Xo(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var i=po.transition;po.transition={};try{e(!1),t()}finally{bt=n,po.transition=i}}function ea(){return Io().memoizedState}function ta(e,t,n){var i=nc(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},ia(e))ra(t,n);else if(null!==(n=Rs(e,t,n,i))){ic(n,e,i,tc()),sa(n,t,i)}}function na(e,t,n){var i=nc(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(ia(e))ra(t,r);else{var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var o=t.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,ai(a,o)){var l=t.interleaved;return null===l?(r.next=r,Is(t)):(r.next=l.next,l.next=r),void(t.interleaved=r)}}catch(e){}null!==(n=Rs(e,t,r,i))&&(ic(n,e,i,r=tc()),sa(n,t,i))}}function ia(e){var t=e.alternate;return e===mo||null!==t&&t===mo}function ra(e,t){bo=yo=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function sa(e,t,n){if(0!=(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}var oa={readContext:ks,useCallback:So,useContext:So,useEffect:So,useImperativeHandle:So,useInsertionEffect:So,useLayoutEffect:So,useMemo:So,useReducer:So,useRef:So,useState:So,useDebugValue:So,useDeferredValue:So,useTransition:So,useMutableSource:So,useSyncExternalStore:So,useId:So,unstable_isNewReconciler:!1},aa={readContext:ks,useCallback:function(e,t){return Co().memoizedState=[e,void 0===t?null:t],e},useContext:ks,useEffect:$o,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,Bo(4194308,4,Ho.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Bo(4194308,4,e,t)},useInsertionEffect:function(e,t){return Bo(4,2,e,t)},useMemo:function(e,t){var n=Co();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=Co();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=ta.bind(null,mo,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},Co().memoizedState=e},useState:Uo,useDebugValue:Jo,useDeferredValue:function(e){return Co().memoizedState=e},useTransition:function(){var e=Uo(!1),t=e[0];return e=Xo.bind(null,e[1]),Co().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=mo,r=Co();if(rs){if(void 0===n)throw Error(s(407));n=n()}else{if(n=t(),null===Al)throw Error(s(349));0!=(30&fo)||Do(i,t,n)}r.memoizedState=n;var o={value:n,getSnapshot:t};return r.queue=o,$o(Lo.bind(null,i,o,e),[e]),i.flags|=2048,Fo(9,Oo.bind(null,i,o,n,t),void 0,null),n},useId:function(){var e=Co(),t=Al.identifierPrefix;if(rs){var n=Yr;t=":"+t+"R"+(n=(Qr&~(1<<32-ot(Qr)-1)).toString(32)+n),0<(n=_o++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=wo++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},la={readContext:ks,useCallback:Qo,useContext:ks,useEffect:qo,useImperativeHandle:Ko,useInsertionEffect:Go,useLayoutEffect:Wo,useMemo:Yo,useReducer:Po,useRef:Vo,useState:function(){return Po(Ro)},useDebugValue:Jo,useDeferredValue:function(e){return Zo(Io(),go.memoizedState,e)},useTransition:function(){return[Po(Ro)[0],Io().memoizedState]},useMutableSource:No,useSyncExternalStore:xo,useId:ea,unstable_isNewReconciler:!1},ca={readContext:ks,useCallback:Qo,useContext:ks,useEffect:qo,useImperativeHandle:Ko,useInsertionEffect:Go,useLayoutEffect:Wo,useMemo:Yo,useReducer:Ao,useRef:Vo,useState:function(){return Ao(Ro)},useDebugValue:Jo,useDeferredValue:function(e){var t=Io();return null===go?t.memoizedState=e:Zo(t,go.memoizedState,e)},useTransition:function(){return[Ao(Ro)[0],Io().memoizedState]},useMutableSource:No,useSyncExternalStore:xo,useId:ea,unstable_isNewReconciler:!1};function ua(e,t){try{var n="",i=t;do{n+=B(i),i=i.return}while(i);var r=n}catch(e){r="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:r,digest:null}}function da(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ha(e,t){try{console.error(t.value)}catch(e){setTimeout((function(){throw e}))}}var pa="function"==typeof WeakMap?WeakMap:Map;function fa(e,t,n){(n=Ds(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){Gl||(Gl=!0,Wl=i),ha(0,t)},n}function ma(e,t,n){(n=Ds(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"==typeof i){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){ha(0,t)}}var s=e.stateNode;return null!==s&&"function"==typeof s.componentDidCatch&&(n.callback=function(){ha(0,t),"function"!=typeof i&&(null===Hl?Hl=new Set([this]):Hl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ga(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new pa;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=Cc.bind(null,e,t,n),t.then(e,e))}function va(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function ya(e,t,n,i,r){return 0==(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Ds(-1,1)).tag=2,Os(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var ba=_.ReactCurrentOwner,_a=!1;function wa(e,t,n,i){t.child=null===e?Ys(t,null,n,i):Qs(t,e.child,n,i)}function Sa(e,t,n,i,r){n=n.render;var s=t.ref;return Es(t,r),i=Eo(e,t,n,i,s,r),n=ko(),null===e||_a?(rs&&n&&es(t),t.flags|=1,wa(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Ga(e,t,r))}function Ta(e,t,n,i,r){if(null===e){var s=n.type;return"function"!=typeof s||Dc(s)||void 0!==s.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Lc(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,Ea(e,t,s,i,r))}if(s=e.child,0==(e.lanes&r)){var o=s.memoizedProps;if((n=null!==(n=n.compare)?n:li)(o,i)&&e.ref===t.ref)return Ga(e,t,r)}return t.flags|=1,(e=Oc(s,i)).ref=t.ref,e.return=t,t.child=e}function Ea(e,t,n,i,r){if(null!==e){var s=e.memoizedProps;if(li(s,i)&&e.ref===t.ref){if(_a=!1,t.pendingProps=i=s,0==(e.lanes&r))return t.lanes=e.lanes,Ga(e,t,r);0!=(131072&e.flags)&&(_a=!0)}}return Ia(e,t,n,i,r)}function ka(e,t,n){var i=t.pendingProps,r=i.children,s=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0==(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Cr(Ol,Dl),Dl|=n;else{if(0==(1073741824&n))return e=null!==s?s.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Cr(Ol,Dl),Dl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==s?s.baseLanes:n,Cr(Ol,Dl),Dl|=i}else null!==s?(i=s.baseLanes|n,t.memoizedState=null):i=n,Cr(Ol,Dl),Dl|=i;return wa(e,t,r,n),t.child}function Ca(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ia(e,t,n,i,r){var s=xr(n)?Ar:Rr.current;return s=Nr(t,s),Es(t,r),n=Eo(e,t,n,i,s,r),i=ko(),null===e||_a?(rs&&i&&es(t),t.flags|=1,wa(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Ga(e,t,r))}function Ra(e,t,n,i,r){if(xr(n)){var s=!0;Mr(t)}else s=!1;if(Es(t,r),null===t.stateNode)qa(e,t),$s(t,n,i),Gs(t,n,i,r),i=!0;else if(null===e){var o=t.stateNode,a=t.memoizedProps;o.props=a;var l=o.context,c=n.contextType;"object"==typeof c&&null!==c?c=ks(c):c=Nr(t,c=xr(n)?Ar:Rr.current);var u=n.getDerivedStateFromProps,d="function"==typeof u||"function"==typeof o.getSnapshotBeforeUpdate;d||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(a!==i||l!==c)&&qs(t,o,i,c),As=!1;var h=t.memoizedState;o.state=h,js(t,i,o,r),l=t.memoizedState,a!==i||h!==l||Pr.current||As?("function"==typeof u&&(Vs(t,n,u,i),l=t.memoizedState),(a=As||zs(t,n,a,i,h,l,c))?(d||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||("function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"==typeof o.componentDidMount&&(t.flags|=4194308)):("function"==typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):("function"==typeof o.componentDidMount&&(t.flags|=4194308),i=!1)}else{o=t.stateNode,xs(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:gs(t.type,a),o.props=c,d=t.pendingProps,h=o.context,"object"==typeof(l=n.contextType)&&null!==l?l=ks(l):l=Nr(t,l=xr(n)?Ar:Rr.current);var p=n.getDerivedStateFromProps;(u="function"==typeof p||"function"==typeof o.getSnapshotBeforeUpdate)||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(a!==d||h!==l)&&qs(t,o,i,l),As=!1,h=t.memoizedState,o.state=h,js(t,i,o,r);var f=t.memoizedState;a!==d||h!==f||Pr.current||As?("function"==typeof p&&(Vs(t,n,p,i),f=t.memoizedState),(c=As||zs(t,n,c,i,h,f,l)||!1)?(u||"function"!=typeof o.UNSAFE_componentWillUpdate&&"function"!=typeof o.componentWillUpdate||("function"==typeof o.componentWillUpdate&&o.componentWillUpdate(i,f,l),"function"==typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,f,l)),"function"==typeof o.componentDidUpdate&&(t.flags|=4),"function"==typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof o.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=f),o.props=i,o.state=f,o.context=l,i=c):("function"!=typeof o.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),i=!1)}return Pa(e,t,n,i,s,r)}function Pa(e,t,n,i,r,s){Ca(e,t);var o=0!=(128&t.flags);if(!i&&!o)return r&&jr(t,n,!1),Ga(e,t,s);i=t.stateNode,ba.current=t;var a=o&&"function"!=typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&o?(t.child=Qs(t,e.child,null,s),t.child=Qs(t,null,a,s)):wa(e,t,a,s),t.memoizedState=i.state,r&&jr(t,n,!0),t.child}function Aa(e){var t=e.stateNode;t.pendingContext?Or(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Or(0,t.context,!1),io(e,t.containerInfo)}function Na(e,t,n,i,r){return ps(),fs(r),t.flags|=256,wa(e,t,n,i),t.child}var xa,Da,Oa,La,Ma={dehydrated:null,treeContext:null,retryLane:0};function ja(e){return{baseLanes:e,cachePool:null,transitions:null}}function Ua(e,t,n){var i,r=t.pendingProps,o=ao.current,a=!1,l=0!=(128&t.flags);if((i=l)||(i=(null===e||null!==e.memoizedState)&&0!=(2&o)),i?(a=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Cr(ao,1&o),null===e)return cs(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0==(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=r.children,e=r.fallback,a?(r=t.mode,a=t.child,l={mode:"hidden",children:l},0==(1&r)&&null!==a?(a.childLanes=0,a.pendingProps=l):a=jc(l,r,0,null),e=Mc(e,r,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=ja(n),t.memoizedState=Ma,e):Fa(t,l));if(null!==(o=e.memoizedState)&&null!==(i=o.dehydrated))return function(e,t,n,i,r,o,a){if(n)return 256&t.flags?(t.flags&=-257,Va(e,t,a,i=da(Error(s(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=i.fallback,r=t.mode,i=jc({mode:"visible",children:i.children},r,0,null),(o=Mc(o,r,a,null)).flags|=2,i.return=t,o.return=t,i.sibling=o,t.child=i,0!=(1&t.mode)&&Qs(t,e.child,null,a),t.child.memoizedState=ja(a),t.memoizedState=Ma,o);if(0==(1&t.mode))return Va(e,t,a,null);if("$!"===r.data){if(i=r.nextSibling&&r.nextSibling.dataset)var l=i.dgst;return i=l,Va(e,t,a,i=da(o=Error(s(419)),i,void 0))}if(l=0!=(a&e.childLanes),_a||l){if(null!==(i=Al)){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!=(r&(i.suspendedLanes|a))?0:r)&&r!==o.retryLane&&(o.retryLane=r,Ps(e,r),ic(i,e,r,-1))}return gc(),Va(e,t,a,i=da(Error(s(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=Rc.bind(null,e),r._reactRetry=t,null):(e=o.treeContext,is=cr(r.nextSibling),ns=t,rs=!0,ss=null,null!==e&&(Hr[Kr++]=Qr,Hr[Kr++]=Yr,Hr[Kr++]=Jr,Qr=e.id,Yr=e.overflow,Jr=t),t=Fa(t,i.children),t.flags|=4096,t)}(e,t,l,r,i,o,n);if(a){a=r.fallback,l=t.mode,i=(o=e.child).sibling;var c={mode:"hidden",children:r.children};return 0==(1&l)&&t.child!==o?((r=t.child).childLanes=0,r.pendingProps=c,t.deletions=null):(r=Oc(o,c)).subtreeFlags=14680064&o.subtreeFlags,null!==i?a=Oc(i,a):(a=Mc(a,l,n,null)).flags|=2,a.return=t,r.return=t,r.sibling=a,t.child=r,r=a,a=t.child,l=null===(l=e.child.memoizedState)?ja(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},a.memoizedState=l,a.childLanes=e.childLanes&~n,t.memoizedState=Ma,r}return e=(a=e.child).sibling,r=Oc(a,{mode:"visible",children:r.children}),0==(1&t.mode)&&(r.lanes=n),r.return=t,r.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Fa(e,t){return(t=jc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Va(e,t,n,i){return null!==i&&fs(i),Qs(t,e.child,null,n),(e=Fa(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Ba(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),Ts(e.return,t,n)}function za(e,t,n,i,r){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function $a(e,t,n){var i=t.pendingProps,r=i.revealOrder,s=i.tail;if(wa(e,t,i.children,n),0!=(2&(i=ao.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!=(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Ba(e,n,t);else if(19===e.tag)Ba(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(Cr(ao,i),0==(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===lo(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),za(t,!1,r,n,s);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===lo(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}za(t,!0,n,null,s);break;case"together":za(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function qa(e,t){0==(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ga(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),jl|=t.lanes,0==(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=Oc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Oc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Wa(e,t){if(!rs)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Ha(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Ka(e,t,n){var i=t.pendingProps;switch(ts(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ha(t),null;case 1:case 17:return xr(t.type)&&Dr(),Ha(t),null;case 3:return i=t.stateNode,ro(),kr(Pr),kr(Rr),uo(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(ds(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0==(256&t.flags)||(t.flags|=1024,null!==ss&&(ac(ss),ss=null))),Da(e,t),Ha(t),null;case 5:oo(t);var r=no(to.current);if(n=t.type,null!==e&&null!=t.stateNode)Oa(e,t,n,i,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(s(166));return Ha(t),null}if(e=no(Xs.current),ds(t)){i=t.stateNode,n=t.type;var o=t.memoizedProps;switch(i[hr]=t,i[pr]=o,e=0!=(1&t.mode),n){case"dialog":Fi("cancel",i),Fi("close",i);break;case"iframe":case"object":case"embed":Fi("load",i);break;case"video":case"audio":for(r=0;r<Li.length;r++)Fi(Li[r],i);break;case"source":Fi("error",i);break;case"img":case"image":case"link":Fi("error",i),Fi("load",i);break;case"details":Fi("toggle",i);break;case"input":Q(i,o),Fi("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!o.multiple},Fi("invalid",i);break;case"textarea":re(i,o),Fi("invalid",i)}for(var l in ye(n,o),r=null,o)if(o.hasOwnProperty(l)){var c=o[l];"children"===l?"string"==typeof c?i.textContent!==c&&(!0!==o.suppressHydrationWarning&&Zi(i.textContent,c,e),r=["children",c]):"number"==typeof c&&i.textContent!==""+c&&(!0!==o.suppressHydrationWarning&&Zi(i.textContent,c,e),r=["children",""+c]):a.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Fi("scroll",i)}switch(n){case"input":W(i),X(i,o,!0);break;case"textarea":W(i),oe(i);break;case"select":case"option":break;default:"function"==typeof o.onClick&&(i.onclick=Xi)}i=r,t.updateQueue=i,null!==i&&(t.flags|=4)}else{l=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ae(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof i.is?e=l.createElement(n,{is:i.is}):(e=l.createElement(n),"select"===n&&(l=e,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):e=l.createElementNS(e,n),e[hr]=t,e[pr]=i,xa(e,t,!1,!1),t.stateNode=e;e:{switch(l=be(n,i),n){case"dialog":Fi("cancel",e),Fi("close",e),r=i;break;case"iframe":case"object":case"embed":Fi("load",e),r=i;break;case"video":case"audio":for(r=0;r<Li.length;r++)Fi(Li[r],e);r=i;break;case"source":Fi("error",e),r=i;break;case"img":case"image":case"link":Fi("error",e),Fi("load",e),r=i;break;case"details":Fi("toggle",e),r=i;break;case"input":Q(e,i),r=J(e,i),Fi("invalid",e);break;case"option":default:r=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},r=j({},i,{value:void 0}),Fi("invalid",e);break;case"textarea":re(e,i),r=ie(e,i),Fi("invalid",e)}for(o in ye(n,r),c=r)if(c.hasOwnProperty(o)){var u=c[o];"style"===o?ge(e,u):"dangerouslySetInnerHTML"===o?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===o?"string"==typeof u?("textarea"!==n||""!==u)&&he(e,u):"number"==typeof u&&he(e,""+u):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(a.hasOwnProperty(o)?null!=u&&"onScroll"===o&&Fi("scroll",e):null!=u&&b(e,o,u,l))}switch(n){case"input":W(e),X(e,i,!1);break;case"textarea":W(e),oe(e);break;case"option":null!=i.value&&e.setAttribute("value",""+q(i.value));break;case"select":e.multiple=!!i.multiple,null!=(o=i.value)?ne(e,!!i.multiple,o,!1):null!=i.defaultValue&&ne(e,!!i.multiple,i.defaultValue,!0);break;default:"function"==typeof r.onClick&&(e.onclick=Xi)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ha(t),null;case 6:if(e&&null!=t.stateNode)La(e,t,e.memoizedProps,i);else{if("string"!=typeof i&&null===t.stateNode)throw Error(s(166));if(n=no(to.current),no(Xs.current),ds(t)){if(i=t.stateNode,n=t.memoizedProps,i[hr]=t,(o=i.nodeValue!==n)&&null!==(e=ns))switch(e.tag){case 3:Zi(i.nodeValue,n,0!=(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Zi(i.nodeValue,n,0!=(1&e.mode))}o&&(t.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[hr]=t,t.stateNode=i}return Ha(t),null;case 13:if(kr(ao),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(rs&&null!==is&&0!=(1&t.mode)&&0==(128&t.flags))hs(),ps(),t.flags|=98560,o=!1;else if(o=ds(t),null!==i&&null!==i.dehydrated){if(null===e){if(!o)throw Error(s(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(s(317));o[hr]=t}else ps(),0==(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Ha(t),o=!1}else null!==ss&&(ac(ss),ss=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!=(128&t.flags)?(t.lanes=n,t):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,0!=(1&t.mode)&&(null===e||0!=(1&ao.current)?0===Ll&&(Ll=3):gc())),null!==t.updateQueue&&(t.flags|=4),Ha(t),null);case 4:return ro(),Da(e,t),null===e&&zi(t.stateNode.containerInfo),Ha(t),null;case 10:return Ss(t.type._context),Ha(t),null;case 19:if(kr(ao),null===(o=t.memoizedState))return Ha(t),null;if(i=0!=(128&t.flags),null===(l=o.rendering))if(i)Wa(o,!1);else{if(0!==Ll||null!==e&&0!=(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=lo(e))){for(t.flags|=128,Wa(o,!1),null!==(i=l.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;null!==n;)e=i,(o=n).flags&=14680066,null===(l=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Cr(ao,1&ao.current|2),t.child}e=e.sibling}null!==o.tail&&Ye()>$l&&(t.flags|=128,i=!0,Wa(o,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=lo(l))){if(t.flags|=128,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Wa(o,!0),null===o.tail&&"hidden"===o.tailMode&&!l.alternate&&!rs)return Ha(t),null}else 2*Ye()-o.renderingStartTime>$l&&1073741824!==n&&(t.flags|=128,i=!0,Wa(o,!1),t.lanes=4194304);o.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=o.last)?n.sibling=l:t.child=l,o.last=l)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Ye(),t.sibling=null,n=ao.current,Cr(ao,i?1&n|2:1&n),t):(Ha(t),null);case 22:case 23:return hc(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!=(1&t.mode)?0!=(1073741824&Dl)&&(Ha(t),6&t.subtreeFlags&&(t.flags|=8192)):Ha(t),null;case 24:case 25:return null}throw Error(s(156,t.tag))}function Ja(e,t){switch(ts(t),t.tag){case 1:return xr(t.type)&&Dr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ro(),kr(Pr),kr(Rr),uo(),0!=(65536&(e=t.flags))&&0==(128&e)?(t.flags=-65537&e|128,t):null;case 5:return oo(t),null;case 13:if(kr(ao),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));ps()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return kr(ao),null;case 4:return ro(),null;case 10:return Ss(t.type._context),null;case 22:case 23:return hc(),null;default:return null}}xa=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Da=function(){},Oa=function(e,t,n,i){var r=e.memoizedProps;if(r!==i){e=t.stateNode,no(Xs.current);var s,o=null;switch(n){case"input":r=J(e,r),i=J(e,i),o=[];break;case"select":r=j({},r,{value:void 0}),i=j({},i,{value:void 0}),o=[];break;case"textarea":r=ie(e,r),i=ie(e,i),o=[];break;default:"function"!=typeof r.onClick&&"function"==typeof i.onClick&&(e.onclick=Xi)}for(u in ye(n,i),n=null,r)if(!i.hasOwnProperty(u)&&r.hasOwnProperty(u)&&null!=r[u])if("style"===u){var l=r[u];for(s in l)l.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(a.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in i){var c=i[u];if(l=null!=r?r[u]:void 0,i.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(n||(n={}),n[s]=c[s])}else n||(o||(o=[]),o.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(o=o||[]).push(u,c)):"children"===u?"string"!=typeof c&&"number"!=typeof c||(o=o||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(a.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Fi("scroll",e),o||l===c||(o=[])):(o=o||[]).push(u,c))}n&&(o=o||[]).push("style",n);var u=o;(t.updateQueue=u)&&(t.flags|=4)}},La=function(e,t,n,i){n!==i&&(t.flags|=4)};var Qa=!1,Ya=!1,Za="function"==typeof WeakSet?WeakSet:Set,Xa=null;function el(e,t){var n=e.ref;if(null!==n)if("function"==typeof n)try{n(null)}catch(n){kc(e,t,n)}else n.current=null}function tl(e,t,n){try{n()}catch(n){kc(e,t,n)}}var nl=!1;function il(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var s=r.destroy;r.destroy=void 0,void 0!==s&&tl(t,n,s)}r=r.next}while(r!==i)}}function rl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function sl(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"==typeof t?t(e):t.current=e}}function ol(e){var t=e.alternate;null!==t&&(e.alternate=null,ol(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hr],delete t[pr],delete t[mr],delete t[gr],delete t[vr])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function al(e){return 5===e.tag||3===e.tag||4===e.tag}function ll(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||al(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cl(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=Xi));else if(4!==i&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}function ul(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(ul(e,t,n),e=e.sibling;null!==e;)ul(e,t,n),e=e.sibling}var dl=null,hl=!1;function pl(e,t,n){for(n=n.child;null!==n;)fl(e,t,n),n=n.sibling}function fl(e,t,n){if(st&&"function"==typeof st.onCommitFiberUnmount)try{st.onCommitFiberUnmount(rt,n)}catch(e){}switch(n.tag){case 5:Ya||el(n,t);case 6:var i=dl,r=hl;dl=null,pl(e,t,n),hl=r,null!==(dl=i)&&(hl?(e=dl,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):dl.removeChild(n.stateNode));break;case 18:null!==dl&&(hl?(e=dl,n=n.stateNode,8===e.nodeType?lr(e.parentNode,n):1===e.nodeType&&lr(e,n),zt(e)):lr(dl,n.stateNode));break;case 4:i=dl,r=hl,dl=n.stateNode.containerInfo,hl=!0,pl(e,t,n),dl=i,hl=r;break;case 0:case 11:case 14:case 15:if(!Ya&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,void 0!==o&&(0!=(2&s)||0!=(4&s))&&tl(n,t,o),r=r.next}while(r!==i)}pl(e,t,n);break;case 1:if(!Ya&&(el(n,t),"function"==typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(e){kc(n,t,e)}pl(e,t,n);break;case 21:pl(e,t,n);break;case 22:1&n.mode?(Ya=(i=Ya)||null!==n.memoizedState,pl(e,t,n),Ya=i):pl(e,t,n);break;default:pl(e,t,n)}}function ml(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Za),t.forEach((function(t){var i=Pc.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))}))}}function gl(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var o=e,a=t,l=a;e:for(;null!==l;){switch(l.tag){case 5:dl=l.stateNode,hl=!1;break e;case 3:case 4:dl=l.stateNode.containerInfo,hl=!0;break e}l=l.return}if(null===dl)throw Error(s(160));fl(o,a,r),dl=null,hl=!1;var c=r.alternate;null!==c&&(c.return=null),r.return=null}catch(e){kc(r,t,e)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)vl(t,e),t=t.sibling}function vl(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(gl(t,e),yl(e),4&i){try{il(3,e,e.return),rl(3,e)}catch(t){kc(e,e.return,t)}try{il(5,e,e.return)}catch(t){kc(e,e.return,t)}}break;case 1:gl(t,e),yl(e),512&i&&null!==n&&el(n,n.return);break;case 5:if(gl(t,e),yl(e),512&i&&null!==n&&el(n,n.return),32&e.flags){var r=e.stateNode;try{he(r,"")}catch(t){kc(e,e.return,t)}}if(4&i&&null!=(r=e.stateNode)){var o=e.memoizedProps,a=null!==n?n.memoizedProps:o,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===o.type&&null!=o.name&&Y(r,o),be(l,a);var u=be(l,o);for(a=0;a<c.length;a+=2){var d=c[a],h=c[a+1];"style"===d?ge(r,h):"dangerouslySetInnerHTML"===d?de(r,h):"children"===d?he(r,h):b(r,d,h,u)}switch(l){case"input":Z(r,o);break;case"textarea":se(r,o);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var f=o.value;null!=f?ne(r,!!o.multiple,f,!1):p!==!!o.multiple&&(null!=o.defaultValue?ne(r,!!o.multiple,o.defaultValue,!0):ne(r,!!o.multiple,o.multiple?[]:"",!1))}r[pr]=o}catch(t){kc(e,e.return,t)}}break;case 6:if(gl(t,e),yl(e),4&i){if(null===e.stateNode)throw Error(s(162));r=e.stateNode,o=e.memoizedProps;try{r.nodeValue=o}catch(t){kc(e,e.return,t)}}break;case 3:if(gl(t,e),yl(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{zt(t.containerInfo)}catch(t){kc(e,e.return,t)}break;case 4:default:gl(t,e),yl(e);break;case 13:gl(t,e),yl(e),8192&(r=e.child).flags&&(o=null!==r.memoizedState,r.stateNode.isHidden=o,!o||null!==r.alternate&&null!==r.alternate.memoizedState||(zl=Ye())),4&i&&ml(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(Ya=(u=Ya)||d,gl(t,e),Ya=u):gl(t,e),yl(e),8192&i){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&0!=(1&e.mode))for(Xa=e,d=e.child;null!==d;){for(h=Xa=d;null!==Xa;){switch(f=(p=Xa).child,p.tag){case 0:case 11:case 14:case 15:il(4,p,p.return);break;case 1:el(p,p.return);var m=p.stateNode;if("function"==typeof m.componentWillUnmount){i=p,n=p.return;try{t=i,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(e){kc(i,n,e)}}break;case 5:el(p,p.return);break;case 22:if(null!==p.memoizedState){Sl(h);continue}}null!==f?(f.return=p,Xa=f):Sl(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{r=h.stateNode,u?"function"==typeof(o=r.style).setProperty?o.setProperty("display","none","important"):o.display="none":(l=h.stateNode,a=null!=(c=h.memoizedProps.style)&&c.hasOwnProperty("display")?c.display:null,l.style.display=me("display",a))}catch(t){kc(e,e.return,t)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(t){kc(e,e.return,t)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:gl(t,e),yl(e),4&i&&ml(e);case 21:}}function yl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(al(n)){var i=n;break e}n=n.return}throw Error(s(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(he(r,""),i.flags&=-33),ul(e,ll(e),r);break;case 3:case 4:var o=i.stateNode.containerInfo;cl(e,ll(e),o);break;default:throw Error(s(161))}}catch(t){kc(e,e.return,t)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function bl(e,t,n){Xa=e,_l(e,t,n)}function _l(e,t,n){for(var i=0!=(1&e.mode);null!==Xa;){var r=Xa,s=r.child;if(22===r.tag&&i){var o=null!==r.memoizedState||Qa;if(!o){var a=r.alternate,l=null!==a&&null!==a.memoizedState||Ya;a=Qa;var c=Ya;if(Qa=o,(Ya=l)&&!c)for(Xa=r;null!==Xa;)l=(o=Xa).child,22===o.tag&&null!==o.memoizedState?Tl(r):null!==l?(l.return=o,Xa=l):Tl(r);for(;null!==s;)Xa=s,_l(s,t,n),s=s.sibling;Xa=r,Qa=a,Ya=c}wl(e)}else 0!=(8772&r.subtreeFlags)&&null!==s?(s.return=r,Xa=s):wl(e)}}function wl(e){for(;null!==Xa;){var t=Xa;if(0!=(8772&t.flags)){var n=t.alternate;try{if(0!=(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Ya||rl(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!Ya)if(null===n)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:gs(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&Us(t,o,i);break;case 3:var a=t.updateQueue;if(null!==a){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Us(t,a,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&zt(h)}}}break;default:throw Error(s(163))}Ya||512&t.flags&&sl(t)}catch(e){kc(t,t.return,e)}}if(t===e){Xa=null;break}if(null!==(n=t.sibling)){n.return=t.return,Xa=n;break}Xa=t.return}}function Sl(e){for(;null!==Xa;){var t=Xa;if(t===e){Xa=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Xa=n;break}Xa=t.return}}function Tl(e){for(;null!==Xa;){var t=Xa;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rl(4,t)}catch(e){kc(t,n,e)}break;case 1:var i=t.stateNode;if("function"==typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(e){kc(t,r,e)}}var s=t.return;try{sl(t)}catch(e){kc(t,s,e)}break;case 5:var o=t.return;try{sl(t)}catch(e){kc(t,o,e)}}}catch(e){kc(t,t.return,e)}if(t===e){Xa=null;break}var a=t.sibling;if(null!==a){a.return=t.return,Xa=a;break}Xa=t.return}}var El,kl=Math.ceil,Cl=_.ReactCurrentDispatcher,Il=_.ReactCurrentOwner,Rl=_.ReactCurrentBatchConfig,Pl=0,Al=null,Nl=null,xl=0,Dl=0,Ol=Er(0),Ll=0,Ml=null,jl=0,Ul=0,Fl=0,Vl=null,Bl=null,zl=0,$l=1/0,ql=null,Gl=!1,Wl=null,Hl=null,Kl=!1,Jl=null,Ql=0,Yl=0,Zl=null,Xl=-1,ec=0;function tc(){return 0!=(6&Pl)?Ye():-1!==Xl?Xl:Xl=Ye()}function nc(e){return 0==(1&e.mode)?1:0!=(2&Pl)&&0!==xl?xl&-xl:null!==ms.transition?(0===ec&&(ec=mt()),ec):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Qt(e.type)}function ic(e,t,n,i){if(50<Yl)throw Yl=0,Zl=null,Error(s(185));vt(e,n,i),0!=(2&Pl)&&e===Al||(e===Al&&(0==(2&Pl)&&(Ul|=n),4===Ll&&lc(e,xl)),rc(e,i),1===n&&0===Pl&&0==(1&t.mode)&&($l=Ye()+500,Fr&&zr()))}function rc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,s=e.pendingLanes;0<s;){var o=31-ot(s),a=1<<o,l=r[o];-1===l?0!=(a&n)&&0==(a&i)||(r[o]=pt(a,t)):l<=t&&(e.expiredLanes|=a),s&=~a}}(e,t);var i=ht(e,e===Al?xl:0);if(0===i)null!==n&&Ke(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&Ke(n),1===t)0===e.tag?function(e){Fr=!0,Br(e)}(cc.bind(null,e)):Br(cc.bind(null,e)),or((function(){0==(6&Pl)&&zr()})),n=null;else{switch(_t(i)){case 1:n=Xe;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=it}n=Ac(n,sc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function sc(e,t){if(Xl=-1,ec=0,0!=(6&Pl))throw Error(s(327));var n=e.callbackNode;if(Tc()&&e.callbackNode!==n)return null;var i=ht(e,e===Al?xl:0);if(0===i)return null;if(0!=(30&i)||0!=(i&e.expiredLanes)||t)t=vc(e,i);else{t=i;var r=Pl;Pl|=2;var o=mc();for(Al===e&&xl===t||(ql=null,$l=Ye()+500,pc(e,t));;)try{bc();break}catch(t){fc(e,t)}ws(),Cl.current=o,Pl=r,null!==Nl?t=0:(Al=null,xl=0,t=Ll)}if(0!==t){if(2===t&&(0!==(r=ft(e))&&(i=r,t=oc(e,r))),1===t)throw n=Ml,pc(e,0),lc(e,i),rc(e,Ye()),n;if(6===t)lc(e,i);else{if(r=e.current.alternate,0==(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!ai(s(),r))return!1}catch(e){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=vc(e,i))&&(0!==(o=ft(e))&&(i=o,t=oc(e,o))),1===t))throw n=Ml,pc(e,0),lc(e,i),rc(e,Ye()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error(s(345));case 2:case 5:Sc(e,Bl,ql);break;case 3:if(lc(e,i),(130023424&i)===i&&10<(t=zl+500-Ye())){if(0!==ht(e,0))break;if(((r=e.suspendedLanes)&i)!==i){tc(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=ir(Sc.bind(null,e,Bl,ql),t);break}Sc(e,Bl,ql);break;case 4:if(lc(e,i),(4194240&i)===i)break;for(t=e.eventTimes,r=-1;0<i;){var a=31-ot(i);o=1<<a,(a=t[a])>r&&(r=a),i&=~o}if(i=r,10<(i=(120>(i=Ye()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*kl(i/1960))-i)){e.timeoutHandle=ir(Sc.bind(null,e,Bl,ql),i);break}Sc(e,Bl,ql);break;default:throw Error(s(329))}}}return rc(e,Ye()),e.callbackNode===n?sc.bind(null,e):null}function oc(e,t){var n=Vl;return e.current.memoizedState.isDehydrated&&(pc(e,t).flags|=256),2!==(e=vc(e,t))&&(t=Bl,Bl=n,null!==t&&ac(t)),e}function ac(e){null===Bl?Bl=e:Bl.push.apply(Bl,e)}function lc(e,t){for(t&=~Fl,t&=~Ul,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ot(t),i=1<<n;e[n]=-1,t&=~i}}function cc(e){if(0!=(6&Pl))throw Error(s(327));Tc();var t=ht(e,0);if(0==(1&t))return rc(e,Ye()),null;var n=vc(e,t);if(0!==e.tag&&2===n){var i=ft(e);0!==i&&(t=i,n=oc(e,i))}if(1===n)throw n=Ml,pc(e,0),lc(e,t),rc(e,Ye()),n;if(6===n)throw Error(s(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Sc(e,Bl,ql),rc(e,Ye()),null}function uc(e,t){var n=Pl;Pl|=1;try{return e(t)}finally{0===(Pl=n)&&($l=Ye()+500,Fr&&zr())}}function dc(e){null!==Jl&&0===Jl.tag&&0==(6&Pl)&&Tc();var t=Pl;Pl|=1;var n=Rl.transition,i=bt;try{if(Rl.transition=null,bt=1,e)return e()}finally{bt=i,Rl.transition=n,0==(6&(Pl=t))&&zr()}}function hc(){Dl=Ol.current,kr(Ol)}function pc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,rr(n)),null!==Nl)for(n=Nl.return;null!==n;){var i=n;switch(ts(i),i.tag){case 1:null!=(i=i.type.childContextTypes)&&Dr();break;case 3:ro(),kr(Pr),kr(Rr),uo();break;case 5:oo(i);break;case 4:ro();break;case 13:case 19:kr(ao);break;case 10:Ss(i.type._context);break;case 22:case 23:hc()}n=n.return}if(Al=e,Nl=e=Oc(e.current,null),xl=Dl=t,Ll=0,Ml=null,Fl=Ul=jl=0,Bl=Vl=null,null!==Cs){for(t=0;t<Cs.length;t++)if(null!==(i=(n=Cs[t]).interleaved)){n.interleaved=null;var r=i.next,s=n.pending;if(null!==s){var o=s.next;s.next=r,i.next=o}n.pending=i}Cs=null}return e}function fc(e,t){for(;;){var n=Nl;try{if(ws(),ho.current=oa,yo){for(var i=mo.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}yo=!1}if(fo=0,vo=go=mo=null,bo=!1,_o=0,Il.current=null,null===n||null===n.return){Ll=1,Ml=t,Nl=null;break}e:{var o=e,a=n.return,l=n,c=t;if(t=xl,l.flags|=32768,null!==c&&"object"==typeof c&&"function"==typeof c.then){var u=c,d=l,h=d.tag;if(0==(1&d.mode)&&(0===h||11===h||15===h)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var f=va(a);if(null!==f){f.flags&=-257,ya(f,a,l,0,t),1&f.mode&&ga(o,u,t),c=u;var m=(t=f).updateQueue;if(null===m){var g=new Set;g.add(c),t.updateQueue=g}else m.add(c);break e}if(0==(1&t)){ga(o,u,t),gc();break e}c=Error(s(426))}else if(rs&&1&l.mode){var v=va(a);if(null!==v){0==(65536&v.flags)&&(v.flags|=256),ya(v,a,l,0,t),fs(ua(c,l));break e}}o=c=ua(c,l),4!==Ll&&(Ll=2),null===Vl?Vl=[o]:Vl.push(o),o=a;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Ms(o,fa(0,c,t));break e;case 1:l=c;var y=o.type,b=o.stateNode;if(0==(128&o.flags)&&("function"==typeof y.getDerivedStateFromError||null!==b&&"function"==typeof b.componentDidCatch&&(null===Hl||!Hl.has(b)))){o.flags|=65536,t&=-t,o.lanes|=t,Ms(o,ma(o,l,t));break e}}o=o.return}while(null!==o)}wc(n)}catch(e){t=e,Nl===n&&null!==n&&(Nl=n=n.return);continue}break}}function mc(){var e=Cl.current;return Cl.current=oa,null===e?oa:e}function gc(){0!==Ll&&3!==Ll&&2!==Ll||(Ll=4),null===Al||0==(268435455&jl)&&0==(268435455&Ul)||lc(Al,xl)}function vc(e,t){var n=Pl;Pl|=2;var i=mc();for(Al===e&&xl===t||(ql=null,pc(e,t));;)try{yc();break}catch(t){fc(e,t)}if(ws(),Pl=n,Cl.current=i,null!==Nl)throw Error(s(261));return Al=null,xl=0,Ll}function yc(){for(;null!==Nl;)_c(Nl)}function bc(){for(;null!==Nl&&!Je();)_c(Nl)}function _c(e){var t=El(e.alternate,e,Dl);e.memoizedProps=e.pendingProps,null===t?wc(e):Nl=t,Il.current=null}function wc(e){var t=e;do{var n=t.alternate;if(e=t.return,0==(32768&t.flags)){if(null!==(n=Ka(n,t,Dl)))return void(Nl=n)}else{if(null!==(n=Ja(n,t)))return n.flags&=32767,void(Nl=n);if(null===e)return Ll=6,void(Nl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Nl=t);Nl=t=e}while(null!==t);0===Ll&&(Ll=5)}function Sc(e,t,n){var i=bt,r=Rl.transition;try{Rl.transition=null,bt=1,function(e,t,n,i){do{Tc()}while(null!==Jl);if(0!=(6&Pl))throw Error(s(327));n=e.finishedWork;var r=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(s(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-ot(n),s=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~s}}(e,o),e===Al&&(Nl=Al=null,xl=0),0==(2064&n.subtreeFlags)&&0==(2064&n.flags)||Kl||(Kl=!0,Ac(tt,(function(){return Tc(),null}))),o=0!=(15990&n.flags),0!=(15990&n.subtreeFlags)||o){o=Rl.transition,Rl.transition=null;var a=bt;bt=1;var l=Pl;Pl|=4,Il.current=null,function(e,t){if(er=qt,pi(e=hi())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{n.nodeType,o.nodeType}catch(e){n=null;break e}var a=0,l=-1,c=-1,u=0,d=0,h=e,p=null;t:for(;;){for(var f;h!==n||0!==r&&3!==h.nodeType||(l=a+r),h!==o||0!==i&&3!==h.nodeType||(c=a+i),3===h.nodeType&&(a+=h.nodeValue.length),null!==(f=h.firstChild);)p=h,h=f;for(;;){if(h===e)break t;if(p===n&&++u===r&&(l=a),p===o&&++d===i&&(c=a),null!==(f=h.nextSibling))break;p=(h=p).parentNode}h=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(tr={focusedElem:e,selectionRange:n},qt=!1,Xa=t;null!==Xa;)if(e=(t=Xa).child,0!=(1028&t.subtreeFlags)&&null!==e)e.return=t,Xa=e;else for(;null!==Xa;){t=Xa;try{var m=t.alternate;if(0!=(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,v=m.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:gs(t.type,g),v);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var _=t.stateNode.containerInfo;1===_.nodeType?_.textContent="":9===_.nodeType&&_.documentElement&&_.removeChild(_.documentElement);break;default:throw Error(s(163))}}catch(e){kc(t,t.return,e)}if(null!==(e=t.sibling)){e.return=t.return,Xa=e;break}Xa=t.return}m=nl,nl=!1}(e,n),vl(n,e),fi(tr),qt=!!er,tr=er=null,e.current=n,bl(n,e,r),Qe(),Pl=l,bt=a,Rl.transition=o}else e.current=n;if(Kl&&(Kl=!1,Jl=e,Ql=r),o=e.pendingLanes,0===o&&(Hl=null),function(e){if(st&&"function"==typeof st.onCommitFiberRoot)try{st.onCommitFiberRoot(rt,e,void 0,128==(128&e.current.flags))}catch(e){}}(n.stateNode),rc(e,Ye()),null!==t)for(i=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(Gl)throw Gl=!1,e=Wl,Wl=null,e;0!=(1&Ql)&&0!==e.tag&&Tc(),o=e.pendingLanes,0!=(1&o)?e===Zl?Yl++:(Yl=0,Zl=e):Yl=0,zr()}(e,t,n,i)}finally{Rl.transition=r,bt=i}return null}function Tc(){if(null!==Jl){var e=_t(Ql),t=Rl.transition,n=bt;try{if(Rl.transition=null,bt=16>e?16:e,null===Jl)var i=!1;else{if(e=Jl,Jl=null,Ql=0,0!=(6&Pl))throw Error(s(331));var r=Pl;for(Pl|=4,Xa=e.current;null!==Xa;){var o=Xa,a=o.child;if(0!=(16&Xa.flags)){var l=o.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Xa=u;null!==Xa;){var d=Xa;switch(d.tag){case 0:case 11:case 15:il(8,d,o)}var h=d.child;if(null!==h)h.return=d,Xa=h;else for(;null!==Xa;){var p=(d=Xa).sibling,f=d.return;if(ol(d),d===u){Xa=null;break}if(null!==p){p.return=f,Xa=p;break}Xa=f}}}var m=o.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}Xa=o}}if(0!=(2064&o.subtreeFlags)&&null!==a)a.return=o,Xa=a;else e:for(;null!==Xa;){if(0!=(2048&(o=Xa).flags))switch(o.tag){case 0:case 11:case 15:il(9,o,o.return)}var y=o.sibling;if(null!==y){y.return=o.return,Xa=y;break e}Xa=o.return}}var b=e.current;for(Xa=b;null!==Xa;){var _=(a=Xa).child;if(0!=(2064&a.subtreeFlags)&&null!==_)_.return=a,Xa=_;else e:for(a=b;null!==Xa;){if(0!=(2048&(l=Xa).flags))try{switch(l.tag){case 0:case 11:case 15:rl(9,l)}}catch(e){kc(l,l.return,e)}if(l===a){Xa=null;break e}var w=l.sibling;if(null!==w){w.return=l.return,Xa=w;break e}Xa=l.return}}if(Pl=r,zr(),st&&"function"==typeof st.onPostCommitFiberRoot)try{st.onPostCommitFiberRoot(rt,e)}catch(e){}i=!0}return i}finally{bt=n,Rl.transition=t}}return!1}function Ec(e,t,n){e=Os(e,t=fa(0,t=ua(n,t),1),1),t=tc(),null!==e&&(vt(e,1,t),rc(e,t))}function kc(e,t,n){if(3===e.tag)Ec(e,e,n);else for(;null!==t;){if(3===t.tag){Ec(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof i.componentDidCatch&&(null===Hl||!Hl.has(i))){t=Os(t,e=ma(t,e=ua(n,e),1),1),e=tc(),null!==t&&(vt(t,1,e),rc(t,e));break}}t=t.return}}function Cc(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=tc(),e.pingedLanes|=e.suspendedLanes&n,Al===e&&(xl&n)===n&&(4===Ll||3===Ll&&(130023424&xl)===xl&&500>Ye()-zl?pc(e,0):Fl|=n),rc(e,t)}function Ic(e,t){0===t&&(0==(1&e.mode)?t=1:(t=ut,0==(130023424&(ut<<=1))&&(ut=4194304)));var n=tc();null!==(e=Ps(e,t))&&(vt(e,t,n),rc(e,n))}function Rc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Ic(e,n)}function Pc(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(s(314))}null!==i&&i.delete(t),Ic(e,n)}function Ac(e,t){return He(e,t)}function Nc(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xc(e,t,n,i){return new Nc(e,t,n,i)}function Dc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Oc(e,t){var n=e.alternate;return null===n?((n=xc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Lc(e,t,n,i,r,o){var a=2;if(i=e,"function"==typeof e)Dc(e)&&(a=1);else if("string"==typeof e)a=5;else e:switch(e){case T:return Mc(n.children,r,o,t);case E:a=8,r|=8;break;case k:return(e=xc(12,n,t,2|r)).elementType=k,e.lanes=o,e;case P:return(e=xc(13,n,t,r)).elementType=P,e.lanes=o,e;case A:return(e=xc(19,n,t,r)).elementType=A,e.lanes=o,e;case D:return jc(n,r,o,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case C:a=10;break e;case I:a=9;break e;case R:a=11;break e;case N:a=14;break e;case x:a=16,i=null;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=xc(a,n,t,r)).elementType=e,t.type=i,t.lanes=o,t}function Mc(e,t,n,i){return(e=xc(7,e,i,t)).lanes=n,e}function jc(e,t,n,i){return(e=xc(22,e,i,t)).elementType=D,e.lanes=n,e.stateNode={isHidden:!1},e}function Uc(e,t,n){return(e=xc(6,e,null,t)).lanes=n,e}function Fc(e,t,n){return(t=xc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Vc(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Bc(e,t,n,i,r,s,o,a,l){return e=new Vc(e,t,n,a,l),1===t?(t=1,!0===s&&(t|=8)):t=0,s=xc(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ns(s),e}function zc(e){if(!e)return Ir;e:{if(ze(e=e._reactInternals)!==e||1!==e.tag)throw Error(s(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(xr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(s(171))}if(1===e.tag){var n=e.type;if(xr(n))return Lr(e,n,t)}return t}function $c(e,t,n,i,r,s,o,a,l){return(e=Bc(n,i,!0,e,0,s,0,a,l)).context=zc(null),n=e.current,(s=Ds(i=tc(),r=nc(n))).callback=null!=t?t:null,Os(n,s,r),e.current.lanes=r,vt(e,r,i),rc(e,i),e}function qc(e,t,n,i){var r=t.current,s=tc(),o=nc(r);return n=zc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Ds(s,o)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=Os(r,t,o))&&(ic(e,r,o,s),Ls(e,r,o)),o}function Gc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Wc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Hc(e,t){Wc(e,t),(e=e.alternate)&&Wc(e,t)}El=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Pr.current)_a=!0;else{if(0==(e.lanes&n)&&0==(128&t.flags))return _a=!1,function(e,t,n){switch(t.tag){case 3:Aa(t),ps();break;case 5:so(t);break;case 1:xr(t.type)&&Mr(t);break;case 4:io(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,r=t.memoizedProps.value;Cr(vs,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(Cr(ao,1&ao.current),t.flags|=128,null):0!=(n&t.child.childLanes)?Ua(e,t,n):(Cr(ao,1&ao.current),null!==(e=Ga(e,t,n))?e.sibling:null);Cr(ao,1&ao.current);break;case 19:if(i=0!=(n&t.childLanes),0!=(128&e.flags)){if(i)return $a(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Cr(ao,ao.current),i)break;return null;case 22:case 23:return t.lanes=0,ka(e,t,n)}return Ga(e,t,n)}(e,t,n);_a=0!=(131072&e.flags)}else _a=!1,rs&&0!=(1048576&t.flags)&&Xr(t,Wr,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;qa(e,t),e=t.pendingProps;var r=Nr(t,Rr.current);Es(t,n),r=Eo(null,t,i,e,r,n);var o=ko();return t.flags|=1,"object"==typeof r&&null!==r&&"function"==typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,xr(i)?(o=!0,Mr(t)):o=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Ns(t),r.updater=Bs,t.stateNode=r,r._reactInternals=t,Gs(t,i,e,n),t=Pa(null,t,i,!0,o,n)):(t.tag=0,rs&&o&&es(t),wa(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(qa(e,t),e=t.pendingProps,i=(r=i._init)(i._payload),t.type=i,r=t.tag=function(e){if("function"==typeof e)return Dc(e)?1:0;if(null!=e){if((e=e.$$typeof)===R)return 11;if(e===N)return 14}return 2}(i),e=gs(i,e),r){case 0:t=Ia(null,t,i,e,n);break e;case 1:t=Ra(null,t,i,e,n);break e;case 11:t=Sa(null,t,i,e,n);break e;case 14:t=Ta(null,t,i,gs(i.type,e),n);break e}throw Error(s(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,Ia(e,t,i,r=t.elementType===i?r:gs(i,r),n);case 1:return i=t.type,r=t.pendingProps,Ra(e,t,i,r=t.elementType===i?r:gs(i,r),n);case 3:e:{if(Aa(t),null===e)throw Error(s(387));i=t.pendingProps,r=(o=t.memoizedState).element,xs(e,t),js(t,i,null,n);var a=t.memoizedState;if(i=a.element,o.isDehydrated){if(o={element:i,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Na(e,t,i,n,r=ua(Error(s(423)),t));break e}if(i!==r){t=Na(e,t,i,n,r=ua(Error(s(424)),t));break e}for(is=cr(t.stateNode.containerInfo.firstChild),ns=t,rs=!0,ss=null,n=Ys(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ps(),i===r){t=Ga(e,t,n);break e}wa(e,t,i,n)}t=t.child}return t;case 5:return so(t),null===e&&cs(t),i=t.type,r=t.pendingProps,o=null!==e?e.memoizedProps:null,a=r.children,nr(i,r)?a=null:null!==o&&nr(i,o)&&(t.flags|=32),Ca(e,t),wa(e,t,a,n),t.child;case 6:return null===e&&cs(t),null;case 13:return Ua(e,t,n);case 4:return io(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=Qs(t,null,i,n):wa(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,Sa(e,t,i,r=t.elementType===i?r:gs(i,r),n);case 7:return wa(e,t,t.pendingProps,n),t.child;case 8:case 12:return wa(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,o=t.memoizedProps,a=r.value,Cr(vs,i._currentValue),i._currentValue=a,null!==o)if(ai(o.value,a)){if(o.children===r.children&&!Pr.current){t=Ga(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var l=o.dependencies;if(null!==l){a=o.child;for(var c=l.firstContext;null!==c;){if(c.context===i){if(1===o.tag){(c=Ds(-1,n&-n)).tag=2;var u=o.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}o.lanes|=n,null!==(c=o.alternate)&&(c.lanes|=n),Ts(o.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===o.tag)a=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(a=o.return))throw Error(s(341));a.lanes|=n,null!==(l=a.alternate)&&(l.lanes|=n),Ts(a,n,t),a=o.sibling}else a=o.child;if(null!==a)a.return=o;else for(a=o;null!==a;){if(a===t){a=null;break}if(null!==(o=a.sibling)){o.return=a.return,a=o;break}a=a.return}o=a}wa(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,Es(t,n),i=i(r=ks(r)),t.flags|=1,wa(e,t,i,n),t.child;case 14:return r=gs(i=t.type,t.pendingProps),Ta(e,t,i,r=gs(i.type,r),n);case 15:return Ea(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:gs(i,r),qa(e,t),t.tag=1,xr(i)?(e=!0,Mr(t)):e=!1,Es(t,n),$s(t,i,r),Gs(t,i,r,n),Pa(null,t,i,!0,e,n);case 19:return $a(e,t,n);case 22:return ka(e,t,n)}throw Error(s(156,t.tag))};var Kc="function"==typeof reportError?reportError:function(e){console.error(e)};function Jc(e){this._internalRoot=e}function Qc(e){this._internalRoot=e}function Yc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Zc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Xc(){}function eu(e,t,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if("function"==typeof r){var a=r;r=function(){var e=Gc(o);a.call(e)}}qc(t,o,e,r)}else o=function(e,t,n,i,r){if(r){if("function"==typeof i){var s=i;i=function(){var e=Gc(o);s.call(e)}}var o=$c(t,i,e,0,null,!1,0,"",Xc);return e._reactRootContainer=o,e[fr]=o.current,zi(8===e.nodeType?e.parentNode:e),dc(),o}for(;r=e.lastChild;)e.removeChild(r);if("function"==typeof i){var a=i;i=function(){var e=Gc(l);a.call(e)}}var l=Bc(e,0,!1,null,0,!1,0,"",Xc);return e._reactRootContainer=l,e[fr]=l.current,zi(8===e.nodeType?e.parentNode:e),dc((function(){qc(t,l,n,i)})),l}(n,t,e,r,i);return Gc(o)}Qc.prototype.render=Jc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(s(409));qc(e,t,null,null)},Qc.prototype.unmount=Jc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;dc((function(){qc(null,e,null,null)})),t[fr]=null}},Qc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Et();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Dt.length&&0!==t&&t<Dt[n].priority;n++);Dt.splice(n,0,e),0===n&&jt(e)}},wt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(yt(t,1|n),rc(t,Ye()),0==(6&Pl)&&($l=Ye()+500,zr()))}break;case 13:dc((function(){var t=Ps(e,1);if(null!==t){var n=tc();ic(t,e,1,n)}})),Hc(e,1)}},St=function(e){if(13===e.tag){var t=Ps(e,134217728);if(null!==t)ic(t,e,134217728,tc());Hc(e,134217728)}},Tt=function(e){if(13===e.tag){var t=nc(e),n=Ps(e,t);if(null!==n)ic(n,e,t,tc());Hc(e,t)}},Et=function(){return bt},kt=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},Se=function(e,t,n){switch(t){case"input":if(Z(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=wr(i);if(!r)throw Error(s(90));H(i),Z(i,r)}}}break;case"textarea":se(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Re=uc,Pe=dc;var tu={usingClientEntryPoint:!1,Events:[br,_r,wr,Ce,Ie,uc]},nu={findFiberByHostInstance:yr,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},iu={bundleType:nu.bundleType,version:nu.version,rendererPackageName:nu.rendererPackageName,rendererConfig:nu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:_.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ge(e))?null:e.stateNode},findFiberByHostInstance:nu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ru.isDisabled&&ru.supportsFiber)try{rt=ru.inject(iu),st=ru}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Yc(t))throw Error(s(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:S,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Yc(e))throw Error(s(299));var n=!1,i="",r=Kc;return null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=Bc(e,1,!1,null,0,n,0,i,r),e[fr]=t.current,zi(8===e.nodeType?e.parentNode:e),new Jc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return e=null===(e=Ge(t))?null:e.stateNode},t.flushSync=function(e){return dc(e)},t.hydrate=function(e,t,n){if(!Zc(t))throw Error(s(200));return eu(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Yc(e))throw Error(s(405));var i=null!=n&&n.hydratedSources||null,r=!1,o="",a=Kc;if(null!=n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(a=n.onRecoverableError)),t=$c(t,null,e,1,null!=n?n:null,r,0,o,a),e[fr]=t.current,zi(e),i)for(e=0;e<i.length;e++)r=(r=(n=i[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new Qc(t)},t.render=function(e,t,n){if(!Zc(t))throw Error(s(200));return eu(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Zc(e))throw Error(s(40));return!!e._reactRootContainer&&(dc((function(){eu(null,null,e,!1,(function(){e._reactRootContainer=null,e[fr]=null}))})),!0)},t.unstable_batchedUpdates=uc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!Zc(n))throw Error(s(200));if(null==e||void 0===e._reactInternals)throw Error(s(38));return eu(e,t,n,!1,i)},t.version="18.2.0-next-9e3b772b8-20220608"},745:(e,t,n)=>{"use strict";var i=n(3935);t.s=i.createRoot,i.hydrateRoot},3935:(e,t,n)=>{"use strict";!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=n(4448)},9921:(e,t)=>{"use strict";var n="function"==typeof Symbol&&Symbol.for,i=n?Symbol.for("react.element"):60103,r=n?Symbol.for("react.portal"):60106,s=n?Symbol.for("react.fragment"):60107,o=n?Symbol.for("react.strict_mode"):60108,a=n?Symbol.for("react.profiler"):60114,l=n?Symbol.for("react.provider"):60109,c=n?Symbol.for("react.context"):60110,u=n?Symbol.for("react.async_mode"):60111,d=n?Symbol.for("react.concurrent_mode"):60111,h=n?Symbol.for("react.forward_ref"):60112,p=n?Symbol.for("react.suspense"):60113,f=n?Symbol.for("react.suspense_list"):60120,m=n?Symbol.for("react.memo"):60115,g=n?Symbol.for("react.lazy"):60116,v=n?Symbol.for("react.block"):60121,y=n?Symbol.for("react.fundamental"):60117,b=n?Symbol.for("react.responder"):60118,_=n?Symbol.for("react.scope"):60119;function w(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case i:switch(e=e.type){case u:case d:case s:case a:case o:case p:return e;default:switch(e=e&&e.$$typeof){case c:case h:case g:case m:case l:return e;default:return t}}case r:return t}}}function S(e){return w(e)===d}t.AsyncMode=u,t.ConcurrentMode=d,t.ContextConsumer=c,t.ContextProvider=l,t.Element=i,t.ForwardRef=h,t.Fragment=s,t.Lazy=g,t.Memo=m,t.Portal=r,t.Profiler=a,t.StrictMode=o,t.Suspense=p,t.isAsyncMode=function(e){return S(e)||w(e)===u},t.isConcurrentMode=S,t.isContextConsumer=function(e){return w(e)===c},t.isContextProvider=function(e){return w(e)===l},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===i},t.isForwardRef=function(e){return w(e)===h},t.isFragment=function(e){return w(e)===s},t.isLazy=function(e){return w(e)===g},t.isMemo=function(e){return w(e)===m},t.isPortal=function(e){return w(e)===r},t.isProfiler=function(e){return w(e)===a},t.isStrictMode=function(e){return w(e)===o},t.isSuspense=function(e){return w(e)===p},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===s||e===d||e===a||e===o||e===p||e===f||"object"==typeof e&&null!==e&&(e.$$typeof===g||e.$$typeof===m||e.$$typeof===l||e.$$typeof===c||e.$$typeof===h||e.$$typeof===y||e.$$typeof===b||e.$$typeof===_||e.$$typeof===v)},t.typeOf=w},9864:(e,t,n)=>{"use strict";e.exports=n(9921)},9655:(e,t,n)=>{"use strict";n.d(t,{lr:()=>m,rU:()=>h});var i=n(7294),r=n(9250),s=n(2599);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o.apply(this,arguments)}function a(e,t){if(null==e)return{};var n,i,r={},s=Object.keys(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}function l(e){return void 0===e&&(e=""),new URLSearchParams("string"==typeof e||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce(((t,n)=>{let i=e[n];return t.concat(Array.isArray(i)?i.map((e=>[n,e])):[[n,i]])}),[]))}const c=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset"];const u="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement,d=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,h=i.forwardRef((function(e,t){let n,{onClick:l,relative:h,reloadDocument:p,replace:f,state:m,target:g,to:v,preventScrollReset:y}=e,b=a(e,c),{basename:_}=i.useContext(r.Us),w=!1;if("string"==typeof v&&d.test(v)&&(n=v,u))try{let e=new URL(window.location.href),t=v.startsWith("//")?new URL(e.protocol+v):new URL(v),n=(0,s.Zn)(t.pathname,_);t.origin===e.origin&&null!=n?v=n+t.search+t.hash:w=!0}catch(e){}let S=(0,r.oQ)(v,{relative:h}),T=function(e,t){let{target:n,replace:o,state:a,preventScrollReset:l,relative:c}=void 0===t?{}:t,u=(0,r.s0)(),d=(0,r.TH)(),h=(0,r.WU)(e,{relative:c});return i.useCallback((t=>{if(function(e,t){return!(0!==e.button||t&&"_self"!==t||function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e))}(t,n)){t.preventDefault();let n=void 0!==o?o:(0,s.Ep)(d)===(0,s.Ep)(h);u(e,{replace:n,state:a,preventScrollReset:l,relative:c})}}),[d,u,h,o,a,n,e,l,c])}(v,{replace:f,state:m,target:g,preventScrollReset:y,relative:h});return i.createElement("a",o({},b,{href:n||S,onClick:w||p?l:function(e){l&&l(e),e.defaultPrevented||T(e)},ref:t,target:g}))}));var p,f;function m(e){let t=i.useRef(l(e)),n=i.useRef(!1),s=(0,r.TH)(),o=i.useMemo((()=>function(e,t){let n=l(e);if(t)for(let e of t.keys())n.has(e)||t.getAll(e).forEach((t=>{n.append(e,t)}));return n}(s.search,n.current?null:t.current)),[s.search]),a=(0,r.s0)(),c=i.useCallback(((e,t)=>{const i=l("function"==typeof e?e(o):e);n.current=!0,a("?"+i,t)}),[a,o]);return[o,c]}(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmitImpl="useSubmitImpl",e.UseFetcher="useFetcher"})(p||(p={})),function(e){e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(f||(f={}))},9250:(e,t,n)=>{"use strict";var i;n.d(t,{AW:()=>D,TH:()=>g,UO:()=>b,Us:()=>u,VA:()=>x,WU:()=>_,Z5:()=>L,oQ:()=>f,s0:()=>y});var r=n(7294),s=n(2599);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o.apply(this,arguments)}var a=(i||(i=n.t(r,2))).startTransition;const l=r.createContext(null);const c=r.createContext(null);const u=r.createContext(null);const d=r.createContext(null);const h=r.createContext({outlet:null,matches:[],isDataRoute:!1});const p=r.createContext(null);function f(e,t){let{relative:n}=void 0===t?{}:t;m()||(0,s.J0)(!1);let{basename:i,navigator:o}=r.useContext(u),{hash:a,pathname:l,search:c}=_(e,{relative:n}),d=l;return"/"!==i&&(d="/"===l?i:(0,s.RQ)([i,l])),o.createHref({pathname:d,search:c,hash:a})}function m(){return null!=r.useContext(d)}function g(){return m()||(0,s.J0)(!1),r.useContext(d).location}function v(e){r.useContext(u).static||r.useLayoutEffect(e)}function y(){let{isDataRoute:e}=r.useContext(h);return e?function(){let{router:e}=P(I.UseNavigateStable),t=N(R.UseNavigateStable),n=r.useRef(!1);return v((()=>{n.current=!0})),r.useCallback((function(i,r){void 0===r&&(r={}),n.current&&("number"==typeof i?e.navigate(i):e.navigate(i,o({fromRouteId:t},r)))}),[e,t])}():function(){m()||(0,s.J0)(!1);let e=r.useContext(l),{basename:t,navigator:n}=r.useContext(u),{matches:i}=r.useContext(h),{pathname:o}=g(),a=JSON.stringify((0,s.Zq)(i).map((e=>e.pathnameBase))),c=r.useRef(!1);return v((()=>{c.current=!0})),r.useCallback((function(i,r){if(void 0===r&&(r={}),!c.current)return;if("number"==typeof i)return void n.go(i);let l=(0,s.pC)(i,JSON.parse(a),o,"path"===r.relative);null==e&&"/"!==t&&(l.pathname="/"===l.pathname?t:(0,s.RQ)([t,l.pathname])),(r.replace?n.replace:n.push)(l,r.state,r)}),[t,n,a,o,e])}()}function b(){let{matches:e}=r.useContext(h),t=e[e.length-1];return t?t.params:{}}function _(e,t){let{relative:n}=void 0===t?{}:t,{matches:i}=r.useContext(h),{pathname:o}=g(),a=JSON.stringify((0,s.Zq)(i).map((e=>e.pathnameBase)));return r.useMemo((()=>(0,s.pC)(e,JSON.parse(a),o,"path"===n)),[e,a,o,n])}function w(e,t,n){m()||(0,s.J0)(!1);let{navigator:i}=r.useContext(u),{matches:a}=r.useContext(h),l=a[a.length-1],c=l?l.params:{},p=(l&&l.pathname,l?l.pathnameBase:"/");l&&l.route;let f,v=g();if(t){var y;let e="string"==typeof t?(0,s.cP)(t):t;"/"===p||(null==(y=e.pathname)?void 0:y.startsWith(p))||(0,s.J0)(!1),f=e}else f=v;let b=f.pathname||"/",_="/"===p?b:b.slice(p.length)||"/",w=(0,s.fp)(e,{pathname:_});let S=C(w&&w.map((e=>Object.assign({},e,{params:Object.assign({},c,e.params),pathname:(0,s.RQ)([p,i.encodeLocation?i.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?p:(0,s.RQ)([p,i.encodeLocation?i.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])}))),a,n);return t&&S?r.createElement(d.Provider,{value:{location:o({pathname:"/",search:"",hash:"",state:null,key:"default"},f),navigationType:s.aU.Pop}},S):S}function S(){let e=function(){var e;let t=r.useContext(p),n=A(R.UseRouteError),i=N(R.UseRouteError);if(t)return t;return null==(e=n.errors)?void 0:e[i]}(),t=(0,s.WK)(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,i="rgba(200,200,200, 0.5)",o={padding:"0.5rem",backgroundColor:i};return r.createElement(r.Fragment,null,r.createElement("h2",null,"Unexpected Application Error!"),r.createElement("h3",{style:{fontStyle:"italic"}},t),n?r.createElement("pre",{style:o},n):null,null)}const T=r.createElement(S,null);class E extends r.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error||t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error?r.createElement(h.Provider,{value:this.props.routeContext},r.createElement(p.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function k(e){let{routeContext:t,match:n,children:i}=e,s=r.useContext(l);return s&&s.static&&s.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=n.route.id),r.createElement(h.Provider,{value:t},i)}function C(e,t,n){var i;if(void 0===t&&(t=[]),void 0===n&&(n=null),null==e){var o;if(null==(o=n)||!o.errors)return null;e=n.matches}let a=e,l=null==(i=n)?void 0:i.errors;if(null!=l){let e=a.findIndex((e=>e.route.id&&(null==l?void 0:l[e.route.id])));e>=0||(0,s.J0)(!1),a=a.slice(0,Math.min(a.length,e+1))}return a.reduceRight(((e,i,s)=>{let o=i.route.id?null==l?void 0:l[i.route.id]:null,c=null;n&&(c=i.route.errorElement||T);let u=t.concat(a.slice(0,s+1)),d=()=>{let t;return t=o?c:i.route.Component?r.createElement(i.route.Component,null):i.route.element?i.route.element:e,r.createElement(k,{match:i,routeContext:{outlet:e,matches:u,isDataRoute:null!=n},children:t})};return n&&(i.route.ErrorBoundary||i.route.errorElement||0===s)?r.createElement(E,{location:n.location,revalidation:n.revalidation,component:c,error:o,children:d(),routeContext:{outlet:null,matches:u,isDataRoute:!0}}):d()}),null)}var I,R;function P(e){let t=r.useContext(l);return t||(0,s.J0)(!1),t}function A(e){let t=r.useContext(c);return t||(0,s.J0)(!1),t}function N(e){let t=function(e){let t=r.useContext(h);return t||(0,s.J0)(!1),t}(),n=t.matches[t.matches.length-1];return n.route.id||(0,s.J0)(!1),n.route.id}!function(e){e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate"}(I||(I={})),function(e){e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId"}(R||(R={}));function x(e){let{basename:t,children:n,initialEntries:i,initialIndex:o,future:l}=e,c=r.useRef();null==c.current&&(c.current=(0,s.PP)({initialEntries:i,initialIndex:o,v5Compat:!0}));let u=c.current,[d,h]=r.useState({action:u.action,location:u.location}),{v7_startTransition:p}=l||{},f=r.useCallback((e=>{p&&a?a((()=>h(e))):h(e)}),[h,p]);return r.useLayoutEffect((()=>u.listen(f)),[u,f]),r.createElement(O,{basename:t,children:n,location:d.location,navigationType:d.action,navigator:u})}function D(e){(0,s.J0)(!1)}function O(e){let{basename:t="/",children:n=null,location:i,navigationType:o=s.aU.Pop,navigator:a,static:l=!1}=e;m()&&(0,s.J0)(!1);let c=t.replace(/^\/*/,"/"),h=r.useMemo((()=>({basename:c,navigator:a,static:l})),[c,a,l]);"string"==typeof i&&(i=(0,s.cP)(i));let{pathname:p="/",search:f="",hash:g="",state:v=null,key:y="default"}=i,b=r.useMemo((()=>{let e=(0,s.Zn)(p,c);return null==e?null:{location:{pathname:e,search:f,hash:g,state:v,key:y},navigationType:o}}),[c,p,f,g,v,y,o]);return null==b?null:r.createElement(u.Provider,{value:h},r.createElement(d.Provider,{children:n,value:b}))}function L(e){let{children:t,location:n}=e;return w(j(t),n)}var M;!function(e){e[e.pending=0]="pending",e[e.success=1]="success",e[e.error=2]="error"}(M||(M={}));new Promise((()=>{}));r.Component;function j(e,t){void 0===t&&(t=[]);let n=[];return r.Children.forEach(e,((e,i)=>{if(!r.isValidElement(e))return;let o=[...t,i];if(e.type===r.Fragment)return void n.push.apply(n,j(e.props.children,o));e.type!==D&&(0,s.J0)(!1),e.props.index&&e.props.children&&(0,s.J0)(!1);let a={id:e.props.id||o.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(a.children=j(e.props.children,o)),n.push(a)})),n}},5251:(e,t,n)=>{"use strict";var i=n(7294),r=Symbol.for("react.element"),s=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var i,s={},c=null,u=null;for(i in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)o.call(t,i)&&!l.hasOwnProperty(i)&&(s[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===s[i]&&(s[i]=t[i]);return{$$typeof:r,type:e,key:c,ref:u,props:s,_owner:a.current}}t.Fragment=s,t.jsx=c,t.jsxs=c},2408:(e,t)=>{"use strict";var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}function y(){}function b(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var _=b.prototype=new y;_.constructor=b,m(_,v.prototype),_.isPureReactComponent=!0;var w=Array.isArray,S=Object.prototype.hasOwnProperty,T={current:null},E={key:!0,ref:!0,__self:!0,__source:!0};function k(e,t,i){var r,s={},o=null,a=null;if(null!=t)for(r in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(o=""+t.key),t)S.call(t,r)&&!E.hasOwnProperty(r)&&(s[r]=t[r]);var l=arguments.length-2;if(1===l)s.children=i;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];s.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===s[r]&&(s[r]=l[r]);return{$$typeof:n,type:e,key:o,ref:a,props:s,_owner:T.current}}function C(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var I=/\/+/g;function R(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function P(e,t,r,s,o){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l=!1;if(null===e)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case i:l=!0}}if(l)return o=o(l=e),e=""===s?"."+R(l,0):s,w(o)?(r="",null!=e&&(r=e.replace(I,"$&/")+"/"),P(o,t,r,"",(function(e){return e}))):null!=o&&(C(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,r+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(I,"$&/")+"/")+e)),t.push(o)),1;if(l=0,s=""===s?".":s+":",w(e))for(var c=0;c<e.length;c++){var u=s+R(a=e[c],c);l+=P(a,t,r,u,o)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"==typeof u)for(e=u.call(e),c=0;!(a=e.next()).done;)l+=P(a=a.value,t,r,u=s+R(a,c++),o);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function A(e,t,n){if(null==e)return e;var i=[],r=0;return P(e,i,"","",(function(e){return t.call(n,e,r++)})),i}function N(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var x={current:null},D={transition:null},O={ReactCurrentDispatcher:x,ReactCurrentBatchConfig:D,ReactCurrentOwner:T};t.Children={map:A,forEach:function(e,t,n){A(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return A(e,(function(){t++})),t},toArray:function(e){return A(e,(function(e){return e}))||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=r,t.Profiler=o,t.PureComponent=b,t.StrictMode=s,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O,t.cloneElement=function(e,t,i){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=m({},e.props),s=e.key,o=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,a=T.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)S.call(t,c)&&!E.hasOwnProperty(c)&&(r[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)r.children=i;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];r.children=l}return{$$typeof:n,type:e.type,key:s,ref:o,props:r,_owner:a}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=k,t.createFactory=function(e){var t=k.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=C,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:N}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=D.transition;D.transition={};try{e()}finally{D.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return x.current.useCallback(e,t)},t.useContext=function(e){return x.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return x.current.useDeferredValue(e)},t.useEffect=function(e,t){return x.current.useEffect(e,t)},t.useId=function(){return x.current.useId()},t.useImperativeHandle=function(e,t,n){return x.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return x.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return x.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return x.current.useMemo(e,t)},t.useReducer=function(e,t,n){return x.current.useReducer(e,t,n)},t.useRef=function(e){return x.current.useRef(e)},t.useState=function(e){return x.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return x.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return x.current.useTransition()},t.version="18.2.0"},7294:(e,t,n)=>{"use strict";e.exports=n(2408)},5893:(e,t,n)=>{"use strict";e.exports=n(5251)},53:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<s(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,o=r>>>1;i<o;){var a=2*(i+1)-1,l=e[a],c=a+1,u=e[c];if(0>s(l,n))c<r&&0>s(u,l)?(e[i]=u,e[c]=n,i=c):(e[i]=l,e[a]=n,i=a);else{if(!(c<r&&0>s(u,n)))break e;e[i]=u,e[c]=n,i=c}}}return t}function s(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],u=[],d=1,h=null,p=3,f=!1,m=!1,g=!1,v="function"==typeof setTimeout?setTimeout:null,y="function"==typeof clearTimeout?clearTimeout:null,b="undefined"!=typeof setImmediate?setImmediate:null;function _(e){for(var t=i(u);null!==t;){if(null===t.callback)r(u);else{if(!(t.startTime<=e))break;r(u),t.sortIndex=t.expirationTime,n(c,t)}t=i(u)}}function w(e){if(g=!1,_(e),!m)if(null!==i(c))m=!0,D(S);else{var t=i(u);null!==t&&O(w,t.startTime-e)}}function S(e,n){m=!1,g&&(g=!1,y(C),C=-1),f=!0;var s=p;try{for(_(n),h=i(c);null!==h&&(!(h.expirationTime>n)||e&&!P());){var o=h.callback;if("function"==typeof o){h.callback=null,p=h.priorityLevel;var a=o(h.expirationTime<=n);n=t.unstable_now(),"function"==typeof a?h.callback=a:h===i(c)&&r(c),_(n)}else r(c);h=i(c)}if(null!==h)var l=!0;else{var d=i(u);null!==d&&O(w,d.startTime-n),l=!1}return l}finally{h=null,p=s,f=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var T,E=!1,k=null,C=-1,I=5,R=-1;function P(){return!(t.unstable_now()-R<I)}function A(){if(null!==k){var e=t.unstable_now();R=e;var n=!0;try{n=k(!0,e)}finally{n?T():(E=!1,k=null)}}else E=!1}if("function"==typeof b)T=function(){b(A)};else if("undefined"!=typeof MessageChannel){var N=new MessageChannel,x=N.port2;N.port1.onmessage=A,T=function(){x.postMessage(null)}}else T=function(){v(A,0)};function D(e){k=e,E||(E=!0,T())}function O(e,n){C=v((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,D(S))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return i(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,r,s){var o=t.unstable_now();switch("object"==typeof s&&null!==s?s="number"==typeof(s=s.delay)&&0<s?o+s:o:s=o,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return e={id:d++,callback:r,priorityLevel:e,startTime:s,expirationTime:a=s+a,sortIndex:-1},s>o?(e.sortIndex=s,n(u,e),null===i(c)&&e===i(u)&&(g?(y(C),C=-1):g=!0,O(w,s-o))):(e.sortIndex=a,n(c,e),m||f||(m=!0,D(S))),e},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},3840:(e,t,n)=>{"use strict";e.exports=n(53)},6692:e=>{var t=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(t).forEach((function(e){t[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))},766:(e,t,n)=>{var i=n(962),r=n(5776);t.cW=r,t.Qc=i.parse,i.parseParams,i.parseFmtpConfig,i.parsePayloads,i.parseRemoteCandidates,i.parseImageAttributes,i.parseSimulcastStreamList},962:(e,t,n)=>{var i=function(e){return String(Number(e))===e?Number(e):e},r=function(e,t,n){var r=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:r&&!t[e.name]&&(t[e.name]={});var s=e.push?{}:r?t[e.name]:t;!function(e,t,n,r){if(r&&!n)t[r]=i(e[1]);else for(var s=0;s<n.length;s+=1)null!=e[s+1]&&(t[n[s]]=i(e[s+1]))}(n.match(e.reg),s,e.names,e.name),e.push&&t[e.push].push(s)},s=n(6692),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},n=[],i=t;return e.split(/(\r\n|\r|\n)/).filter(o).forEach((function(e){var t=e[0],o=e.slice(2);"m"===t&&(n.push({rtp:[],fmtp:[]}),i=n[n.length-1]);for(var a=0;a<(s[t]||[]).length;a+=1){var l=s[t][a];if(l.reg.test(o))return r(l,i,o)}})),t.media=n,t};var a=function(e,t){var n=t.split(/=(.+)/,2);return 2===n.length?e[n[0]]=i(n[1]):1===n.length&&t.length>1&&(e[n[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(a,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(i),r=0;r<n.length;r+=3)t.push({component:n[r],ip:n[r+1],port:n[r+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(a,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,n=!1;return"~"!==e[0]?t=i(e):(t=i(e.substring(1,e.length)),n=!0),{scid:t,paused:n}}))}))}},5776:(e,t,n)=>{var i=n(6692),r=/%[sdv%]/g,s=function(e){var t=1,n=arguments,i=n.length;return e.replace(r,(function(e){if(t>=i)return e;var r=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(r);case"%d":return Number(r);case"%v":return""}}))},o=function(e,t,n){var i=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var r=0;r<t.names.length;r+=1){var o=t.names[r];t.name?i.push(n[t.name][o]):i.push(n[t.names[r]])}else i.push(n[t.name]);return s.apply(null,i)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],l=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var n=t.outerOrder||a,r=t.innerOrder||l,s=[];return n.forEach((function(t){i[t].forEach((function(n){n.name in e&&null!=e[n.name]?s.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){s.push(o(t,n,e))}))}))})),e.media.forEach((function(e){s.push(o("m",i.m[0],e)),r.forEach((function(t){i[t].forEach((function(n){n.name in e&&null!=e[n.name]?s.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){s.push(o(t,n,e))}))}))}))})),s.join("\r\n")+"\r\n"}},7539:e=>{"use strict";const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":n.relatedAddress=t[e+1];break;case"rport":n.relatedPort=parseInt(t[e+1],10);break;case"tcptype":n.tcpType=t[e+1];break;case"ufrag":n.ufrag=t[e+1],n.usernameFragment=t[e+1];break;default:void 0===n[t[e]]&&(n[t[e]]=t[e+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const i=e.substring(e.indexOf(" ")+1).split(";");for(let e=0;e<i.length;e++)n=i[e].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const i=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)})),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substring(t+1,i),n.value=e.substring(i+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const i=t.matchPrefix(e+n,"a=ice-ufrag:")[0],r=t.matchPrefix(e+n,"a=ice-pwd:")[0];return i&&r?{usernameFragment:i.substring(12),password:r.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" ");n.profile=i[2];for(let r=3;r<i.length;r++){const s=i[r],o=t.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(o){const i=t.parseRtpMap(o),r=t.matchPrefix(e,"a=fmtp:"+s+" ");switch(i.parameters=r.length?t.parseFmtp(r[0]):{},i.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+s+" ").map(t.parseRtcpFb),n.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(i.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))}));const r=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach((e=>{r.forEach((t=>{e.rtcpFeedback.find((e=>e.type===t.type&&e.parameter===t.parameter))||e.rtcpFeedback.push(t)}))})),n},t.writeRtpDescription=function(e,n){let i="";i+="m="+e+" ",i+=n.codecs.length>0?"9":"0",i+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{i+=t.writeRtpMap(e),i+=t.writeFmtp(e),i+=t.writeRtcpFb(e)}));let r=0;return n.codecs.forEach((e=>{e.maxptime>r&&(r=e.maxptime)})),r>0&&(i+="a=maxptime:"+r+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{i+=t.writeExtmap(e)})),i},t.parseRtpEncodingParameters=function(e){const n=[],i=t.parseRtpParameters(e),r=-1!==i.fecMechanisms.indexOf("RED"),s=-1!==i.fecMechanisms.indexOf("ULPFEC"),o=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),a=o.length>0&&o[0].ssrc;let l;const c=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substring(17).split(" ").map((e=>parseInt(e,10)))));c.length>0&&c[0].length>1&&c[0][0]===a&&(l=c[0][1]),i.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)};a&&l&&(t.rtx={ssrc:l}),n.push(t),r&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:a,mechanism:s?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&a&&n.push({ssrc:a});let u=t.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substring(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,n.forEach((e=>{e.maxBitrate=u}))),n},t.parseRtcpParameters=function(e){const n={},i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);const r=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=r.length>0,n.compound=0===r.length;const s=t.matchPrefix(e,"a=rtcp-mux");return n.mux=s.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const i=t.matchPrefix(e,"a=msid:");if(1===i.length)return n=i[0].substring(7).split(" "),{stream:n[0],track:n[1]};const r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return r.length>0?(n=r[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");let r;i.length>0&&(r=parseInt(i[0].substring(19),10)),isNaN(r)&&(r=65536);const s=t.matchPrefix(e,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substring(12),10),protocol:n.fmt,maxMessageSize:r};const o=t.matchPrefix(e,"a=sctpmap:");if(o.length>0){const e=o[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,i){let r;const s=void 0!==n?n:2;r=e||t.generateSessionId();return"v=0\r\no="+(i||"thisisadapterortc")+" "+r+" "+s+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const i=t.splitLines(e);for(let e=0;e<i.length;e++)switch(i[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[e].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let e=0;e<n.length;e++)if(n[e].length<2||"="!==n[e].charAt(1))return!1;return!0},e.exports=t},6774:e=>{e.exports=function(e,t,n,i){var r=n?n.call(i,e,t):void 0;if(void 0!==r)return!!r;if(e===t)return!0;if("object"!=typeof e||!e||"object"!=typeof t||!t)return!1;var s=Object.keys(e),o=Object.keys(t);if(s.length!==o.length)return!1;for(var a=Object.prototype.hasOwnProperty.bind(t),l=0;l<s.length;l++){var c=s[l];if(!a(c))return!1;var u=e[c],d=t[c];if(!1===(r=n?n.call(i,u,d,c):void 0)||void 0===r&&u!==d)return!1}return!0}},2788:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>De});var i=n(9864),r=n(7294),s=n(6774),o=n.n(s);const a=function(e){function t(e,i,l,c,h){for(var p,f,m,g,_,S=0,T=0,E=0,k=0,C=0,x=0,O=m=p=0,M=0,j=0,U=0,F=0,V=l.length,B=V-1,z="",$="",q="",G="";M<V;){if(f=l.charCodeAt(M),M===B&&0!==T+k+E+S&&(0!==T&&(f=47===T?10:47),k=E=S=0,V++,B++),0===T+k+E+S){if(M===B&&(0<j&&(z=z.replace(d,"")),0<z.trim().length)){switch(f){case 32:case 9:case 59:case 13:case 10:break;default:z+=l.charAt(M)}f=59}switch(f){case 123:for(p=(z=z.trim()).charCodeAt(0),m=1,F=++M;M<V;){switch(f=l.charCodeAt(M)){case 123:m++;break;case 125:m--;break;case 47:switch(f=l.charCodeAt(M+1)){case 42:case 47:e:{for(O=M+1;O<B;++O)switch(l.charCodeAt(O)){case 47:if(42===f&&42===l.charCodeAt(O-1)&&M+2!==O){M=O+1;break e}break;case 10:if(47===f){M=O+1;break e}}M=O}}break;case 91:f++;case 40:f++;case 34:case 39:for(;M++<B&&l.charCodeAt(M)!==f;);}if(0===m)break;M++}if(m=l.substring(F,M),0===p&&(p=(z=z.replace(u,"").trim()).charCodeAt(0)),64===p){switch(0<j&&(z=z.replace(d,"")),f=z.charCodeAt(1)){case 100:case 109:case 115:case 45:j=i;break;default:j=N}if(F=(m=t(i,j,m,f,h+1)).length,0<D&&(_=a(3,m,j=n(N,z,U),i,R,I,F,f,h,c),z=j.join(""),void 0!==_&&0===(F=(m=_.trim()).length)&&(f=0,m="")),0<F)switch(f){case 115:z=z.replace(w,o);case 100:case 109:case 45:m=z+"{"+m+"}";break;case 107:m=(z=z.replace(v,"$1 $2"))+"{"+m+"}",m=1===A||2===A&&s("@"+m,3)?"@-webkit-"+m+"@"+m:"@"+m;break;default:m=z+m,112===c&&($+=m,m="")}else m=""}else m=t(i,n(i,z,U),m,c,h+1);q+=m,m=U=j=O=p=0,z="",f=l.charCodeAt(++M);break;case 125:case 59:if(1<(F=(z=(0<j?z.replace(d,""):z).trim()).length))switch(0===O&&(p=z.charCodeAt(0),45===p||96<p&&123>p)&&(F=(z=z.replace(" ",":")).length),0<D&&void 0!==(_=a(1,z,i,e,R,I,$.length,c,h,c))&&0===(F=(z=_.trim()).length)&&(z="\0\0"),p=z.charCodeAt(0),f=z.charCodeAt(1),p){case 0:break;case 64:if(105===f||99===f){G+=z+l.charAt(M);break}default:58!==z.charCodeAt(F-1)&&($+=r(z,p,f,z.charCodeAt(2)))}U=j=O=p=0,z="",f=l.charCodeAt(++M)}}switch(f){case 13:case 10:47===T?T=0:0===1+p&&107!==c&&0<z.length&&(j=1,z+="\0"),0<D*L&&a(0,z,i,e,R,I,$.length,c,h,c),I=1,R++;break;case 59:case 125:if(0===T+k+E+S){I++;break}default:switch(I++,g=l.charAt(M),f){case 9:case 32:if(0===k+S+T)switch(C){case 44:case 58:case 9:case 32:g="";break;default:32!==f&&(g=" ")}break;case 0:g="\\0";break;case 12:g="\\f";break;case 11:g="\\v";break;case 38:0===k+T+S&&(j=U=1,g="\f"+g);break;case 108:if(0===k+T+S+P&&0<O)switch(M-O){case 2:112===C&&58===l.charCodeAt(M-3)&&(P=C);case 8:111===x&&(P=x)}break;case 58:0===k+T+S&&(O=M);break;case 44:0===T+E+k+S&&(j=1,g+="\r");break;case 34:case 39:0===T&&(k=k===f?0:0===k?f:k);break;case 91:0===k+T+E&&S++;break;case 93:0===k+T+E&&S--;break;case 41:0===k+T+S&&E--;break;case 40:if(0===k+T+S){if(0===p)if(2*C+3*x==533);else p=1;E++}break;case 64:0===T+E+k+S+O+m&&(m=1);break;case 42:case 47:if(!(0<k+S+E))switch(T){case 0:switch(2*f+3*l.charCodeAt(M+1)){case 235:T=47;break;case 220:F=M,T=42}break;case 42:47===f&&42===C&&F+2!==M&&(33===l.charCodeAt(F+2)&&($+=l.substring(F,M+1)),g="",T=0)}}0===T&&(z+=g)}x=C,C=f,M++}if(0<(F=$.length)){if(j=i,0<D&&(void 0!==(_=a(2,$,j,e,R,I,F,c,h,c))&&0===($=_).length))return G+$+q;if($=j.join(",")+"{"+$+"}",0!=A*P){switch(2!==A||s($,2)||(P=0),P){case 111:$=$.replace(b,":-moz-$1")+$;break;case 112:$=$.replace(y,"::-webkit-input-$1")+$.replace(y,"::-moz-$1")+$.replace(y,":-ms-input-$1")+$}P=0}}return G+$+q}function n(e,t,n){var r=t.trim().split(m);t=r;var s=r.length,o=e.length;switch(o){case 0:case 1:var a=0;for(e=0===o?"":e[0]+" ";a<s;++a)t[a]=i(e,t[a],n).trim();break;default:var l=a=0;for(t=[];a<s;++a)for(var c=0;c<o;++c)t[l++]=i(e[c]+" ",r[a],n).trim()}return t}function i(e,t,n){var i=t.charCodeAt(0);switch(33>i&&(i=(t=t.trim()).charCodeAt(0)),i){case 38:return t.replace(g,"$1"+e.trim());case 58:return e.trim()+t.replace(g,"$1"+e.trim());default:if(0<1*n&&0<t.indexOf("\f"))return t.replace(g,(58===e.charCodeAt(0)?"":"$1")+e.trim())}return e+t}function r(e,t,n,i){var o=e+";",a=2*t+3*n+4*i;if(944===a){e=o.indexOf(":",9)+1;var l=o.substring(e,o.length-1).trim();return l=o.substring(0,e).trim()+l+";",1===A||2===A&&s(l,1)?"-webkit-"+l+l:l}if(0===A||2===A&&!s(o,1))return o;switch(a){case 1015:return 97===o.charCodeAt(10)?"-webkit-"+o+o:o;case 951:return 116===o.charCodeAt(3)?"-webkit-"+o+o:o;case 963:return 110===o.charCodeAt(5)?"-webkit-"+o+o:o;case 1009:if(100!==o.charCodeAt(4))break;case 969:case 942:return"-webkit-"+o+o;case 978:return"-webkit-"+o+"-moz-"+o+o;case 1019:case 983:return"-webkit-"+o+"-moz-"+o+"-ms-"+o+o;case 883:if(45===o.charCodeAt(8))return"-webkit-"+o+o;if(0<o.indexOf("image-set(",11))return o.replace(C,"$1-webkit-$2")+o;break;case 932:if(45===o.charCodeAt(4))switch(o.charCodeAt(5)){case 103:return"-webkit-box-"+o.replace("-grow","")+"-webkit-"+o+"-ms-"+o.replace("grow","positive")+o;case 115:return"-webkit-"+o+"-ms-"+o.replace("shrink","negative")+o;case 98:return"-webkit-"+o+"-ms-"+o.replace("basis","preferred-size")+o}return"-webkit-"+o+"-ms-"+o+o;case 964:return"-webkit-"+o+"-ms-flex-"+o+o;case 1023:if(99!==o.charCodeAt(8))break;return"-webkit-box-pack"+(l=o.substring(o.indexOf(":",15)).replace("flex-","").replace("space-between","justify"))+"-webkit-"+o+"-ms-flex-pack"+l+o;case 1005:return p.test(o)?o.replace(h,":-webkit-")+o.replace(h,":-moz-")+o:o;case 1e3:switch(t=(l=o.substring(13).trim()).indexOf("-")+1,l.charCodeAt(0)+l.charCodeAt(t)){case 226:l=o.replace(_,"tb");break;case 232:l=o.replace(_,"tb-rl");break;case 220:l=o.replace(_,"lr");break;default:return o}return"-webkit-"+o+"-ms-"+l+o;case 1017:if(-1===o.indexOf("sticky",9))break;case 975:switch(t=(o=e).length-10,a=(l=(33===o.charCodeAt(t)?o.substring(0,t):o).substring(e.indexOf(":",7)+1).trim()).charCodeAt(0)+(0|l.charCodeAt(7))){case 203:if(111>l.charCodeAt(8))break;case 115:o=o.replace(l,"-webkit-"+l)+";"+o;break;case 207:case 102:o=o.replace(l,"-webkit-"+(102<a?"inline-":"")+"box")+";"+o.replace(l,"-webkit-"+l)+";"+o.replace(l,"-ms-"+l+"box")+";"+o}return o+";";case 938:if(45===o.charCodeAt(5))switch(o.charCodeAt(6)){case 105:return l=o.replace("-items",""),"-webkit-"+o+"-webkit-box-"+l+"-ms-flex-"+l+o;case 115:return"-webkit-"+o+"-ms-flex-item-"+o.replace(T,"")+o;default:return"-webkit-"+o+"-ms-flex-line-pack"+o.replace("align-content","").replace(T,"")+o}break;case 973:case 989:if(45!==o.charCodeAt(3)||122===o.charCodeAt(4))break;case 931:case 953:if(!0===k.test(e))return 115===(l=e.substring(e.indexOf(":")+1)).charCodeAt(0)?r(e.replace("stretch","fill-available"),t,n,i).replace(":fill-available",":stretch"):o.replace(l,"-webkit-"+l)+o.replace(l,"-moz-"+l.replace("fill-",""))+o;break;case 962:if(o="-webkit-"+o+(102===o.charCodeAt(5)?"-ms-"+o:"")+o,211===n+i&&105===o.charCodeAt(13)&&0<o.indexOf("transform",10))return o.substring(0,o.indexOf(";",27)+1).replace(f,"$1-webkit-$2")+o}return o}function s(e,t){var n=e.indexOf(1===t?":":"{"),i=e.substring(0,3!==t?n:10);return n=e.substring(n+1,e.length-1),O(2!==t?i:i.replace(E,"$1"),n,t)}function o(e,t){var n=r(t,t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2));return n!==t+";"?n.replace(S," or ($1)").substring(4):"("+t+")"}function a(e,t,n,i,r,s,o,a,l,u){for(var d,h=0,p=t;h<D;++h)switch(d=x[h].call(c,e,p,n,i,r,s,o,a,l,u)){case void 0:case!1:case!0:case null:break;default:p=d}if(p!==t)return p}function l(e){return void 0!==(e=e.prefix)&&(O=null,e?"function"!=typeof e?A=1:(A=2,O=e):A=0),l}function c(e,n){var i=e;if(33>i.charCodeAt(0)&&(i=i.trim()),i=[i],0<D){var r=a(-1,n,i,i,R,I,0,0,0,0);void 0!==r&&"string"==typeof r&&(n=r)}var s=t(N,i,n,0,0);return 0<D&&(void 0!==(r=a(-2,s,i,i,R,I,s.length,0,0,0))&&(s=r)),"",P=0,I=R=1,s}var u=/^\0+/g,d=/[\0\r\f]/g,h=/: */g,p=/zoo|gra/,f=/([,: ])(transform)/g,m=/,\r+?/g,g=/([\t\r\n ])*\f?&/g,v=/@(k\w+)\s*(\S*)\s*/,y=/::(place)/g,b=/:(read-only)/g,_=/[svh]\w+-[tblr]{2}/,w=/\(\s*(.*)\s*\)/g,S=/([\s\S]*?);/g,T=/-self|flex-/g,E=/[^]*?(:[rp][el]a[\w-]+)[^]*/,k=/stretch|:\s*\w+\-(?:conte|avail)/,C=/([^-])(image-set\()/,I=1,R=1,P=0,A=1,N=[],x=[],D=0,O=null,L=0;return c.use=function e(t){switch(t){case void 0:case null:D=x.length=0;break;default:if("function"==typeof t)x[D++]=t;else if("object"==typeof t)for(var n=0,i=t.length;n<i;++n)e(t[n]);else L=0|!!t}return e},c.set=l,void 0!==e&&l(e),c};const l={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1};function c(e){var t=Object.create(null);return function(n){return void 0===t[n]&&(t[n]=e(n)),t[n]}}var u=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,d=c((function(e){return u.test(e)||111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)<91})),h=n(2545),p=n.n(h);function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}var m=function(e,t){for(var n=[e[0]],i=0,r=t.length;i<r;i+=1)n.push(t[i],e[i+1]);return n},g=function(e){return null!==e&&"object"==typeof e&&"[object Object]"===(e.toString?e.toString():Object.prototype.toString.call(e))&&!(0,i.typeOf)(e)},v=Object.freeze([]),y=Object.freeze({});function b(e){return"function"==typeof e}function _(e){return e.displayName||e.name||"Component"}function w(e){return e&&"string"==typeof e.styledComponentId}var S="undefined"!=typeof process&&void 0!==process.env&&(process.env.REACT_APP_SC_ATTR||process.env.SC_ATTR)||"data-styled",T="undefined"!=typeof window&&"HTMLElement"in window,E=Boolean("boolean"==typeof SC_DISABLE_SPEEDY?SC_DISABLE_SPEEDY:"undefined"!=typeof process&&void 0!==process.env&&(void 0!==process.env.REACT_APP_SC_DISABLE_SPEEDY&&""!==process.env.REACT_APP_SC_DISABLE_SPEEDY?"false"!==process.env.REACT_APP_SC_DISABLE_SPEEDY&&process.env.REACT_APP_SC_DISABLE_SPEEDY:void 0!==process.env.SC_DISABLE_SPEEDY&&""!==process.env.SC_DISABLE_SPEEDY&&("false"!==process.env.SC_DISABLE_SPEEDY&&process.env.SC_DISABLE_SPEEDY)));function k(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];throw new Error("An error occurred. See https://git.io/JUIaE#"+e+" for more information."+(n.length>0?" Args: "+n.join(", "):""))}var C=function(){function e(e){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=e}var t=e.prototype;return t.indexOfGroup=function(e){for(var t=0,n=0;n<e;n++)t+=this.groupSizes[n];return t},t.insertRules=function(e,t){if(e>=this.groupSizes.length){for(var n=this.groupSizes,i=n.length,r=i;e>=r;)(r<<=1)<0&&k(16,""+e);this.groupSizes=new Uint32Array(r),this.groupSizes.set(n),this.length=r;for(var s=i;s<r;s++)this.groupSizes[s]=0}for(var o=this.indexOfGroup(e+1),a=0,l=t.length;a<l;a++)this.tag.insertRule(o,t[a])&&(this.groupSizes[e]++,o++)},t.clearGroup=function(e){if(e<this.length){var t=this.groupSizes[e],n=this.indexOfGroup(e),i=n+t;this.groupSizes[e]=0;for(var r=n;r<i;r++)this.tag.deleteRule(n)}},t.getGroup=function(e){var t="";if(e>=this.length||0===this.groupSizes[e])return t;for(var n=this.groupSizes[e],i=this.indexOfGroup(e),r=i+n,s=i;s<r;s++)t+=this.tag.getRule(s)+"/*!sc*/\n";return t},e}(),I=new Map,R=new Map,P=1,A=function(e){if(I.has(e))return I.get(e);for(;R.has(P);)P++;var t=P++;return I.set(e,t),R.set(t,e),t},N=function(e){return R.get(e)},x=function(e,t){t>=P&&(P=t+1),I.set(e,t),R.set(t,e)},D="style["+S+'][data-styled-version="5.3.11"]',O=new RegExp("^"+S+'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)'),L=function(e,t,n){for(var i,r=n.split(","),s=0,o=r.length;s<o;s++)(i=r[s])&&e.registerName(t,i)},M=function(e,t){for(var n=(t.textContent||"").split("/*!sc*/\n"),i=[],r=0,s=n.length;r<s;r++){var o=n[r].trim();if(o){var a=o.match(O);if(a){var l=0|parseInt(a[1],10),c=a[2];0!==l&&(x(c,l),L(e,c,a[3]),e.getTag().insertRules(l,i)),i.length=0}else i.push(o)}}},j=function(){return n.nc},U=function(e){var t=document.head,n=e||t,i=document.createElement("style"),r=function(e){for(var t=e.childNodes,n=t.length;n>=0;n--){var i=t[n];if(i&&1===i.nodeType&&i.hasAttribute(S))return i}}(n),s=void 0!==r?r.nextSibling:null;i.setAttribute(S,"active"),i.setAttribute("data-styled-version","5.3.11");var o=j();return o&&i.setAttribute("nonce",o),n.insertBefore(i,s),i},F=function(){function e(e){var t=this.element=U(e);t.appendChild(document.createTextNode("")),this.sheet=function(e){if(e.sheet)return e.sheet;for(var t=document.styleSheets,n=0,i=t.length;n<i;n++){var r=t[n];if(r.ownerNode===e)return r}k(17)}(t),this.length=0}var t=e.prototype;return t.insertRule=function(e,t){try{return this.sheet.insertRule(t,e),this.length++,!0}catch(e){return!1}},t.deleteRule=function(e){this.sheet.deleteRule(e),this.length--},t.getRule=function(e){var t=this.sheet.cssRules[e];return void 0!==t&&"string"==typeof t.cssText?t.cssText:""},e}(),V=function(){function e(e){var t=this.element=U(e);this.nodes=t.childNodes,this.length=0}var t=e.prototype;return t.insertRule=function(e,t){if(e<=this.length&&e>=0){var n=document.createTextNode(t),i=this.nodes[e];return this.element.insertBefore(n,i||null),this.length++,!0}return!1},t.deleteRule=function(e){this.element.removeChild(this.nodes[e]),this.length--},t.getRule=function(e){return e<this.length?this.nodes[e].textContent:""},e}(),B=function(){function e(e){this.rules=[],this.length=0}var t=e.prototype;return t.insertRule=function(e,t){return e<=this.length&&(this.rules.splice(e,0,t),this.length++,!0)},t.deleteRule=function(e){this.rules.splice(e,1),this.length--},t.getRule=function(e){return e<this.length?this.rules[e]:""},e}(),z=T,$={isServer:!T,useCSSOMInjection:!E},q=function(){function e(e,t,n){void 0===e&&(e=y),void 0===t&&(t={}),this.options=f({},$,{},e),this.gs=t,this.names=new Map(n),this.server=!!e.isServer,!this.server&&T&&z&&(z=!1,function(e){for(var t=document.querySelectorAll(D),n=0,i=t.length;n<i;n++){var r=t[n];r&&"active"!==r.getAttribute(S)&&(M(e,r),r.parentNode&&r.parentNode.removeChild(r))}}(this))}e.registerId=function(e){return A(e)};var t=e.prototype;return t.reconstructWithOptions=function(t,n){return void 0===n&&(n=!0),new e(f({},this.options,{},t),this.gs,n&&this.names||void 0)},t.allocateGSInstance=function(e){return this.gs[e]=(this.gs[e]||0)+1},t.getTag=function(){return this.tag||(this.tag=(n=(t=this.options).isServer,i=t.useCSSOMInjection,r=t.target,e=n?new B(r):i?new F(r):new V(r),new C(e)));var e,t,n,i,r},t.hasNameForId=function(e,t){return this.names.has(e)&&this.names.get(e).has(t)},t.registerName=function(e,t){if(A(e),this.names.has(e))this.names.get(e).add(t);else{var n=new Set;n.add(t),this.names.set(e,n)}},t.insertRules=function(e,t,n){this.registerName(e,t),this.getTag().insertRules(A(e),n)},t.clearNames=function(e){this.names.has(e)&&this.names.get(e).clear()},t.clearRules=function(e){this.getTag().clearGroup(A(e)),this.clearNames(e)},t.clearTag=function(){this.tag=void 0},t.toString=function(){return function(e){for(var t=e.getTag(),n=t.length,i="",r=0;r<n;r++){var s=N(r);if(void 0!==s){var o=e.names.get(s),a=t.getGroup(r);if(o&&a&&o.size){var l=S+".g"+r+'[id="'+s+'"]',c="";void 0!==o&&o.forEach((function(e){e.length>0&&(c+=e+",")})),i+=""+a+l+'{content:"'+c+'"}/*!sc*/\n'}}}return i}(this)},e}(),G=/(a)(d)/gi,W=function(e){return String.fromCharCode(e+(e>25?39:97))};function H(e){var t,n="";for(t=Math.abs(e);t>52;t=t/52|0)n=W(t%52)+n;return(W(t%52)+n).replace(G,"$1-$2")}var K=function(e,t){for(var n=t.length;n;)e=33*e^t.charCodeAt(--n);return e},J=function(e){return K(5381,e)};function Q(e){for(var t=0;t<e.length;t+=1){var n=e[t];if(b(n)&&!w(n))return!1}return!0}var Y=J("5.3.11"),Z=function(){function e(e,t,n){this.rules=e,this.staticRulesId="",this.isStatic=(void 0===n||n.isStatic)&&Q(e),this.componentId=t,this.baseHash=K(Y,t),this.baseStyle=n,q.registerId(t)}return e.prototype.generateAndInjectStyles=function(e,t,n){var i=this.componentId,r=[];if(this.baseStyle&&r.push(this.baseStyle.generateAndInjectStyles(e,t,n)),this.isStatic&&!n.hash)if(this.staticRulesId&&t.hasNameForId(i,this.staticRulesId))r.push(this.staticRulesId);else{var s=ge(this.rules,e,t,n).join(""),o=H(K(this.baseHash,s)>>>0);if(!t.hasNameForId(i,o)){var a=n(s,"."+o,void 0,i);t.insertRules(i,o,a)}r.push(o),this.staticRulesId=o}else{for(var l=this.rules.length,c=K(this.baseHash,n.hash),u="",d=0;d<l;d++){var h=this.rules[d];if("string"==typeof h)u+=h;else if(h){var p=ge(h,e,t,n),f=Array.isArray(p)?p.join(""):p;c=K(c,f+d),u+=f}}if(u){var m=H(c>>>0);if(!t.hasNameForId(i,m)){var g=n(u,"."+m,void 0,i);t.insertRules(i,m,g)}r.push(m)}}return r.join(" ")},e}(),X=/^\s*\/\/.*$/gm,ee=[":","[",".","#"];function te(e){var t,n,i,r,s=void 0===e?y:e,o=s.options,l=void 0===o?y:o,c=s.plugins,u=void 0===c?v:c,d=new a(l),h=[],p=function(e){function t(t){if(t)try{e(t+"}")}catch(e){}}return function(n,i,r,s,o,a,l,c,u,d){switch(n){case 1:if(0===u&&64===i.charCodeAt(0))return e(i+";"),"";break;case 2:if(0===c)return i+"/*|*/";break;case 3:switch(c){case 102:case 112:return e(r[0]+i),"";default:return i+(0===d?"/*|*/":"")}case-2:i.split("/*|*/}").forEach(t)}}}((function(e){h.push(e)})),f=function(e,i,s){return 0===i&&-1!==ee.indexOf(s[n.length])||s.match(r)?e:"."+t};function m(e,s,o,a){void 0===a&&(a="&");var l=e.replace(X,""),c=s&&o?o+" "+s+" { "+l+" }":l;return t=a,n=s,i=new RegExp("\\"+n+"\\b","g"),r=new RegExp("(\\"+n+"\\b){2,}"),d(o||!s?"":s,c)}return d.use([].concat(u,[function(e,t,r){2===e&&r.length&&r[0].lastIndexOf(n)>0&&(r[0]=r[0].replace(i,f))},p,function(e){if(-2===e){var t=h;return h=[],t}}])),m.hash=u.length?u.reduce((function(e,t){return t.name||k(15),K(e,t.name)}),5381).toString():"",m}var ne=r.createContext(),ie=(ne.Consumer,r.createContext()),re=(ie.Consumer,new q),se=te();function oe(){return(0,r.useContext)(ne)||re}function ae(){return(0,r.useContext)(ie)||se}function le(e){var t=(0,r.useState)(e.stylisPlugins),n=t[0],i=t[1],s=oe(),a=(0,r.useMemo)((function(){var t=s;return e.sheet?t=e.sheet:e.target&&(t=t.reconstructWithOptions({target:e.target},!1)),e.disableCSSOMInjection&&(t=t.reconstructWithOptions({useCSSOMInjection:!1})),t}),[e.disableCSSOMInjection,e.sheet,e.target]),l=(0,r.useMemo)((function(){return te({options:{prefix:!e.disableVendorPrefixes},plugins:n})}),[e.disableVendorPrefixes,n]);return(0,r.useEffect)((function(){o()(n,e.stylisPlugins)||i(e.stylisPlugins)}),[e.stylisPlugins]),r.createElement(ne.Provider,{value:a},r.createElement(ie.Provider,{value:l},e.children))}var ce=function(){function e(e,t){var n=this;this.inject=function(e,t){void 0===t&&(t=se);var i=n.name+t.hash;e.hasNameForId(n.id,i)||e.insertRules(n.id,i,t(n.rules,i,"@keyframes"))},this.toString=function(){return k(12,String(n.name))},this.name=e,this.id="sc-keyframes-"+e,this.rules=t}return e.prototype.getName=function(e){return void 0===e&&(e=se),this.name+e.hash},e}(),ue=/([A-Z])/,de=/([A-Z])/g,he=/^ms-/,pe=function(e){return"-"+e.toLowerCase()};function fe(e){return ue.test(e)?e.replace(de,pe).replace(he,"-ms-"):e}var me=function(e){return null==e||!1===e||""===e};function ge(e,t,n,i){if(Array.isArray(e)){for(var r,s=[],o=0,a=e.length;o<a;o+=1)""!==(r=ge(e[o],t,n,i))&&(Array.isArray(r)?s.push.apply(s,r):s.push(r));return s}return me(e)?"":w(e)?"."+e.styledComponentId:b(e)?"function"!=typeof(c=e)||c.prototype&&c.prototype.isReactComponent||!t?e:ge(e(t),t,n,i):e instanceof ce?n?(e.inject(n,i),e.getName(i)):e:g(e)?function e(t,n){var i,r,s=[];for(var o in t)t.hasOwnProperty(o)&&!me(t[o])&&(Array.isArray(t[o])&&t[o].isCss||b(t[o])?s.push(fe(o)+":",t[o],";"):g(t[o])?s.push.apply(s,e(t[o],o)):s.push(fe(o)+": "+(i=o,(null==(r=t[o])||"boolean"==typeof r||""===r?"":"number"!=typeof r||0===r||i in l||i.startsWith("--")?String(r).trim():r+"px")+";")));return n?[n+" {"].concat(s,["}"]):s}(e):e.toString();var c}var ve=function(e){return Array.isArray(e)&&(e.isCss=!0),e};function ye(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return b(e)||g(e)?ve(ge(m(v,[e].concat(n)))):0===n.length&&1===e.length&&"string"==typeof e[0]?e:ve(ge(m(e,n)))}new Set;var be=function(e,t,n){return void 0===n&&(n=y),e.theme!==n.theme&&e.theme||t||n.theme},_e=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,we=/(^-|-$)/g;function Se(e){return e.replace(_e,"-").replace(we,"")}var Te=function(e){return H(J(e)>>>0)};function Ee(e){return"string"==typeof e&&!0}var ke=function(e){return"function"==typeof e||"object"==typeof e&&null!==e&&!Array.isArray(e)},Ce=function(e){return"__proto__"!==e&&"constructor"!==e&&"prototype"!==e};function Ie(e,t,n){var i=e[n];ke(t)&&ke(i)?Re(i,t):e[n]=t}function Re(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(var r=0,s=n;r<s.length;r++){var o=s[r];if(ke(o))for(var a in o)Ce(a)&&Ie(e,o[a],a)}return e}var Pe=r.createContext();Pe.Consumer;var Ae={};function Ne(e,t,n){var i=w(e),s=!Ee(e),o=t.attrs,a=void 0===o?v:o,l=t.componentId,c=void 0===l?function(e,t){var n="string"!=typeof e?"sc":Se(e);Ae[n]=(Ae[n]||0)+1;var i=n+"-"+Te("5.3.11"+n+Ae[n]);return t?t+"-"+i:i}(t.displayName,t.parentComponentId):l,u=t.displayName,h=void 0===u?function(e){return Ee(e)?"styled."+e:"Styled("+_(e)+")"}(e):u,m=t.displayName&&t.componentId?Se(t.displayName)+"-"+t.componentId:t.componentId||c,g=i&&e.attrs?Array.prototype.concat(e.attrs,a).filter(Boolean):a,S=t.shouldForwardProp;i&&e.shouldForwardProp&&(S=t.shouldForwardProp?function(n,i,r){return e.shouldForwardProp(n,i,r)&&t.shouldForwardProp(n,i,r)}:e.shouldForwardProp);var T,E=new Z(n,m,i?e.componentStyle:void 0),k=E.isStatic&&0===a.length,C=function(e,t){return function(e,t,n,i){var s=e.attrs,o=e.componentStyle,a=e.defaultProps,l=e.foldedComponentIds,c=e.shouldForwardProp,u=e.styledComponentId,h=e.target,p=function(e,t,n){void 0===e&&(e=y);var i=f({},t,{theme:e}),r={};return n.forEach((function(e){var t,n,s,o=e;for(t in b(o)&&(o=o(i)),o)i[t]=r[t]="className"===t?(n=r[t],s=o[t],n&&s?n+" "+s:n||s):o[t]})),[i,r]}(be(t,(0,r.useContext)(Pe),a)||y,t,s),m=p[0],g=p[1],v=function(e,t,n,i){var r=oe(),s=ae();return t?e.generateAndInjectStyles(y,r,s):e.generateAndInjectStyles(n,r,s)}(o,i,m),_=n,w=g.$as||t.$as||g.as||t.as||h,S=Ee(w),T=g!==t?f({},t,{},g):t,E={};for(var k in T)"$"!==k[0]&&"as"!==k&&("forwardedAs"===k?E.as=T[k]:(c?c(k,d,w):!S||d(k))&&(E[k]=T[k]));return t.style&&g.style!==t.style&&(E.style=f({},t.style,{},g.style)),E.className=Array.prototype.concat(l,u,v!==u?v:null,t.className,g.className).filter(Boolean).join(" "),E.ref=_,(0,r.createElement)(w,E)}(T,e,t,k)};return C.displayName=h,(T=r.forwardRef(C)).attrs=g,T.componentStyle=E,T.displayName=h,T.shouldForwardProp=S,T.foldedComponentIds=i?Array.prototype.concat(e.foldedComponentIds,e.styledComponentId):v,T.styledComponentId=m,T.target=i?e.target:e,T.withComponent=function(e){var i=t.componentId,r=function(e,t){if(null==e)return{};var n,i,r={},s=Object.keys(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(t,["componentId"]),s=i&&i+"-"+(Ee(e)?e:Se(_(e)));return Ne(e,f({},r,{attrs:g,componentId:s}),n)},Object.defineProperty(T,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(t){this._foldedDefaultProps=i?Re({},e.defaultProps,t):t}}),Object.defineProperty(T,"toString",{value:function(){return"."+T.styledComponentId}}),s&&p()(T,e,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0,withComponent:!0}),T}var xe=function(e){return function e(t,n,r){if(void 0===r&&(r=y),!(0,i.isValidElementType)(n))return k(1,String(n));var s=function(){return t(n,r,ye.apply(void 0,arguments))};return s.withConfig=function(i){return e(t,n,f({},r,{},i))},s.attrs=function(i){return e(t,n,f({},r,{attrs:Array.prototype.concat(r.attrs,i).filter(Boolean)}))},s}(Ne,e)};["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","textPath","tspan"].forEach((function(e){xe[e]=xe(e)}));!function(){function e(e,t){this.rules=e,this.componentId=t,this.isStatic=Q(e),q.registerId(this.componentId+1)}var t=e.prototype;t.createStyles=function(e,t,n,i){var r=i(ge(this.rules,t,n,i).join(""),""),s=this.componentId+e;n.insertRules(s,s,r)},t.removeStyles=function(e,t){t.clearRules(this.componentId+e)},t.renderStyles=function(e,t,n,i){e>2&&q.registerId(this.componentId+e),this.removeStyles(e,n),this.createStyles(e,t,n,i)}}();!function(){function e(){var e=this;this._emitSheetCSS=function(){var t=e.instance.toString();if(!t)return"";var n=j();return"<style "+[n&&'nonce="'+n+'"',S+'="true"','data-styled-version="5.3.11"'].filter(Boolean).join(" ")+">"+t+"</style>"},this.getStyleTags=function(){return e.sealed?k(2):e._emitSheetCSS()},this.getStyleElement=function(){var t;if(e.sealed)return k(2);var n=((t={})[S]="",t["data-styled-version"]="5.3.11",t.dangerouslySetInnerHTML={__html:e.instance.toString()},t),i=j();return i&&(n.nonce=i),[r.createElement("style",f({},n,{key:"sc-0-0"}))]},this.seal=function(){e.sealed=!0},this.instance=new q({isServer:!0}),this.sealed=!1}var t=e.prototype;t.collectStyles=function(e){return this.sealed?k(2):r.createElement(le,{sheet:this.instance},e)},t.interleaveWithNodeStream=function(e){return k(3)}}();const De=xe},8709:(e,t,n)=>{"use strict";n.d(t,{Oy:()=>r,Qm:()=>o,St:()=>s});var i=n(7294);const r=i.createContext(null),s=i.createContext(null),o=i.createContext({companyUpdated:0})},8345:(e,t,n)=>{"use strict";n.r(t),n.d(t,{focusApp:()=>u,onElectronResize:()=>l,resizeToFullscreen:()=>a,sizes:()=>o});var i=n(6267),r=n(9994);let s;const o=[{name:"Extra Large",pages:[i._e,i.Kd,i.Ff,"/social-auth"],size:{width:993,height:728}},{name:"TeamCallSize",pages:[i.H],size:{width:604,height:728},pinned:!0},{name:"Medium",pages:[i.Gt,i.Pk],size:{width:541,height:359},pinned:!0},{name:"Default",pages:[i.ef,i._2],size:{width:280,height:445},pinned:!0},{name:"contacts-expanded",pages:["/home-contacts-expanded"],size:{width:520,height:476},pinned:!0},{name:"Small Auth Pages",pages:[i.UC,i.kS,i.Lx],size:{width:280,height:440}}];function a(){try{const e={name:"fullcreen",pages:[""],size:{width:window.screen.width,height:window.screen.height}};s=e,window.electron.send("maximize")}catch(e){}}async function l(e,t=!1,n={},o=!1){if(0==String(e).length)return void console.error("onElectronResize NO PATH provided",e);let a=function(e){let t=c(e);if(null===t&&e!==i.ef){t=c(`/${e.split("/")[1]}`)}return t}(e);if(null!=a)(s?.name!=a.name||t)&&((0,r.t)(a,n),s=a);else if(!o&&e!==i.ef){l(`/${e.split("/")[1]}`,t,n,!0)}}function c(e){if(!String(e).startsWith("/"))return console.error("path string should start with /",e),null;for(let t=0;t<o.length;t++){const n=o[t];if(n&&n.pages?.includes(e))return n}return null}function u(){window.electron.send("focusApp")}},9994:(e,t,n)=>{"use strict";function i(e,t={}){const n=!0===e?.pinned??!1;window.electron.send("customResize",{resize:{width:e.size.width,height:e.size.height},stayOnTop:n,options:t})}function r(e,t,n=!1){window.electron.send("customResize",{resize:{width:e,height:t},stayOnTop:n,options:{minimizing:!0}})}n.d(t,{Z:()=>r,t:()=>i})},8119:(e,t,n)=>{"use strict";n.d(t,{H5:()=>l,HB:()=>c,Le:()=>u,VI:()=>a,XS:()=>o,sL:()=>d});var i=n(6267);const r="used-app-before-1";function s(){return o()}function o(){try{const e=window.localStorage.getItem(r);if(e){if(JSON.parse(e))return!0}}catch(e){return!1}return!1}function a(){window.localStorage.removeItem(r)}function l(){window.localStorage.setItem(r,JSON.stringify(1))}function c(){return s()?i.UC:i._e}function u(){return i.Kd}function d(){return s()?i.kS:i.Ff}},143:(e,t,n)=>{"use strict";n.d(t,{Ip:()=>m,JZ:()=>c,Mj:()=>d,Re:()=>h,Si:()=>g,aU:()=>l,hB:()=>p,lB:()=>f,zV:()=>u});const i="presence_v2",r="team_presence_v2",s="team_call_v2",o="private_call_v2",a="company_users_state";function l(e,t){return`${o}/${e}/${t}`}function c(e){return`${o}/${e}`}function u(e){return`${s}/${e}`}function d(e){return`${s}/${e}/state`}function h(e,t){return`${s}/${e}/members/${t}/state`}function p(e,t=void 0){let n=`${i}/${e}`;return t&&(n+=""+t),n}function f(e){return`${r}/${e}`}function m(e,t,n=void 0){let i=`${r}/${e}/${t}`;return n&&(i+=""+n),i}function g(e){return`${a}/${e}`}},4290:(e,t,n)=>{"use strict";n.d(t,{E:()=>s});var i=n(270),r=n(782);const s=(0,i.ZP)()((0,r.mW)((0,r.tJ)((e=>({users:[],teams:[],setUsers:t=>e({users:t}),setTeams:t=>e({teams:t}),clearAll:()=>e({users:[],teams:[]})})),{name:"use-contacts-v2"})))},4430:(e,t,n)=>{"use strict";n.d(t,{i:()=>s});var i=n(270),r=n(782);const s=(0,i.ZP)()((0,r.mW)((0,r.tJ)((e=>({pendingRedirect:null,pendingRequest:null,dispatch:(t,n)=>{"pendingRequest"==t?e({pendingRequest:n}):"pendingRedirect"==t?e({pendingRedirect:n}):"reset"==t?e({pendingRequest:null,pendingRedirect:null}):console.error("409 invalid type for useRequestsStore.dispatch -> ",t,n)}})),{name:"useRequestsStore-v1"})))},7943:(e,t,n)=>{"use strict";n.d(t,{D6:()=>a,EO:()=>r,Ml:()=>c,U0:()=>o,aO:()=>l,fg:()=>s,oL:()=>u});n(1142);var i=n(3821);const r={offline:"offline",online:"online",busy:"busy"},s={offline:"#FF5250",online:"#80D06C",busy:"#F59506"},o={presence:r.offline,status:"",expiry:0};function a(e){return String(e).match(/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/)}function l(e){return String(e).trim().length>=10&&/\d/.test(e)&&/[a-zA-Z]/.test(e)}const c="Your password must contain at least 10 characters, including a combination of both letters and numbers.";function u(e){let t=Date.now();if(e==i.Mr){t+=function(){const e=(new Date).setHours(23,59,59,999);return e.valueOf()}()}else{t+=60*parseInt(e)}return t}},6540:(e,t,n)=>{"use strict";n.d(t,{a:()=>a});var i=n(270),r=n(782),s=n(7943),o=n(2485);const a=(0,i.ZP)()((0,r.mW)((0,r.tJ)((e=>({data:{presence:s.EO.offline,status:"",expiry:0},current:"",dispatch:t=>{e((e=>{const n=((e,t)=>{let n={presence:e.data.presence,status:e.data.status||"",expiry:e.data.expiry||0};return Object.keys(t).forEach((e=>{e in n?n[e]=t[e]:console.error("Bad key provided",e,t[e])})),n})(e,t);return{current:(0,o.ZT)(n),data:n}}))}})),{name:"presence-storage-v2"})))},5633:(e,t,n)=>{"use strict";function i(e){return e.name||e.displayName||e.email||"Person"}function r(e){return!!e.name&&!e.email}n.d(t,{R:()=>i,f:()=>r})},2485:(e,t,n)=>{"use strict";n.d(t,{$W:()=>d,Gg:()=>c,XO:()=>p,ZT:()=>o,iN:()=>h,s9:()=>u});var i=n(7943),r=n(3821),s=n(4340);const o=e=>l(e)&&!a(e.expiry)?e.status:e.presence;function a(e){return Date.now()>=e}function l(e){return""!=e.status&&e.expiry>0}function c(e){return o(e)!=i.EO.offline}function u(e){return e.presence==i.EO.offline}function d(e){return l(e)&&!a(e.expiry)&&""!=e.status?i.EO.busy:i.EO.online}function h(e){const t=r.eI.find((t=>t.key==e));return t?t.title:null}function p(e){const t=r.eI.find((t=>t.key==e&&!0===t.selectable));return t&&t.key in s?s[t.key]:null}},1008:(e,t,n)=>{"use strict";n.d(t,{n:()=>s});var i=n(143),r=n(1142);async function s(e,t,n,s){const o=(0,i.aU)(e,t),a=s?"creatorState":"guestState",l=`${o}/${a}`;let c={};("left"!=n||(c=await r.ij(o).catch((e=>{})),c&&c.timestamp))&&r.Wo(l,n).then((()=>{c&&function(e,t){const n="left"==e?.guestState||"reject"==e?.guestState||"reject"==t?.guestState||"left"==t?.guestState,i="left"==e?.creatorState||"left"==t?.creatorState;return n&&i}(c,{[a]:n})&&function(e,t){const n=(0,i.aU)(e,t);r.Wo(n,null)}(e,t)})).catch((e=>console.error(e)))}},3995:(e,t,n)=>{"use strict";n.d(t,{k:()=>s});var i=n(143),r=n(1142);function s(e,t,n){const s=(0,i.Re)(t,n);return r.Wo(s,e)}},8341:(e,t,n)=>{"use strict";n.d(t,{a:()=>r});n(9155),n(565);var i=n(763);function r(e){return e.customImage?e.customImage:e?.providerData?.photoURL?e.providerData.photoURL:e.photoURL?e.photoURL:i.bK}},8013:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var i=n(5893),r=n(5360);function s(e){return(0,i.jsxs)("div",{className:`centered-popup ${e.classNames}`,children:[(0,i.jsx)("div",{className:"blur-bg"}),(0,i.jsx)("div",{className:"centered-popup__wrapper",children:(0,i.jsxs)("div",{className:"centered-popup__container",children:[e.onClose&&(0,i.jsx)("div",{className:"centered-popup__close",children:(0,i.jsx)("img",{src:r.Z,onClick:e.onClose})}),e.image&&(0,i.jsx)("div",{className:"centered-popup__image",children:(0,i.jsx)("img",{src:e.image})}),e.title&&(0,i.jsx)("div",{className:"centered-popup__title",children:e.title}),e.message&&(0,i.jsx)("div",{className:"centered-popup__message",children:e.message}),(0,i.jsx)("div",{className:"centered-popup__actions",children:e.children})]})})]})}},2460:(e,t,n)=>{"use strict";n.d(t,{G:()=>o});var i=n(5893);n(7294);const r=n.p+"a55f5ffb6511267d5b8e18f48241b368.svg";const s=n.p+"3e0a6f43cc9d7f9042fffb9ad7ca1663.svg";function o(e){const{toggleMinimize:t,theme:n="dark"}=e;return(0,i.jsx)("button",{onClick:t,className:"clear-light minimized-arrow",children:"dark"==n?(0,i.jsx)("img",{src:s,className:"arrow-down"}):(0,i.jsx)("img",{src:r,className:"arrow-down"})})}},9947:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var i=n(5893),r=n(7943),s=n(7294);function o(e){const{currentState:t}=e,[n,o]=(0,s.useState)("transparent");return(0,s.useEffect)((function(){t==r.EO.offline?o("transparent"):t in r.EO?o(r.fg[t]):o(r.fg.busy)}),[t]),(0,i.jsx)("div",{className:e.classNames,style:{background:n}})}},5360:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});n(7294);const i=n.p+"8a3f713cf434cafd62d64893d93c50a6.svg"},763:(e,t,n)=>{"use strict";n.d(t,{bK:()=>i,R$:()=>r});n(749),n(6782);const i=n.p+"f0be3a4bc51939efb94c.png";n(7294);const r=n.p+"c212de8563c6ef67e7e9ec55a2732b82.svg"},7166:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i=n(8493)},8874:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});n(7294);const i=n.p+"b290dc49686add1c9e22d0da57858a83.svg"},4340:(e,t,n)=>{"use strict";n.r(t),n.d(t,{freshair:()=>i,lunch:()=>r,sick:()=>s,vacation:()=>o});n(7294);const i=n.p+"0eaee11ecc1f8e9f5cd8dbeb6d881c88.svg";const r=n.p+"8213b0c9ef677ea2cd9f6c99e43c9c6f.svg";const s=n.p+"cf3de526149a1d69192ba5e0b2b106f3.svg";const o=n.p+"c6896ca5436f2b3aef187abf7e1cf0bd.svg"},3531:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var i=n(5893),r=n(8341);function s(e){const{user:t}=e;let n=(0,r.a)(t);return(0,i.jsx)("img",{src:n,className:"profile-image",alt:e?.user?.email})}},5814:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(5893),r=n(7943),s=n(6540),o=n(7294);function a(e){const t=(0,s.a)((e=>e.current)),[n,a]=(0,o.useState)(r.fg.online);return(0,o.useEffect)((function(){t in r.EO?a(r.fg[t]):a(r.fg.busy)}),[t]),(0,i.jsx)("div",{className:e.classNames,style:{background:n}})}},6008:(e,t,n)=>{"use strict";n.d(t,{Cv:()=>u,Dx:()=>r,Ee:()=>s,GA:()=>a,JO:()=>d,U9:()=>l,bR:()=>c,im:()=>h});var i=n(2788);const r=i.ZP.div`
    color: white;
    padding-left: 10px;
    font-weight: 500;
    font-size: 13px;
    line-height: 18px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
`,s=(i.ZP.div`
    color: black;
    padding-left: 10px;
    font-weight: 500;
    font-size: 8px;
    line-height: 18px;
    overflow: hidden;
    text-overflow: ellipsis;
`,i.ZP.img`
    position: relative;
    width: 36px;
    height: 36px;
`),o=i.ZP.button`
    position: relative;
    margin-left: auto !important;
    background: #9CD78D;
    height: 31px;
    width: 31px;
    min-width: 31px;
    padding: 0 !important;
    margin: 0;
    opacity: 0.8;
    border-radius: 5px;
    display: flex;
    justify-content: center;
    align-items: center;  
`,a=(0,i.ZP)(o)`
    background: #9CD78D;
    &:hover{
        background: #9CD78D !important;
    }
`,l=(0,i.ZP)(o)`
    background: #727272;
    cursor: default;
    cursor: not-allowed;
    &:hover{
        background: #727272 !important;
    }
`,c=i.ZP.img`
        width: 20px;
        height: 20px;
`,u=(0,i.ZP)(o)`
    background: #89B77D;
    &:hover{
        background: #89B77D !important;
    }
`,d=i.ZP.img`
    width: 19px;
    height: 19px;
`,h=(i.ZP.span`
    position: absolute;
    top: -5px;
    right: -5px;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background-color: grey;
`,i.ZP.div`
    display: flex;
    flex-direction: row;
    align-items: center;
    padding: 5px 0;
    margin-bottom: 4px;

    /* &:hover:not(.disabled-hovers){
        ${r}{
            color: yellow;
        }
        ${d}{
            cursor: pointer;
            transform: translateY(1px);
        }
    } */
`)},3821:(e,t,n)=>{"use strict";n.d(t,{Bz:()=>p,Dk:()=>s,Hk:()=>a,K$:()=>i,Mr:()=>d,Nn:()=>h,TD:()=>o,Vy:()=>u,Yg:()=>c,eI:()=>f,np:()=>l,pz:()=>r});const i={user:"user",guest:"guest",host:"host"},r={disconnected:"Disconnected",connecting:"Connecting",connected:"Connected"},s=!1,o=!1,a="users_v2",l="user_interactions",c="companies",u="v2",d="EOD",h=6,p="donotdisturb",f=[{key:"lunch",title:"Out for lunch",selectable:!0},{key:"sick",title:"Out sick",selectable:!0},{key:"vacation",title:"On vacation",selectable:!0},{key:"freshair",title:"Getting some air",selectable:!0},{key:p,title:"Do not disturb",selectable:!1},{key:"oncall",title:"On call",selectable:!1}]},6267:(e,t,n)=>{"use strict";n.d(t,{wn:()=>ir,ef:()=>Xi,Gt:()=>hr,_e:()=>er,UC:()=>cr,Lx:()=>tr,Pk:()=>dr,ME:()=>or,VV:()=>lr,vZ:()=>ar,_2:()=>sr,Kd:()=>nr,Ff:()=>rr,kS:()=>ur,Z6:()=>fr,H:()=>pr,ZP:()=>gr});var i=n(5893),r=n(7294),s=n(8709),o=n(3821),a=n(9250),l=n(1142),c=n(2788),u=n(5783),d=n(725);function h(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((i=i.apply(e,t||[])).next())}))}var p=n(3273);const f=(e,t)=>p.Z.e("react-sdk",t,e),m=(e=f)=>{var t,n;const i=(0,u.cw)(),s=(0,u._U)(d.VP),o=(0,u._U)(d.pk),a=(0,u._U)((0,d.gA)(null==o?void 0:o.id)),l=(0,r.useCallback)(((t=!1)=>h(void 0,void 0,void 0,(function*(){try{yield i.setScreenShareEnabled(!s,t)}catch(t){e(t,"toggleScreenShare")}}))),[i,s,e]);return{amIScreenSharing:s,screenSharingPeerId:null==o?void 0:o.id,screenSharingPeerName:null==o?void 0:o.name,screenShareVideoTrackId:null===(t=null==a?void 0:a.video)||void 0===t?void 0:t.id,screenShareAudioTrackId:null===(n=null==a?void 0:a.audio)||void 0===n?void 0:n.id,toggleScreenShare:l}};function g(){return g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},g.apply(this,arguments)}function v(e,t){return v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},v(e,t)}var y=new Map,b=new WeakMap,_=0,w=void 0;function S(e){return Object.keys(e).sort().filter((function(t){return void 0!==e[t]})).map((function(t){return t+"_"+("root"===t?(n=e.root)?(b.has(n)||(_+=1,b.set(n,_.toString())),b.get(n)):"0":e[t]);var n})).toString()}function T(e,t,n,i){if(void 0===n&&(n={}),void 0===i&&(i=w),void 0===window.IntersectionObserver&&void 0!==i){var r=e.getBoundingClientRect();return t(i,{isIntersecting:i,target:e,intersectionRatio:"number"==typeof n.threshold?n.threshold:0,time:0,boundingClientRect:r,intersectionRect:r,rootBounds:r}),function(){}}var s=function(e){var t=S(e),n=y.get(t);if(!n){var i,r=new Map,s=new IntersectionObserver((function(t){t.forEach((function(t){var n,s=t.isIntersecting&&i.some((function(e){return t.intersectionRatio>=e}));e.trackVisibility&&void 0===t.isVisible&&(t.isVisible=s),null==(n=r.get(t.target))||n.forEach((function(e){e(s,t)}))}))}),e);i=s.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),n={id:t,observer:s,elements:r},y.set(t,n)}return n}(n),o=s.id,a=s.observer,l=s.elements,c=l.get(e)||[];return l.has(e)||l.set(e,c),c.push(t),a.observe(e),function(){c.splice(c.indexOf(t),1),0===c.length&&(l.delete(e),a.unobserve(e)),0===l.size&&(a.disconnect(),y.delete(o))}}var E=["children","as","triggerOnce","threshold","root","rootMargin","onChange","skip","trackVisibility","delay","initialInView","fallbackInView"];function k(e){return"function"!=typeof e.children}var C=function(e){var t,n;function i(t){var n;return(n=e.call(this,t)||this).node=null,n._unobserveCb=null,n.handleNode=function(e){n.node&&(n.unobserve(),e||n.props.triggerOnce||n.props.skip||n.setState({inView:!!n.props.initialInView,entry:void 0})),n.node=e||null,n.observeNode()},n.handleChange=function(e,t){e&&n.props.triggerOnce&&n.unobserve(),k(n.props)||n.setState({inView:e,entry:t}),n.props.onChange&&n.props.onChange(e,t)},n.state={inView:!!t.initialInView,entry:void 0},n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,v(t,n);var s=i.prototype;return s.componentDidUpdate=function(e){e.rootMargin===this.props.rootMargin&&e.root===this.props.root&&e.threshold===this.props.threshold&&e.skip===this.props.skip&&e.trackVisibility===this.props.trackVisibility&&e.delay===this.props.delay||(this.unobserve(),this.observeNode())},s.componentWillUnmount=function(){this.unobserve(),this.node=null},s.observeNode=function(){if(this.node&&!this.props.skip){var e=this.props,t=e.threshold,n=e.root,i=e.rootMargin,r=e.trackVisibility,s=e.delay,o=e.fallbackInView;this._unobserveCb=T(this.node,this.handleChange,{threshold:t,root:n,rootMargin:i,trackVisibility:r,delay:s},o)}},s.unobserve=function(){this._unobserveCb&&(this._unobserveCb(),this._unobserveCb=null)},s.render=function(){if(!k(this.props)){var e=this.state,t=e.inView,n=e.entry;return this.props.children({inView:t,entry:n,ref:this.handleNode})}var i=this.props,s=i.children,o=i.as,a=function(e,t){if(null==e)return{};var n,i,r={},s=Object.keys(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(i,E);return r.createElement(o||"div",g({ref:this.handleNode},a),s)},i}(r.Component);C.displayName="InView",C.defaultProps={threshold:0,triggerOnce:!1,initialInView:!1};const I=({trackId:e,attach:t,threshold:n=.5})=>{const i=(0,u.cw)(),s=(0,r.useRef)(null),o=(0,u._U)((0,d.GP)(e)),{ref:a,inView:l}=function(e){var t=void 0===e?{}:e,n=t.threshold,i=t.delay,s=t.trackVisibility,o=t.rootMargin,a=t.root,l=t.triggerOnce,c=t.skip,u=t.initialInView,d=t.fallbackInView,h=r.useRef(),p=r.useState({inView:!!u}),f=p[0],m=p[1],g=r.useCallback((function(e){void 0!==h.current&&(h.current(),h.current=void 0),c||e&&(h.current=T(e,(function(e,t){m({inView:e,entry:t}),t.isIntersecting&&l&&h.current&&(h.current(),h.current=void 0)}),{root:a,rootMargin:o,threshold:n,trackVisibility:s,delay:i},d))}),[Array.isArray(n)?n.toString():n,a,o,l,c,s,d,i]);(0,r.useEffect)((function(){h.current||!f.entry||l||c||m({inView:!!u})}));var v=[g,f.inView,f.entry];return v.ref=v[0],v.inView=v[1],v.entry=v[2],v}({threshold:n}),c=(0,r.useCallback)((e=>{e&&(s.current=e,a(e))}),[a]);return(0,r.useEffect)((()=>{h(void 0,void 0,void 0,(function*(){s.current&&(null==o?void 0:o.id)&&(l&&o.enabled&&!1!==t?yield i.attachVideo(o.id,s.current):yield i.detachVideo(o.id,s.current))}))}),[i,l,s,null==o?void 0:o.id,null==o?void 0:o.enabled,null==o?void 0:o.deviceID,null==o?void 0:o.plugins,t]),(0,r.useEffect)((()=>()=>{h(void 0,void 0,void 0,(function*(){if(s.current&&o)try{yield i.detachVideo(o.id,s.current)}catch(e){p.Z.w("detach video error for track",o.id,e)}}))}),[]),{videoRef:c}},R=c.ZP.video`
  outline: 1px dotted grey;
`;function P(e){const{peer:t,showName:n=!0,containerClass:s="peer-container",nameClass:o=""}=e,{videoRef:a}=I({trackId:t.videoTrack}),[l,c]=(0,r.useState)(!0);return(0,i.jsxs)("div",{className:s,children:[(0,i.jsx)(R,{ref:a,className:"peer-video "+(t.isLocal?"local":""),autoPlay:!0,muted:l,playsInline:!0}),n&&(0,i.jsxs)("div",{className:`peer-name ${o}`,children:[t.name," ",t.isLocal?"(You)":""]})]})}const A=(0,r.memo)((function(e){const{track:t,peer:n,canToggleFullscreen:s}=e,[o,a]=(0,r.useState)(!1);let l=null;const{videoRef:c}=I({trackId:t.id});function u(){o||!s||n.isLocal||e.isFullscreen||(e.toggleFullscreen&&e.toggleFullscreen(!0),a(!0),l=setTimeout((()=>{a(!1)}),500))}(0,r.useEffect)((()=>(window.addEventListener("dblclick",u,!1),document.addEventListener("keydown",d,!1),()=>{document.removeEventListener("keydown",d,!1),window.addEventListener("dblclick",u,!1)})),[]);const d=(0,r.useCallback)((t=>{!n.isLocal&&s&&("Escape"!=t.key&&27!==t.keyCode||e.toggleFullscreen&&e.toggleFullscreen(!1))}),[]);return(0,i.jsx)("div",{className:"screensharing-peer",children:(0,i.jsx)("div",{className:"screensharing-peer__container",children:(0,i.jsxs)("div",{className:"screensharing-peer__video-container",children:[(0,i.jsx)("video",{ref:c,autoPlay:!0,muted:!0,playsInline:!0}),s&&e.isFullscreen&&e.toggleFullscreen&&(0,i.jsx)("button",{className:"toggle-fullscreen-button clear-light",onClick:()=>{e.toggleFullscreen(!1)},children:"Exit fullscreen"})]})})})}));var N=n(5360),x=n(7166),D=n(5915);function O(e){return(0,i.jsx)("div",{className:`screen ${e.isSelected&&"screen__selected"}`,onClick:e.onSelect,children:(0,i.jsx)("img",{src:e.screen.preview,alt:e.screen.name})})}function L(e){const[t,n]=(0,r.useState)([]),[s,o]=(0,r.useState)(null),a=(0,u._U)(d.xf);return(0,D.Z)((async function(){window.electron.ipcRenderer.once("screensharing",(e=>{o(e[0]),n(e)})),window.electron.ipcRenderer.sendMessage("screensharing",{})})),(0,i.jsx)("div",{className:"screenshare-popup",children:(0,i.jsxs)("div",{className:"screenshare-popup__container",children:[(0,i.jsx)("div",{className:"screenshare-popup__close",onClick:e.onClose,children:(0,i.jsx)("img",{src:N.Z})}),a.screen?(0,i.jsxs)("div",{className:"screenshare-popup__title",children:["Share your screen ",e.name&&`with ${e.name}`]}):(0,i.jsx)("div",{className:"screenshare-popup__title",children:"Screensharing disabled! Enable it in dashboard."}),(0,i.jsx)("div",{className:"screenshare-popup__screens",children:a.screen?0===t.length?(0,i.jsx)("div",{className:"screenshare-popup__loading",children:(0,i.jsx)("img",{src:x.Z})}):(0,i.jsx)(i.Fragment,{children:t.map(((e,t)=>(0,i.jsx)(O,{screen:e,isSelected:s?.id==e.id,onSelect:()=>{o(e)}},e.id)))}):null}),(0,i.jsxs)("div",{className:"screenshare-popup__buttons",children:[(0,i.jsx)("button",{className:"outlined-light",onClick:e.onClose,children:"Cancel"}),(0,i.jsx)("button",{className:"green",onClick:function(){setTimeout((()=>{e.onShare(s),e.onClose()}),50)},disabled:null==s,children:"Share"})]})]})})}const M=()=>void 0!==navigator.mediaDevices.getDisplayMedia;function j(){let e=null;const t=(0,u.cw)(),n=(0,u._U)(d.xf),{amIScreenSharing:i}=m(),s=(0,u._U)(d.ln);function o(e){const t={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,minWidth:1280,maxWidth:1280,minHeight:720,maxHeight:720}};return console.log("config",e,t),t}return(0,D.Z)((()=>{M()||console.error("Screensharing is not supported!")})),(0,r.useEffect)((()=>{if(s&&!n.screen){const e="https://dashboard.100ms.live/dashboard";console.error("Screensharing is disabled in 100ms dashboard. Go to "+e+" and enable it!")}}),[s]),{start:async function(r,s="screen"){if(console.log("start",r,n.screen,i),n.screen&&!i){const n=await async function(e){const t={video:o(e),audio:!1},n=await navigator.mediaDevices.getUserMedia(t).catch(console.error);if(n)return n.getVideoTracks()[0];return null}(r);n&&(await t.addTrack(n,s),await t.setScreenShareEnabled(!0,{videoOnly:!0}),e=r)}},stop:async function(){null!=e?(await t.removeTrack(e),console.log("STOP SCREENSHARE",e)):console.log("missing currentTrack",e),await t.setScreenShareEnabled(!1)},active:n.screen&&i}}var U=n(8013);function F(e){return(0,i.jsxs)(U.Z,{title:"Do you want to stop sharing your screen?",classNames:"screenshare-stop",onClose:e.onCancel,children:[(0,i.jsx)("button",{onClick:e.onCancel,className:"outlined-light",children:"No"}),(0,i.jsx)("button",{onClick:e.onSuccess,className:"green",children:"Yes"})]})}const V=(e=f)=>{const t=(0,u._U)(d.uX),n=(0,u._U)(d.um),i=(0,u._U)(d.xf),s=(0,u.cw)(),o=(0,r.useCallback)((()=>h(void 0,void 0,void 0,(function*(){try{yield s.setLocalAudioEnabled(!t)}catch(t){e(t,"toggleAudio")}}))),[s,t,e]),a=(0,r.useCallback)((()=>h(void 0,void 0,void 0,(function*(){try{yield s.setLocalVideoEnabled(!n)}catch(t){e(t,"toggleVideo")}}))),[s,n,e]);return{isLocalAudioEnabled:t,isLocalVideoEnabled:n,toggleAudio:(null==i?void 0:i.audio)?o:void 0,toggleVideo:(null==i?void 0:i.video)?a:void 0}};const B=n.p+"f95dd7d6b8a7f295fce60256597d1681.svg";const z=n.p+"539abdbe5e0ecf37996573cdd301fa94.svg";const $=n.p+"a5027b2e5506baefaed94de36653f834.svg";function q(e){const{isLocalAudioEnabled:t,isLocalVideoEnabled:n,toggleAudio:r,toggleVideo:s}=V(),{amIScreenSharing:o}=m();return(0,i.jsx)("div",{className:"control-bar "+(e.classNames?e.classNames:""),children:(0,i.jsxs)("div",{className:"actions",children:[(0,i.jsx)("button",{className:`toggle-mic ${t?"clear-light":"active"} `,onClick:r,children:(0,i.jsx)("img",{src:z})}),(0,i.jsx)("button",{className:"leave-call clear-light",onClick:e.onLeave,children:(0,i.jsx)("img",{src:B})}),e.toggleScreenshare&&(0,i.jsx)("button",{className:"screen-share "+(o?"active":"clear-light"),onClick:e.toggleScreenshare,children:(0,i.jsx)("img",{src:$})})]})})}var G=n(2460);function W(e){const t=(0,a.TH)(),[s,l]=(0,r.useState)(!1),[c,h]=(0,r.useState)(!1),[p,f]=(0,r.useState)(!1),g=j(),{amIScreenSharing:v}=m(),[y,b]=(0,r.useState)(!1),{resizeToFullscreen:_,onElectronResize:w}=n(8345),S=(0,u._U)(d.BK),T=(0,u._U)(d.ud),E=(0,u._U)(d.pk),k=(0,u._U)((0,d.K6)(E?.id)),C=(0,u._U)(d.Pz);function I(){b(!1),w(t.pathname,!0)}function R(){c||v?v?f(!0):h(!1):h(!0)}return(0,r.useEffect)((()=>()=>{v&&g.stop(),y&&I()}),[]),(0,r.useEffect)((()=>{s!=T&&l(T)}),[T]),(0,r.useEffect)((()=>{s||k||!y||I()}),[s,k,y]),e.visible?(0,i.jsxs)("div",{className:`private-room-section ${y?"fullscreen-room":""} `,children:[(0,i.jsxs)("div",{className:`page-limiter ${p?"blur-section":""} `,children:[(0,i.jsx)(G.G,{toggleMinimize:e.toggleMinimize,theme:"light"}),s&&k&&!E?.isLocal?(0,i.jsx)(A,{peer:E,track:k,canToggleFullscreen:!0,toggleFullscreen:function(e){null==e&&(e=!y),e?(b(!0),_()):I()},isFullscreen:y},E?.id):(0,i.jsxs)("div",{className:"peers-container",children:[S.map((t=>t.isLocal?null:(0,i.jsx)(P,{peer:t,showName:e.accepted,nameClass:""+(e.accepted?"person-name__top-left":"")},t.id))),null]}),e.accepted&&C==o.pz.connected?(0,i.jsx)("div",{className:"call-overlay",children:(0,i.jsx)(q,{classNames:"sticky",onLeave:e.onLeave,toggleScreenshare:R})}):null,e?.children&&e.children,c&&(0,i.jsx)(L,{name:e.person?.name,onClose:R,onShare:e=>g.start(e.id)})]}),p&&(0,i.jsx)(F,{onCancel:()=>{f(!1)},onSuccess:function(){f(!1),g?.stop()}})]}):null}var H=n(5633),K=n(143),J=n(3531);const Q=c.ZP.div`
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
`;function Y(e){const{user:t}=e;return(0,i.jsx)(Q,{children:(0,i.jsx)(J.Z,{user:t})})}const Z=c.ZP.div`
  position: fixed;
  left: 10px;
  top: 5px;
`,X=c.ZP.div`
  width: 80px;
  height: 80px;
`,ee=c.ZP.div`
  font-size: 10px;
`;function te(e){const{visible:t,children:n}=e,r=(0,u._U)(d.BK);return t?(0,i.jsxs)(Z,{children:[(0,i.jsxs)(X,{children:[(0,i.jsx)(ee,{children:"Preview"}),r.map((e=>e.isLocal&&(0,i.jsx)(P,{peer:e,showName:!1,containerClass:"local-preview-container"},e.id)))]}),n]}):null}var ne=n(89);const ie={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"}};function re(e){return`${ne.u}${e}`}function se(e){return new Promise(((t,n)=>{fetch(re("/token"),function(e){const{role:t,user_id:n,room_id:i}=e;return{...ie,body:JSON.stringify({role:t,user_id:n,room_id:i})}}(e)).then((e=>e.json())).then((e=>t(e.token))).catch((e=>{n({message:"error on get room token",error:e})}))}))}function oe(e){return new Promise(((t,n)=>{var i;fetch(re("/room"),(i=e.room,{...ie,body:JSON.stringify({room:i})})).then((e=>e.json())).then((e=>t(e.id))).catch((e=>{n({message:"error on room creation",error:e})}))}))}var ae=n(6008),le=n(5390),ce=n(8784),ue=n(4224),de=n(1008),he=n(4430),pe=n(9462);const fe=c.ZP.div`
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
  flex-direction: column;
`,me=c.ZP.h2`
  margin-top: 10px;
  color: white;
  text-align: center;
  font-weight: 700;
  font-size: 18px;
  line-height: 25px;
`,ge=c.ZP.div`
  margin-top: 10px;
  color: white;
  font-weight: 500;
  font-size: 14px;
  line-height: 19px;
  text-align: center;
`,ve=c.ZP.div`
  position: absolute;
  top: calc(50% - 20px);
  left: 50%;
  transform: translate(-50%, -50%);
`,ye=c.ZP.div`
  position: absolute;
  bottom: 20px;
  left: 0;
  right: 0;
`;const be=function(e){const{user:t}=(0,r.useContext)(s.St),n=(0,a.UO)(),[c,h]=(0,r.useState)(null),[p,f]=(0,r.useState)(!1),[m,g]=(0,r.useState)(!1),[v,y]=(0,r.useState)(!1),[b,_]=(0,r.useState)(!1),[w,S]=(0,r.useState)(""),[T,E]=(0,r.useState)(""),[k,C]=(0,r.useState)(!1),I=(0,a.s0)(),[R,P]=(0,r.useState)(""),A=(0,he.i)((e=>e.pendingRedirect)),[N,O]=(0,r.useState)(!1),[L,M]=(0,r.useState)(null),j=(0,u.cw)(),U=(0,u._U)(d.ln),F=(0,u._U)(d.uX),V=(0,u._U)(d.um),B=(0,u._U)(d.LY);function z(){window.removeEventListener("beforeunload",(()=>{Q()}))}function $(e){(0,de.n)(String(n.inviteeUid),t.uid,e,!0)}function J(e=pe.C.left,i=!1){z(),$(e),p||m||i||(0,le.$s)(String(n.inviteeUid),t.uid),U&&j.leave(),setTimeout((()=>{I(Xi)}),100)}function Q(){$(pe.C.left),U&&j.leave()}return(0,D.Z)((async function(){await function(){c?.uid||h({uid:String(n.inviteeUid),email:"",displayName:""});return new Promise(((e,t)=>{(0,ce.bG)(n.inviteeUid).then((i=>{i?(h(i),e(1)):t({error:{message:"No data found for invitee #"+n.inviteeUid}})})).catch((e=>{t(e)}))}))}().catch(console.error),(0,ue.u)(t.uid,String(n.inviteeUid));const e=await oe(function(){return{room:`private_${e(n.inviteeUid)}_${e(t.uid)}`};function e(e){return e.slice(0,5)+""+e.slice(e.length-5,e.length)}}()).catch((e=>{throw console.error(e),new Error("Failed creating private room")}));e&&S(e);const i=await se({role:o.K$.user,user_id:t.uid,room_id:e}).catch((e=>{throw console.error(e),new Error("Failed at getting room token")}));i&&(E(i),(r=i,new Promise((async(e,n)=>{try{const n=function(e=T){return{userName:(0,H.R)(t),authToken:e,settings:{isAudioMuted:!1,isVideoMuted:!1},rememberDeviceSelection:!1}}(r);await j.join(n),e(1)}catch(e){console.error(e),n(e)}}))).then((()=>{console.log("joined room")})).catch((e=>{console.error("connection failed",e)})));var r;O(!0)})),(0,r.useEffect)((function(){const e=function(){const e=(0,K.aU)(n.inviteeUid,t.uid);return l.oL(e,(e=>{switch(e?.guestState){case"accept":P(e.guestState),f(!0),i=String(n.inviteeUid),(0,le.I8)(i,t.uid).then((e=>{e>0&&(0,le.CV)(i,t.uid)})).catch((e=>{null!=e&&console.error("MISSED CALL ERROR?",e)}));break;case"reject":P(e.guestState),g(!0),J(pe.C.left);break;case"left":P(e.guestState)}var i;e?.guestState in pe.C&&M(e.guestState)}))}();return window.addEventListener("beforeunload",(()=>{Q()})),()=>{e&&e(),z()}}),[]),(0,r.useEffect)((function(){if(o.TD)return;U&&""!=w?(F||async function(){try{await j.setLocalAudioEnabled(!F)}catch(e){console.log("rejected audio permissions",e),alert("please enable your audio. Click on notification that will appear after closing this popup")}}(),V||async function(){try{await j.setLocalVideoEnabled(!V)}catch(e){console.log("rejected video permissions",e)}}(),p||v?console.log("skipping invitation, because: ",p,v,w):(y(!0),function(e,n){const i=(0,K.aU)(e,t.uid),r={name:(0,H.R)(t),room:n,timestamp:Date.now(),createdBy:t?.uid,creatorState:pe.C.accept,guestState:pe.C.invite,company:t.companies[0]};l.Wo(i,r).then((()=>{_(!0)})).catch((e=>{console.error(e)}))}(String(n.inviteeUid),String(w)))):U&&""==w?console.log("waiting for roomiD update...",w):console.log("NOT CONNECTED",U,w)}),[U,w]),(0,r.useEffect)((function(){}),[B]),(0,r.useEffect)((function(){setTimeout((()=>{b&&R==pe.C.left&&null===A&&J(pe.C.left,!0)}),100)}),[R,b]),(0,r.useEffect)((()=>{null!=A&&N&&(z(),Q())}),[A]),(0,i.jsx)("div",{className:"outgoing-call-page",children:p?(0,i.jsx)(W,{visible:!0,accepted:p,onLeave:()=>{J()},toggleMinimize:e.toggleMinimize,person:c}):(0,i.jsxs)(fe,{children:[k?(0,i.jsx)(te,{visible:!p,children:(0,i.jsx)("button",{onClick:()=>{C(!1)},className:"dark xs",children:"Hide preview"})}):null,(0,i.jsx)(G.G,{toggleMinimize:e.toggleMinimize,theme:"light"}),(0,i.jsx)(ve,{children:(0,i.jsxs)("div",{className:"waiting-response",children:[(0,i.jsx)(Y,{user:c}),U?L==pe.C.joined?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(me,{children:"Person is now linked with you"}),(0,i.jsx)(ge,{children:"Waiting for response"})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(me,{children:"Invitee is connecting..."}),(0,i.jsx)(ge,{children:" "})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(me,{children:"Connecting..."}),(0,i.jsx)(ge,{children:" "})]})]})}),(0,i.jsx)(ye,{children:U?(0,i.jsx)(q,{onLeave:()=>{J()},classNames:"relative"}):(0,i.jsx)("div",{className:"control-bar relative",children:(0,i.jsx)("div",{className:"actions",children:(0,i.jsx)(ae.bR,{src:x.Z})})})})]})})};var _e=n(9655),we=n(749),Se=n(6782);const Te=c.ZP.div`
  display: flex;
  justify-content: space-between;
  width: 45%;
  margin: 0 auto;
`,Ee=c.ZP.div`
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
`,ke=c.ZP.div`
  font-weight: 500;
  font-size: 12px;
  line-height: 16px;
  margin-top: 10px;
  text-align: center;
`,Ce=c.ZP.div`
  &&& {
    width: 42px;
    height: 42px;
    background: transparent;
    outline: 0 none;
    padding: 0;
    cursor: pointer;
  }
`,Ie=c.ZP.img`
  width: 42px;
  height: 42px;
`,Re=c.ZP.h2`
  color: white;
  font-weight: 700;
  font-size: 18px;
  line-height: 25px;
  text-align: center;
`,Pe=c.ZP.div`
  margin-top: 10px;
  color: white;
  font-weight: 500;
  font-size: 14px;
  line-height: 19px;
  text-align: center;
`,Ae=c.ZP.div`
  width: 100%;
  height: 100%;
  position: relative;
`,Ne=c.ZP.div`
  position: absolute;
  top: calc(50% - 20px);
  left: 50%;
  transform: translate(-50%, -50%);
`,xe=c.ZP.div`
  position: absolute;
  bottom: 30px;
  left: 0;
  right: 0;
`;function De(e){const{onAccept:t,onReject:n,isConnected:r,debug:s,person:a}=e;return(0,i.jsxs)(Ae,{children:[(0,i.jsxs)(Ne,{children:[(0,i.jsx)(Re,{children:a||"Incoming..."}),(0,i.jsx)(Pe,{children:"Chat request"})]}),r||o.TD?(0,i.jsx)(xe,{children:(0,i.jsxs)(Te,{children:[(0,i.jsxs)(Ee,{children:[(0,i.jsx)(Ce,{onClick:n,children:(0,i.jsx)(Ie,{src:Se.Z})}),(0,i.jsx)(ke,{children:"I'm busy"})]}),(0,i.jsxs)(Ee,{children:[(0,i.jsx)(Ce,{onClick:t,children:(0,i.jsx)(Ie,{src:we.Z})}),(0,i.jsx)(ke,{children:"Connect"})]})]})}):null]})}function Oe(e){const{peer:t,talking:n,dominant:s}=e,{videoRef:o}=I({trackId:t.videoTrack}),[a,l]=(0,r.useState)("0 none");return(0,r.useEffect)((()=>{l(n&&s?"2px solid green":n&&!s?"px solid orange":"0 none")}),[n,s]),(0,i.jsx)("div",{className:"team-peer",children:(0,i.jsx)("div",{className:"team-peer__container",children:(0,i.jsxs)("div",{className:"team-peer__video-container",children:[(0,i.jsx)("video",{ref:o,className:"team-peer-video "+(t.isLocal?"local":""),autoPlay:!0,muted:!0,playsInline:!0,style:{outline:a}}),(0,i.jsxs)("div",{className:"peer-name",children:[t.name," ",t.isLocal?"(You)":""]})]})})})}const Le=n.p+"2680805b5c6444a8f93b8e193ada124e.svg";var Me=n(6806);function je(e){const{peer:t,talking:n,dominant:s,teamUid:o}=e,[a,c]=(0,r.useState)(!1),u=(0,K.Re)(o,t.customerUserId),{videoRef:d}=I({trackId:t.videoTrack});function h(e){e!=Me.q.accepted&&e!=Me.q.rejoined||c(!0)}return(0,r.useEffect)((()=>{l.o(u,(e=>{e&&h(e)}));const e=l.oL(u,(e=>{e&&h(e)}));return()=>{e&&e()}}),[]),a?(0,i.jsx)("div",{className:"peer-small-video",children:(0,i.jsx)("video",{ref:d,className:""+(t.isLocal?"local":""),autoPlay:!0,muted:!0,playsInline:!0})}):null}const Ue=n.p+"565ec1c780f65179d63210122095848c.svg";const Fe=n.p+"43e976c4097f5ac6ed184acda0716cbe.svg",Ve={joined:0,absent:0};function Be(e){const[t,n]=(0,r.useState)(Ve),[s,o]=(0,r.useState)(!1),a=(0,u._U)(d.ln);function c(e){let t={joined:0,absent:0};const i=[Me.q.accepted,Me.q.rejoined];e&&e.members&&Object.entries(e.members).forEach((([e,n])=>{i.includes(n.state)?t.joined+=1:t.absent+=1})),n(t)}return(0,r.useEffect)((()=>{a&&(s||l.ij((0,K.zV)(e.teamUid)).then((e=>{e&&(o(!0),c(e))})).catch((e=>{})))}),[a]),(0,r.useEffect)((()=>{const t=l.oL((0,K.zV)(e.teamUid),(e=>{e&&c(e)}));return()=>{t&&t()}}),[]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"team-state__joined",children:[(0,i.jsx)("img",{src:Ue,className:"team-state-icon"}),"Joined:",(0,i.jsx)("div",{className:"members-counter",children:(0,i.jsx)("span",{children:t.joined>0&&t.joined})})]}),(0,i.jsxs)("div",{className:"team-state__absent",children:[(0,i.jsx)("img",{src:Fe,className:"team-state-icon"}),"Absent:",(0,i.jsx)("div",{className:"members-counter",children:(0,i.jsx)("span",{children:t.absent>0&&t.absent})})]})]})}const ze=3,$e=1;function qe(){const e=(0,u._U)(d.BK),t=(0,u._U)(d.ln),[n,i]=(0,r.useState)($e),[s,o]=(0,r.useState)($e),[a,l]=(0,r.useState)(0),[c,h]=(0,r.useState)(ze-1);function p(){const e=(n-1)*ze;l(e>0?e:0),h(n*ze)}return(0,r.useEffect)((()=>{if(t){let t=Math.ceil(e.length/ze);o(t<$e?$e:t)}else o($e)}),[t,e]),(0,r.useEffect)((()=>{(function(){let e=!1;n>s&&(i(s),e=!0);return e})()&&p()}),[s]),(0,r.useEffect)((()=>{p()}),[n]),{max:s,current:n,change:function(e){(function(e){return e>=$e&&e<=s})(e)&&i(e)},index:{min:a,max:c}}}const Ge=n.p+"5b5a5de7cb07433a135a2da93eb88042.svg";const We=n.p+"cbfec5717d8d09591b050a3a3bfddbfd.svg";function He(e){const{pagination:t,maxPagination:n,handleClick:r}=e;return(0,i.jsxs)("div",{className:"pagination",children:[(0,i.jsx)("div",{className:"pagination__arrows",children:(0,i.jsx)("button",{onClick:()=>{r(t-1)},children:(0,i.jsx)("img",{src:Ge})})}),(0,i.jsx)("div",{className:"pagination__dots",children:(0,i.jsx)("ul",{children:[...Array(n).keys()].map((e=>(0,i.jsx)("li",{className:t-1==e?"active":"",children:(0,i.jsx)("button",{onClick:()=>{r(e)}})},e)))})}),(0,i.jsx)("div",{className:"pagination__arrows",children:(0,i.jsx)("button",{onClick:()=>{r(t+1)},children:(0,i.jsx)("img",{src:We})})})]})}const Ke=[o.K$.guest];function Je(e){const{teamInfo:t,toggleMinimize:s,shouldBlur:o=!1}=e,l=(0,a.TH)(),[c,h]=(0,r.useState)(null),[p,f]=(0,r.useState)(!1),[m,g]=(0,r.useState)(!1),[v,y]=(0,r.useState)(!1),[b,_]=(0,r.useState)(!1),{resizeToFullscreen:w,onElectronResize:S}=n(8345),T=qe(),E=(0,u._U)(d.BK),k=(0,u._U)(d.UP),C=(0,u._U)(d.ln),I=(0,u._U)(d.vX),R=(0,u._U)(d.Dl),P=(0,u._U)(d.ud),N=(0,u._U)(d.pk),x=(0,u._U)((0,d.K6)(N?.id));function D(){_(!1),S(l.pathname,!0)}return(0,r.useEffect)((function(){C&&(I?h(I):null==c&&(console.log("on init show yourself",k),h(k)))}),[C,I]),(0,r.useEffect)((()=>{m!=P&&g(P)}),[P]),(0,r.useEffect)((()=>{m||x||!b||D()}),[m,x,b]),(0,i.jsxs)("div",{className:`team-call-page__room ${b&&"fullscreen-room"}`,children:[(0,i.jsxs)("div",{className:"team-call-page__header",children:[(0,i.jsxs)("div",{className:"header-title",children:[(0,i.jsx)("img",{src:Le}),t&&t.name]}),(0,i.jsxs)("div",{className:"team-state",children:[t&&t.uid?(0,i.jsx)(Be,{teamUid:t.uid}):null,(0,i.jsx)(G.G,{toggleMinimize:s})]})]}),(0,i.jsxs)("div",{className:"team-call-page__container "+(o?"blur-section":""),children:[m&&x?(0,i.jsx)("div",{className:"team-call-page__main-speaker",children:(0,i.jsx)(A,{peer:N,track:x,canToggleFullscreen:!0,toggleFullscreen:function(e){console.log("toggleFullscreen",e,b),null==e&&(e=!b),e?(_(!0),w()):D()},isFullscreen:b},N?.id)}):E.map((e=>null!=c&&c.id==e.id?(0,i.jsx)("div",{className:"team-call-page__main-speaker",children:(0,i.jsx)(Oe,{peer:e,dominant:null!=I&&I.id==e.id,talking:null!=R&&!!R[String(e?.audioTrack)]})},`main_${e.id}`):null)),(0,i.jsx)("div",{className:"team-call-page__controls",children:e?.children&&e.children}),(0,i.jsx)("div",{className:"team-call-page__peers",children:E.map(((e,n)=>!e.isLocal&&!Ke.includes(String(e.roleName))&&n>=T.index.min&&n<T.index.max&&(0,i.jsx)(je,{peer:e,dominant:null!=I&&I.id==e.id,talking:null!=R&&!!R[String(e?.audioTrack)],teamUid:t.uid},`member_${e.id}`)))}),T.max>1?(0,i.jsx)("div",{className:"team-call-page__pagination",children:(0,i.jsx)(He,{pagination:T.current,maxPagination:T.max,handleClick:T.change})}):null]})]})}var Qe=n(9063);const Ye=c.ZP.div`
  display: flex;
  justify-content: space-between;
  width: 45%;
  margin: 0 auto;
`,Ze=c.ZP.div`
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
`,Xe=c.ZP.div`
  font-weight: 500;
  font-size: 12px;
  line-height: 16px;
  margin-top: 10px;
  text-align: center;
`,et=c.ZP.div`
  &&& {
    width: 42px;
    height: 42px;
    background: transparent;
    outline: 0 none;
    padding: 0;
    cursor: pointer;
  }
`,tt=c.ZP.img`
  width: 42px;
  height: 42px;
`;function nt(e){const{onAccept:t,onReject:n}=e;return(0,i.jsxs)(Ye,{children:[(0,i.jsxs)(Ze,{children:[(0,i.jsx)(et,{onClick:n,children:(0,i.jsx)(tt,{src:Se.Z})}),(0,i.jsx)(Xe,{children:"I'm busy"})]}),(0,i.jsxs)(Ze,{children:[(0,i.jsx)(et,{onClick:t,children:(0,i.jsx)(tt,{src:we.Z})}),(0,i.jsx)(Xe,{children:"Connect"})]})]})}var it=n(3995);const rt=function(e){const t=(0,a.UO)(),[n,c]=(0,_e.lr)(),h=n.get("rejoin"),p=!!n.get("autoaccept")||h,{state:f}=(0,a.TH)(),g=1==f?.host,{user:v}=(0,r.useContext)(s.St),[y,b]=(0,r.useState)(g),[_,w]=(0,r.useState)(!1),[S,T]=(0,r.useState)({}),[E,k]=(0,r.useState)(!1),[C,I]=(0,r.useState)(!1),R=(0,a.s0)(),P=j(),A=(0,he.i)((e=>e.pendingRedirect)),[N,x]=(0,r.useState)(!1),O=(0,u.cw)(),M=(0,u._U)(d.ln),U=(0,u._U)(d.Pz),V=(0,u._U)(d.uX),B=(0,u._U)(d.um),{amIScreenSharing:z}=m();function $(){window.removeEventListener("beforeunload",J)}async function G(){b(!0);const e=h?Me.q.rejoined:Me.q.accepted;(0,it.k)(e,String(t.team),v.uid),B||async function(){try{await O.setLocalVideoEnabled(!B)}catch(e){console.log("rejected video permissions",e)}}(),V||async function(){try{await O.setLocalAudioEnabled(!V)}catch(e){console.log("rejected audio permissions",e),alert("please enable your audio. Click on notification that will appear after closing this popup")}}()}async function W(e=!0){if(M&&await O.leave(),e){if(await async function(){const e=(0,K.zV)(String(t.team)),n=[Me.q.accepted,Me.q.rejoined],i=await l.ij(e);if(i&&i.state!==Me.n.ended&&i.members){return 0===Object.keys(i.members).filter((e=>n.includes(i.members[e].state))).length}return!1}())return function(){const e=(0,K.Mj)(String(t.team));l.Wo(e,Me.n.ended)}(),!0}return!1}function J(){(0,it.k)(Me.q.left,String(t.team),v.uid),W()}function Q(e){console.error(new Error(e))}function Y(){E||z?z?I(!0):k(!1):k(!0)}return(0,D.Z)((async function(){if(_)return void console.error("BUSY!",M,U);if(w(!0),async function(){const e=await(0,Qe.I)(String(t.company),String(t.team));e&&(T(e),x(!0))}(),g){const e=await async function(){const e=await se({role:o.K$.host,user_id:v.uid,room_id:String(t.room)}).catch(Q);return{userName:(0,H.R)(v),authToken:String(e),settings:{isAudioMuted:!1,isVideoMuted:!1},rememberDeviceSelection:!0}}();O.join(e)}else{const e=await async function(){const e=await se({role:o.K$.user,user_id:v.uid,room_id:String(t.room)}).catch(Q);return{userName:(0,H.R)(v),authToken:String(e),settings:{isAudioMuted:!0,isVideoMuted:!0},rememberDeviceSelection:!0}}();O.join(e)}})),(0,r.useEffect)((function(){return window.addEventListener("beforeunload",J),()=>{z&&P.stop(),$()}}),[]),(0,r.useEffect)((function(){const e=l.oL((0,K.zV)(String(t.team)),(async e=>{e?.state==Me.n.ended&&null==A&&(await W(),R("/"))}));M&&w(!1);return()=>{e&&e()}}),[U,M]),(0,r.useEffect)((()=>{p&&!y&&N&&setTimeout((()=>{G()}),1e3)}),[M,x]),(0,r.useEffect)((()=>{A&&($(),J())}),[A]),(0,i.jsxs)("div",{className:"team-call-page",children:[(0,i.jsx)(Je,{teamInfo:S,toggleMinimize:e.toggleMinimize,shouldBlur:C,children:y||p?(0,i.jsx)(q,{onLeave:async function(){$(),(0,it.k)(Me.q.left,String(t.team),v.uid),await W(),R("/")},classNames:"sticky",toggleScreenshare:Y}):(0,i.jsx)("div",{className:"team-call-invitation",children:(0,i.jsx)(nt,{onAccept:G,onReject:async function(){(0,it.k)(Me.q.rejected,String(t.team),v.uid),W(!1),R("/")}})})}),E&&(0,i.jsx)(L,{name:S?.name,onClose:Y,onShare:e=>P.start(e.id)}),C&&(0,i.jsx)(F,{onCancel:()=>{I(!1)},onSuccess:function(){I(!1),P?.stop()}})]})};var st=n(3647);const ot=["displayName","email","name"];function at(e,t,n=ot){const[i,s]=(0,r.useState)([]);return(0,r.useEffect)((()=>{let i=[];e.map((e=>{(function(e){if(0===t.trim().length)return!0;let i=!1;const r=t.toLowerCase();return n.forEach((t=>{e[t]&&String(e[t]).toLowerCase().includes(r)&&(i=!0)})),i})(e)&&i.push(e)})),s(i)}),[e.length,t]),i}const lt=n.p+"364db5aef31c55c98081aff5eaba26d3.svg";function ct(e){const{onChange:t}=e,[n,s]=(0,r.useState)(""),[o,a]=(0,r.useState)(e?.defaultExpanded||!1),l=(0,r.useRef)(null);return(0,r.useEffect)((()=>{o&&setTimeout((()=>{null!=l&&l.current.focus()}),50)}),[o]),o?(0,i.jsxs)("div",{className:"contact-filter-input",children:[(0,i.jsx)("img",{src:lt,className:"filter-icon"}),(0,i.jsx)("input",{className:"form-input",value:n,onChange:function(e){const n=e.target.value;s(n),t(n)},placeholder:"Search for contact",ref:l,autoFocus:!0})]}):(0,i.jsx)("button",{className:"expand-contact-filter",onClick:()=>{a(!0)},children:(0,i.jsx)("img",{src:lt,className:"filter-icon"})})}class ut{constructor(e){this.companyUid=e.companyUid,this.teamUid=e.teamUid,this.user=e.user,this.room="",this.isHost=!1}async init(){this.room=await this.getRoom(this.teamUid).catch(this.errorOnCreateRoom);return await this.inviteTeamMembers(this.room).catch((e=>{}))?this.room:null}async getRoom(e){return new Promise((async(t,n)=>{const i=await this.checkRoomExists(e).catch((e=>{}));i&&t(i);oe(this.roomConfig(e)).then((e=>t(e))).catch((e=>{n(e)}))}))}async checkRoomExists(e){return new Promise(((e,t)=>{setTimeout((()=>{t(!1)}),500)}))}roomConfig(e){return{room:`team_${e}`}}async getTeamMembers(){let e={};return(await(0,st.n)(this.companyUid,this.teamUid)).forEach((t=>{e[t.uid]={uid:t.uid,name:(0,H.R)(t),state:t.uid==this.user.uid?Me.q.accepted:Me.q.invited}})),e}async inviteTeamMembers(e){const t=(0,K.zV)(this.teamUid),n=await this.getTeamMembers().catch(this.onTeamMembersError),i={createdBy:this.user.uid,room:e,team:this.teamUid,company:this.companyUid,state:Me.n.live,members:n};return new Promise(((e,n)=>{(0,l.Wo)(t,i).then((()=>{e(!0)})).catch((e=>{console.error(e),n(e)}))}))}onTeamMembersError(e){throw console.error(e),new Error("Team members not found!")}errorOnCreateRoom(e){throw console.log("error while creating room",e),new Error("Failed creating a room")}}var dt=n(763),ht=n(7943);function pt(e,t){const[n,i]=(0,r.useState)(!1);return(0,r.useEffect)((function(){let n=0;try{Object.keys(e).forEach((i=>{(function(e){return e==ht.EO.online})(e[i])&&i!=t.uid&&(n+=1)}))}catch(e){console.error(e)}i(n>0)}),[e]),n}const ft=n.p+"efafe98bb82c4f604bef681e0abb1932.svg";const mt=n.p+"53e50533a1ff8d23a4b82fa4ff1b5db9.svg";const gt=function(e){const{team:t,createCall:n,joinCall:o}=e,[a,c]=(0,r.useState)(!1),{user:u}=(0,r.useContext)(s.St),[d,h]=(0,r.useState)([]),[p,f]=(0,r.useState)(!1),m=pt(d,u);return(0,r.useEffect)((function(){const e=function(){const e=(0,K.lB)(t.uid);return l.oL(e,(e=>{h(e)}))}(),n=function(){const e=(0,K.zV)(t.uid);return l.oL(e,(e=>{e&&"live"==e.state?f(!0):f(!1)}))}();return()=>{e&&e(),n&&n()}}),[]),(0,i.jsxs)(ae.im,{children:[(0,i.jsx)(ae.Ee,{src:dt.R$}),(0,i.jsx)(ae.Dx,{children:t.name}),a?(0,i.jsx)(ae.Cv,{children:(0,i.jsx)(ae.bR,{src:x.Z})}):p?(0,i.jsx)(ae.GA,{onClick:function(){o?o(t,p):console.error("join call not defined")},children:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ae.JO,{src:ft}),(0,i.jsx)("div",{className:"live-meeting-icon",children:"1"})]})}):m?(0,i.jsx)(ae.GA,{onClick:function(){c(!0),n(t,(()=>{c(!1)}))},children:(0,i.jsx)(ae.JO,{src:ft})}):(0,i.jsx)(ae.U9,{children:(0,i.jsx)(ae.JO,{src:mt})})]})};var vt=n(2485);function yt(e){const{presenceObj:t}=e,[n,s]=(0,r.useState)(""),[o,a]=(0,r.useState)(""),[l,c]=(0,r.useState)(null),[u,d]=(0,r.useState)("");function h(e="",t="",n){s(e),d(t),c(n);const i=e==ht.EO.online?ht.fg.online:e==ht.EO.busy?ht.fg.busy:ht.fg.offline;a(i)}return(0,r.useEffect)((function(){if((0,vt.s9)(t))h("","",null);else{if((0,vt.$W)(t)==ht.EO.busy){const e=(0,vt.XO)(t.status),n=(0,vt.iN)(t.status),i=null!==n?n:"";h(ht.EO.busy,i,e)}else h(ht.EO.online,"",null)}}),[t.presence,t.status,t.expiry]),null!==l?(0,i.jsx)("span",{children:(0,i.jsx)("img",{src:l,alt:u})}):null}var bt=n(8409),_t=n(9947);function wt(e){const{user:t,presenceObj:n}=e,[s,o]=(0,r.useState)((0,vt.ZT)(n));return(0,r.useEffect)((function(){o((0,vt.ZT)(n))}),[n.presence,n.status,n.expiry]),(0,i.jsxs)("div",{className:"contact-profile-image",children:[(0,i.jsx)(J.Z,{user:t}),(0,i.jsx)(_t.Z,{classNames:"status-dot",currentState:s})]})}const St=function(e){const{user:t,createCall:n}=e,{presenceObj:o,stopListener:a}=(0,bt.C)(t),l=(0,bt.c)(o),c=(0,r.useContext)(s.St),{missedCall:u,stopMissedListener:d}=(0,le.NG)(c?.user?.uid,t.uid);return(0,r.useEffect)((function(){return()=>{a&&a(),d&&d()}}),[]),(0,i.jsxs)(ae.im,{className:l?"":"disabled-hovers",children:[(0,i.jsx)(wt,{user:t,presenceObj:o}),(0,i.jsxs)(ae.Dx,{children:[t.name," ",(0,i.jsx)(yt,{presenceObj:o})]}),l?(0,i.jsxs)(ae.GA,{onClick:()=>{n(t)},children:[(0,i.jsx)(ae.JO,{src:ft}),u&&(0,i.jsx)("div",{className:"live-meeting-icon",children:"1"})]}):(0,i.jsxs)(ae.U9,{onClick:e=>{e.preventDefault()},children:[(0,i.jsx)(ae.JO,{src:ft}),u&&(0,i.jsx)("div",{className:"live-meeting-icon",children:"1"})]})]})};function Tt(e){const{contact:t,createCall:n,joinCall:r}=e;return(0,H.f)(t)?(0,i.jsx)(gt,{team:t,createCall:n,joinCall:r},t.uid):(0,i.jsx)(St,{user:t,createCall:n},t.uid)}const Et=1;function kt(e){const[t,n]=(0,r.useState)(Et),[i,s]=(0,r.useState)(Et),[a,l]=(0,r.useState)(0),[c,u]=(0,r.useState)(o.Nn-1);function d(){const e=(t-1)*o.Nn;l(e>0?e:0),u(t*o.Nn)}return(0,r.useEffect)((()=>{let t=Math.ceil(e.length/o.Nn);s(t<Et?Et:t)}),[e.length]),(0,r.useEffect)((()=>{(function(){let e=!1;t>i&&(n(i),e=!0);return e})()&&d()}),[i]),(0,r.useEffect)((()=>{d()}),[t]),{max:i,current:t,change:function(e){(function(e){return e>=Et&&e<=i})(e)&&n(e)},index:{min:a,max:c}}}function Ct(e){const{contacts:t,createCall:n,joinCall:s}=e,o=kt(t),[a,l]=(0,r.useState)([]);function c(){const e=t.slice(o.index.min,o.index.max);l(e)}return(0,r.useEffect)(c,[]),(0,r.useEffect)(c,[t.length,o.index.min,o.index.max]),(0,i.jsxs)(i.Fragment,{children:[a.length>0&&a.map((e=>(0,i.jsx)(Tt,{contact:e,createCall:()=>{n(e)},joinCall:()=>{s(e)}},e.uid))),o.max>1&&(0,i.jsx)(He,{pagination:o.current,maxPagination:o.max,handleClick:o.change})]})}function It(e){const{contacts:t,createCall:n,joinCall:o}=e,{user:a}=(0,r.useContext)(s.St);return(0,i.jsx)(i.Fragment,{children:t.length>0&&t.map((e=>{if(e.uid!=a.uid)return(0,i.jsx)(Tt,{contact:e,createCall:n,joinCall:o},e.uid)}))})}function Rt(e){const{contacts:t,title:n,expanded:o=!1,multiColumn:c=!1}=e,{user:u}=(0,r.useContext)(s.St),[d,h]=(0,r.useState)(""),p=at(t,d),f=(0,a.s0)();const m=c?Ct:It;return(0,i.jsxs)("section",{className:"contact-list",children:[(0,i.jsx)("div",{className:"contact-list__header",children:o?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h2",{className:"title",children:n}),(0,i.jsx)(ct,{onChange:h})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ct,{onChange:h,defaultExpanded:!0}),e?.children&&e.children]})}),(0,i.jsxs)("div",{className:"contact-list__items",children:[(0,i.jsx)(m,{contacts:p,createCall:async function(e,t){var n;(0,H.f)(e)?await async function(e){const t=u.companies[0],n=new ut({companyUid:t,teamUid:e,user:u}),i=await n.init();if(i){console.log("should navigate to team room",i,e);const n=fr.getTeamCallRoute(i,e,t);return f(n,{state:{host:!0}}),!0}return console.error("Team call failed - room not found",i),!1}(e.uid):(n=e.uid,f(fr.getOutgoingRoute(n))),t&&t()},joinCall:function(e,t=!1){!async function(e,t=!1){const n=(0,K.zV)(e),i=await(0,l.Tr)(n).catch((e=>{console.error(e)}));if(i&&"live"==i?.state){const e=new URLSearchParams({rejoin:t?"1":"0"}),n=fr.getTeamCallRoute(i.room,i.team,i.company);return f(n+"?"+e),!0}}(e.uid,t)}}),0===p.length&&(0,i.jsx)("div",{className:"contacts-not-found",children:"Not found"})]})]})}function Pt(e,t){return e.filter((e=>e.uid!=t))}var At=n(4290),Nt=n(2549);let xt;const Dt=function(){const{user:e}=(0,r.useContext)(s.St),{companyUpdated:t}=(0,r.useContext)(s.Qm),[l,c]=(0,r.useState)([]),[u,d]=(0,r.useState)([]),[h,p]=(0,r.useState)([]),[f,m]=(0,r.useState)(!1),[g,v]=(0,r.useState)([]),[y,b]=(0,r.useState)(!1),[_,w]=(0,r.useState)(!1),S=(0,a.TH)(),T=(0,At.E)((e=>e.setUsers)),E=(0,At.E)((e=>e.users)),k=(0,At.E)((e=>e.setTeams)),C=(0,At.E)((e=>e.teams));function I(t=!1){(function(t=!1){if(E&&E.length&&!t)return Promise.resolve(E);{const t=[e.uid];return(0,st.E)(e.companies[0],t)}})(t).then((t=>{T(t);const n=function(e,t){return e.sort(((e,n)=>{const i=t.indexOf(e.uid),r=t.indexOf(n.uid);return i>r?-1:i<r?1:0}))}(Pt(t,e.uid),g);c(n)}))}(0,r.useEffect)((()=>{S?.pathname==Xi&&(b(!1),m(!1))}),[S]),(0,r.useEffect)((()=>{e&&async function(){if(e.companies&&e.companies.length>0){const t=await(0,ue.V)(e.uid).catch((e=>{}));t&&v(t),xt=setTimeout((()=>{I()}),1e3),w(!0),(C&&C.length?Promise.resolve(C):(0,Nt.YR)(e.uid,e.companies)).then((e=>{k(e),d(e)}))}}()}),[e]),(0,r.useEffect)((()=>{t>0&&_&&(clearTimeout(xt),xt=setTimeout((()=>{I(!0)}),1e3))}),[t]),(0,r.useEffect)((()=>{if(e&&e.uid)if(y)m(l.length>o.Nn);else{const t=function(e,t,n,i=0){const r=e.concat(t).filter((e=>e.uid!=n));return i>0?r.slice(0,i):r}(l,u,e?.uid,o.Nn);p(t)}}),[l.length,u.length,y]);const R=["page-limiter"];return y&&f?R.push("half-expanded"):(y||f)&&R.push("medium"),(0,i.jsx)("div",{className:"home-page hide-on-minimize",children:(0,i.jsx)("div",{className:R.join(" "),children:(0,i.jsx)("div",{className:"contact-list-wrapper "+(y?"expanded":""),children:y?(0,i.jsxs)("div",{className:"side-by-side",children:[(0,i.jsx)(Rt,{expanded:y,contacts:u,title:"Teams",multiColumn:f}),(0,i.jsx)(Rt,{expanded:y,contacts:l,title:"All contacts",multiColumn:f})]}):(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(Rt,{contacts:h,title:"All contacts",children:(0,i.jsx)("button",{onClick:function(){const{onElectronResize:e}=n(8345);e&&e("/home-contacts-expanded",!0),b(!0)},className:"dark",children:"See all"})})})})})})};var Ot=n(9155),Lt=n(565),Mt=n(8119);const jt=n.p+"67c54d60c320281954f7454ef7eb4250.svg",Ut="remember-me";function Ft(){const e=window.localStorage.getItem(Ut);if(e){const t=JSON.parse(e);if(String(t.remember).length>0)return t}return null}function Vt(e,t=""){const n={email:e,name:t};window.localStorage.setItem(Ut,JSON.stringify(n))}const Bt=n.p+"9f13e1e5fb5908223cefa1dad26728f5.svg";const zt=function(e){const{onSubmit:t,theme:n="dark",loading:s}=e,[o,a]=(0,r.useState)(""),[l,c]=(0,r.useState)(""),[u,d]=(0,r.useState)(!1),[h,p]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{const e=Ft();null!=e&&a(e.email)}),[]),(0,i.jsxs)("form",{onSubmit:t,children:[(0,i.jsxs)("div",{className:"form-element",children:[(0,i.jsx)("label",{children:"Email"}),(0,i.jsx)("input",{name:"email",type:"text",placeholder:"Enter email",required:!0,value:o,onChange:e=>a(e.target.value)})]}),(0,i.jsxs)("div",{className:"form-element",children:[(0,i.jsx)("label",{children:"Password"}),(0,i.jsxs)("div",{className:"input-with-icon",children:[(0,i.jsx)("input",{name:"password",type:u?"text":"password",placeholder:"********",required:!0,value:l,onChange:e=>c(e.target.value)}),(0,i.jsx)("img",{src:u?jt:Bt,className:"input-icon password-input",onClick:()=>{d(!u)}})]})]}),(0,i.jsxs)("div",{className:"flex-spread",children:[(0,i.jsxs)("label",{className:`custom-checkmark ${n}`,children:[(0,i.jsx)("input",{type:"checkbox",id:"remember",name:"remember",checked:h,onChange:()=>{p(!h)}}),"Remember me"]}),(0,i.jsx)("div",{className:"forgot",children:(0,i.jsx)(_e.rU,{to:(0,Mt.sL)(),children:"Forgot password?"})})]}),(0,i.jsx)("div",{children:(0,i.jsxs)("button",{type:"submit",disabled:!((0,ht.D6)(o)&&(0,ht.aO)(l))||s,className:"full with-loader "+(s?"loading":""),children:[(0,i.jsx)("span",{children:"Sign in"}),(0,i.jsx)("img",{src:x.Z,className:"loading-animation"})]})})]})},$t=n.p+"cbb806676e030b7f2e0d.jpg",qt=n.p+"aeac7226ea0807feb7c8.jpg";function Gt(){return(0,i.jsxs)("div",{className:"app-previews",children:[(0,i.jsx)("div",{children:(0,i.jsx)("h2",{className:"app-previews__title",children:"Work in the office, from anywhere"})}),(0,i.jsx)("div",{className:"app-previews__images",children:(0,i.jsx)("img",{src:$t})}),(0,i.jsxs)("div",{className:"app-previews__reviews",children:[(0,i.jsx)("div",{className:"app-previews__review-text",children:"“Photon has improved our team communication and productivity  x10. We’ve never had such an efficient way to stay connected, we can’t imagine not using it.”"}),(0,i.jsxs)("div",{className:"app-previews__reviewer",children:[(0,i.jsx)("img",{src:qt}),(0,i.jsx)("strong",{children:"Mike Hall,"}),"  Finance Manager"]})]})]})}var Wt=n(8874);const Ht=n.p+"c4b755773aaacb0417d9.png";var Kt=n(9994);function Jt(){const e={size:{width:993,height:728}};return setTimeout((()=>{(0,Kt.t)(e)}),2500)}const Qt={"auth/configuration-not-found":"Configuration not found on auth server","auth/wrong-password":"Wrong password!"};function Yt(e){const t=e.error||e;if(t){const e=Object.entries(Qt).find((([e,n])=>t.message&&t.message.includes(e)));return e?e[1]:t.message}return console.error(t),"Unknown error"}var Zt=n(3844);function Xt(e,t,n,i){e.preventDefault(),e.target.remember.checked?Vt(e.target.email.value):Vt(""),(0,Ot.e5)(t,e.target.email.value,e.target.password.value).then((async t=>{if(t.user){const i=await(0,Zt._Z)(t.user);e.target.remember.checked?Vt(i.email,(0,H.R)(i)):Vt(""),e.target.reset(),n(i)}else console.error("Sign in failed"),i({message:"Sign in failed!"})})).catch(i)}const en=n.p+"6c6adc6ce1580c6a4c4daa6e1028fcc3.svg";function tn(e){const{onClick:t,loading:n}=e;return(0,i.jsx)("div",{className:"social-login",children:(0,i.jsxs)("button",{type:"button",onClick:t,disabled:n,className:`full auth-button with-loader ${n?"loading":""} ${e.classNames&&e.classNames}`,children:[(0,i.jsxs)("span",{children:[(0,i.jsx)("img",{src:en,className:"icon"})," Sign in with Google"]}),(0,i.jsx)("img",{src:x.Z,className:"loading-animation"})]})})}const nn=function(){const{setUser:e}=(0,r.useContext)(s.St),t=(0,a.s0)();let n=null;const[o,l]=(0,r.useState)(!1),[c,u]=(0,r.useState)(!1);function d(e){const t=Yt(e);l(!1),alert(t)}async function h(n){e(n),setTimeout((()=>{l(!1),t(Xi)}),100)}return(0,i.jsx)("div",{className:"auth-page login-page",children:(0,i.jsxs)("div",{className:"page-limiter",children:[(0,i.jsxs)("div",{className:"auth-page__form",children:[(0,i.jsx)("div",{className:"auth-page__logo",children:(0,i.jsx)("img",{className:"photon-logo",alt:"Photon",src:Wt.Z})}),(0,i.jsxs)("div",{className:"form-contents",children:[(0,i.jsxs)("div",{className:"title-wrapper",children:[(0,i.jsx)("h1",{className:"form-contents__title",children:"Welcome"}),(0,i.jsx)("img",{src:Ht})]}),(0,i.jsx)(zt,{onSubmit:e=>{l(!0),Xt(e,Lt.I,h,d)},theme:"light",loading:o}),(0,i.jsx)(tn,{onClick:()=>{u(!0),n=Jt();const e=new Ot.hJ;(0,Ot.F6)(Lt.I,e),setTimeout((()=>{u(!1)}),5e3)},loading:c})]}),(0,i.jsxs)("div",{className:"auth-page__bottom-link",children:["Don't have an account? ",(0,i.jsx)(_e.rU,{to:(0,Mt.Le)(),children:"Sign Up"})]})]}),(0,i.jsx)(Gt,{})]})})};const rn=function(){const{user:e,setUser:t}=(0,r.useContext)(s.St),n=(0,a.s0)();let o=null;const l=Ft(),[c,u]=(0,r.useState)(!1),[d,h]=(0,r.useState)(!1);function p(e){const t=Yt(e);u(!1),alert(t)}async function f(e){t(e),setTimeout((()=>{u(!1),n(Xi)}),100)}return(0,i.jsx)("div",{className:"auth-pages-small login-page-small",children:(0,i.jsxs)("div",{className:"page-limiter",children:[(0,i.jsxs)("div",{className:"title-wrapper",children:[(0,i.jsxs)("h1",{className:"title",children:["Welcome back",null!==l&&String(l.name).length>0&&", "+l.name]}),(0,i.jsx)("img",{src:Ht})]}),(0,i.jsx)(zt,{onSubmit:e=>{u(!0),Xt(e,Lt.I,f,p)},loading:c}),(0,i.jsx)(tn,{onClick:()=>{o=Jt();const e=new Ot.hJ;(0,Ot.F6)(Lt.I,e),h(!0),setTimeout((()=>{h(!1)}),5e3)},loading:d,classNames:"sm"}),(0,i.jsxs)("div",{className:"auth-page__bottom-link",children:["Don't have an account? ",(0,i.jsx)("button",{className:"button-link",onClick:function(){(0,Mt.VI)(),setTimeout((()=>{n((0,Mt.Le)())}),100)},children:"Sign Up"})]})]})})};const sn=n.p+"7d4d5d390c4ae9bb6233.png";const on=n.p+"3d141b9ba0b99dcd53e14a30649d952a.svg";function an(e){return(0,i.jsx)("div",{className:"form-contents",children:(0,i.jsxs)("form",{onSubmit:e.onSubmit,children:[(0,i.jsxs)("div",{className:"form-element",children:[(0,i.jsx)("label",{children:"Email"}),(0,i.jsx)("input",{name:"email",id:"email",type:"text",placeholder:"Enter email"})]}),(0,i.jsx)("div",{children:(0,i.jsx)("button",{type:"submit",className:"full",children:"Send reset link"})})]})})}const ln=function(){const e=(0,a.s0)();return(0,i.jsx)("div",{className:"auth-page reset-page",children:(0,i.jsxs)("div",{className:"page-limiter",children:[(0,i.jsxs)("div",{className:"auth-page__form",children:[(0,i.jsx)("div",{className:"auth-page__logo",children:(0,i.jsx)("img",{className:"photon-logo",alt:"Photon",src:Wt.Z})}),(0,i.jsxs)("div",{className:"form-contents",children:[(0,i.jsxs)("div",{className:"title-wrapper with-subtitle",children:[(0,i.jsx)("h1",{className:"form-contents__title ",children:"Forgot Password?"}),(0,i.jsx)("img",{src:sn})]}),(0,i.jsx)("div",{className:"form-contents__subtitle",children:"We’ll send a link to your email to reset your password"}),(0,i.jsx)("div",{className:"form-contents",children:(0,i.jsx)(an,{onSubmit:t=>{t.preventDefault();const n=t.target.email.value;(0,Ot.LS)(Lt.I,n).then((()=>{alert("Password reset email sent!"),e((0,Mt.HB)())})).catch((e=>{alert("Reset error: "+e.message)}))}})}),(0,i.jsx)("div",{className:"auth-page__link-with-icon",children:(0,i.jsxs)(_e.rU,{to:(0,Mt.HB)(),children:[(0,i.jsx)("img",{src:on}),"Back to Login"]})})]}),(0,i.jsxs)("div",{className:"auth-page__bottom-link",children:["Dont have account? ",(0,i.jsx)(_e.rU,{to:(0,Mt.Le)(),children:"Sign Up"})]})]}),(0,i.jsx)(Gt,{})]})})};const cn=n.p+"73889a76c0635aa7cba0723c7d60d3c4.svg";const un=function(){const e=(0,a.s0)();return(0,i.jsx)("div",{className:"auth-pages-small reset-page-small",children:(0,i.jsxs)("div",{className:"page-limiter spread",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"title-wrapper",children:(0,i.jsxs)("div",{className:"title",children:[(0,i.jsx)("h1",{children:"Forgot Password?"}),(0,i.jsx)("img",{src:sn})]})}),(0,i.jsx)("div",{className:"subtitle",children:"We’ll send a link to your email to reset your password"}),(0,i.jsx)("div",{className:"form-contents",children:(0,i.jsxs)("form",{onSubmit:t=>{t.preventDefault();const n=t.target.email.value;(0,Ot.LS)(Lt.I,n).then((()=>{alert("Password reset email sent!"),e((0,Mt.HB)())})).catch((e=>{alert("Reset error: "+e.message)}))},children:[(0,i.jsxs)("div",{className:"form-element",children:[(0,i.jsx)("label",{children:"Email"}),(0,i.jsx)("input",{name:"email",id:"email",type:"text",placeholder:"Enter email"})]}),(0,i.jsx)("div",{children:(0,i.jsx)("button",{type:"submit",className:"full",children:"Send reset link"})})]})})]}),(0,i.jsx)("div",{className:"link-with-icon",children:(0,i.jsxs)(_e.rU,{to:(0,Mt.HB)(),children:[(0,i.jsx)("img",{src:cn}),"Back to Login"]})})]})})},dn={invitationCode:"",email:"",password:"",displayName:"",type:""};const hn=function(e){const{handleSubmit:t,loading:n}=e,[s,o]=(0,r.useState)(dn),[a,l]=(0,r.useState)(!1),[c,u]=(0,r.useState)(!0);function d(e,t){const n={...s,[e]:t};o(n)}return(0,r.useEffect)((()=>{s.password.length>0&&u((0,ht.aO)(s.password))}),[s.password]),(0,i.jsxs)("form",{onSubmit:function(e){t(s,e)},children:[(0,i.jsxs)("div",{className:"form-element",children:[(0,i.jsx)("label",{children:"Company code"}),(0,i.jsx)("input",{name:"code",type:"text",placeholder:"Company code",required:!0,value:s.invitationCode,onChange:e=>d("invitationCode",e.target.value)})]}),(0,i.jsxs)("div",{className:"form-element",children:[(0,i.jsx)("label",{children:"Email"}),(0,i.jsx)("input",{name:"email",type:"text",placeholder:"Enter email",required:!0,value:s.email,onChange:e=>d("email",e.target.value)})]}),(0,i.jsxs)("div",{className:"form-element",children:[(0,i.jsx)("label",{children:"Password"}),(0,i.jsxs)("div",{className:"input-with-icon",children:[(0,i.jsx)("input",{name:"password",type:a?"text":"password",placeholder:"********",required:!0,value:s.password,onChange:e=>d("password",e.target.value)}),(0,i.jsx)("img",{src:a?jt:Bt,className:"input-icon",onClick:()=>{l(!a)}})]}),!c&&(0,i.jsx)("div",{className:"invalid-input",children:ht.Ml})]}),(0,i.jsxs)("div",{className:"form-element",children:[(0,i.jsx)("label",{children:"Name"}),(0,i.jsx)("input",{name:"name",type:"text",placeholder:"Your name",required:!0,value:s.displayName,onChange:e=>d("displayName",e.target.value)})]}),(0,i.jsx)("div",{children:(0,i.jsxs)("button",{type:"submit",disabled:!((0,ht.D6)(s.email)&&(0,ht.aO)(s.password)&&String(s.displayName).trim().length>0&&String(s.invitationCode).trim().length>0)||n,className:"full with-loader "+(n?"loading":""),children:[(0,i.jsx)("span",{children:"Create account"}),(0,i.jsx)("img",{src:x.Z,className:"loading-animation"})]})})]})},pn=n.p+"6faae5a742eb1316e535.png";const fn=function(){const e=(0,a.s0)(),[t,n]=(0,r.useState)(!1);return(0,i.jsx)("div",{className:"auth-page register-page",children:(0,i.jsxs)("div",{className:"page-limiter",children:[(0,i.jsxs)("div",{className:"auth-page__form",children:[(0,i.jsx)("div",{className:"auth-page__logo",children:(0,i.jsx)("img",{className:"photon-logo",alt:"Photon",src:Wt.Z})}),(0,i.jsxs)("div",{className:"form-contents",children:[(0,i.jsxs)("div",{className:"title-wrapper",children:[(0,i.jsx)("h1",{className:"form-contents__title",children:"Create an account"}),(0,i.jsx)("img",{src:pn})]}),(0,i.jsx)(hn,{handleSubmit:function(t,i){i.preventDefault(),n(!0),(0,Zt.z2)(t).then((i=>{n(!1),console.log("register",t,i),Vt(t.email,t.displayName),e((0,Mt.HB)())})).catch((e=>{n(!1),alert("Registration error: "+e.message)}))},loading:t})]}),(0,i.jsxs)("div",{className:"auth-page__bottom-link",children:["Already have an account? ",(0,i.jsx)(_e.rU,{to:(0,Mt.HB)(),children:"Sign In"})]})]}),(0,i.jsx)(Gt,{})]})})};const mn=n.p+"a07f889e767daee46b34ed708518098a.svg";var gn=n(6540),vn=n(5814);function yn(){const[e,t]=(0,r.useState)(""),n=(0,gn.a)((e=>e.current));return(0,r.useEffect)((function(){const e=(0,vt.iN)(n);t(e||(i=n,i.charAt(0).toUpperCase()+i.slice(1)));var i}),[n]),(0,i.jsxs)("div",{children:[(0,i.jsx)(vn.Z,{classNames:"presence-identicator"}),(0,i.jsx)("span",{className:"presence-status",children:e})]})}const bn=n.p+"d086c7e493d968e32986e77cb39b6114.svg";const _n=n.p+"71054d6b7364841237adab4d170f2451.svg";const wn=n.p+"c14090d047951314a9c28824edb6daee.svg";const Sn=n.p+"bbbf1e6f7cabf429832f84c57ae114f6.svg";function Tn(e){return e.visible?(0,i.jsxs)(U.Z,{title:"Sign out",message:"Are you sure you'd like to sign out of Photon?",classNames:"sign-out-popup",onClose:e.onCancel,children:[(0,i.jsx)("button",{onClick:e.onCancel,className:"outlined-light",children:"Cancel"}),(0,i.jsx)("button",{onClick:e.onSuccess,className:"green",children:"Sign Out"})]}):null}var En=n(4340);const kn=n.p+"7f6102b878ea44dc471c23f0381ff943.svg";const Cn=n.p+"afba4a1d528583416e282e56eac0f3f8.svg",In=[{title:"Today",value:o.Mr},{title:"30min",value:18e5},{title:"1hour",value:36e5},{title:"1week",value:6048e5}];function Rn(e){const{onClose:t}=e,{user:n}=(0,r.useContext)(s.St),a=(0,r.useContext)(s.Oy),[l,c]=(0,r.useState)(In[0]),[u,d]=(0,r.useState)(""),h=(0,gn.a)((e=>e.current));function p(){if(null!==u){const e=(0,ht.oL)(l.value==o.Mr?o.Mr:l.value);a.changeStatus(u,e)}else a.changeStatus("",0)}function f(){t()}return(0,r.useEffect)((function(){o.eI.find((e=>e.key==h))&&d(h);!function(){const e=window.localStorage.getItem("remember_expiry");if(e){const t=JSON.parse(e);In.forEach((e=>{t.title&&t.value&&t.title==e.title&&t.value==e.value&&c(e)}))}}()}),[]),(0,r.useEffect)((()=>{d(h)}),[h]),(0,i.jsx)("div",{className:"profile-status-filler",children:(0,i.jsxs)("div",{className:"profile-status-popup",children:[(0,i.jsxs)("button",{className:"clear-light profile-status-popup__back",onClick:f,children:[(0,i.jsx)("img",{src:Cn}),(0,i.jsx)("span",{children:"Whats's your status?"})]}),(0,i.jsx)("hr",{className:"separator"}),(0,i.jsx)("ul",{className:"statuses",children:o.eI.map((e=>{if(!e.selectable)return null;let t=u==e.key;return(0,i.jsx)("li",{children:(0,i.jsxs)("button",{onClick:()=>{!function(e){d(u==e?.key?"":e.key)}(e)},className:"status-button clear-light",children:[(0,i.jsxs)("span",{className:"button-content",children:[(0,i.jsx)("span",{className:"icon-wrapper",children:(0,i.jsx)("img",{src:En[e.key]})}),e.title]}),(0,i.jsx)("span",{className:"selected-status",children:t&&(0,i.jsx)("img",{src:kn})})]})},e.key)}))}),(0,i.jsx)("div",{className:"clear-after-title",children:"Clear after:"}),(0,i.jsx)("ul",{className:"clear-after-time",children:In.map((e=>{let t=e.title==l.title;return(0,i.jsx)("li",{className:t?"selected":"",children:(0,i.jsx)("button",{onClick:()=>{c(e)},className:"clear-light",children:e.title})},e.value)}))}),(0,i.jsxs)("div",{className:"status-buttons-wrapper",children:[(0,i.jsx)("button",{onClick:f,className:"outlined-light sm",children:"Cancel"}),(0,i.jsx)("button",{onClick:function(){var e;e=l,window.localStorage.setItem("remember_expiry",JSON.stringify(e)),p(),t()},className:"green sm-plus",children:"Save"})]})]})})}const Pn=31536e6;const An=n.p+"7c90e8e7d6346903850fde7e7c8d29a8.svg";var Nn=n(1657),xn=n(4444),Dn=n(8463);const On="firebasestorage.googleapis.com",Ln="storageBucket";class Mn extends xn.ZR{constructor(e,t,n=0){super(Fn(e),`Firebase Storage: ${t} (${Fn(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Mn.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Fn(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var jn,Un;function Fn(e){return"storage/"+e}function Vn(){return new Mn(jn.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function Bn(){return new Mn(jn.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function zn(){return new Mn(jn.CANCELED,"User canceled the upload/download.")}function $n(){return new Mn(jn.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function qn(e){return new Mn(jn.INVALID_ARGUMENT,e)}function Gn(){return new Mn(jn.APP_DELETED,"The Firebase app was deleted.")}function Wn(e,t){return new Mn(jn.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function Hn(e){throw new Mn(jn.INTERNAL_ERROR,"Internal error: "+e)}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(jn||(jn={}));class Kn{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=Kn.makeFromUrl(e,t)}catch(t){return new Kn(e,"")}if(""===n.path)return n;throw i=e,new Mn(jn.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+i+"'.");var i}static makeFromUrl(e,t){let n=null;const i="([A-Za-z0-9.\\-_]+)";const r=new RegExp("^gs://"+i+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}const o=t.replace(/[.]/g,"\\."),a=[{regex:r,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${i}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${t===On?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${i}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let t=0;t<a.length;t++){const i=a[t],r=i.regex.exec(e);if(r){const e=r[i.indices.bucket];let t=r[i.indices.path];t||(t=""),n=new Kn(e,t),i.postModify(n);break}}if(null==n)throw function(e){return new Mn(jn.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class Jn{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function Qn(e){return"string"==typeof e||e instanceof String}function Yn(e){return Zn()&&e instanceof Blob}function Zn(){return"undefined"!=typeof Blob&&!(0,xn.UG)()}function Xn(e,t,n,i){if(i<t)throw qn(`Invalid value for '${e}'. Expected ${t} or greater.`);if(i>n)throw qn(`Invalid value for '${e}'. Expected ${n} or less.`)}function ei(e,t,n){let i=t;return null==n&&(i=`https://${t}`),`${n}://${i}/v0${e}`}function ti(e){const t=encodeURIComponent;let n="?";for(const i in e)if(e.hasOwnProperty(i)){n=n+(t(i)+"="+t(e[i]))+"&"}return n=n.slice(0,-1),n}function ni(e,t){const n=e>=500&&e<600,i=-1!==[408,429].indexOf(e),r=-1!==t.indexOf(e);return n||i||r}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(Un||(Un={}));class ii{constructor(e,t,n,i,r,s,o,a,l,c,u,d=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=i,this.successCodes_=r,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=l,this.progressCallback_=c,this.connectionFactory_=u,this.retry=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()}))}start_(){const e=(e,t)=>{if(t)return void e(!1,new ri(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const i=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(i),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(i),this.pendingConnection_=null;const t=n.getErrorCode()===Un.NO_ERROR,r=n.getStatus();if(!t||ni(r,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===Un.ABORT;return void e(!1,new ri(!1,null,t))}const s=-1!==this.successCodes_.indexOf(r);e(!0,new ri(s,n))}))},t=(e,t)=>{const n=this.resolve_,i=this.reject_,r=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(r,r.getResponse());void 0!==e?n(e):n()}catch(e){i(e)}else if(null!==r){const e=Vn();e.serverResponse=r.getErrorText(),this.errorCallback_?i(this.errorCallback_(r,e)):i(e)}else if(t.canceled){i(this.appDelete_?Gn():zn())}else{i(Bn())}};this.canceled_?t(0,new ri(!1,null,!0)):this.backoffId_=function(e,t,n){let i=1,r=null,s=null,o=!1,a=0;function l(){return 2===a}let c=!1;function u(...e){c||(c=!0,t.apply(null,e))}function d(t){r=setTimeout((()=>{r=null,e(p,l())}),t)}function h(){s&&clearTimeout(s)}function p(e,...t){if(c)return void h();if(e)return h(),void u.call(null,e,...t);if(l()||o)return h(),void u.call(null,e,...t);let n;i<64&&(i*=2),1===a?(a=2,n=0):n=1e3*(i+Math.random()),d(n)}let f=!1;function m(e){f||(f=!0,h(),c||(null!==r?(e||(a=2),clearTimeout(r),d(0)):e||(a=1)))}return d(0),s=setTimeout((()=>{o=!0,m(!0)}),n),m}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class ri{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function si(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function oi(...e){const t=si();if(void 0!==t){const n=new t;for(let t=0;t<e.length;t++)n.append(e[t]);return n.getBlob()}if(Zn())return new Blob(e);throw new Mn(jn.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}function ai(e){if("undefined"==typeof atob)throw t="base-64",new Mn(jn.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`);var t;return atob(e)}const li={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class ci{constructor(e,t){this.data=e,this.contentType=t||null}}function ui(e,t){switch(e){case li.RAW:return new ci(di(t));case li.BASE64:case li.BASE64URL:return new ci(hi(e,t));case li.DATA_URL:return new ci(function(e){const t=new pi(e);return t.base64?hi(li.BASE64,t.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(e){throw Wn(li.DATA_URL,"Malformed data URL.")}return di(t)}(t.rest)}(t),new pi(t).contentType)}throw Vn()}function di(e){const t=[];for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);if(i<=127)t.push(i);else if(i<=2047)t.push(192|i>>6,128|63&i);else if(55296==(64512&i)){if(n<e.length-1&&56320==(64512&e.charCodeAt(n+1))){i=65536|(1023&i)<<10|1023&e.charCodeAt(++n),t.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i)}else t.push(239,191,189)}else 56320==(64512&i)?t.push(239,191,189):t.push(224|i>>12,128|i>>6&63,128|63&i)}return new Uint8Array(t)}function hi(e,t){switch(e){case li.BASE64:{const n=-1!==t.indexOf("-"),i=-1!==t.indexOf("_");if(n||i){throw Wn(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?")}break}case li.BASE64URL:{const n=-1!==t.indexOf("+"),i=-1!==t.indexOf("/");if(n||i){throw Wn(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?")}t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=ai(t)}catch(t){if(t.message.includes("polyfill"))throw t;throw Wn(e,"Invalid character found")}const i=new Uint8Array(n.length);for(let e=0;e<n.length;e++)i[e]=n.charCodeAt(e);return i}class pi{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw Wn(li.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;null!=n&&(this.base64=function(e,t){const n=e.length>=t.length;if(!n)return!1;return e.substring(e.length-t.length)===t}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}class fi{constructor(e,t){let n=0,i="";Yn(e)?(this.data_=e,n=e.size,i=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,t){if(Yn(this.data_)){const n=function(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.mozSlice?e.mozSlice(t,n):e.slice?e.slice(t,n):null}(this.data_,e,t);return null===n?null:new fi(n)}{const n=new Uint8Array(this.data_.buffer,e,t-e);return new fi(n,!0)}}static getBlob(...e){if(Zn()){const t=e.map((e=>e instanceof fi?e.data_:e));return new fi(oi.apply(null,t))}{const t=e.map((e=>Qn(e)?ui(li.RAW,e).data:e.data_));let n=0;t.forEach((e=>{n+=e.byteLength}));const i=new Uint8Array(n);let r=0;return t.forEach((e=>{for(let t=0;t<e.length;t++)i[r++]=e[t]})),new fi(i,!0)}}uploadData(){return this.data_}}function mi(e){let t;try{t=JSON.parse(e)}catch(e){return null}return"object"!=typeof(n=t)||Array.isArray(n)?null:t;var n}function gi(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function vi(e,t){return t}class yi{constructor(e,t,n,i){this.server=e,this.local=t||e,this.writable=!!n,this.xform=i||vi}}let bi=null;function _i(){if(bi)return bi;const e=[];e.push(new yi("bucket")),e.push(new yi("generation")),e.push(new yi("metageneration")),e.push(new yi("name","fullPath",!0));const t=new yi("name");t.xform=function(e,t){return function(e){return!Qn(e)||e.length<2?e:gi(e)}(t)},e.push(t);const n=new yi("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new yi("timeCreated")),e.push(new yi("updated")),e.push(new yi("md5Hash",null,!0)),e.push(new yi("cacheControl",null,!0)),e.push(new yi("contentDisposition",null,!0)),e.push(new yi("contentEncoding",null,!0)),e.push(new yi("contentLanguage",null,!0)),e.push(new yi("contentType",null,!0)),e.push(new yi("metadata","customMetadata",!0)),bi=e,bi}function wi(e,t,n){const i={type:"file"},r=n.length;for(let e=0;e<r;e++){const r=n[e];i[r.local]=r.xform(i,t[r.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){const n=e.bucket,i=e.fullPath,r=new Kn(n,i);return t._makeStorageReference(r)}})}(i,e),i}function Si(e,t,n){const i=mi(t);if(null===i)return null;return wi(e,i,n)}function Ti(e,t){const n={},i=t.length;for(let r=0;r<i;r++){const i=t[r];i.writable&&(n[i.server]=e[i.local])}return JSON.stringify(n)}class Ei{constructor(e,t,n,i){this.url=e,this.method=t,this.handler=n,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function ki(e){if(!e)throw Vn()}function Ci(e,t){return function(n,i){const r=Si(e,i,t);return ki(null!==r),r}}function Ii(e,t){return function(n,i){const r=Si(e,i,t);return ki(null!==r),function(e,t,n,i){const r=mi(t);if(null===r)return null;if(!Qn(r.downloadTokens))return null;const s=r.downloadTokens;if(0===s.length)return null;const o=encodeURIComponent;return s.split(",").map((t=>{const r=e.bucket,s=e.fullPath;return ei("/b/"+o(r)+"/o/"+o(s),n,i)+ti({alt:"media",token:t})}))[0]}(r,i,e.host,e._protocol)}}function Ri(e){return function(t,n){let i;var r,s;return 401===t.getStatus()?i=t.getErrorText().includes("Firebase App Check token is invalid")?new Mn(jn.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new Mn(jn.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(s=e.bucket,i=new Mn(jn.QUOTA_EXCEEDED,"Quota for bucket '"+s+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(r=e.path,i=new Mn(jn.UNAUTHORIZED,"User does not have permission to access '"+r+"'.")):i=n,i.status=t.getStatus(),i.serverResponse=n.serverResponse,i}}function Pi(e){const t=Ri(e);return function(n,i){let r=t(n,i);var s;return 404===n.getStatus()&&(s=e.path,r=new Mn(jn.OBJECT_NOT_FOUND,"Object '"+s+"' does not exist.")),r.serverResponse=i.serverResponse,r}}function Ai(e,t,n){const i=Object.assign({},n);return i.fullPath=e.path,i.size=t.size(),i.contentType||(i.contentType=function(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}(null,t)),i}function Ni(e,t,n,i,r){const s=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};const a=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();o["Content-Type"]="multipart/related; boundary="+a;const l=Ai(t,i,r),c="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+Ti(l,n)+"\r\n--"+a+"\r\nContent-Type: "+l.contentType+"\r\n\r\n",u="\r\n--"+a+"--",d=fi.getBlob(c,i,u);if(null===d)throw $n();const h={name:l.fullPath},p=ei(s,e.host,e._protocol),f=e.maxUploadRetryTime,m=new Ei(p,"POST",Ci(e,n),f);return m.urlParams=h,m.headers=o,m.body=d.uploadData(),m.errorHandler=Ri(t),m}let xi=null;class Di{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Un.NO_ERROR,this.sendPromise_=new Promise((e=>{this.xhr_.addEventListener("abort",(()=>{this.errorCode_=Un.ABORT,e()})),this.xhr_.addEventListener("error",(()=>{this.errorCode_=Un.NETWORK_ERROR,e()})),this.xhr_.addEventListener("load",(()=>{e()}))}))}send(e,t,n,i){if(this.sent_)throw Hn("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==i)for(const e in i)i.hasOwnProperty(e)&&this.xhr_.setRequestHeader(e,i[e].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Hn("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Hn("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw Hn("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Hn("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class Oi extends Di{initXhr(){this.xhr_.responseType="text"}}function Li(){return xi?xi():new Oi}class Mi{constructor(e,t){this._service=e,this._location=t instanceof Kn?t:Kn.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Mi(e,t)}get root(){const e=new Kn(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return gi(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new Kn(this._location.bucket,e);return new Mi(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new Mn(jn.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function ji(e,t,n){e._throwIfRoot("uploadBytes");const i=Ni(e.storage,e._location,_i(),new fi(t,!0),n);return e.storage.makeRequestWithTokens(i,Li).then((t=>({metadata:t,ref:e})))}function Ui(e){e._throwIfRoot("getDownloadURL");const t=function(e,t,n){const i=ei(t.fullServerUrl(),e.host,e._protocol),r=e.maxOperationRetryTime,s=new Ei(i,"GET",Ii(e,n),r);return s.errorHandler=Pi(t),s}(e.storage,e._location,_i());return e.storage.makeRequestWithTokens(t,Li).then((e=>{if(null===e)throw new Mn(jn.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e}))}function Fi(e,t){const n=function(e,t){const n=t.split("/").filter((e=>e.length>0)).join("/");return 0===e.length?n:e+"/"+n}(e._location.path,t),i=new Kn(e._location.bucket,n);return new Mi(e.storage,i)}function Vi(e,t){if(e instanceof $i){const n=e;if(null==n._bucket)throw new Mn(jn.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Ln+"' property when initializing the app?");const i=new Mi(n,n._bucket);return null!=t?Vi(i,t):i}return void 0!==t?Fi(e,t):e}function Bi(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof $i)return new Mi(e,t);throw qn("To use ref(service, url), the first argument must be a Storage instance.")}return Vi(e,t)}function zi(e,t){const n=null==t?void 0:t[Ln];return null==n?null:Kn.makeFromBucketSpec(n,e)}class $i{constructor(e,t,n,i,r){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=i,this._firebaseVersion=r,this._bucket=null,this._host=On,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=i?Kn.makeFromBucketSpec(i,this._host):zi(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=Kn.makeFromBucketSpec(this._url,e):this._bucket=zi(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Xn("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Xn("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});if(e){return(await e.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((e=>e.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Mi(this,e)}_makeRequest(e,t,n,i,r=!0){if(this._deleted)return new Jn(Gn());{const s=function(e,t,n,i,r,s,o=!0){const a=ti(e.urlParams),l=e.url+a,c=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(c,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(c,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!=t?t:"AppManager")}(c,s),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(c,i),new ii(l,e.method,c,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,r,o)}(e,this._appId,n,i,t,this._firebaseVersion,r);return this._requests.add(s),s.getPromise().then((()=>this._requests.delete(s)),(()=>this._requests.delete(s))),s}}async makeRequestWithTokens(e,t){const[n,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,i).getPromise()}}const qi="@firebase/storage",Gi="0.11.2",Wi="storage";function Hi(e=(0,Nn.Mq)(),t){e=(0,xn.m9)(e);const n=(0,Nn.qX)(e,Wi).getImmediate({identifier:t}),i=(0,xn.P0)("storage");return i&&function(e,t,n,i={}){!function(e,t,n,i={}){e.host=`${t}:${n}`,e._protocol="http";const{mockUserToken:r}=i;r&&(e._overrideAuthToken="string"==typeof r?r:(0,xn.Sg)(r,e.app.options.projectId))}(e,t,n,i)}(n,...i),n}function Ki(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return new $i(n,i,r,t,Nn.Jn)}(0,Nn.Xd)(new Dn.wA(Wi,Ki,"PUBLIC").setMultipleInstances(!0)),(0,Nn.KN)(qi,Gi,""),(0,Nn.KN)(qi,Gi,"esm2017");const Ji=n(8493);function Qi(e){const{user:t,setUser:n}=(0,r.useContext)(s.St),o=(0,r.useRef)(null),[a,l]=(0,r.useState)(null),[c,u]=(0,r.useState)(!1);function d(){o.current.click()}function h(e){e.ref&&function(e){return Ui(e=(0,xn.m9)(e))}(e.ref).then((async e=>{(0,ce.bY)(t.uid,e).then((()=>{n({...t,customImage:e}),u(!1)})).catch((e=>{console.error(e),u(!1),alert(e)}))}))}return(0,r.useEffect)((()=>{null==a||c||(function(e){const n=Hi(),i=e.type.split("/")[1],r=`images/${t.uid}/${Date.now()}.${i}`;var s,o;(function(e,t,n){return ji(e=(0,xn.m9)(e),t,n)})((s=n,o=r,Bi(s=(0,xn.m9)(s),o)),e).then(h).catch((e=>{alert(e),u(!1)}))}(a),u(!0))}),[a]),(0,i.jsxs)("button",{className:"profile-image-change",children:[!c&&(0,i.jsx)(J.Z,{user:t}),c?(0,i.jsx)("div",{className:"profile-image-change__busy",children:(0,i.jsx)("img",{src:Ji,onClick:d})}):(0,i.jsx)("div",{className:"profile-image-change__hover",children:(0,i.jsx)("img",{src:An,onClick:d})}),(0,i.jsx)("input",{type:"file",ref:o,onChange:function(e){l(e.target.files[0])},accept:"image/jpeg, image/png, image/jpg"})]})}const Yi=function(e){const{handleSubmit:t,errorMessage:n}=e,[s,o]=(0,r.useState)({invitationCode:""});return(0,i.jsxs)("form",{onSubmit:function(e){t(s,e)},children:[(0,i.jsxs)("div",{className:"form-element",children:[(0,i.jsx)("label",{children:"Company code"}),(0,i.jsx)("input",{name:"code",type:"text",placeholder:"Company code",required:!0,value:s.invitationCode,onChange:e=>function(e,t){const n={...s,[e]:t};o(n)}("invitationCode",e.target.value)})]}),n&&""!==n?(0,i.jsxs)("div",{className:"error-message",children:["Error: ",n]}):null,(0,i.jsxs)("div",{children:[(0,i.jsx)("button",{type:"submit",disabled:!(String(s.invitationCode).trim().length>=4),className:"full",children:"Complete"}),e?.children&&e.children]})]})};const Zi=function(e){const{userUid:t,callback:n}=e,[s,o]=(0,r.useState)(""),l=(0,a.s0)();function c(e){console.error(e),e.message&&alert(e.message)}return(0,i.jsx)("div",{className:"auth-pages-small finish-registration",children:(0,i.jsxs)("div",{className:"page-limiter",children:[(0,i.jsxs)("div",{className:"title-wrapper",children:[(0,i.jsx)("h1",{className:"title",children:"Finish registration"}),(0,i.jsx)("img",{src:Ht})]}),(0,i.jsx)("div",{className:"form-contents",children:(0,i.jsx)(Yi,{handleSubmit:async function(e,i){i.preventDefault();const r=await(0,Nt.N3)(e?.invitationCode);if(null===r)return void o("Company code not found");o(""),console.log("got company?",r),await(0,ce.Xd)(t,r.uid).catch(c)?n&&n(t):console.error("failed finreg finalization")},errorMessage:s,children:(0,i.jsx)("button",{type:"button",onClick:function(){l(tr)},className:"full btn-grey",children:"Cancel"})})})]})})};const Xi="/",er="/login",tr="/logout",nr="/register",ir="/register-finish",rr="/reset",sr="/profile",or="/profile/email",ar="/profile/password",lr="/profile/name",cr="/login/small",ur="/reset/small",dr="/outgoing",hr="/incoming",pr="/teamcall",fr={registerFinish:"/register-finish/:uid",outgoing:"/outgoing/:inviteeUid",incoming:"/incoming/:room/:inviter",teamCall:"/teamcall/:room/:team/:company",getRegisterFinishRoute:e=>fr.registerFinish.replace(":uid",e),getOutgoingRoute:e=>fr.outgoing.replace(":inviteeUid",e),getIncomingRoute:(e,t)=>fr.incoming.replace(":room",e).replace(":inviter",t),getTeamCallRoute:(e,t,n)=>fr.teamCall.replace(":room",e).replace(":team",t).replace(":company",n)},mr=[{path:Xi,component:Dt,name:"Home",protected:!0,nav:!0},{path:er,component:nn,name:"Login",protected:!1},{path:cr,component:rn,name:"Login_",protected:!1},{path:tr,component:function(){const e=(0,r.useContext)(s.Oy),t=(0,a.s0)(),{setUser:n}=(0,r.useContext)(s.St);return(0,r.useEffect)((function(){return e?.changePresence(ht.EO.offline),n(null),(0,Ot.w7)(Lt.I).then((()=>{t((0,Mt.HB)())})),()=>{}}),[]),null},name:"Logout",protected:!1},{path:rr,component:ln,name:"Reset",protected:!1},{path:ur,component:un,name:"Reset_",protected:!1},{path:nr,component:fn,name:"Register",protected:!1},{path:ir+"/:uid",component:function(){const{uid:e}=(0,a.UO)(),{onFinishRegistration:t}=(0,r.useContext)(s.St);return(0,i.jsx)(Zi,{userUid:e,callback:function(){t(e)}})},name:"Registration finalization",protected:!1},{path:sr,component:function(){const{user:e,setUser:t}=(0,r.useContext)(s.St),n=(0,a.s0)(),l=(0,gn.a)((e=>e.data)),[c,u]=(0,r.useState)(!1),[d,h]=(0,r.useState)(l.status==o.Bz),p=function(e,t=!0){const n=(0,gn.a)((e=>e.data)),i=(0,r.useContext)(s.Oy),[a,l]=(0,r.useState)(e);return(0,r.useEffect)((function(){n.status!=o.Bz&&l(!1)}),[n.status]),(0,r.useEffect)((function(){if(!t)if(e!==a&&l(e),e){const e=Date.now()+Pn;i?.changeStatus(o.Bz,e)}else i?.changeStatus("",0)}),[e]),a}(d,!c),[f,m]=(0,r.useState)(!1),[g,v]=(0,r.useState)(!1),y=(0,bt.c)(l);function b(){m(!f)}return(0,r.useEffect)((()=>{e&&!c&&u(!0)}),[]),e?f?(0,i.jsx)("div",{className:"profile-page ",children:(0,i.jsx)(Rn,{onClose:()=>{b()}})}):(0,i.jsxs)("div",{className:"profile-page ",children:[(0,i.jsxs)("div",{className:"profile-page__size-limiter "+(g&&"blur-section"),children:[(0,i.jsxs)("div",{className:"profile-page__hero spacing",children:[(0,i.jsx)(Qi,{}),(0,i.jsxs)("div",{className:"profile-info",children:[(0,i.jsxs)("div",{className:"profile-name",children:[e.name,(0,i.jsx)(_e.rU,{className:"clear-light edit",to:lr,children:(0,i.jsx)("img",{src:mn})})]}),(0,i.jsx)("div",{className:"profile-status",children:(0,i.jsx)(yn,{})})]})]}),(0,i.jsx)("div",{className:"update-status-button spacing",children:(0,i.jsx)("button",{className:"change-status clear-light",onClick:b,children:y?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("img",{src:bn,className:"status-icon"})," Update your status"]}):(0,i.jsxs)(i.Fragment,{children:[En[l.status]?(0,i.jsx)("img",{src:En[l.status]}):(0,i.jsx)("img",{src:bn}),o.eI.find((e=>e.key==l.status))?.title]})})}),(0,i.jsx)("div",{className:"separator"}),(0,i.jsxs)("div",{className:"profile-tools spacing",children:[(0,i.jsxs)("div",{className:"profile-tools__item",children:[(0,i.jsxs)("div",{className:"profile-tools__item-align",children:[(0,i.jsx)("img",{src:_n,className:"icon-disturb"}),"Do not disturb mode"]}),(0,i.jsx)("div",{children:(0,i.jsxs)("label",{className:"switch style-white-orange",children:[(0,i.jsx)("input",{type:"checkbox",checked:p,onChange:()=>{}}),(0,i.jsx)("span",{className:"slider round",onClick:()=>{h(!d)}})]})})]}),(0,i.jsx)("div",{className:"profile-tools__item",children:(0,i.jsxs)(_e.rU,{to:ar,className:"profile-tools__item-align",children:[(0,i.jsx)("img",{src:wn}),"Forgot password?"]})}),(0,i.jsx)("div",{className:"profile-tools__item",children:(0,i.jsxs)(_e.rU,{to:or,className:"profile-tools__item-align",children:[(0,i.jsx)("img",{src:Sn,className:"icon-edit"}),"Edit email address"]})})]}),(0,i.jsx)("div",{className:"separator"}),(0,i.jsx)("div",{className:"profile-tools spacing",children:(0,i.jsx)("div",{className:"profile-tools__item",children:(0,i.jsx)("button",{onClick:function(){v(!0)},className:"like-link clear-light",children:"Sign out of PHOTON"})})})]}),g&&(0,i.jsx)(Tn,{visible:g,onSuccess:function(){n(tr)},onCancel:()=>{v(!1)}})]}):null},name:"Profile",protected:!0,nav:!0},{path:or,component:function(){const[e,t]=(0,r.useState)("");return(0,i.jsx)("div",{className:"profile-page profile-change-email",children:(0,i.jsxs)("div",{className:"profile-page__size-limiter",children:[(0,i.jsx)("div",{children:(0,i.jsx)("h1",{className:"profile-page__title",children:"Change email"})}),(0,i.jsx)("div",{className:"form-contents",children:(0,i.jsxs)("form",{onSubmit:e=>{e.preventDefault();const n=function(e,n){if(String(e).trim()!=String(n).trim())return t("Emails do not match"),!1;if(!(0,ht.D6)(e))return t("Email is not valid"),!1;return!0}(e.target.email.value,e.target.email2.value);n&&alert("TODO")},children:[(0,i.jsxs)("div",{className:"form-element",children:[(0,i.jsx)("label",{children:"Email"}),(0,i.jsx)("input",{name:"email",type:"text",placeholder:"Enter email"})]}),(0,i.jsxs)("div",{className:"form-element",children:[(0,i.jsx)("label",{children:"Confirm"}),(0,i.jsx)("input",{name:"email2",type:"text",placeholder:"Confirm email"})]}),(0,i.jsx)("div",{children:(0,i.jsx)("button",{type:"submit",className:"full",children:"Save"})})]})}),""!=e?(0,i.jsx)("div",{className:"profile-page__error",children:e}):null,(0,i.jsx)("div",{className:"auth-page__link-with-icon",children:(0,i.jsxs)(_e.rU,{to:sr,children:[(0,i.jsx)("img",{src:cn}),"Back"]})})]})})},name:"Profile - Change Email",protected:!0,nav:!0},{path:ar,component:function(){const{user:e}=(0,r.useContext)(s.St),[t,n]=(0,r.useState)(""),[o,a]=(0,r.useState)(""),[l,c]=(0,r.useState)("");return(0,r.useEffect)((()=>{e&&n(e.email)}),[]),(0,i.jsx)("div",{className:"profile-page profile-forgot-password",children:(0,i.jsxs)("div",{className:"profile-page__size-limiter",children:[(0,i.jsx)("div",{children:(0,i.jsx)("h1",{className:"profile-page__title",children:"Forgot password?"})}),(0,i.jsx)("div",{className:"profile-page__subtitle",children:"We’ll send a link to your email to reset your password"}),(0,i.jsx)(an,{onSubmit:e=>{e.preventDefault();const t=e.target.email.value;(0,Ot.LS)(Lt.I,t).then((()=>{a("Password reset link sent to email!"),n("")})).catch((e=>{e?.message.includes("auth/missing-email")?c("Enter valid email address"):c(e.message)}))},email:t}),""!=o?(0,i.jsx)("div",{className:"profile-page__message",children:o}):null,""!=l?(0,i.jsx)("div",{className:"profile-page__error",children:l}):null,(0,i.jsx)("div",{className:"auth-page__link-with-icon",children:(0,i.jsxs)(_e.rU,{to:sr,children:[(0,i.jsx)("img",{src:cn}),"Back"]})})]})})},name:"Profile - Change Password",protected:!0,nav:!0},{path:lr,component:function(){const{user:e,setUser:t}=(0,r.useContext)(s.St),n=(0,r.useRef)(null),[o,l]=(0,r.useState)(""),c=(0,a.s0)();return(0,r.useEffect)((()=>{e&&e.displayName&&(n.current.value=e.name)}),[]),(0,i.jsx)("div",{className:"profile-page profile-change-name",children:(0,i.jsxs)("div",{className:"profile-page__size-limiter",children:[(0,i.jsx)("div",{children:(0,i.jsx)("h1",{className:"profile-page__title",children:"Change name"})}),(0,i.jsx)("div",{className:"profile-page__subtitle",children:"Want to change your display name?"}),(0,i.jsx)("div",{className:"form-contents",children:(0,i.jsxs)("form",{onSubmit:function(n){n.preventDefault();const i=String(n.target.name.value).trim();i.length<=1?l("Name is too short"):(0,ce.WY)(e.uid,i).then((()=>{t({...e,name:i}),setTimeout((()=>{c(sr)}),50)})).catch((e=>{console.error(e),l(e.message)}))},children:[(0,i.jsxs)("div",{className:"form-element",children:[(0,i.jsx)("label",{children:"Name"}),(0,i.jsx)("input",{ref:n,name:"name",type:"text",placeholder:"Enter preferred name"})]}),(0,i.jsx)("div",{children:(0,i.jsx)("button",{type:"submit",className:"full",children:"Save"})})]})}),""!=o?(0,i.jsx)("div",{className:"profile-page__error",children:o}):null,(0,i.jsx)("div",{className:"auth-page__link-with-icon",children:(0,i.jsxs)(_e.rU,{to:sr,children:[(0,i.jsx)("img",{src:cn}),"Back"]})})]})})},name:"Profile - Change Name",protected:!0,nav:!0},{path:fr.outgoing,component:be,name:"Outgoing Call",protected:!0,isCallRoute:!0},{path:fr.incoming,component:function(e){const{room:t,inviter:n}=(0,a.UO)(),{toggleMinimize:c}=e,[h,p]=(0,r.useState)(!1),[f,m]=(0,r.useState)(null),[g,v]=(0,r.useState)(null),{user:y}=(0,r.useContext)(s.St),b=(0,a.s0)(),[_,w]=(0,r.useState)(""),[S,T]=(0,_e.lr)(),[E,k]=(0,r.useState)(!1),C=!!S.get("autoaccept"),I=(0,he.i)((e=>e.pendingRedirect)),R=(0,u.cw)(),P=(0,u._U)(d.ln),A=(0,u._U)(d.Pz),N=(0,u._U)(d.uX),O=(0,u._U)(d.um);function L(){window.removeEventListener("beforeunload",(()=>{j()}))}function M(e){(0,de.n)(y.uid,n,e,!1)}function j(){M(pe.C.left),P&&R.leave()}function U(e=pe.C.left){L(),M(e),P&&R.leave(),setTimeout((()=>{b("/")}),100)}function F(){p(!0),M(pe.C.accept),V(f?.createdBy),O||async function(){try{await R.setLocalVideoEnabled(!O)}catch(e){console.log("rejected video permissions",e)}}(),N||async function(){try{await R.setLocalAudioEnabled(!N)}catch(e){console.log("rejected audio permissions",e),alert("please enable your audio. Click on notification that will appear after closing this popup")}}()}function V(e){e&&(0,le.I8)(e,y.uid).then((t=>{t&&(0,le.CV)(e,y.uid)})).catch((e=>{}))}return(0,D.Z)((async function(){e=n,(0,ce.bG)(e).then((e=>{e&&v(e)})),(0,ue.u)(y.uid,n);var e;const i=(0,K.aU)(y.uid,n);l.o(i,(async e=>{k(!0),m(e);const n=await async function(){const e=await se({role:o.K$.user,user_id:y.uid,room_id:String(t)}).catch((e=>{throw console.error(e),new Error("Failed getting token")}));return{userName:(0,H.R)(y),authToken:e,settings:{isAudioMuted:!0,isVideoMuted:!0}}}();await R.join(n)}))})),(0,r.useEffect)((function(){!P||h||C?P&&!h&&C&&F():M(pe.C.joined)}),[A,P]),(0,r.useEffect)((function(){const e=function(){const e=(0,K.aU)(String(y.uid),n);return l.oL(e,(e=>{"left"==e?.creatorState&&(w(e.creatorState),U())}))}();return window.addEventListener("beforeunload",(()=>{j()})),()=>{e&&e(),L()}}),[]),(0,r.useEffect)((function(){_==pe.C.left&&null===I&&U()}),[_]),(0,r.useEffect)((()=>{I&&E&&(L(),j())}),[I]),(0,i.jsxs)("div",{className:"incoming-call-page",children:[(0,i.jsx)(W,{visible:!0,accepted:h,onLeave:()=>{U()},toggleMinimize:c,person:g}),h||C?!h&&C?(0,i.jsx)("img",{src:x.Z}):null:(0,i.jsx)("div",{className:"private-call-invitation",children:(0,i.jsx)(De,{onAccept:F,onReject:function(){V(f?.createdBy),U(pe.C.reject)},debug:A,isConnected:P,person:f?.name})})]})},name:"Incoming Call",protected:!0,isCallRoute:!0},{path:fr.teamCall,component:rt,name:"Team Call",protected:!0,isCallRoute:!0}],gr=mr},89:(e,t,n)=>{"use strict";n.d(t,{q:()=>i,u:()=>r});const i={apiKey:"AIzaSyAdhyZ1GKQi3EV_sQ9gq1-ZiZC1sP1E6rk",authDomain:"lynk-a79b9.firebaseapp.com",databaseURL:"https://lynk-a79b9-default-rtdb.europe-west1.firebasedatabase.app",projectId:"lynk-a79b9",storageBucket:"lynk-a79b9.appspot.com",messagingSenderId:"771779066172",appId:"1:771779066172:web:436f1af1d98f33dbf2c639"},r="https://us-central1-lynk-a79b9.cloudfunctions.net/lynk"},565:(e,t,n)=>{"use strict";n.d(t,{I:()=>u,db:()=>c,e:()=>d});var i=n(1657);(0,i.KN)("firebase","9.22.2","app");var r=n(9155),s=n(3953),o=n(89),a=n(8679);const l=(0,i.ZF)(o.q),c=(0,s.ad)(l),u=(0,r.v0)(l),d=()=>(0,a.N8)(l)},3844:(e,t,n)=>{"use strict";n.d(t,{RQ:()=>c,_Z:()=>u,z2:()=>l});var i=n(3821),r=n(9155),s=n(565),o=n(3953),a=n(2549);function l(e){return new Promise((async(t,n)=>{if(!i.Dk){if(!await(0,a.N3)(e.invitationCode))return n({message:"Invitation code not found."})}(0,r.Xb)(s.I,e.email,e.password).then((async r=>{const{user:l}=r;await async function(e,t){const n=await(0,a.N3)(t.invitationCode),r={email:t.email,name:t.displayName,companies:n?[n.uid]:[],version:i.Vy};return(0,o.pl)((0,o.JU)(s.db,i.Hk,e),r)}(l.uid,e).catch((e=>{n(e)})),t(l)})).catch((e=>{n(e)}))}))}async function c(e,t){return(0,o.pl)((0,o.JU)(s.db,i.Hk,e),t)}async function u(e,t=void 0){const n=await(0,o.QT)((0,o.JU)(s.db,i.Hk,e.uid)),r=n.exists()?n.data():{teams:[]},a={...e,...r};return t?t(a):a}},1142:(e,t,n)=>{"use strict";n.d(t,{Tr:()=>c,Wo:()=>u,iH:()=>o,ij:()=>l,o:()=>a,oL:()=>s});var i=n(8679),r=n(565);function s(e,t){const n=(0,r.e)(),s=(0,i.iH)(n,e);return(0,i.jM)(s,(e=>{const n=e.val();n&&t(n)}))}function o(e,t){const n=(0,r.e)(),s=(0,i.iH)(n,e);return(0,i.yv)(s,(e=>{e&&t(e.val())}))}function a(e,t){const n=(0,r.e)(),s=(0,i.iH)(n);(0,i.U2)((0,i.iU)(s,e)).then((e=>{e.exists()&&t(e.val())})).catch((e=>{console.error(e)}))}function l(e){return new Promise(((t,n)=>{const s=(0,r.e)(),o=(0,i.iH)(s);(0,i.U2)((0,i.iU)(o,e)).then((e=>{e.exists()?t(e.val()):n(null)})).catch((e=>{console.error(e),n(e)}))}))}function c(e){const t=(0,r.e)(),n=(0,i.iH)(t,e);return new Promise(((e,t)=>{(0,i.jM)(n,(n=>{n.exists()?e(n.val()):t()}),{onlyOnce:!0})}))}function u(e,t){const n=(0,r.e)();return new Promise(((r,s)=>{(0,i.t8)((0,i.iH)(n,e),t).then((()=>{r("success")})).catch((e=>{s({message:"update failed",error:e})}))}))}},2549:(e,t,n)=>{"use strict";n.d(t,{N3:()=>o,YR:()=>l});var i=n(3953),r=n(565),s=n(3821);async function o(e){const t=(0,i.hJ)(r.db,s.Yg),n=(0,i.IO)(t,(0,i.ar)("invitationCode","==",e)),o=await(0,i.PL)(n);if(o.size>0){const e=[];return o.forEach((t=>{e.push({...t.data(),uid:t.id})})),e[0]}return null}function a(e){return`_cache_teams_${e}`}async function l(e,t){const n=await async function(e){const t=(0,i.IO)((0,i.hJ)(r.db,s.Yg),(0,i.ar)((0,i.Jm)(),"in",e)),n=await(0,i.PL)(t),o=[];return n.forEach((e=>{const t=e.data();o.push({...t,uid:e.id})})),o}(t);let o=[];for await(let t of n){(await c(t)).forEach((t=>{t.users.findIndex((t=>t==e))>-1&&o.push(t)}));break}return function(e,t){const n=a(e),i=Date.now()+5e3;localStorage.setItem(n,JSON.stringify({expiry:i,data:t}))}(e,o),o}async function c(e){const t=(0,i.IO)((0,i.hJ)(r.db,`${s.Yg}/${e.uid}/teams`)),n=await(0,i.PL)(t),o=[];return n.forEach((e=>{o.push({...e.data(),uid:e.id})})),o}},3647:(e,t,n)=>{"use strict";n.d(t,{E:()=>o,n:()=>a});var i=n(3821),r=n(3953),s=n(565);async function o(e,t=[]){const n=(0,r.IO)((0,r.hJ)(s.db,i.Hk),(0,r.ar)("companies","array-contains",e)),o=await(0,r.PL)(n),a=[];return o.forEach((e=>{t.includes(e.id)||a.push({...e.data(),uid:e.id})})),a}async function a(e,t){const n=await(0,r.QT)((0,r.JU)(s.db,i.Yg,`${e}/teams/${t}`));if(n.exists()){const e=n.data().users.map((e=>e));return console.log("looking for ",e),await async function(e){const t=[],n=(0,r.IO)((0,r.hJ)(s.db,i.Hk),(0,r.ar)((0,r.Jm)(),"in",e));return(await(0,r.PL)(n)).forEach((e=>{if(e&&e.id){let n=e.data();t.push({...n,uid:e.id})}})),t}(e)}return[]}},9063:(e,t,n)=>{"use strict";n.d(t,{I:()=>o});var i=n(3953),r=n(565),s=n(3821);async function o(e,t){const n=await(0,i.QT)((0,i.JU)(r.db,`${s.Yg}/${e}/teams/${t}`));return n.exists()?{...n.data(),uid:t}:null}},8784:(e,t,n)=>{"use strict";n.d(t,{WY:()=>l,Xd:()=>d,bG:()=>a,bY:()=>c,oM:()=>h,oe:()=>u});var i=n(3821),r=n(3953),s=n(565),o=n(3844);async function a(e){const t=await(0,r.QT)((0,r.JU)(s.db,i.Hk,e));return t.exists()?{...t.data(),uid:e}:null}function l(e,t){const n=function(e){let t=!0;return 0===String(e).trim().length&&(t=!1),t}(t);if(n){const n=(0,r.JU)(s.db,i.Hk,e);return(0,r.r7)(n,{name:t})}return Promise.reject({message:"Enter name",error:"Validation failed"})}function c(e,t){const n=(0,r.JU)(s.db,i.Hk,e);return(0,r.r7)(n,{customImage:t})}async function u(e,t="google"){const n={name:e.displayName,email:e.email,type:t,companies:[],version:i.Vy};return(0,o.RQ)(e.uid,n)}function d(e,t){return new Promise((async(n,o)=>{const l=await a(e),c=l?.companies.filter((e=>e==t)).length;if(!c&&null!=l){const n=l.companies.length>0?{companies:(0,r.vr)(t)}:{companies:[t]},a=(0,r.JU)(s.db,i.Hk,e);await(0,r.r7)(a,n).catch((e=>{o({message:"Failed updating user companies",error:e})}))}n(!0)}))}async function h(e){if(console.log("## IS VALID USER?",e.companies,e.uid,e),e?.companies?.length>0)return console.log("## VALID 1",e?.teams.length),!0;const t=await a(e.uid);return t?t&&t.companies&&0==t.companies.length?(console.log("## INVALID 3"),!1):(console.log("## VALID - USER",e),!0):(console.log("## INVALID 2"),null)}},8409:(e,t,n)=>{"use strict";n.d(t,{C:()=>u,c:()=>c});var i=n(7943),r=n(2485),s=n(7294),o=n(5915),a=n(1142),l=n(143);function c(e){const[t,n]=(0,s.useState)(!1);return(0,s.useEffect)((function(){if((0,r.s9)(e))n(!1);else{const t=(0,r.$W)(e);n(t==i.EO.online)}}),[e.presence,e.status,e.expiry]),t}function u(e){let t=()=>{};const[n,r]=(0,s.useState)(i.U0);return(0,o.Z)((()=>{a.o((0,l.hB)(e.uid),(e=>{e&&r(e)})),t=a.oL((0,l.hB)(e.uid),(e=>{e&&r(e)}))})),{presenceObj:n,stopListener:t}}},5915:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var i=n(7294);function r(e=(()=>{})){const t=(0,i.useRef)(!1);t.current||(e(),t.current=!0)}},5390:(e,t,n)=>{"use strict";n.d(t,{$s:()=>c,CV:()=>u,I8:()=>l,NG:()=>o,yY:()=>a});var i=n(7294),r=n(5915),s=n(1142);function o(e,t){const[n,o]=(0,i.useState)(!1);let a=()=>{};return(0,r.Z)((()=>{s.o(d(e,t),(e=>{e&&o(!0)})),a=s.oL(d(e,t),(e=>{e&&o(!0)}))})),{missedCall:n,stopMissedListener:a}}function a(e){const[t,n]=(0,i.useState)(0);let o=()=>{};function a(e){let t=0;try{Object.entries(e).forEach((([e,n])=>{n>0&&(t+=1)})),n(t)}catch(e){console.error(e)}}return(0,r.Z)((()=>{s.o(h(e),(e=>{e&&a(e)})),o=s.oL(h(e),(e=>{e&&a(e)}))})),{missedCounter:t,stopMissedCallsListener:o}}function l(e,t){const n=d(e,t);return s.ij(n)}function c(e,t){const n=d(e,t),i=Date.now();s.Wo(n,i)}function u(e,t){const n=d(e,t);s.Wo(n,null)}function d(e,t){return`missed_calls/${t}/${e}`}function h(e){return`missed_calls/${e}`}},4224:(e,t,n)=>{"use strict";n.d(t,{V:()=>a,u:()=>o});var i=n(3821),r=n(565),s=n(3953);async function o(e,t){const n=(0,s.JU)(r.db,i.np,e),o=await(0,s.QT)(n);let a={};if(o.exists()){let e=o.data();a={...e},a[t]&&a[t].numberOfCalls?a[t]={lastCalled:(new Date).getTime(),numberOfCalls:e[t].numberOfCalls+1}:a[t]={lastCalled:(new Date).getTime(),numberOfCalls:1}}else a={[t]:{lastCalled:(new Date).getTime(),numberOfCalls:1}};const l=`${e}`;(0,s.pl)((0,s.JU)(r.db,i.np,l),a)}async function a(e){try{const t=(0,s.JU)(r.db,i.np,e),n=await(0,s.QT)(t);if(n.exists()){const e=n.data(),t=Object.entries(e).map((([e,t])=>e)).sort(((t,n)=>e[t].lastCalled>e[n].lastCalled?1:e[t].lastCalled<e[n].lastCalled?-1:0));let i=Object.entries(e).map((([e,t])=>e)).sort(((t,n)=>e[t].numberOfCalls<e[n].numberOfCalls?1:e[t].numberOfCalls>e[n].numberOfCalls?-1:0));return i=[...i.slice(0,3)],{interactions:t,numbersOfCalls:i}}return{interactions:[],numbersOfCalls:[]}}catch(e){return console.log(e),{interactions:[],numbersOfCalls:[]}}}},9462:(e,t,n)=>{"use strict";var i;n.d(t,{C:()=>i}),function(e){e.invite="invite",e.accept="accept",e.reject="reject",e.left="left",e.joined="joined"}(i||(i={}))},6806:(e,t,n)=>{"use strict";var i,r;n.d(t,{n:()=>r,q:()=>i}),function(e){e.invited="invited",e.accepted="accepted",e.rejected="rejected",e.left="left",e.rejoined="rejoined"}(i||(i={})),function(e){e.live="live",e.ended="ended"}(r||(r={}))},2238:function(e,t,n){var i;!function(r,s){"use strict";var o="function",a="undefined",l="object",c="string",u="major",d="model",h="name",p="type",f="vendor",m="version",g="architecture",v="console",y="mobile",b="tablet",_="smarttv",w="wearable",S="embedded",T="Amazon",E="Apple",k="ASUS",C="BlackBerry",I="Browser",R="Chrome",P="Firefox",A="Google",N="Huawei",x="LG",D="Microsoft",O="Motorola",L="Opera",M="Samsung",j="Sharp",U="Sony",F="Xiaomi",V="Zebra",B="Facebook",z="Chromium OS",$="Mac OS",q=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},G=function(e,t){return typeof e===c&&-1!==W(t).indexOf(W(e))},W=function(e){return e.toLowerCase()},H=function(e,t){if(typeof e===c)return e=e.replace(/^\s\s*/,""),typeof t===a?e:e.substring(0,350)},K=function(e,t){for(var n,i,r,a,c,u,d=0;d<t.length&&!c;){var h=t[d],p=t[d+1];for(n=i=0;n<h.length&&!c&&h[n];)if(c=h[n++].exec(e))for(r=0;r<p.length;r++)u=c[++i],typeof(a=p[r])===l&&a.length>0?2===a.length?typeof a[1]==o?this[a[0]]=a[1].call(this,u):this[a[0]]=a[1]:3===a.length?typeof a[1]!==o||a[1].exec&&a[1].test?this[a[0]]=u?u.replace(a[1],a[2]):s:this[a[0]]=u?a[1].call(this,u,a[2]):s:4===a.length&&(this[a[0]]=u?a[3].call(this,u.replace(a[1],a[2])):s):this[a]=u||s;d+=2}},J=function(e,t){for(var n in t)if(typeof t[n]===l&&t[n].length>0){for(var i=0;i<t[n].length;i++)if(G(t[n][i],e))return"?"===n?s:n}else if(G(t[n],e))return"?"===n?s:n;return e},Q={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Y={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[m,[h,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[m,[h,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[h,m],[/opios[\/ ]+([\w\.]+)/i],[m,[h,L+" Mini"]],[/\bopr\/([\w\.]+)/i],[m,[h,L]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[h,m],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[m,[h,"UC"+I]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[m,[h,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[m,[h,"WeChat"]],[/konqueror\/([\w\.]+)/i],[m,[h,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[m,[h,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[m,[h,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[h,/(.+)/,"$1 Secure "+I],m],[/\bfocus\/([\w\.]+)/i],[m,[h,P+" Focus"]],[/\bopt\/([\w\.]+)/i],[m,[h,L+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[m,[h,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[m,[h,"Dolphin"]],[/coast\/([\w\.]+)/i],[m,[h,L+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[m,[h,"MIUI "+I]],[/fxios\/([-\w\.]+)/i],[m,[h,P]],[/\bqihu|(qi?ho?o?|360)browser/i],[[h,"360 "+I]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[h,/(.+)/,"$1 "+I],m],[/(comodo_dragon)\/([\w\.]+)/i],[[h,/_/g," "],m],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[h,m],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[h],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[h,B],m],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[h,m],[/\bgsa\/([\w\.]+) .*safari\//i],[m,[h,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[m,[h,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[m,[h,R+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[h,R+" WebView"],m],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[m,[h,"Android "+I]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[h,m],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[m,[h,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[m,h],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[h,[m,J,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[h,m],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[h,"Netscape"],m],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[m,[h,P+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[h,m],[/(cobalt)\/([\w\.]+)/i],[h,[m,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[g,"amd64"]],[/(ia32(?=;))/i],[[g,W]],[/((?:i[346]|x)86)[;\)]/i],[[g,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[g,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[g,"armhf"]],[/windows (ce|mobile); ppc;/i],[[g,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[g,/ower/,"",W]],[/(sun4\w)[;\)]/i],[[g,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[g,W]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[d,[f,M],[p,b]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[d,[f,M],[p,y]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[d,[f,E],[p,y]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[d,[f,E],[p,b]],[/(macintosh);/i],[d,[f,E]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[d,[f,j],[p,y]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[d,[f,N],[p,b]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[d,[f,N],[p,y]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[d,/_/g," "],[f,F],[p,y]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[d,/_/g," "],[f,F],[p,b]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[d,[f,"OPPO"],[p,y]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[d,[f,"Vivo"],[p,y]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[d,[f,"Realme"],[p,y]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[d,[f,O],[p,y]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[d,[f,O],[p,b]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[d,[f,x],[p,b]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[d,[f,x],[p,y]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[d,[f,"Lenovo"],[p,b]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[d,/_/g," "],[f,"Nokia"],[p,y]],[/(pixel c)\b/i],[d,[f,A],[p,b]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[d,[f,A],[p,y]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[d,[f,U],[p,y]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[d,"Xperia Tablet"],[f,U],[p,b]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[d,[f,"OnePlus"],[p,y]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[d,[f,T],[p,b]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[d,/(.+)/g,"Fire Phone $1"],[f,T],[p,y]],[/(playbook);[-\w\),; ]+(rim)/i],[d,f,[p,b]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[d,[f,C],[p,y]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[d,[f,k],[p,b]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[d,[f,k],[p,y]],[/(nexus 9)/i],[d,[f,"HTC"],[p,b]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[f,[d,/_/g," "],[p,y]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[d,[f,"Acer"],[p,b]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[d,[f,"Meizu"],[p,y]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[f,d,[p,y]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[f,d,[p,b]],[/(surface duo)/i],[d,[f,D],[p,b]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[d,[f,"Fairphone"],[p,y]],[/(u304aa)/i],[d,[f,"AT&T"],[p,y]],[/\bsie-(\w*)/i],[d,[f,"Siemens"],[p,y]],[/\b(rct\w+) b/i],[d,[f,"RCA"],[p,b]],[/\b(venue[\d ]{2,7}) b/i],[d,[f,"Dell"],[p,b]],[/\b(q(?:mv|ta)\w+) b/i],[d,[f,"Verizon"],[p,b]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[d,[f,"Barnes & Noble"],[p,b]],[/\b(tm\d{3}\w+) b/i],[d,[f,"NuVision"],[p,b]],[/\b(k88) b/i],[d,[f,"ZTE"],[p,b]],[/\b(nx\d{3}j) b/i],[d,[f,"ZTE"],[p,y]],[/\b(gen\d{3}) b.+49h/i],[d,[f,"Swiss"],[p,y]],[/\b(zur\d{3}) b/i],[d,[f,"Swiss"],[p,b]],[/\b((zeki)?tb.*\b) b/i],[d,[f,"Zeki"],[p,b]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[f,"Dragon Touch"],d,[p,b]],[/\b(ns-?\w{0,9}) b/i],[d,[f,"Insignia"],[p,b]],[/\b((nxa|next)-?\w{0,9}) b/i],[d,[f,"NextBook"],[p,b]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[f,"Voice"],d,[p,y]],[/\b(lvtel\-)?(v1[12]) b/i],[[f,"LvTel"],d,[p,y]],[/\b(ph-1) /i],[d,[f,"Essential"],[p,y]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[d,[f,"Envizen"],[p,b]],[/\b(trio[-\w\. ]+) b/i],[d,[f,"MachSpeed"],[p,b]],[/\btu_(1491) b/i],[d,[f,"Rotor"],[p,b]],[/(shield[\w ]+) b/i],[d,[f,"Nvidia"],[p,b]],[/(sprint) (\w+)/i],[f,d,[p,y]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[f,D],[p,y]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[d,[f,V],[p,b]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[d,[f,V],[p,y]],[/smart-tv.+(samsung)/i],[f,[p,_]],[/hbbtv.+maple;(\d+)/i],[[d,/^/,"SmartTV"],[f,M],[p,_]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[f,x],[p,_]],[/(apple) ?tv/i],[f,[d,E+" TV"],[p,_]],[/crkey/i],[[d,R+"cast"],[f,A],[p,_]],[/droid.+aft(\w)( bui|\))/i],[d,[f,T],[p,_]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[d,[f,j],[p,_]],[/(bravia[\w ]+)( bui|\))/i],[d,[f,U],[p,_]],[/(mitv-\w{5}) bui/i],[d,[f,F],[p,_]],[/Hbbtv.*(technisat) (.*);/i],[f,d,[p,_]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[f,H],[d,H],[p,_]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[p,_]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[f,d,[p,v]],[/droid.+; (shield) bui/i],[d,[f,"Nvidia"],[p,v]],[/(playstation [345portablevi]+)/i],[d,[f,U],[p,v]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[d,[f,D],[p,v]],[/((pebble))app/i],[f,d,[p,w]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[d,[f,E],[p,w]],[/droid.+; (glass) \d/i],[d,[f,A],[p,w]],[/droid.+; (wt63?0{2,3})\)/i],[d,[f,V],[p,w]],[/(quest( 2| pro)?)/i],[d,[f,B],[p,w]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[f,[p,S]],[/(aeobc)\b/i],[d,[f,T],[p,S]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[d,[p,y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[d,[p,b]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[p,b]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[p,y]],[/(android[-\w\. ]{0,9});.+buil/i],[d,[f,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[m,[h,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[m,[h,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[h,m],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[m,h]],os:[[/microsoft (windows) (vista|xp)/i],[h,m],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[h,[m,J,Q]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[h,"Windows"],[m,J,Q]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/ios;fbsv\/([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[m,/_/g,"."],[h,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[h,$],[m,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[m,h],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[h,m],[/\(bb(10);/i],[m,[h,C]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[m,[h,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[m,[h,P+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[m,[h,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[m,[h,"watchOS"]],[/crkey\/([\d\.]+)/i],[m,[h,R+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[h,z],m],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[h,m],[/(sunos) ?([\w\.\d]*)/i],[[h,"Solaris"],m],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[h,m]]},Z=function(e,t){if(typeof e===l&&(t=e,e=s),!(this instanceof Z))return new Z(e,t).getResult();var n=typeof r!==a&&r.navigator?r.navigator:s,i=e||(n&&n.userAgent?n.userAgent:""),v=n&&n.userAgentData?n.userAgentData:s,_=t?function(e,t){var n={};for(var i in e)t[i]&&t[i].length%2==0?n[i]=t[i].concat(e[i]):n[i]=e[i];return n}(Y,t):Y,w=n&&n.userAgent==i;return this.getBrowser=function(){var e,t={};return t[h]=s,t[m]=s,K.call(t,i,_.browser),t[u]=typeof(e=t[m])===c?e.replace(/[^\d\.]/g,"").split(".")[0]:s,w&&n&&n.brave&&typeof n.brave.isBrave==o&&(t[h]="Brave"),t},this.getCPU=function(){var e={};return e[g]=s,K.call(e,i,_.cpu),e},this.getDevice=function(){var e={};return e[f]=s,e[d]=s,e[p]=s,K.call(e,i,_.device),w&&!e[p]&&v&&v.mobile&&(e[p]=y),w&&"Macintosh"==e[d]&&n&&typeof n.standalone!==a&&n.maxTouchPoints&&n.maxTouchPoints>2&&(e[d]="iPad",e[p]=b),e},this.getEngine=function(){var e={};return e[h]=s,e[m]=s,K.call(e,i,_.engine),e},this.getOS=function(){var e={};return e[h]=s,e[m]=s,K.call(e,i,_.os),w&&!e[h]&&v&&"Unknown"!=v.platform&&(e[h]=v.platform.replace(/chrome os/i,z).replace(/macos/i,$)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(e){return i=typeof e===c&&e.length>350?H(e,350):e,this},this.setUA(i),this};Z.VERSION="1.0.35",Z.BROWSER=q([h,m,u]),Z.CPU=q([g]),Z.DEVICE=q([d,f,p,v,y,_,b,w,S]),Z.ENGINE=Z.OS=q([h,m]),typeof t!==a?(e.exports&&(t=e.exports=Z),t.UAParser=Z):n.amdO?(i=function(){return Z}.call(t,n,t,e))===s||(e.exports=i):typeof r!==a&&(r.UAParser=Z);var X=typeof r!==a&&(r.jQuery||r.Zepto);if(X&&!X.ua){var ee=new Z;X.ua=ee.getResult(),X.ua.get=function(){return ee.getUA()},X.ua.set=function(e){ee.setUA(e);var t=ee.getResult();for(var n in t)X.ua[n]=t[n]}}}("object"==typeof window?window:this)},3250:(e,t,n)=>{"use strict";var i=n(7294);var r="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},s=i.useState,o=i.useEffect,a=i.useLayoutEffect,l=i.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!r(e,n)}catch(e){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),i=s({inst:{value:n,getSnapshot:t}}),r=i[0].inst,u=i[1];return a((function(){r.value=n,r.getSnapshot=t,c(r)&&u({inst:r})}),[e,n,t]),o((function(){return c(r)&&u({inst:r}),e((function(){c(r)&&u({inst:r})}))}),[e]),l(n),n};t.useSyncExternalStore=void 0!==i.useSyncExternalStore?i.useSyncExternalStore:u},139:(e,t,n)=>{"use strict";var i=n(7294),r=n(1688);var s="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},o=r.useSyncExternalStore,a=i.useRef,l=i.useEffect,c=i.useMemo,u=i.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,n,i,r){var d=a(null);if(null===d.current){var h={hasValue:!1,value:null};d.current=h}else h=d.current;d=c((function(){function e(e){if(!l){if(l=!0,o=e,e=i(e),void 0!==r&&h.hasValue){var t=h.value;if(r(t,e))return a=t}return a=e}if(t=a,s(o,e))return t;var n=i(e);return void 0!==r&&r(t,n)?t:(o=e,a=n)}var o,a,l=!1,c=void 0===n?null:n;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]}),[t,n,i,r]);var p=o(e,d[0],d[1]);return l((function(){h.hasValue=!0,h.value=p}),[p]),u(p),p}},1688:(e,t,n)=>{"use strict";e.exports=n(3250)},2798:(e,t,n)=>{"use strict";e.exports=n(139)},8493:(e,t,n)=>{"use strict";e.exports=n.p+"803f24369a085e35482e.gif"},1657:(e,t,n)=>{"use strict";n.d(t,{Jn:()=>j,qX:()=>D,Xd:()=>x,Mq:()=>F,ZF:()=>U,KN:()=>V});var i=n(8463),r=n(3333),s=n(4444);const o=(e,t)=>t.some((t=>e instanceof t));let a,l;const c=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,p=new WeakMap;let f={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return u.get(e);if("objectStoreNames"===t)return e.objectStoreNames||d.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return v(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function m(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(l||(l=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(y(this),t),v(c.get(this))}:function(...t){return v(e.apply(y(this),t))}:function(t,...n){const i=e.call(y(this),t,...n);return d.set(i,t.sort?t.sort():[t]),v(i)}}function g(e){return"function"==typeof e?m(e):(e instanceof IDBTransaction&&function(e){if(u.has(e))return;const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)}));u.set(e,t)}(e),o(e,a||(a=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,f):e)}function v(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(v(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&c.set(t,e)})).catch((()=>{})),p.set(t,e),t}(e);if(h.has(e))return h.get(e);const t=g(e);return t!==e&&(h.set(e,t),p.set(t,e)),t}const y=e=>p.get(e);const b=["get","getKey","getAll","getAllKeys","count"],_=["put","add","delete","clear"],w=new Map;function S(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(w.get(t))return w.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,r=_.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!b.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,r?"readwrite":"readonly");let o=s.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),r&&s.done]))[0]};return w.set(t,s),s}f=(e=>({...e,get:(t,n,i)=>S(t,n)||e.get(t,n,i),has:(t,n)=>!!S(t,n)||e.has(t,n)}))(f);class T{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const E="@firebase/app",k="0.9.12",C=new r.Yd("@firebase/app"),I="[DEFAULT]",R={[E]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},P=new Map,A=new Map;function N(e,t){try{e.container.addComponent(t)}catch(n){C.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function x(e){const t=e.name;if(A.has(t))return C.debug(`There were multiple attempts to register component ${t}.`),!1;A.set(t,e);for(const t of P.values())N(t,e);return!0}function D(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const O={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},L=new s.LL("app","Firebase",O);class M{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new i.wA("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw L.create("app-deleted",{appName:this._name})}}const j="9.22.2";function U(e,t={}){let n=e;if("object"!=typeof t){t={name:t}}const r=Object.assign({name:I,automaticDataCollectionEnabled:!1},t),o=r.name;if("string"!=typeof o||!o)throw L.create("bad-app-name",{appName:String(o)});if(n||(n=(0,s.aH)()),!n)throw L.create("no-options");const a=P.get(o);if(a){if((0,s.vZ)(n,a.options)&&(0,s.vZ)(r,a.config))return a;throw L.create("duplicate-app",{appName:o})}const l=new i.H0(o);for(const e of A.values())l.addComponent(e);const c=new M(n,r,l);return P.set(o,c),c}function F(e=I){const t=P.get(e);if(!t&&e===I&&(0,s.aH)())return U();if(!t)throw L.create("no-app",{appName:e});return t}function V(e,t,n){var r;let s=null!==(r=R[e])&&void 0!==r?r:e;n&&(s+=`-${n}`);const o=s.match(/\s|\//),a=t.match(/\s|\//);if(o||a){const e=[`Unable to register library "${s}" with version "${t}":`];return o&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),o&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void C.warn(e.join(" "))}x(new i.wA(`${s}-version`,(()=>({library:s,version:t})),"VERSION"))}const B="firebase-heartbeat-database",z=1,$="firebase-heartbeat-store";let q=null;function G(){return q||(q=function(e,t,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){const o=indexedDB.open(e,t),a=v(o);return i&&o.addEventListener("upgradeneeded",(e=>{i(v(o.result),e.oldVersion,e.newVersion,v(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{s&&e.addEventListener("close",(()=>s())),r&&e.addEventListener("versionchange",(e=>r(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}(B,z,{upgrade:(e,t)=>{if(0===t)e.createObjectStore($)}}).catch((e=>{throw L.create("idb-open",{originalErrorMessage:e.message})}))),q}async function W(e,t){try{const n=(await G()).transaction($,"readwrite"),i=n.objectStore($);await i.put(t,H(e)),await n.done}catch(e){if(e instanceof s.ZR)C.warn(e.message);else{const t=L.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});C.warn(t.message)}}}function H(e){return`${e.name}!${e.options.appId}`}class K{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Q(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=J();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=J(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let i=e.slice();for(const r of e){const e=n.find((e=>e.agent===r.agent));if(e){if(e.dates.push(r.date),Y(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),Y(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=(0,s.L)(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function J(){return(new Date).toISOString().substring(0,10)}class Q{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,s.hl)()&&(0,s.eu)().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){return await async function(e){try{const t=await G();return await t.transaction($).objectStore($).get(H(e))}catch(e){if(e instanceof s.ZR)C.warn(e.message);else{const t=L.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});C.warn(t.message)}}}(this.app)||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return W(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return W(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Y(e){return(0,s.L)(JSON.stringify({version:2,heartbeats:e})).length}var Z;Z="",x(new i.wA("platform-logger",(e=>new T(e)),"PRIVATE")),x(new i.wA("heartbeat",(e=>new K(e)),"PRIVATE")),V(E,k,Z),V(E,k,"esm2017"),V("fire-js","")},8463:(e,t,n)=>{"use strict";n.d(t,{H0:()=>a,wA:()=>r});var i=n(4444);class r{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const s="[DEFAULT]";class o{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new i.BH;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),i=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(i)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:s})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=s){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=s){return this.instances.has(e)}getOptions(e=s){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(e)&&t.resolve(i)}return i}onInit(e,t){var n;const i=this.normalizeInstanceIdentifier(t),r=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;r.add(e),this.onInitCallbacks.set(i,r);const s=this.instances.get(i);return s&&e(s,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=e,i===s?void 0:i),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var i;return n||null}normalizeInstanceIdentifier(e=s){return this.component?this.component.multipleInstances?e:s:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new o(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},3333:(e,t,n)=>{"use strict";n.d(t,{Yd:()=>c,in:()=>r});const i=[];var r;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(r||(r={}));const s={debug:r.DEBUG,verbose:r.VERBOSE,info:r.INFO,warn:r.WARN,error:r.ERROR,silent:r.SILENT},o=r.INFO,a={[r.DEBUG]:"log",[r.VERBOSE]:"log",[r.INFO]:"info",[r.WARN]:"warn",[r.ERROR]:"error"},l=(e,t,...n)=>{if(t<e.logLevel)return;const i=(new Date).toISOString(),r=a[t];if(!r)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[r](`[${i}]  ${e.name}:`,...n)};class c{constructor(e){this.name=e,this._logLevel=o,this._logHandler=l,this._userLogHandler=null,i.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in r))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?s[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,r.DEBUG,...e),this._logHandler(this,r.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,r.VERBOSE,...e),this._logHandler(this,r.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,r.INFO,...e),this._logHandler(this,r.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,r.WARN,...e),this._logHandler(this,r.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,r.ERROR,...e),this._logHandler(this,r.ERROR,...e)}}},9155:(e,t,n)=>{"use strict";n.d(t,{hJ:()=>Ue,Xb:()=>Ze,v0:()=>wn,LS:()=>Ye,e5:()=>Xe,F6:()=>Vt,w7:()=>et});var i=n(4444),r=n(1657);function s(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}Object.create;Object.create;var o=n(3333),a=n(8463);function l(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const c=l,u=new i.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),d=new o.Yd("@firebase/auth");function h(e,...t){d.logLevel<=o.in.ERROR&&d.error(`Auth (${r.Jn}): ${e}`,...t)}function p(e,...t){throw v(e,...t)}function f(e,...t){return v(e,...t)}function m(e,t,n){const r=Object.assign(Object.assign({},c()),{[t]:n});return new i.LL("auth","Firebase",r).create(t,{appName:e.name})}function g(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&p(e,"argument-error"),m(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function v(e,...t){if("string"!=typeof e){const n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return u.create(e,...t)}function y(e,t,...n){if(!e)throw v(t,...n)}function b(e){const t="INTERNAL ASSERTION FAILED: "+e;throw h(t),new Error(t)}function _(e,t){e||b(t)}function w(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function S(){return"http:"===T()||"https:"===T()}function T(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class E{constructor(e,t){this.shortDelay=e,this.longDelay=t,_(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,i.uI)()||(0,i.b$)()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(S()||(0,i.ru)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function k(e,t){_(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class C{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void b("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void b("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void b("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const I={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},R=new E(3e4,6e4);function P(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function A(e,t,n,r,s={}){return N(e,s,(async()=>{let s={},o={};r&&("GET"===t?o=r:s={body:JSON.stringify(r)});const a=(0,i.xO)(Object.assign({key:e.config.apiKey},o)).slice(1),l=await e._getAdditionalHeaders();return l["Content-Type"]="application/json",e.languageCode&&(l["X-Firebase-Locale"]=e.languageCode),C.fetch()(D(e,e.config.apiHost,n,a),Object.assign({method:t,headers:l,referrerPolicy:"no-referrer"},s))}))}async function N(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},I),t);try{const t=new O(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw L(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw L(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw L(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw L(e,"user-disabled",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw m(e,a,o);p(e,a)}}catch(t){if(t instanceof i.ZR)throw t;p(e,"network-request-failed",{message:String(t)})}}async function x(e,t,n,i,r={}){const s=await A(e,t,n,i,r);return"mfaPendingCredential"in s&&p(e,"multi-factor-auth-required",{_serverResponse:s}),s}function D(e,t,n,i){const r=`${t}${n}?${i}`;return e.config.emulator?k(e.config,r):`${e.config.apiScheme}://${r}`}class O{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(f(this.auth,"network-request-failed"))),R.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function L(e,t,n){const i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const r=f(e,t,i);return r.customData._tokenResponse=n,r}function M(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function j(e){return 1e3*Number(e)}function U(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return h("JWT malformed, contained fewer than 3 sections"),null;try{const e=(0,i.tV)(n);return e?JSON.parse(e):(h("Failed to decode base64 JWT payload"),null)}catch(e){return h("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function F(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof i.ZR&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class V{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class B{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=M(this.lastLoginAt),this.creationTime=M(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function z(e){var t;const n=e.auth,i=await e.getIdToken(),r=await F(e,async function(e,t){return A(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:i}));y(null==r?void 0:r.users.length,n,"internal-error");const o=r.users[0];e._notifyReloadListener(o);const a=(null===(t=o.providerUserInfo)||void 0===t?void 0:t.length)?o.providerUserInfo.map((e=>{var{providerId:t}=e,n=s(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[];const l=(c=e.providerData,u=a,[...c.filter((e=>!u.some((t=>t.providerId===e.providerId)))),...u]);var c,u;const d=e.isAnonymous,h=!(e.email&&o.passwordHash||(null==l?void 0:l.length)),p=!!d&&h,f={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:l,metadata:new B(o.createdAt,o.lastLoginAt),isAnonymous:p};Object.assign(e,f)}class ${constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){y(e.idToken,"internal-error"),y(void 0!==e.idToken,"internal-error"),y(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=U(e);return y(t,"internal-error"),y(void 0!==t.exp,"internal-error"),y(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return y(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:s}=await async function(e,t){const n=await N(e,{},(async()=>{const n=(0,i.xO)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:s}=e.config,o=D(e,r,"/v1/token",`key=${s}`),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",C.fetch()(o,{method:"POST",headers:a,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:r}=t,s=new $;return n&&(y("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),i&&(y("string"==typeof i,"internal-error",{appName:e}),s.accessToken=i),r&&(y("number"==typeof r,"internal-error",{appName:e}),s.expirationTime=r),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new $,this.toJSON())}_performRefresh(){return b("not implemented")}}function q(e,t){y("string"==typeof e||void 0===e,"internal-error",{appName:t})}class G{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,r=s(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new V(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new B(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await F(this,this.stsTokenManager.getToken(this.auth,e));return y(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=(0,i.m9)(e),r=await n.getIdToken(t),s=U(r);y(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const o="object"==typeof s.firebase?s.firebase:void 0,a=null==o?void 0:o.sign_in_provider;return{claims:s,token:r,authTime:M(j(s.auth_time)),issuedAtTime:M(j(s.iat)),expirationTime:M(j(s.exp)),signInProvider:a||null,signInSecondFactor:(null==o?void 0:o.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=(0,i.m9)(e);await z(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(y(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new G(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){y(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await z(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await F(this,async function(e,t){return A(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,r,s,o,a,l,c;const u=null!==(n=t.displayName)&&void 0!==n?n:void 0,d=null!==(i=t.email)&&void 0!==i?i:void 0,h=null!==(r=t.phoneNumber)&&void 0!==r?r:void 0,p=null!==(s=t.photoURL)&&void 0!==s?s:void 0,f=null!==(o=t.tenantId)&&void 0!==o?o:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(l=t.createdAt)&&void 0!==l?l:void 0,v=null!==(c=t.lastLoginAt)&&void 0!==c?c:void 0,{uid:b,emailVerified:_,isAnonymous:w,providerData:S,stsTokenManager:T}=t;y(b&&T,e,"internal-error");const E=$.fromJSON(this.name,T);y("string"==typeof b,e,"internal-error"),q(u,e.name),q(d,e.name),y("boolean"==typeof _,e,"internal-error"),y("boolean"==typeof w,e,"internal-error"),q(h,e.name),q(p,e.name),q(f,e.name),q(m,e.name),q(g,e.name),q(v,e.name);const k=new G({uid:b,auth:e,email:d,emailVerified:_,displayName:u,isAnonymous:w,photoURL:p,phoneNumber:h,tenantId:f,stsTokenManager:E,createdAt:g,lastLoginAt:v});return S&&Array.isArray(S)&&(k.providerData=S.map((e=>Object.assign({},e)))),m&&(k._redirectEventId=m),k}static async _fromIdTokenResponse(e,t,n=!1){const i=new $;i.updateFromServerResponse(t);const r=new G({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await z(r),r}}const W=new Map;function H(e){_(e instanceof Function,"Expected a class definition");let t=W.get(e);return t?(_(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,W.set(e,t),t)}class K{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}K.type="NONE";const J=K;function Q(e,t,n){return`firebase:${e}:${t}:${n}`}class Y{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:r}=this.auth;this.fullUserKey=Q(this.userKey,i.apiKey,r),this.fullPersistenceKey=Q("persistence",i.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?G._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Y(H(J),e,n);const i=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let r=i[0]||H(J);const s=Q(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(s);if(t){const i=G._fromJSON(e,t);n!==r&&(o=i),r=n;break}}catch(e){}const a=i.filter((e=>e._shouldAllowMigration));return r._shouldAllowMigration&&a.length?(r=a[0],o&&await r._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==r)try{await e._remove(s)}catch(e){}}))),new Y(r,e,n)):new Y(r,e,n)}}function Z(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(ne(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(X(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(re(t))return"Blackberry";if(se(t))return"Webos";if(ee(t))return"Safari";if((t.includes("chrome/")||te(t))&&!t.includes("edge/"))return"Chrome";if(ie(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function X(e=(0,i.z$)()){return/firefox\//i.test(e)}function ee(e=(0,i.z$)()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function te(e=(0,i.z$)()){return/crios\//i.test(e)}function ne(e=(0,i.z$)()){return/iemobile/i.test(e)}function ie(e=(0,i.z$)()){return/android/i.test(e)}function re(e=(0,i.z$)()){return/blackberry/i.test(e)}function se(e=(0,i.z$)()){return/webos/i.test(e)}function oe(e=(0,i.z$)()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function ae(e=(0,i.z$)()){return oe(e)||ie(e)||se(e)||re(e)||/windows phone/i.test(e)||ne(e)}function le(e,t=[]){let n;switch(e){case"Browser":n=Z((0,i.z$)());break;case"Worker":n=`${Z((0,i.z$)())}-${e}`;break;default:n=e}const s=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${r.Jn}/${s}`}async function ce(e,t){return A(e,"GET","/v2/recaptchaConfig",P(e,t))}function ue(e){return void 0!==e&&void 0!==e.enterprise}class de{constructor(e){if(this.siteKey="",this.emailPasswordEnabled=!1,void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.emailPasswordEnabled=e.recaptchaEnforcementState.some((e=>"EMAIL_PASSWORD_PROVIDER"===e.provider&&"OFF"!==e.enforcementState))}}function he(e){return new Promise(((t,n)=>{const i=document.createElement("script");var r,s;i.setAttribute("src",e),i.onload=t,i.onerror=e=>{const t=f("internal-error");t.customData=e,n(t)},i.type="text/javascript",i.charset="UTF-8",(null!==(s=null===(r=document.getElementsByTagName("head"))||void 0===r?void 0:r[0])&&void 0!==s?s:document).appendChild(i)}))}function pe(e){return`__${e}${Math.floor(1e6*Math.random())}`}class fe{constructor(e){this.type="recaptcha-enterprise",this.auth=ye(e)}async verify(e="verify",t=!1){function n(t,n,i){const r=window.grecaptcha;ue(r)?r.enterprise.ready((()=>{r.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n("NO_RECAPTCHA")}))})):i(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((e,i)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{ce(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((i=>{if(void 0!==i.recaptchaKey){const n=new de(i);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((r=>{if(!t&&ue(window.grecaptcha))n(r,e,i);else{if("undefined"==typeof window)return void i(new Error("RecaptchaVerifier is only supported in browser"));he("https://www.google.com/recaptcha/enterprise.js?render="+r).then((()=>{n(r,e,i)})).catch((e=>{i(e)}))}})).catch((e=>{i(e)}))}))}}async function me(e,t,n,i=!1){const r=new fe(e);let s;try{s=await r.verify(n)}catch(e){s=await r.verify(n,!0)}const o=Object.assign({},t);return i?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}class ge{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,i)=>{try{n(e(t))}catch(e){i(e)}}));n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class ve{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new be(this),this.idTokenSubscription=new be(this),this.beforeStateQueue=new ge(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=u,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=H(t)),this._initializationPromise=this.queue((async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await Y.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let i=n,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==i?void 0:i._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||!(null==o?void 0:o.user)||(i=o.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(e){i=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return y(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await z(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?(0,i.m9)(e):null;return t&&y(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&y(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(H(e))}))}async initializeRecaptchaConfig(){const e=await ce(this,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),t=new de(e);if(null==this.tenantId?this._agentRecaptchaConfig=t:this._tenantRecaptchaConfigs[this.tenantId]=t,t.emailPasswordEnabled){new fe(this).verify()}}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new i.LL("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&H(e)||this._popupRedirectResolver;y(t,this,"argument-error"),this.redirectPersistenceManager=await Y.create(this,[H(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const r="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return y(s,this,"internal-error"),s.then((()=>r(this.currentUser))),"function"==typeof t?e.addObserver(t,n,i):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return y(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=le(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){d.logLevel<=o.in.WARN&&d.warn(`Auth (${r.Jn}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function ye(e){return(0,i.m9)(e)}class be{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,i.ne)((e=>this.observer=e))}get next(){return y(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function _e(e,t,n){const i=ye(e);y(i._canInitEmulator,i,"emulator-config-failed"),y(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");const r=!!(null==n?void 0:n.disableWarnings),s=we(t),{host:o,port:a}=function(e){const t=we(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const i=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){const e=r[1];return{host:e,port:Se(i.substr(e.length+1))}}{const[e,t]=i.split(":");return{host:e,port:Se(t)}}}(t),l=null===a?"":`:${a}`;i.config.emulator={url:`${s}//${o}${l}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})}),r||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function we(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Se(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Te{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return b("not implemented")}_getIdTokenResponse(e){return b("not implemented")}_linkToIdToken(e,t){return b("not implemented")}_getReauthenticationResolver(e){return b("not implemented")}}async function Ee(e,t){return A(e,"POST","/v1/accounts:update",t)}async function ke(e,t){return x(e,"POST","/v1/accounts:signInWithPassword",P(e,t))}async function Ce(e,t){return A(e,"POST","/v1/accounts:sendOobCode",P(e,t))}async function Ie(e,t){return Ce(e,t)}class Re extends Te{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new Re(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Re(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){var t;switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};if(null===(t=e._getRecaptchaConfig())||void 0===t?void 0:t.emailPasswordEnabled){const t=await me(e,n,"signInWithPassword");return ke(e,t)}return ke(e,n).catch((async t=>{if("auth/missing-recaptcha-token"===t.code){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const t=await me(e,n,"signInWithPassword");return ke(e,t)}return Promise.reject(t)}));case"emailLink":return async function(e,t){return x(e,"POST","/v1/accounts:signInWithEmailLink",P(e,t))}(e,{email:this._email,oobCode:this._password});default:p(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Ee(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return x(e,"POST","/v1/accounts:signInWithEmailLink",P(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:p(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Pe(e,t){return x(e,"POST","/v1/accounts:signInWithIdp",P(e,t))}class Ae extends Te{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Ae(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):p("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,r=s(t,["providerId","signInMethod"]);if(!n||!i)return null;const o=new Ae(n,i);return o.idToken=r.idToken||void 0,o.accessToken=r.accessToken||void 0,o.secret=r.secret,o.nonce=r.nonce,o.pendingToken=r.pendingToken||null,o}_getIdTokenResponse(e){return Pe(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Pe(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Pe(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,i.xO)(t)}return e}}const Ne={USER_NOT_FOUND:"user-not-found"};class xe extends Te{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new xe({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new xe({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return x(e,"POST","/v1/accounts:signInWithPhoneNumber",P(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await x(e,"POST","/v1/accounts:signInWithPhoneNumber",P(e,t));if(n.temporaryProof)throw L(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return x(e,"POST","/v1/accounts:signInWithPhoneNumber",P(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Ne)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}=e;return n||t||i||r?new xe({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}):null}}class De{constructor(e){var t,n,r,s,o,a;const l=(0,i.zd)((0,i.pd)(e)),c=null!==(t=l.apiKey)&&void 0!==t?t:null,u=null!==(n=l.oobCode)&&void 0!==n?n:null,d=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=l.mode)&&void 0!==r?r:null);y(c&&u&&d,"argument-error"),this.apiKey=c,this.operation=d,this.code=u,this.continueUrl=null!==(s=l.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(o=l.languageCode)&&void 0!==o?o:null,this.tenantId=null!==(a=l.tenantId)&&void 0!==a?a:null}static parseLink(e){const t=function(e){const t=(0,i.zd)((0,i.pd)(e)).link,n=t?(0,i.zd)((0,i.pd)(t)).deep_link_id:null,r=(0,i.zd)((0,i.pd)(e)).deep_link_id;return(r?(0,i.zd)((0,i.pd)(r)).link:null)||r||n||t||e}(e);try{return new De(t)}catch(e){return null}}}class Oe{constructor(){this.providerId=Oe.PROVIDER_ID}static credential(e,t){return Re._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=De.parseLink(t);return y(n,"argument-error"),Re._fromEmailAndCode(e,n.code,n.tenantId)}}Oe.PROVIDER_ID="password",Oe.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Oe.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Le{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Me extends Le{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class je extends Me{constructor(){super("facebook.com")}static credential(e){return Ae._fromParams({providerId:je.PROVIDER_ID,signInMethod:je.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return je.credentialFromTaggedObject(e)}static credentialFromError(e){return je.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return je.credential(e.oauthAccessToken)}catch(e){return null}}}je.FACEBOOK_SIGN_IN_METHOD="facebook.com",je.PROVIDER_ID="facebook.com";class Ue extends Me{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Ae._fromParams({providerId:Ue.PROVIDER_ID,signInMethod:Ue.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ue.credentialFromTaggedObject(e)}static credentialFromError(e){return Ue.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Ue.credential(t,n)}catch(e){return null}}}Ue.GOOGLE_SIGN_IN_METHOD="google.com",Ue.PROVIDER_ID="google.com";class Fe extends Me{constructor(){super("github.com")}static credential(e){return Ae._fromParams({providerId:Fe.PROVIDER_ID,signInMethod:Fe.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Fe.credentialFromTaggedObject(e)}static credentialFromError(e){return Fe.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Fe.credential(e.oauthAccessToken)}catch(e){return null}}}Fe.GITHUB_SIGN_IN_METHOD="github.com",Fe.PROVIDER_ID="github.com";class Ve extends Me{constructor(){super("twitter.com")}static credential(e,t){return Ae._fromParams({providerId:Ve.PROVIDER_ID,signInMethod:Ve.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ve.credentialFromTaggedObject(e)}static credentialFromError(e){return Ve.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Ve.credential(t,n)}catch(e){return null}}}async function Be(e,t){return x(e,"POST","/v1/accounts:signUp",P(e,t))}Ve.TWITTER_SIGN_IN_METHOD="twitter.com",Ve.PROVIDER_ID="twitter.com";class ze{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){const r=await G._fromIdTokenResponse(e,n,i),s=$e(n);return new ze({user:r,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const i=$e(n);return new ze({user:e,providerId:i,_tokenResponse:n,operationType:t})}}function $e(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class qe extends i.ZR{constructor(e,t,n,i){var r;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,qe.prototype),this.customData={appName:e.name,tenantId:null!==(r=e.tenantId)&&void 0!==r?r:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new qe(e,t,n,i)}}function Ge(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw qe._fromErrorAndOperation(e,n,t,i);throw n}))}async function We(e,t,n=!1){const i=await F(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return ze._forOperation(e,"link",i)}async function He(e,t,n=!1){const{auth:i}=e,r="reauthenticate";try{const s=await F(e,Ge(i,r,t,e),n);y(s.idToken,i,"internal-error");const o=U(s.idToken);y(o,i,"internal-error");const{sub:a}=o;return y(e.uid===a,i,"user-mismatch"),ze._forOperation(e,r,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&p(i,"user-mismatch"),e}}async function Ke(e,t,n=!1){const i="signIn",r=await Ge(e,i,t),s=await ze._fromIdTokenResponse(e,i,r);return n||await e._updateCurrentUser(s.user),s}async function Je(e,t){return Ke(ye(e),t)}function Qe(e,t,n){var i;y((null===(i=n.url)||void 0===i?void 0:i.length)>0,e,"invalid-continue-uri"),y(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(y(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(y(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function Ye(e,t,n){var i;const r=ye(e),s={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};if(null===(i=r._getRecaptchaConfig())||void 0===i?void 0:i.emailPasswordEnabled){const e=await me(r,s,"getOobCode",!0);n&&Qe(r,e,n),await Ie(r,e)}else n&&Qe(r,s,n),await Ie(r,s).catch((async e=>{if("auth/missing-recaptcha-token"!==e.code)return Promise.reject(e);{console.log("Password resets are protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the password reset flow.");const e=await me(r,s,"getOobCode",!0);n&&Qe(r,e,n),await Ie(r,e)}}))}async function Ze(e,t,n){var i;const r=ye(e),s={returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"};let o;if(null===(i=r._getRecaptchaConfig())||void 0===i?void 0:i.emailPasswordEnabled){const e=await me(r,s,"signUpPassword");o=Be(r,e)}else o=Be(r,s).catch((async e=>{if("auth/missing-recaptcha-token"===e.code){console.log("Sign-up is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-up flow.");const e=await me(r,s,"signUpPassword");return Be(r,e)}return Promise.reject(e)}));const a=await o.catch((e=>Promise.reject(e))),l=await ze._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(l.user),l}function Xe(e,t,n){return Je((0,i.m9)(e),Oe.credential(t,n))}function et(e){return(0,i.m9)(e).signOut()}new WeakMap;const tt="__sak";class nt{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(tt,"1"),this.storage.removeItem(tt),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class it extends nt{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=(0,i.z$)();return ee(e)||oe(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=ae(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(n);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);(0,i.w1)()&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}it.type="LOCAL";const rt=it;class st extends nt{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}st.type="SESSION";const ot=st;class at{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new at(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:i,data:r}=t.data,s=this.handlersMap[i];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const o=Array.from(s).map((async e=>e(t.origin,r))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function lt(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}at.receivers=[];class ct{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const i="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let r,s;return new Promise(((o,a)=>{const l=lt("",20);i.port1.start();const c=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:i,onMessage(e){const t=e;if(t.data.eventId===l)switch(t.data.status){case"ack":clearTimeout(c),r=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(r),o(t.data.response);break;default:clearTimeout(c),clearTimeout(r),a(new Error("invalid_response"))}}},this.handlers.add(s),i.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[i.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function ut(){return window}function dt(){return void 0!==ut().WorkerGlobalScope&&"function"==typeof ut().importScripts}const ht="firebaseLocalStorageDb",pt="firebaseLocalStorage",ft="fbase_key";class mt{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function gt(e,t){return e.transaction([pt],t?"readwrite":"readonly").objectStore(pt)}function vt(){const e=indexedDB.open(ht,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(pt,{keyPath:ft})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(pt)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(ht);return new mt(e).toPromise()}(),t(await vt()))}))}))}async function yt(e,t,n){const i=gt(e,!0).put({[ft]:t,value:n});return new mt(i).toPromise()}function bt(e,t){const n=gt(e,!0).delete(t);return new mt(n).toPromise()}class _t{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await vt()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return dt()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=at._getInstance(dt()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new ct(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await vt();return await yt(e,tt,"1"),await bt(e,tt),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>yt(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=gt(e,!1).get(t),i=await new mt(n).toPromise();return void 0===i?null:i.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>bt(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=gt(e,!1).getAll();return new mt(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:i,value:r}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),t.push(i));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}_t.type="LOCAL";const wt=_t;pe("rcb"),new E(3e4,6e4);const St="recaptcha";async function Tt(e,t,n){var i;const r=await n.verify();try{let s;if(y("string"==typeof r,e,"argument-error"),y(n.type===St,e,"argument-error"),s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){y("enroll"===t.type,e,"internal-error");const n=await function(e,t){return A(e,"POST","/v2/accounts/mfaEnrollment:start",P(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:r}});return n.phoneSessionInfo.sessionInfo}{y("signin"===t.type,e,"internal-error");const n=(null===(i=s.multiFactorHint)||void 0===i?void 0:i.uid)||s.multiFactorUid;y(n,e,"missing-multi-factor-info");const o=await function(e,t){return A(e,"POST","/v2/accounts/mfaSignIn:start",P(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:r}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return A(e,"POST","/v1/accounts:sendVerificationCode",P(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:r});return t}}finally{n._reset()}}class Et{constructor(e){this.providerId=Et.PROVIDER_ID,this.auth=ye(e)}verifyPhoneNumber(e,t){return Tt(this.auth,e,(0,i.m9)(t))}static credential(e,t){return xe._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Et.credentialFromTaggedObject(t)}static credentialFromError(e){return Et.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?xe._fromTokenResponse(t,n):null}}function kt(e,t){return t?H(t):(y(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Et.PROVIDER_ID="phone",Et.PHONE_SIGN_IN_METHOD="phone";class Ct extends Te{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Pe(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Pe(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Pe(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function It(e){return Ke(e.auth,new Ct(e),e.bypassAuthState)}function Rt(e){const{auth:t,user:n}=e;return y(n,t,"internal-error"),He(n,new Ct(e),e.bypassAuthState)}async function Pt(e){const{auth:t,user:n}=e;return y(n,t,"internal-error"),We(n,new Ct(e),e.bypassAuthState)}class At{constructor(e,t,n,i,r=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:i,tenantId:r,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return It;case"linkViaPopup":case"linkViaRedirect":return Pt;case"reauthViaPopup":case"reauthViaRedirect":return Rt;default:p(this.auth,"internal-error")}}resolve(e){_(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){_(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Nt=new E(2e3,1e4);class xt extends At{constructor(e,t,n,i,r){super(e,t,i,r),this.provider=n,this.authWindow=null,this.pollId=null,xt.currentPopupAction&&xt.currentPopupAction.cancel(),xt.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return y(e,this.auth,"internal-error"),e}async onExecution(){_(1===this.filter.length,"Popup operations only handle one event");const e=lt();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(f(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(f(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,xt.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(f(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,Nt.get())};e()}}xt.currentPopupAction=null;const Dt="pendingRedirect",Ot=new Map;class Lt extends At{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Ot.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=Ft(t),i=Ut(e);if(!await i._isAvailable())return!1;const r="true"===await i._get(n);return await i._remove(n),r}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Ot.set(this.auth._key(),e)}return this.bypassAuthState||Ot.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function Mt(e,t){return Ut(e)._set(Ft(t),"true")}function jt(e,t){Ot.set(e._key(),t)}function Ut(e){return H(e._redirectPersistence)}function Ft(e){return Q(Dt,e.config.apiKey,e.name)}function Vt(e,t,n){return async function(e,t,n){const i=ye(e);g(e,t,Le),await i._initializationPromise;const r=kt(i,n);return await Mt(r,i),r._openRedirect(i,t,"signInViaRedirect")}(e,t,n)}async function Bt(e,t,n=!1){const i=ye(e),r=kt(i,t),s=new Lt(i,r,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,t)),o}class zt{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return qt(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!qt(e)){const i=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(f(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has($t(e))}saveEventToCache(e){this.cachedEventUids.add($t(e)),this.lastProcessedEventTime=Date.now()}}function $t(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function qt({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const Gt=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Wt=/^https?/;async function Ht(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return A(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(Kt(e))return}catch(e){}p(e,"unauthorized-domain")}function Kt(e){const t=w(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){const r=new URL(e);return""===r.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===i}if(!Wt.test(n))return!1;if(Gt.test(e))return i===e;const r=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}const Jt=new E(3e4,6e4);function Qt(){const e=ut().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}let Yt=null;function Zt(e){return Yt=Yt||function(e){return new Promise(((t,n)=>{var i,r,s;function o(){Qt(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Qt(),n(f(e,"network-request-failed"))},timeout:Jt.get()})}if(null===(r=null===(i=ut().gapi)||void 0===i?void 0:i.iframes)||void 0===r?void 0:r.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=ut().gapi)||void 0===s?void 0:s.load)){const t=pe("iframefcb");return ut()[t]=()=>{gapi.load?o():n(f(e,"network-request-failed"))},he(`https://apis.google.com/js/api.js?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw Yt=null,e}))}(e),Yt}const Xt=new E(5e3,15e3),en="__/auth/iframe",tn="emulator/auth/iframe",nn={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},rn=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function sn(e){const t=e.config;y(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?k(t,tn):`https://${e.config.authDomain}/${en}`,s={apiKey:t.apiKey,appName:e.name,v:r.Jn},o=rn.get(e.config.apiHost);o&&(s.eid=o);const a=e._getFrameworks();return a.length&&(s.fw=a.join(",")),`${n}?${(0,i.xO)(s).slice(1)}`}const on={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class an{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function ln(e,t,n,r=500,s=600){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const c=Object.assign(Object.assign({},on),{width:r.toString(),height:s.toString(),top:o,left:a}),u=(0,i.z$)().toLowerCase();n&&(l=te(u)?"_blank":n),X(u)&&(t=t||"http://localhost",c.scrollbars="yes");const d=Object.entries(c).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=(0,i.z$)()){var t;return oe(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(u)&&"_self"!==l)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(t||"",l),new an(null);const h=window.open(t||"",l,d);y(h,e,"popup-blocked");try{h.focus()}catch(e){}return new an(h)}const cn="__/auth/handler",un="emulator/auth/handler",dn=encodeURIComponent("fac");async function hn(e,t,n,s,o,a){y(e.config.authDomain,e,"auth-domain-config-required"),y(e.config.apiKey,e,"invalid-api-key");const l={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:s,v:r.Jn,eventId:o};if(t instanceof Le){t.setDefaultLanguage(e.languageCode),l.providerId=t.providerId||"",(0,i.xb)(t.getCustomParameters())||(l.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(a||{}))l[e]=t}if(t instanceof Me){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(l.scopes=e.join(","))}e.tenantId&&(l.tid=e.tenantId);const c=l;for(const e of Object.keys(c))void 0===c[e]&&delete c[e];const u=await e._getAppCheckToken(),d=u?`#${dn}=${encodeURIComponent(u)}`:"";return`${function({config:e}){if(!e.emulator)return`https://${e.authDomain}/${cn}`;return k(e,un)}(e)}?${(0,i.xO)(c).slice(1)}${d}`}const pn="webStorageSupport";const fn=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ot,this._completeRedirectFn=Bt,this._overrideRedirectResult=jt}async _openPopup(e,t,n,i){var r;_(null===(r=this.eventManagers[e._key()])||void 0===r?void 0:r.manager,"_initialize() not called before _openPopup()");return ln(e,await hn(e,t,n,w(),i),lt())}async _openRedirect(e,t,n,i){await this._originValidation(e);return function(e){ut().location.href=e}(await hn(e,t,n,w(),i)),new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(_(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await Zt(e),n=ut().gapi;return y(n,e,"internal-error"),t.open({where:document.body,url:sn(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:nn,dontclear:!0},(t=>new Promise((async(n,i)=>{await t.restyle({setHideOnLeave:!1});const r=f(e,"network-request-failed"),s=ut().setTimeout((()=>{i(r)}),Xt.get());function o(){ut().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{i(r)}))}))))}(e),n=new zt(e);return t.register("authEvent",(t=>{y(null==t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(pn,{type:pn},(n=>{var i;const r=null===(i=null==n?void 0:n[0])||void 0===i?void 0:i[pn];void 0!==r&&t(!!r),p(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Ht(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return ae()||ee()||oe()}};var mn="@firebase/auth",gn="0.23.2";class vn{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){y(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const yn=(0,i.Pz)("authIdTokenMaxAge")||300;let bn=null;const _n=e=>async t=>{const n=t&&await t.getIdTokenResult(),i=n&&((new Date).getTime()-Date.parse(n.issuedAtTime))/1e3;if(i&&i>yn)return;const r=null==n?void 0:n.token;bn!==r&&(bn=r,await fetch(e,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function wn(e=(0,r.Mq)()){const t=(0,r.qX)(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=(0,r.qX)(e,"auth");if(n.isInitialized()){const e=n.getImmediate(),r=n.getOptions();if((0,i.vZ)(r,null!=t?t:{}))return e;p(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:fn,persistence:[wt,rt,ot]}),s=(0,i.Pz)("authTokenSyncURL");if(s){const e=_n(s);!function(e,t,n){(0,i.m9)(e).beforeAuthStateChanged(t,n)}(n,e,(()=>e(n.currentUser))),function(e,t,n,r){(0,i.m9)(e).onIdTokenChanged(t,n,r)}(n,(t=>e(t)))}const o=(0,i.q4)("auth");return o&&_e(n,`http://${o}`),n}var Sn;Sn="Browser",(0,r.Xd)(new a.wA("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=n.options;y(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:s,authDomain:o,clientPlatform:Sn,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:le(Sn)},l=new ve(n,i,r,a);return function(e,t){const n=(null==t?void 0:t.persistence)||[],i=(Array.isArray(n)?n:[n]).map(H);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(i,null==t?void 0:t.popupRedirectResolver)}(l,t),l}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),(0,r.Xd)(new a.wA("auth-internal",(e=>(e=>new vn(e))(ye(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,r.KN)(mn,gn,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(Sn)),(0,r.KN)(mn,gn,"esm2017")},8679:(e,t,n)=>{"use strict";n.d(t,{iU:()=>kr,U2:()=>Ir,N8:()=>Ur,yv:()=>xr,jM:()=>Nr,iH:()=>Er,t8:()=>Cr});var i=n(1657),r=n(8463),s=n(4444),o=n(3333);const a="@firebase/database",l="0.14.4";let c="";class u{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),(0,s.Wl)(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:(0,s.cI)(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class d{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return(0,s.r3)(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const h=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new u(t)}}catch(e){}return new d},p=h("localStorage"),f=h("sessionStorage"),m=new o.Yd("@firebase/database"),g=function(){let e=1;return function(){return e++}}(),v=function(e){const t=(0,s.dS)(e),n=new s.gQ;n.update(t);const i=n.digest();return s.US.encodeByteArray(i)},y=function(...e){let t="";for(let n=0;n<e.length;n++){const i=e[n];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?t+=y.apply(null,i):t+="object"==typeof i?(0,s.Wl)(i):i,t+=" "}return t};let b=null,_=!0;const w=function(e,t){(0,s.hu)(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(m.logLevel=o.in.VERBOSE,b=m.log.bind(m),t&&f.set("logging_enabled",!0)):"function"==typeof e?b=e:(b=null,f.remove("logging_enabled"))},S=function(...e){if(!0===_&&(_=!1,null===b&&!0===f.get("logging_enabled")&&w(!0)),b){const t=y.apply(null,e);b(t)}},T=function(e){return function(...t){S(e,...t)}},E=function(...e){const t="FIREBASE INTERNAL ERROR: "+y(...e);m.error(t)},k=function(...e){const t=`FIREBASE FATAL ERROR: ${y(...e)}`;throw m.error(t),new Error(t)},C=function(...e){const t="FIREBASE WARNING: "+y(...e);m.warn(t)},I=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},R="[MIN_NAME]",P="[MAX_NAME]",A=function(e,t){if(e===t)return 0;if(e===R||t===P)return-1;if(t===R||e===P)return 1;{const n=U(e),i=U(t);return null!==n?null!==i?n-i==0?e.length-t.length:n-i:-1:null!==i?1:e<t?-1:1}},N=function(e,t){return e===t?0:e<t?-1:1},x=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+(0,s.Wl)(t))},D=function(e){if("object"!=typeof e||null===e)return(0,s.Wl)(e);const t=[];for(const n in e)t.push(n);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=(0,s.Wl)(t[i]),n+=":",n+=D(e[t[i]]);return n+="}",n},O=function(e,t){const n=e.length;if(n<=t)return[e];const i=[];for(let r=0;r<n;r+=t)r+t>n?i.push(e.substring(r,n)):i.push(e.substring(r,r+t));return i};function L(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const M=function(e){(0,s.hu)(!I(e),"Invalid JSON number");const t=1023;let n,i,r,o,a;0===e?(i=0,r=0,n=1/e==-1/0?1:0):(n=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(o=Math.min(Math.floor(Math.log(e)/Math.LN2),t),i=o+t,r=Math.round(e*Math.pow(2,52-o)-Math.pow(2,52))):(i=0,r=Math.round(e/Math.pow(2,-1074))));const l=[];for(a=52;a;a-=1)l.push(r%2?1:0),r=Math.floor(r/2);for(a=11;a;a-=1)l.push(i%2?1:0),i=Math.floor(i/2);l.push(n?1:0),l.reverse();const c=l.join("");let u="";for(a=0;a<64;a+=8){let e=parseInt(c.substr(a,8),2).toString(16);1===e.length&&(e="0"+e),u+=e}return u.toLowerCase()};const j=new RegExp("^-?(0*)\\d{1,10}$"),U=function(e){if(j.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},F=function(e){try{e()}catch(e){setTimeout((()=>{const t=e.stack||"";throw C("Exception was thrown by user callback.",t),e}),Math.floor(0))}},V=function(e,t){const n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class B{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then((e=>this.appCheck=e))}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise(((t,n)=>{setTimeout((()=>{this.appCheck?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((t=>t.addTokenListener(e)))}notifyForInvalidToken(){C(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class z{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((e=>this.auth_=e))}getToken(e){return this.auth_?this.auth_.getToken(e).catch((e=>e&&"auth/token-not-initialized"===e.code?(S("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e))):new Promise(((t,n)=>{setTimeout((()=>{this.auth_?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((t=>t.addAuthTokenListener(e)))}removeTokenChangeListener(e){this.authProvider_.get().then((t=>t.removeAuthTokenListener(e)))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',C(e)}}class ${constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}$.OWNER="owner";const q="5",G=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,W="ac",H="websocket",K="long_polling";class J{constructor(e,t,n,i,r=!1,s="",o=!1,a=!1){this.secure=t,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=p.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&p.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Q(e,t,n){let i;if((0,s.hu)("string"==typeof t,"typeof type must == string"),(0,s.hu)("object"==typeof n,"typeof params must == object"),t===H)i=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==K)throw new Error("Unknown connection type: "+t);i=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const r=[];return L(n,((e,t)=>{r.push(e+"="+t)})),i+r.join("&")}class Y{constructor(){this.counters_={}}incrementCounter(e,t=1){(0,s.r3)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return(0,s.p$)(this.counters_)}}const Z={},X={};function ee(e){const t=e.toString();return Z[t]||(Z[t]=new Y),Z[t]}class te{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&F((()=>{this.onMessage_(e[t])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const ne="start";class ie{constructor(e,t,n,i,r,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=T(e),this.stats_=ee(t),this.urlFn=e=>(this.appCheckToken&&(e[W]=this.appCheckToken),Q(t,K,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new te(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if((0,s.Yr)()||"complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new re(((...e)=>{const[t,n,i,r,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===ne)this.id=n,this.password=i;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...e)=>{const[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)}),(()=>{this.onClosed_()}),this.urlFn);const e={};e[ne]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v=q,this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[W]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&G.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){ie.forceAllow_=!0}static forceDisallow(){ie.forceDisallow_=!0}static isAvailable(){return!(0,s.Yr)()&&(!!ie.forceAllow_||!(ie.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=(0,s.Wl)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=(0,s.h$)(t),i=O(n,1840);for(let e=0;e<i.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if((0,s.Yr)())return;this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=(0,s.Wl)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class re{constructor(e,t,n,i){if(this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,s.Yr)())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=g(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=re.createIFrame_();let n="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)){n='<script>document.domain="'+document.domain+'";<\/script>'}const i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){S("frame writing exception"),e.stack&&S(e.stack),S(e)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||S("No IE domain setting required")}catch(t){const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;{const e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(e,(()=>{clearTimeout(i),n()}))}addTag(e,t){(0,s.Yr)()?this.doNodeLongPoll(e,t):setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{S("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}}),Math.floor(1))}}let se=null;"undefined"!=typeof MozWebSocket?se=MozWebSocket:"undefined"!=typeof WebSocket&&(se=WebSocket);class oe{constructor(e,t,n,i,r,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=T(this.connId),this.stats_=ee(t),this.connURL=oe.connectionURL_(t,s,o,i,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,i,r){const o={};return o.v=q,!(0,s.Yr)()&&"undefined"!=typeof location&&location.hostname&&G.test(location.hostname)&&(o.r="f"),t&&(o.s=t),n&&(o.ls=n),i&&(o[W]=i),r&&(o.p=r),Q(e,H,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,p.set("previous_websocket_failure",!0);try{let e;if((0,s.Yr)()){const t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/${q}/${c}/${process.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);const n=process.env,i=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;i&&(e.proxy={origin:i})}this.mySock=new se(this.connURL,[],e)}catch(e){this.log_("Error instantiating WebSocket.");const t=e.message||e.data;return t&&this.log_(t),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){oe.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==se&&!oe.forceDisallow_}static previouslyFailed(){return p.isInMemoryStorage||!0===p.get("previous_websocket_failure")}markConnectionHealthy(){p.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=(0,s.cI)(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if((0,s.hu)(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=(0,s.Wl)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=O(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}oe.responsesRequiredToBeHealthy=2,oe.healthyTimeout=3e4;class ae{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[ie,oe]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=oe&&oe.isAvailable();let n=t&&!oe.previouslyFailed();if(e.webSocketOnly&&(t||C("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[oe];else{const e=this.transports_=[];for(const t of ae.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);ae.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}ae.globalTransportInitialized_=!1;class le{constructor(e,t,n,i,r,s,o,a,l,c){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=T("c:"+this.id+":"),this.transportManager_=new ae(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(t,n)}),Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=V((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=x("t",e),n=x("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=x("t",e),n=x("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=x("t",e);if("d"in e){const n=e.d;if("h"===t){const e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?E("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):E("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),q!==n&&C("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),V((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):V((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(p.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class ce{put(e,t,n,i){}merge(e,t,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class ue{constructor(e){this.allowedEvents_=e,this.listeners_={},(0,s.hu)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const i=this.getInitialEvent(e);i&&t.apply(n,i)}off(e,t,n){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let e=0;e<i.length;e++)if(i[e].callback===t&&(!n||n===i[e].context))return void i.splice(e,1)}validateEventType_(e){(0,s.hu)(this.allowedEvents_.find((t=>t===e)),"Unknown event: "+e)}}class de extends ue{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||(0,s.uI)()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}static getInstance(){return new de}getInitialEvent(e){return(0,s.hu)("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const he=32,pe=768;class fe{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function me(){return new fe("")}function ge(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function ve(e){return e.pieces_.length-e.pieceNum_}function ye(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new fe(e.pieces_,t)}function be(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function _e(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function we(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new fe(t,0)}function Se(e,t){const n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof fe)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new fe(n,0)}function Te(e){return e.pieceNum_>=e.pieces_.length}function Ee(e,t){const n=ge(e),i=ge(t);if(null===n)return t;if(n===i)return Ee(ye(e),ye(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function ke(e,t){if(ve(e)!==ve(t))return!1;for(let n=e.pieceNum_,i=t.pieceNum_;n<=e.pieces_.length;n++,i++)if(e.pieces_[n]!==t.pieces_[i])return!1;return!0}function Ce(e,t){let n=e.pieceNum_,i=t.pieceNum_;if(ve(e)>ve(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[i])return!1;++n,++i}return!0}class Ie{constructor(e,t){this.errorPrefix_=t,this.parts_=_e(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=(0,s.ug)(this.parts_[e]);Re(this)}}function Re(e){if(e.byteLength_>pe)throw new Error(e.errorPrefix_+"has a key path longer than "+pe+" bytes ("+e.byteLength_+").");if(e.parts_.length>he)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+he+") or object contains a cycle "+Pe(e))}function Pe(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class Ae extends ue{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,(()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))}),!1)}static getInstance(){return new Ae}getInitialEvent(e){return(0,s.hu)("visible"===e,"Unknown event type: "+e),[this.visible_]}}const Ne=1e3;class xe extends ce{constructor(e,t,n,i,r,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=xe.nextPersistentConnectionId_++,this.log_=T("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Ne,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l&&!(0,s.Yr)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Ae.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&de.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const i=++this.requestNumber_,r={r:i,a:e,b:t};this.log_((0,s.Wl)(r)),(0,s.hu)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),n&&(this.requestCBHash_[i]=n)}get(e){this.initConnection_();const t=new s.BH,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,n,i){this.initConnection_();const r=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),(0,s.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,s.hu)(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");const a={onComplete:i,hashFn:t,query:e,tag:n};this.listens.get(o).set(r,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,(n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)}))}sendListen_(e){const t=e.query,n=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+n+" for "+i);const r={p:n};e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest("q",r,(r=>{const s=r.d,o=r.s;xe.warnOnListenWarnings_(s,t);(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",r),"ok"!==o&&this.removeListen_(n,i),e.onComplete&&e.onComplete(o,s))}))}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&(0,s.r3)(e,"w")){const n=(0,s.DV)(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();C(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||(0,s.GJ)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=(0,s.w9)(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,(t=>{const n=t.s,i=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)}))}unlisten(e,t){const n=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+i),(0,s.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");this.removeListen_(n,i)&&this.connected_&&this.sendUnlisten_(n,i,e._queryObject,t)}sendUnlisten_(e,t,n,i){this.log_("Unlisten on "+e+" for "+t);const r={p:e};i&&(r.q=n,r.t=i),this.sendRequest("n",r)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,i){const r={p:t,d:n};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,(e=>{i&&setTimeout((()=>{i(e.s,e.d)}),Math.floor(0))}))}put(e,t,n,i){this.putInternal("p",e,t,n,i)}merge(e,t,n,i){this.putInternal("m",e,t,n,i)}putInternal(e,t,n,i,r){this.initConnection_();const s={p:t,d:n};void 0!==r&&(s.h=r),this.outstandingPuts_.push({action:e,request:s,onComplete:i}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,(n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)}))}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,(e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}}))}}onDataMessage_(e){if("r"in e){this.log_("from server: "+(0,s.Wl)(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):E("Unrecognized action received from server: "+(0,s.Wl)(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){(0,s.hu)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Ne,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Ne,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=Ne),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+xe.nextConnectionId_++,r=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,n())},c=function(e){(0,s.hu)(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(e)};this.realtime_={close:l,sendRequest:c};const u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[s,l]=await Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);o?S("getToken() completed but was canceled"):(S("getToken() completed. Creating connection."),this.authToken_=s&&s.accessToken,this.appCheckToken_=l&&l.token,a=new le(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,(e=>{C(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),r))}catch(e){this.log_("Failed to get token: "+e),o||(this.repoInfo_.nodeAdmin&&C(e),l())}}}interrupt(e){S("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){S("Resuming connection for reason: "+e),delete this.interruptReasons_[e],(0,s.xb)(this.interruptReasons_)&&(this.reconnectDelay_=Ne,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map((e=>D(e))).join("$"):"default";const i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const n=new fe(e).toString();let i;if(this.listens.has(n)){const e=this.listens.get(n);i=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else i=void 0;return i}onAuthRevoked_(e,t){S("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){S("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";(0,s.Yr)()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+c.replace(/\./g,"-")]=1,(0,s.uI)()?e["framework.cordova"]=1:(0,s.b$)()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=de.getInstance().currentlyOnline();return(0,s.xb)(this.interruptReasons_)&&e}}xe.nextPersistentConnectionId_=0,xe.nextConnectionId_=0;class De{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new De(e,t)}}class Oe{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new De(R,e),i=new De(R,t);return 0!==this.compare(n,i)}minPost(){return De.MIN}}let Le;class Me extends Oe{static get __EMPTY_NODE(){return Le}static set __EMPTY_NODE(e){Le=e}compare(e,t){return A(e.name,t.name)}isDefinedOn(e){throw(0,s.g5)("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return De.MIN}maxPost(){return new De(P,Le)}makePost(e,t){return(0,s.hu)("string"==typeof e,"KeyIndex indexValue must always be a string."),new De(e,Le)}toString(){return".key"}}const je=new Me;class Ue{constructor(e,t,n,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,i&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Fe{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:Fe.RED,this.left=null!=i?i:Ve.EMPTY_NODE,this.right=null!=r?r:Ve.EMPTY_NODE}copy(e,t,n,i,r){return new Fe(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const r=n(e,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Ve.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,i;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Ve.EMPTY_NODE;i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Fe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Fe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Fe.RED=!0,Fe.BLACK=!1;class Ve{constructor(e,t=Ve.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Ve(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Fe.BLACK,null,null))}remove(e){return new Ve(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Fe.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,i=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return i?i.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(i=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Ue(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Ue(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Ue(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Ue(this.root_,null,this.comparator_,!0,e)}}function Be(e,t){return A(e.name,t.name)}function ze(e,t){return A(e,t)}let $e;Ve.EMPTY_NODE=new class{copy(e,t,n,i,r){return this}insert(e,t,n){return new Fe(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const qe=function(e){return"number"==typeof e?"number:"+M(e):"string:"+e},Ge=function(e){if(e.isLeafNode()){const t=e.val();(0,s.hu)("string"==typeof t||"number"==typeof t||"object"==typeof t&&(0,s.r3)(t,".sv"),"Priority must be a string or number.")}else(0,s.hu)(e===$e||e.isEmpty(),"priority of unexpected type.");(0,s.hu)(e===$e||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let We,He,Ke;class Je{constructor(e,t=Je.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,(0,s.hu)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Ge(this.priorityNode_)}static set __childrenNodeConstructor(e){We=e}static get __childrenNodeConstructor(){return We}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Je(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:Je.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Te(e)?this:".priority"===ge(e)?this.priorityNode_:Je.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:Je.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const n=ge(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:((0,s.hu)(".priority"!==n||1===ve(e),".priority must be the last token in a path"),this.updateImmediateChild(n,Je.__childrenNodeConstructor.EMPTY_NODE.updateChild(ye(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+qe(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?M(this.value_):this.value_,this.lazyHash_=v(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Je.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Je.__childrenNodeConstructor?-1:((0,s.hu)(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,i=Je.VALUE_TYPE_ORDER.indexOf(t),r=Je.VALUE_TYPE_ORDER.indexOf(n);return(0,s.hu)(i>=0,"Unknown leaf type: "+t),(0,s.hu)(r>=0,"Unknown leaf type: "+n),i===r?"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}Je.VALUE_TYPE_ORDER=["object","boolean","number","string"];const Qe=new class extends Oe{compare(e,t){const n=e.node.getPriority(),i=t.node.getPriority(),r=n.compareTo(i);return 0===r?A(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return De.MIN}maxPost(){return new De(P,new Je("[PRIORITY-POST]",Ke))}makePost(e,t){const n=He(e);return new De(t,new Je("[PRIORITY-POST]",n))}toString(){return".priority"}},Ye=Math.log(2);class Ze{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Ye,10)),this.current_=this.count-1;const n=(i=this.count,parseInt(Array(i+1).join("1"),2));var i;this.bits_=e+1&n}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Xe=function(e,t,n,i){e.sort(t);const r=function(t,i){const s=i-t;let o,a;if(0===s)return null;if(1===s)return o=e[t],a=n?n(o):o,new Fe(a,o.node,Fe.BLACK,null,null);{const l=parseInt(s/2,10)+t,c=r(t,l),u=r(l+1,i);return o=e[l],a=n?n(o):o,new Fe(a,o.node,Fe.BLACK,c,u)}},s=function(t){let i=null,s=null,o=e.length;const a=function(t,i){const s=o-t,a=o;o-=t;const c=r(s+1,a),u=e[s],d=n?n(u):u;l(new Fe(d,u.node,i,null,c))},l=function(e){i?(i.left=e,i=e):(s=e,i=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),i=Math.pow(2,t.count-(e+1));n?a(i,Fe.BLACK):(a(i,Fe.BLACK),a(i,Fe.RED))}return s}(new Ze(e.length));return new Ve(i||t,s)};let et;const tt={};class nt{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return(0,s.hu)(tt&&Qe,"ChildrenNode.ts has not been loaded"),et=et||new nt({".priority":tt},{".priority":Qe}),et}get(e){const t=(0,s.DV)(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Ve?t:null}hasIndex(e){return(0,s.r3)(this.indexSet_,e.toString())}addIndex(e,t){(0,s.hu)(e!==je,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let i=!1;const r=t.getIterator(De.Wrap);let o,a=r.getNext();for(;a;)i=i||e.isDefinedOn(a.node),n.push(a),a=r.getNext();o=i?Xe(n,e.getCompare()):tt;const l=e.toString(),c=Object.assign({},this.indexSet_);c[l]=e;const u=Object.assign({},this.indexes_);return u[l]=o,new nt(u,c)}addToIndexes(e,t){const n=(0,s.UI)(this.indexes_,((n,i)=>{const r=(0,s.DV)(this.indexSet_,i);if((0,s.hu)(r,"Missing index implementation for "+i),n===tt){if(r.isDefinedOn(e.node)){const n=[],i=t.getIterator(De.Wrap);let s=i.getNext();for(;s;)s.name!==e.name&&n.push(s),s=i.getNext();return n.push(e),Xe(n,r.getCompare())}return tt}{const i=t.get(e.name);let r=n;return i&&(r=r.remove(new De(e.name,i))),r.insert(e,e.node)}}));return new nt(n,this.indexSet_)}removeFromIndexes(e,t){const n=(0,s.UI)(this.indexes_,(n=>{if(n===tt)return n;{const i=t.get(e.name);return i?n.remove(new De(e.name,i)):n}}));return new nt(n,this.indexSet_)}}let it;class rt{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Ge(this.priorityNode_),this.children_.isEmpty()&&(0,s.hu)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return it||(it=new rt(new Ve(ze),null,nt.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||it}updatePriority(e){return this.children_.isEmpty()?this:new rt(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?it:t}}getChild(e){const t=ge(e);return null===t?this:this.getImmediateChild(t).getChild(ye(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if((0,s.hu)(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const n=new De(e,t);let i,r;t.isEmpty()?(i=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(n,this.children_)):(i=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(n,this.children_));const s=i.isEmpty()?it:this.priorityNode_;return new rt(i,s,r)}}updateChild(e,t){const n=ge(e);if(null===n)return t;{(0,s.hu)(".priority"!==ge(e)||1===ve(e),".priority must be the last token in a path");const i=this.getImmediateChild(n).updateChild(ye(e),t);return this.updateImmediateChild(n,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,i=0,r=!0;if(this.forEachChild(Qe,((s,o)=>{t[s]=o.val(e),n++,r&&rt.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):r=!1})),!e&&r&&i<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+qe(this.getPriority().val())+":"),this.forEachChild(Qe,((t,n)=>{const i=n.hash();""!==i&&(e+=":"+t+":"+i)})),this.lazyHash_=""===e?"":v(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const i=this.resolveIndex_(n);if(i){const n=i.getPredecessorKey(new De(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new De(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new De(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal((e=>t(e.name,e.node))):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(e=>e));{const n=this.children_.getIteratorFrom(e.name,De.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)<0;)n.getNext(),i=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(e=>e));{const n=this.children_.getReverseIteratorFrom(e.name,De.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)>0;)n.getNext(),i=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===st?-1:0}withIndex(e){if(e===je||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new rt(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===je||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(Qe),n=t.getIterator(Qe);let i=e.getNext(),r=n.getNext();for(;i&&r;){if(i.name!==r.name||!i.node.equals(r.node))return!1;i=e.getNext(),r=n.getNext()}return null===i&&null===r}return!1}return!1}}resolveIndex_(e){return e===je?null:this.indexMap_.get(e.toString())}}rt.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const st=new class extends rt{constructor(){super(new Ve(ze),rt.EMPTY_NODE,nt.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return rt.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(De,{MIN:{value:new De(R,rt.EMPTY_NODE)},MAX:{value:new De(P,st)}}),Me.__EMPTY_NODE=rt.EMPTY_NODE,Je.__childrenNodeConstructor=rt,$e=st,function(e){Ke=e}(st);const ot=!0;function at(e,t=null){if(null===e)return rt.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),(0,s.hu)(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e){return new Je(e,at(t))}if(e instanceof Array||!ot){let n=rt.EMPTY_NODE;return L(e,((t,i)=>{if((0,s.r3)(e,t)&&"."!==t.substring(0,1)){const e=at(i);!e.isLeafNode()&&e.isEmpty()||(n=n.updateImmediateChild(t,e))}})),n.updatePriority(at(t))}{const n=[];let i=!1;if(L(e,((e,t)=>{if("."!==e.substring(0,1)){const r=at(t);r.isEmpty()||(i=i||!r.getPriority().isEmpty(),n.push(new De(e,r)))}})),0===n.length)return rt.EMPTY_NODE;const r=Xe(n,Be,(e=>e.name),ze);if(i){const e=Xe(n,Qe.getCompare());return new rt(r,at(t),new nt({".priority":e},{".priority":Qe}))}return new rt(r,at(t),nt.Default)}}!function(e){He=e}(at);class lt extends Oe{constructor(e){super(),this.indexPath_=e,(0,s.hu)(!Te(e)&&".priority"!==ge(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),i=this.extractChild(t.node),r=n.compareTo(i);return 0===r?A(e.name,t.name):r}makePost(e,t){const n=at(e),i=rt.EMPTY_NODE.updateChild(this.indexPath_,n);return new De(t,i)}maxPost(){const e=rt.EMPTY_NODE.updateChild(this.indexPath_,st);return new De(P,e)}toString(){return _e(this.indexPath_,0).join("/")}}const ct=new class extends Oe{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?A(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return De.MIN}maxPost(){return De.MAX}makePost(e,t){const n=at(e);return new De(t,n)}toString(){return".value"}};function ut(e){return{type:"value",snapshotNode:e}}function dt(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function ht(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function pt(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class ft{constructor(e){this.index_=e}updateChild(e,t,n,i,r,o){(0,s.hu)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(i).equals(n.getChild(i))&&a.isEmpty()===n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(ht(t,a)):(0,s.hu)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(dt(t,n)):o.trackChildChange(pt(t,n,a))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(Qe,((e,i)=>{t.hasChild(e)||n.trackChildChange(ht(e,i))})),t.isLeafNode()||t.forEachChild(Qe,((t,i)=>{if(e.hasChild(t)){const r=e.getImmediateChild(t);r.equals(i)||n.trackChildChange(pt(t,i,r))}else n.trackChildChange(dt(t,i))}))),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?rt.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class mt{constructor(e){this.indexedFilter_=new ft(e.getIndex()),this.index_=e.getIndex(),this.startPost_=mt.getStartPost_(e),this.endPost_=mt.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,i,r,s){return this.matches(new De(t,n))||(n=rt.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,i,r,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=rt.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(rt.EMPTY_NODE);const r=this;return t.forEachChild(Qe,((e,t)=>{r.matches(new De(e,t))||(i=i.updateImmediateChild(e,rt.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class gt{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{const t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new mt(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,i,r,s){return this.rangedFilter_.matches(new De(t,n))||(n=rt.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,i,r,s):this.fullLimitUpdateChild_(e,t,n,r,s)}updateFullNode(e,t,n){let i;if(t.isLeafNode()||t.isEmpty())i=rt.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;i=rt.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){const t=e.getNext();if(this.withinDirectionalStart(t)){if(!this.withinDirectionalEnd(t))break;i=i.updateImmediateChild(t.name,t.node),n++}}}else{let e;i=t.withIndex(this.index_),i=i.updatePriority(rt.EMPTY_NODE),e=this.reverse_?i.getReverseIterator(this.index_):i.getIterator(this.index_);let n=0;for(;e.hasNext();){const t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:i=i.updateImmediateChild(t.name,rt.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,i,r){let o;if(this.reverse_){const e=this.index_.getCompare();o=(t,n)=>e(n,t)}else o=this.index_.getCompare();const a=e;(0,s.hu)(a.numChildren()===this.limit_,"");const l=new De(t,n),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),u=this.rangedFilter_.matches(l);if(a.hasChild(t)){const e=a.getImmediateChild(t);let s=i.getChildAfterChild(this.index_,c,this.reverse_);for(;null!=s&&(s.name===t||a.hasChild(s.name));)s=i.getChildAfterChild(this.index_,s,this.reverse_);const d=null==s?1:o(s,l);if(u&&!n.isEmpty()&&d>=0)return null!=r&&r.trackChildChange(pt(t,n,e)),a.updateImmediateChild(t,n);{null!=r&&r.trackChildChange(ht(t,e));const n=a.updateImmediateChild(t,rt.EMPTY_NODE);return null!=s&&this.rangedFilter_.matches(s)?(null!=r&&r.trackChildChange(dt(s.name,s.node)),n.updateImmediateChild(s.name,s.node)):n}}return n.isEmpty()?e:u&&o(c,l)>=0?(null!=r&&(r.trackChildChange(ht(c.name,c.node)),r.trackChildChange(dt(t,n))),a.updateImmediateChild(t,n).updateImmediateChild(c.name,rt.EMPTY_NODE)):e}}class vt{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Qe}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return(0,s.hu)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(0,s.hu)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:R}hasEnd(){return this.endSet_}getIndexEndValue(){return(0,s.hu)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(0,s.hu)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:P}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return(0,s.hu)(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Qe}copy(){const e=new vt;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function yt(e){const t={};if(e.isDefault())return t;let n;if(e.index_===Qe?n="$priority":e.index_===ct?n="$value":e.index_===je?n="$key":((0,s.hu)(e.index_ instanceof lt,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=(0,s.Wl)(n),e.startSet_){const n=e.startAfterSet_?"startAfter":"startAt";t[n]=(0,s.Wl)(e.indexStartValue_),e.startNameSet_&&(t[n]+=","+(0,s.Wl)(e.indexStartName_))}if(e.endSet_){const n=e.endBeforeSet_?"endBefore":"endAt";t[n]=(0,s.Wl)(e.indexEndValue_),e.endNameSet_&&(t[n]+=","+(0,s.Wl)(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function bt(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==Qe&&(t.i=e.index_.toString()),t}class _t extends ce{constructor(e,t,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=T("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:((0,s.hu)(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,i){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const o=_t.getListenId_(e,n),a={};this.listens_[o]=a;const l=yt(e._queryParams);this.restRequest_(r+".json",l,((e,t)=>{let l=t;if(404===e&&(l=null,e=null),null===e&&this.onDataUpdate_(r,l,!1,n),(0,s.DV)(this.listens_,o)===a){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",i(t,null)}}))}unlisten(e,t){const n=_t.getListenId_(e,t);delete this.listens_[n]}get(e){const t=yt(e._queryParams),n=e._path.toString(),i=new s.BH;return this.restRequest_(n+".json",t,((e,t)=>{let r=t;404===e&&(r=null,e=null),null===e?(this.onDataUpdate_(n,r,!1,null),i.resolve(r)):i.reject(new Error(r))})),i.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+(0,s.xO)(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(n&&4===a.readyState){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let e=null;if(a.status>=200&&a.status<300){try{e=(0,s.cI)(a.responseText)}catch(e){C("Failed to parse JSON response for "+o+": "+a.responseText)}n(null,e)}else 401!==a.status&&404!==a.status&&C("Got unsuccessful REST response for "+o+" Status: "+a.status),n(a.status);n=null}},a.open("GET",o,!0),a.send()}))}}class wt{constructor(){this.rootNode_=rt.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function St(){return{value:null,children:new Map}}function Tt(e,t,n){if(Te(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const i=ge(t);e.children.has(i)||e.children.set(i,St());Tt(e.children.get(i),t=ye(t),n)}}function Et(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach(((e,n)=>{t(n,e)}))}(e,((e,i)=>{Et(i,new fe(t.toString()+"/"+e),n)}))}class kt{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&L(this.last_,((e,n)=>{t[e]=t[e]-n})),this.last_=e,t}}class Ct{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new kt(e);const n=1e4+2e4*Math.random();V(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;L(e,((e,i)=>{i>0&&(0,s.r3)(this.statsToReport_,e)&&(t[e]=i,n=!0)})),n&&this.server_.reportStats(t),V(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var It;function Rt(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(It||(It={}));class Pt{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=It.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(Te(this.path)){if(null!=this.affectedTree.value)return(0,s.hu)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new fe(e));return new Pt(me(),t,this.revert)}}return(0,s.hu)(ge(this.path)===e,"operationForChild called for unrelated child."),new Pt(ye(this.path),this.affectedTree,this.revert)}}class At{constructor(e,t){this.source=e,this.path=t,this.type=It.LISTEN_COMPLETE}operationForChild(e){return Te(this.path)?new At(this.source,me()):new At(this.source,ye(this.path))}}class Nt{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=It.OVERWRITE}operationForChild(e){return Te(this.path)?new Nt(this.source,me(),this.snap.getImmediateChild(e)):new Nt(this.source,ye(this.path),this.snap)}}class xt{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=It.MERGE}operationForChild(e){if(Te(this.path)){const t=this.children.subtree(new fe(e));return t.isEmpty()?null:t.value?new Nt(this.source,me(),t.value):new xt(this.source,me(),t)}return(0,s.hu)(ge(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new xt(this.source,ye(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Dt{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Te(e))return this.isFullyInitialized()&&!this.filtered_;const t=ge(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class Ot{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Lt(e,t,n,i,r,o){const a=i.filter((e=>e.type===n));a.sort(((t,n)=>function(e,t,n){if(null==t.childName||null==n.childName)throw(0,s.g5)("Should only compare child_ events.");const i=new De(t.childName,t.snapshotNode),r=new De(n.childName,n.snapshotNode);return e.index_.compare(i,r)}(e,t,n))),a.forEach((n=>{const i=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,o);r.forEach((r=>{r.respondsTo(n.type)&&t.push(r.createEvent(i,e.query_))}))}))}function Mt(e,t){return{eventCache:e,serverCache:t}}function jt(e,t,n,i){return Mt(new Dt(t,n,i),e.serverCache)}function Ut(e,t,n,i){return Mt(e.eventCache,new Dt(t,n,i))}function Ft(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Vt(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let Bt;class zt{constructor(e,t=(()=>(Bt||(Bt=new Ve(N)),Bt))()){this.value=e,this.children=t}static fromObject(e){let t=new zt(null);return L(e,((e,n)=>{t=t.set(new fe(e),n)})),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:me(),value:this.value};if(Te(e))return null;{const n=ge(e),i=this.children.get(n);if(null!==i){const r=i.findRootMostMatchingPathAndValue(ye(e),t);if(null!=r){return{path:Se(new fe(n),r.path),value:r.value}}return null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,(()=>!0))}subtree(e){if(Te(e))return this;{const t=ge(e),n=this.children.get(t);return null!==n?n.subtree(ye(e)):new zt(null)}}set(e,t){if(Te(e))return new zt(t,this.children);{const n=ge(e),i=(this.children.get(n)||new zt(null)).set(ye(e),t),r=this.children.insert(n,i);return new zt(this.value,r)}}remove(e){if(Te(e))return this.children.isEmpty()?new zt(null):new zt(null,this.children);{const t=ge(e),n=this.children.get(t);if(n){const i=n.remove(ye(e));let r;return r=i.isEmpty()?this.children.remove(t):this.children.insert(t,i),null===this.value&&r.isEmpty()?new zt(null):new zt(this.value,r)}return this}}get(e){if(Te(e))return this.value;{const t=ge(e),n=this.children.get(t);return n?n.get(ye(e)):null}}setTree(e,t){if(Te(e))return t;{const n=ge(e),i=(this.children.get(n)||new zt(null)).setTree(ye(e),t);let r;return r=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),new zt(this.value,r)}}fold(e){return this.fold_(me(),e)}fold_(e,t){const n={};return this.children.inorderTraversal(((i,r)=>{n[i]=r.fold_(Se(e,i),t)})),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,me(),t)}findOnPath_(e,t,n){const i=!!this.value&&n(t,this.value);if(i)return i;if(Te(e))return null;{const i=ge(e),r=this.children.get(i);return r?r.findOnPath_(ye(e),Se(t,i),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,me(),t)}foreachOnPath_(e,t,n){if(Te(e))return this;{this.value&&n(t,this.value);const i=ge(e),r=this.children.get(i);return r?r.foreachOnPath_(ye(e),Se(t,i),n):new zt(null)}}foreach(e){this.foreach_(me(),e)}foreach_(e,t){this.children.inorderTraversal(((n,i)=>{i.foreach_(Se(e,n),t)})),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal(((t,n)=>{n.value&&e(t,n.value)}))}}class $t{constructor(e){this.writeTree_=e}static empty(){return new $t(new zt(null))}}function qt(e,t,n){if(Te(t))return new $t(new zt(n));{const i=e.writeTree_.findRootMostValueAndPath(t);if(null!=i){const r=i.path;let s=i.value;const o=Ee(r,t);return s=s.updateChild(o,n),new $t(e.writeTree_.set(r,s))}{const i=new zt(n),r=e.writeTree_.setTree(t,i);return new $t(r)}}}function Gt(e,t,n){let i=e;return L(n,((e,n)=>{i=qt(i,Se(t,e),n)})),i}function Wt(e,t){if(Te(t))return $t.empty();{const n=e.writeTree_.setTree(t,new zt(null));return new $t(n)}}function Ht(e,t){return null!=Kt(e,t)}function Kt(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(Ee(n.path,t)):null}function Jt(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(Qe,((e,n)=>{t.push(new De(e,n))})):e.writeTree_.children.inorderTraversal(((e,n)=>{null!=n.value&&t.push(new De(e,n.value))})),t}function Qt(e,t){if(Te(t))return e;{const n=Kt(e,t);return new $t(null!=n?new zt(n):e.writeTree_.subtree(t))}}function Yt(e){return e.writeTree_.isEmpty()}function Zt(e,t){return Xt(me(),e.writeTree_,t)}function Xt(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let i=null;return t.children.inorderTraversal(((t,r)=>{".priority"===t?((0,s.hu)(null!==r.value,"Priority writes must always be leaf nodes"),i=r.value):n=Xt(Se(e,t),r,n)})),n.getChild(e).isEmpty()||null===i||(n=n.updateChild(Se(e,".priority"),i)),n}}function en(e,t){return fn(t,e)}function tn(e,t){const n=e.allWrites.findIndex((e=>e.writeId===t));(0,s.hu)(n>=0,"removeWrite called with nonexistent writeId.");const i=e.allWrites[n];e.allWrites.splice(n,1);let r=i.visible,o=!1,a=e.allWrites.length-1;for(;r&&a>=0;){const t=e.allWrites[a];t.visible&&(a>=n&&nn(t,i.path)?r=!1:Ce(i.path,t.path)&&(o=!0)),a--}if(r){if(o)return function(e){e.visibleWrites=sn(e.allWrites,rn,me()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;if(i.snap)e.visibleWrites=Wt(e.visibleWrites,i.path);else{L(i.children,(t=>{e.visibleWrites=Wt(e.visibleWrites,Se(i.path,t))}))}return!0}return!1}function nn(e,t){if(e.snap)return Ce(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&Ce(Se(e.path,n),t))return!0;return!1}function rn(e){return e.visible}function sn(e,t,n){let i=$t.empty();for(let r=0;r<e.length;++r){const o=e[r];if(t(o)){const e=o.path;let t;if(o.snap)Ce(n,e)?(t=Ee(n,e),i=qt(i,t,o.snap)):Ce(e,n)&&(t=Ee(e,n),i=qt(i,me(),o.snap.getChild(t)));else{if(!o.children)throw(0,s.g5)("WriteRecord should have .snap or .children");if(Ce(n,e))t=Ee(n,e),i=Gt(i,t,o.children);else if(Ce(e,n))if(t=Ee(e,n),Te(t))i=Gt(i,me(),o.children);else{const e=(0,s.DV)(o.children,ge(t));if(e){const n=e.getChild(ye(t));i=qt(i,me(),n)}}}}}return i}function on(e,t,n,i,r){if(i||r){const s=Qt(e.visibleWrites,t);if(!r&&Yt(s))return n;if(r||null!=n||Ht(s,me())){const s=function(e){return(e.visible||r)&&(!i||!~i.indexOf(e.writeId))&&(Ce(e.path,t)||Ce(t,e.path))};return Zt(sn(e.allWrites,s,t),n||rt.EMPTY_NODE)}return null}{const i=Kt(e.visibleWrites,t);if(null!=i)return i;{const i=Qt(e.visibleWrites,t);if(Yt(i))return n;if(null!=n||Ht(i,me())){return Zt(i,n||rt.EMPTY_NODE)}return null}}}function an(e,t,n,i){return on(e.writeTree,e.treePath,t,n,i)}function ln(e,t){return function(e,t,n){let i=rt.EMPTY_NODE;const r=Kt(e.visibleWrites,t);if(r)return r.isLeafNode()||r.forEachChild(Qe,((e,t)=>{i=i.updateImmediateChild(e,t)})),i;if(n){const r=Qt(e.visibleWrites,t);return n.forEachChild(Qe,((e,t)=>{const n=Zt(Qt(r,new fe(e)),t);i=i.updateImmediateChild(e,n)})),Jt(r).forEach((e=>{i=i.updateImmediateChild(e.name,e.node)})),i}return Jt(Qt(e.visibleWrites,t)).forEach((e=>{i=i.updateImmediateChild(e.name,e.node)})),i}(e.writeTree,e.treePath,t)}function cn(e,t,n,i){return function(e,t,n,i,r){(0,s.hu)(i||r,"Either existingEventSnap or existingServerSnap must exist");const o=Se(t,n);if(Ht(e.visibleWrites,o))return null;{const t=Qt(e.visibleWrites,o);return Yt(t)?r.getChild(n):Zt(t,r.getChild(n))}}(e.writeTree,e.treePath,t,n,i)}function un(e,t){return function(e,t){return Kt(e.visibleWrites,t)}(e.writeTree,Se(e.treePath,t))}function dn(e,t,n,i,r,s){return function(e,t,n,i,r,s,o){let a;const l=Qt(e.visibleWrites,t),c=Kt(l,me());if(null!=c)a=c;else{if(null==n)return[];a=Zt(l,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let l=n.getNext();for(;l&&e.length<r;)0!==t(l,i)&&e.push(l),l=n.getNext();return e}}(e.writeTree,e.treePath,t,n,i,r,s)}function hn(e,t,n){return function(e,t,n,i){const r=Se(t,n),s=Kt(e.visibleWrites,r);if(null!=s)return s;if(i.isCompleteForChild(n))return Zt(Qt(e.visibleWrites,r),i.getNode().getImmediateChild(n));return null}(e.writeTree,e.treePath,t,n)}function pn(e,t){return fn(Se(e.treePath,t),e.writeTree)}function fn(e,t){return{treePath:e,writeTree:t}}class mn{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;(0,s.hu)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),(0,s.hu)(".priority"!==n,"Only non-priority child changes can be tracked.");const i=this.changeMap.get(n);if(i){const r=i.type;if("child_added"===t&&"child_removed"===r)this.changeMap.set(n,pt(n,e.snapshotNode,i.snapshotNode));else if("child_removed"===t&&"child_added"===r)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===r)this.changeMap.set(n,ht(n,i.oldSnap));else if("child_changed"===t&&"child_added"===r)this.changeMap.set(n,dt(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==r)throw(0,s.g5)("Illegal combination of changes: "+e+" occurred after "+i);this.changeMap.set(n,pt(n,e.snapshotNode,i.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const gn=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class vn{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new Dt(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return hn(this.writes_,e,t)}}getChildAfterChild(e,t,n){const i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Vt(this.viewCache_),r=dn(this.writes_,i,t,1,n,e);return 0===r.length?null:r[0]}}function yn(e,t,n,i,r){const o=new mn;let a,l;if(n.type===It.OVERWRITE){const c=n;c.source.fromUser?a=wn(e,t,c.path,c.snap,i,r,o):((0,s.hu)(c.source.fromServer,"Unknown source."),l=c.source.tagged||t.serverCache.isFiltered()&&!Te(c.path),a=_n(e,t,c.path,c.snap,i,r,l,o))}else if(n.type===It.MERGE){const c=n;c.source.fromUser?a=function(e,t,n,i,r,s,o){let a=t;return i.foreach(((i,l)=>{const c=Se(n,i);Sn(t,ge(c))&&(a=wn(e,a,c,l,r,s,o))})),i.foreach(((i,l)=>{const c=Se(n,i);Sn(t,ge(c))||(a=wn(e,a,c,l,r,s,o))})),a}(e,t,c.path,c.children,i,r,o):((0,s.hu)(c.source.fromServer,"Unknown source."),l=c.source.tagged||t.serverCache.isFiltered(),a=En(e,t,c.path,c.children,i,r,l,o))}else if(n.type===It.ACK_USER_WRITE){const l=n;a=l.revert?function(e,t,n,i,r,o){let a;if(null!=un(i,n))return t;{const l=new vn(i,t,r),c=t.eventCache.getNode();let u;if(Te(n)||".priority"===ge(n)){let n;if(t.serverCache.isFullyInitialized())n=an(i,Vt(t));else{const e=t.serverCache.getNode();(0,s.hu)(e instanceof rt,"serverChildren would be complete if leaf node"),n=ln(i,e)}u=e.filter.updateFullNode(c,n,o)}else{const r=ge(n);let s=hn(i,r,t.serverCache);null==s&&t.serverCache.isCompleteForChild(r)&&(s=c.getImmediateChild(r)),u=null!=s?e.filter.updateChild(c,r,s,ye(n),l,o):t.eventCache.getNode().hasChild(r)?e.filter.updateChild(c,r,rt.EMPTY_NODE,ye(n),l,o):c,u.isEmpty()&&t.serverCache.isFullyInitialized()&&(a=an(i,Vt(t)),a.isLeafNode()&&(u=e.filter.updateFullNode(u,a,o)))}return a=t.serverCache.isFullyInitialized()||null!=un(i,me()),jt(t,u,a,e.filter.filtersNodes())}}(e,t,l.path,i,r,o):function(e,t,n,i,r,s,o){if(null!=un(r,n))return t;const a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=i.value){if(Te(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return _n(e,t,n,l.getNode().getChild(n),r,s,a,o);if(Te(n)){let i=new zt(null);return l.getNode().forEachChild(je,((e,t)=>{i=i.set(new fe(e),t)})),En(e,t,n,i,r,s,a,o)}return t}{let c=new zt(null);return i.foreach(((e,t)=>{const i=Se(n,e);l.isCompleteForPath(i)&&(c=c.set(e,l.getNode().getChild(i)))})),En(e,t,n,c,r,s,a,o)}}(e,t,l.path,l.affectedTree,i,r,o)}else{if(n.type!==It.LISTEN_COMPLETE)throw(0,s.g5)("Unknown operation type: "+n.type);a=function(e,t,n,i,r){const s=t.serverCache,o=Ut(t,s.getNode(),s.isFullyInitialized()||Te(n),s.isFiltered());return bn(e,o,n,i,gn,r)}(e,t,n.path,i,o)}const c=o.getChanges();return function(e,t,n){const i=t.eventCache;if(i.isFullyInitialized()){const r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=Ft(e);(n.length>0||!e.eventCache.isFullyInitialized()||r&&!i.getNode().equals(s)||!i.getNode().getPriority().equals(s.getPriority()))&&n.push(ut(Ft(t)))}}(t,a,c),{viewCache:a,changes:c}}function bn(e,t,n,i,r,o){const a=t.eventCache;if(null!=un(i,n))return t;{let l,c;if(Te(n))if((0,s.hu)(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=Vt(t),r=ln(i,n instanceof rt?n:rt.EMPTY_NODE);l=e.filter.updateFullNode(t.eventCache.getNode(),r,o)}else{const n=an(i,Vt(t));l=e.filter.updateFullNode(t.eventCache.getNode(),n,o)}else{const u=ge(n);if(".priority"===u){(0,s.hu)(1===ve(n),"Can't have a priority with additional path components");const r=a.getNode();c=t.serverCache.getNode();const o=cn(i,n,r,c);l=null!=o?e.filter.updatePriority(r,o):a.getNode()}else{const s=ye(n);let d;if(a.isCompleteForChild(u)){c=t.serverCache.getNode();const e=cn(i,n,a.getNode(),c);d=null!=e?a.getNode().getImmediateChild(u).updateChild(s,e):a.getNode().getImmediateChild(u)}else d=hn(i,u,t.serverCache);l=null!=d?e.filter.updateChild(a.getNode(),u,d,s,r,o):a.getNode()}}return jt(t,l,a.isFullyInitialized()||Te(n),e.filter.filtersNodes())}}function _n(e,t,n,i,r,s,o,a){const l=t.serverCache;let c;const u=o?e.filter:e.filter.getIndexedFilter();if(Te(n))c=u.updateFullNode(l.getNode(),i,null);else if(u.filtersNodes()&&!l.isFiltered()){const e=l.getNode().updateChild(n,i);c=u.updateFullNode(l.getNode(),e,null)}else{const e=ge(n);if(!l.isCompleteForPath(n)&&ve(n)>1)return t;const r=ye(n),s=l.getNode().getImmediateChild(e).updateChild(r,i);c=".priority"===e?u.updatePriority(l.getNode(),s):u.updateChild(l.getNode(),e,s,r,gn,null)}const d=Ut(t,c,l.isFullyInitialized()||Te(n),u.filtersNodes());return bn(e,d,n,r,new vn(r,d,s),a)}function wn(e,t,n,i,r,s,o){const a=t.eventCache;let l,c;const u=new vn(r,t,s);if(Te(n))c=e.filter.updateFullNode(t.eventCache.getNode(),i,o),l=jt(t,c,!0,e.filter.filtersNodes());else{const r=ge(n);if(".priority"===r)c=e.filter.updatePriority(t.eventCache.getNode(),i),l=jt(t,c,a.isFullyInitialized(),a.isFiltered());else{const s=ye(n),c=a.getNode().getImmediateChild(r);let d;if(Te(s))d=i;else{const e=u.getCompleteChild(r);d=null!=e?".priority"===be(s)&&e.getChild(we(s)).isEmpty()?e:e.updateChild(s,i):rt.EMPTY_NODE}if(c.equals(d))l=t;else{l=jt(t,e.filter.updateChild(a.getNode(),r,d,s,u,o),a.isFullyInitialized(),e.filter.filtersNodes())}}}return l}function Sn(e,t){return e.eventCache.isCompleteForChild(t)}function Tn(e,t,n){return n.foreach(((e,n)=>{t=t.updateChild(e,n)})),t}function En(e,t,n,i,r,s,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let l,c=t;l=Te(n)?i:new zt(null).setTree(n,i);const u=t.serverCache.getNode();return l.children.inorderTraversal(((n,i)=>{if(u.hasChild(n)){const l=Tn(0,t.serverCache.getNode().getImmediateChild(n),i);c=_n(e,c,new fe(n),l,r,s,o,a)}})),l.children.inorderTraversal(((n,i)=>{const l=!t.serverCache.isCompleteForChild(n)&&null===i.value;if(!u.hasChild(n)&&!l){const l=Tn(0,t.serverCache.getNode().getImmediateChild(n),i);c=_n(e,c,new fe(n),l,r,s,o,a)}})),c}class kn{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,i=new ft(n.getIndex()),r=(s=n).loadsAllData()?new ft(s.getIndex()):s.hasLimit()?new gt(s):new mt(s);var s;this.processor_=function(e){return{filter:e}}(r);const o=t.serverCache,a=t.eventCache,l=i.updateFullNode(rt.EMPTY_NODE,o.getNode(),null),c=r.updateFullNode(rt.EMPTY_NODE,a.getNode(),null),u=new Dt(l,o.isFullyInitialized(),i.filtersNodes()),d=new Dt(c,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=Mt(d,u),this.eventGenerator_=new Ot(this.query_)}get query(){return this.query_}}function Cn(e,t){const n=Vt(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!Te(t)&&!n.getImmediateChild(ge(t)).isEmpty())?n.getChild(t):null}function In(e){return 0===e.eventRegistrations_.length}function Rn(e,t,n){const i=[];if(n){(0,s.hu)(null==t,"A cancel should cancel all event registrations.");const r=e.query._path;e.eventRegistrations_.forEach((e=>{const t=e.createCancelEvent(n,r);t&&i.push(t)}))}if(t){let n=[];for(let i=0;i<e.eventRegistrations_.length;++i){const r=e.eventRegistrations_[i];if(r.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(i+1));break}}else n.push(r)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return i}function Pn(e,t,n,i){t.type===It.MERGE&&null!==t.source.queryId&&((0,s.hu)(Vt(e.viewCache_),"We should always have a full cache before handling merges"),(0,s.hu)(Ft(e.viewCache_),"Missing event cache, even though we have a server cache"));const r=e.viewCache_,o=yn(e.processor_,r,t,n,i);var a,l;return a=e.processor_,l=o.viewCache,(0,s.hu)(l.eventCache.getNode().isIndexed(a.filter.getIndex()),"Event snap not indexed"),(0,s.hu)(l.serverCache.getNode().isIndexed(a.filter.getIndex()),"Server snap not indexed"),(0,s.hu)(o.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=o.viewCache,An(e,o.changes,o.viewCache.eventCache.getNode(),null)}function An(e,t,n,i){const r=i?[i]:e.eventRegistrations_;return function(e,t,n,i){const r=[],s=[];return t.forEach((t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),Lt(e,r,"child_removed",t,i,n),Lt(e,r,"child_added",t,i,n),Lt(e,r,"child_moved",s,i,n),Lt(e,r,"child_changed",t,i,n),Lt(e,r,"value",t,i,n),r}(e.eventGenerator_,t,n,r)}let Nn,xn;class Dn{constructor(){this.views=new Map}}function On(e,t,n,i){const r=t.source.queryId;if(null!==r){const o=e.views.get(r);return(0,s.hu)(null!=o,"SyncTree gave us an op for an invalid query."),Pn(o,t,n,i)}{let r=[];for(const s of e.views.values())r=r.concat(Pn(s,t,n,i));return r}}function Ln(e,t,n,i,r){const s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=an(n,r?i:null),s=!1;e?s=!0:i instanceof rt?(e=ln(n,i),s=!1):(e=rt.EMPTY_NODE,s=!1);const o=Mt(new Dt(e,s,!1),new Dt(i,r,!1));return new kn(t,o)}return o}function Mn(e,t,n,i,r,s){const o=Ln(e,t,i,r,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),function(e,t){e.eventRegistrations_.push(t)}(o,n),function(e,t){const n=e.viewCache_.eventCache,i=[];n.getNode().isLeafNode()||n.getNode().forEachChild(Qe,((e,t)=>{i.push(dt(e,t))}));return n.isFullyInitialized()&&i.push(ut(n.getNode())),An(e,i,n.getNode(),t)}(o,n)}function jn(e,t,n,i){const r=t._queryIdentifier,o=[];let a=[];const l=zn(e);if("default"===r)for(const[t,r]of e.views.entries())a=a.concat(Rn(r,n,i)),In(r)&&(e.views.delete(t),r.query._queryParams.loadsAllData()||o.push(r.query));else{const t=e.views.get(r);t&&(a=a.concat(Rn(t,n,i)),In(t)&&(e.views.delete(r),t.query._queryParams.loadsAllData()||o.push(t.query)))}return l&&!zn(e)&&o.push(new((0,s.hu)(Nn,"Reference.ts has not been loaded"),Nn)(t._repo,t._path)),{removed:o,events:a}}function Un(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function Fn(e,t){let n=null;for(const i of e.views.values())n=n||Cn(i,t);return n}function Vn(e,t){if(t._queryParams.loadsAllData())return $n(e);{const n=t._queryIdentifier;return e.views.get(n)}}function Bn(e,t){return null!=Vn(e,t)}function zn(e){return null!=$n(e)}function $n(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let qn=1;class Gn{constructor(e){this.listenProvider_=e,this.syncPointTree_=new zt(null),this.pendingWriteTree_={visibleWrites:$t.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Wn(e,t,n,i,r){return function(e,t,n,i,r){(0,s.hu)(i>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),e.allWrites.push({path:t,snap:n,writeId:i,visible:r}),r&&(e.visibleWrites=qt(e.visibleWrites,t,n)),e.lastWriteId=i}(e.pendingWriteTree_,t,n,i,r),r?ei(e,new Nt({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function Hn(e,t,n=!1){const i=function(e,t){for(let n=0;n<e.allWrites.length;n++){const i=e.allWrites[n];if(i.writeId===t)return i}return null}(e.pendingWriteTree_,t);if(tn(e.pendingWriteTree_,t)){let t=new zt(null);return null!=i.snap?t=t.set(me(),!0):L(i.children,(e=>{t=t.set(new fe(e),!0)})),ei(e,new Pt(i.path,t,n))}return[]}function Kn(e,t,n){return ei(e,new Nt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function Jn(e,t,n,i,r=!1){const s=t._path,o=e.syncPointTree_.get(s);let a=[];if(o&&("default"===t._queryIdentifier||Bn(o,t))){const l=jn(o,t,n,i);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));const c=l.removed;if(a=l.events,!r){const n=-1!==c.findIndex((e=>e._queryParams.loadsAllData())),r=e.syncPointTree_.findOnPath(s,((e,t)=>zn(t)));if(n&&!r){const t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){const n=function(e){return e.fold(((e,t,n)=>{if(t&&zn(t)){return[$n(t)]}{let e=[];return t&&(e=Un(t)),L(n,((t,n)=>{e=e.concat(n)})),e}}))}(t);for(let t=0;t<n.length;++t){const i=n[t],r=i.query,s=ii(e,i);e.listenProvider_.startListening(ci(r),ri(e,r),s.hashFn,s.onComplete)}}}if(!r&&c.length>0&&!i)if(n){const n=null;e.listenProvider_.stopListening(ci(t),n)}else c.forEach((t=>{const n=e.queryToTagMap.get(si(t));e.listenProvider_.stopListening(ci(t),n)}))}!function(e,t){for(let n=0;n<t.length;++n){const i=t[n];if(!i._queryParams.loadsAllData()){const t=si(i),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}}(e,c)}return a}function Qn(e,t,n,i){const r=oi(e,i);if(null!=r){const i=ai(r),s=i.path,o=i.queryId,a=Ee(s,t);return li(e,s,new Nt(Rt(o),a,n))}return[]}function Yn(e,t,n,i=!1){const r=t._path;let o=null,a=!1;e.syncPointTree_.foreachOnPath(r,((e,t)=>{const n=Ee(e,r);o=o||Fn(t,n),a=a||zn(t)}));let l,c=e.syncPointTree_.get(r);if(c?(a=a||zn(c),o=o||Fn(c,me())):(c=new Dn,e.syncPointTree_=e.syncPointTree_.set(r,c)),null!=o)l=!0;else{l=!1,o=rt.EMPTY_NODE;e.syncPointTree_.subtree(r).foreachChild(((e,t)=>{const n=Fn(t,me());n&&(o=o.updateImmediateChild(e,n))}))}const u=Bn(c,t);if(!u&&!t._queryParams.loadsAllData()){const n=si(t);(0,s.hu)(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");const i=qn++;e.queryToTagMap.set(n,i),e.tagToQueryMap.set(i,n)}let d=Mn(c,t,n,en(e.pendingWriteTree_,r),o,l);if(!u&&!a&&!i){const n=Vn(c,t);d=d.concat(function(e,t,n){const i=t._path,r=ri(e,t),o=ii(e,n),a=e.listenProvider_.startListening(ci(t),r,o.hashFn,o.onComplete),l=e.syncPointTree_.subtree(i);if(r)(0,s.hu)(!zn(l.value),"If we're adding a query, it shouldn't be shadowed");else{const t=l.fold(((e,t,n)=>{if(!Te(e)&&t&&zn(t))return[$n(t).query];{let e=[];return t&&(e=e.concat(Un(t).map((e=>e.query)))),L(n,((t,n)=>{e=e.concat(n)})),e}}));for(let n=0;n<t.length;++n){const i=t[n];e.listenProvider_.stopListening(ci(i),ri(e,i))}}return a}(e,t,n))}return d}function Zn(e,t,n){const i=e.pendingWriteTree_,r=e.syncPointTree_.findOnPath(t,((e,n)=>{const i=Fn(n,Ee(e,t));if(i)return i}));return on(i,t,r,n,!0)}function Xn(e,t){const n=t._path;let i=null;e.syncPointTree_.foreachOnPath(n,((e,t)=>{const r=Ee(e,n);i=i||Fn(t,r)}));let r=e.syncPointTree_.get(n);r?i=i||Fn(r,me()):(r=new Dn,e.syncPointTree_=e.syncPointTree_.set(n,r));const s=null!=i,o=s?new Dt(i,!0,!1):null;return function(e){return Ft(e.viewCache_)}(Ln(r,t,en(e.pendingWriteTree_,t._path),s?o.getNode():rt.EMPTY_NODE,s))}function ei(e,t){return ti(t,e.syncPointTree_,null,en(e.pendingWriteTree_,me()))}function ti(e,t,n,i){if(Te(e.path))return ni(e,t,n,i);{const r=t.get(me());null==n&&null!=r&&(n=Fn(r,me()));let s=[];const o=ge(e.path),a=e.operationForChild(o),l=t.children.get(o);if(l&&a){const e=n?n.getImmediateChild(o):null,t=pn(i,o);s=s.concat(ti(a,l,e,t))}return r&&(s=s.concat(On(r,e,i,n))),s}}function ni(e,t,n,i){const r=t.get(me());null==n&&null!=r&&(n=Fn(r,me()));let s=[];return t.children.inorderTraversal(((t,r)=>{const o=n?n.getImmediateChild(t):null,a=pn(i,t),l=e.operationForChild(t);l&&(s=s.concat(ni(l,r,o,a)))})),r&&(s=s.concat(On(r,e,i,n))),s}function ii(e,t){const n=t.query,i=ri(e,n);return{hashFn:()=>{const e=function(e){return e.viewCache_.serverCache.getNode()}(t)||rt.EMPTY_NODE;return e.hash()},onComplete:t=>{if("ok"===t)return i?function(e,t,n){const i=oi(e,n);if(i){const n=ai(i),r=n.path,s=n.queryId,o=Ee(r,t);return li(e,r,new At(Rt(s),o))}return[]}(e,n._path,i):function(e,t){return ei(e,new At({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,n._path);{const i=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const i=new Error(e+" at "+t._path.toString()+": "+n);return i.code=e.toUpperCase(),i}(t,n);return Jn(e,n,null,i)}}}}function ri(e,t){const n=si(t);return e.queryToTagMap.get(n)}function si(e){return e._path.toString()+"$"+e._queryIdentifier}function oi(e,t){return e.tagToQueryMap.get(t)}function ai(e){const t=e.indexOf("$");return(0,s.hu)(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new fe(e.substr(0,t))}}function li(e,t,n){const i=e.syncPointTree_.get(t);(0,s.hu)(i,"Missing sync point for query tag that we're tracking");return On(i,n,en(e.pendingWriteTree_,t),null)}function ci(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new((0,s.hu)(xn,"Reference.ts has not been loaded"),xn)(e._repo,e._path):e}class ui{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new ui(t)}node(){return this.node_}}class di{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Se(this.path_,e);return new di(this.syncTree_,t)}node(){return Zn(this.syncTree_,this.path_)}}const hi=function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e},pi=function(e,t,n){return e&&"object"==typeof e?((0,s.hu)(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?fi(e[".sv"],t,n):"object"==typeof e[".sv"]?mi(e[".sv"],t):void(0,s.hu)(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},fi=function(e,t,n){if("timestamp"===e)return n.timestamp;(0,s.hu)(!1,"Unexpected server value: "+e)},mi=function(e,t,n){e.hasOwnProperty("increment")||(0,s.hu)(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const i=e.increment;"number"!=typeof i&&(0,s.hu)(!1,"Unexpected increment value: "+i);const r=t.node();if((0,s.hu)(null!=r,"Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;const o=r.getValue();return"number"!=typeof o?i:o+i},gi=function(e,t,n,i){return yi(t,new di(n,e),i)},vi=function(e,t,n){return yi(e,new ui(t),n)};function yi(e,t,n){const i=e.getPriority().val(),r=pi(i,t.getImmediateChild(".priority"),n);let s;if(e.isLeafNode()){const i=e,s=pi(i.getValue(),t,n);return s!==i.getValue()||r!==i.getPriority().val()?new Je(s,at(r)):e}{const i=e;return s=i,r!==i.getPriority().val()&&(s=s.updatePriority(new Je(r))),i.forEachChild(Qe,((e,i)=>{const r=yi(i,t.getImmediateChild(e),n);r!==i&&(s=s.updateImmediateChild(e,r))})),s}}class bi{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function _i(e,t){let n=t instanceof fe?t:new fe(t),i=e,r=ge(n);for(;null!==r;){const e=(0,s.DV)(i.node.children,r)||{children:{},childCount:0};i=new bi(r,i,e),n=ye(n),r=ge(n)}return i}function wi(e){return e.node.value}function Si(e,t){e.node.value=t,Ii(e)}function Ti(e){return e.node.childCount>0}function Ei(e,t){L(e.node.children,((n,i)=>{t(new bi(n,e,i))}))}function ki(e,t,n,i){n&&!i&&t(e),Ei(e,(e=>{ki(e,t,!0,i)})),n&&i&&t(e)}function Ci(e){return new fe(null===e.parent?e.name:Ci(e.parent)+"/"+e.name)}function Ii(e){null!==e.parent&&function(e,t,n){const i=function(e){return void 0===wi(e)&&!Ti(e)}(n),r=(0,s.r3)(e.node.children,t);i&&r?(delete e.node.children[t],e.node.childCount--,Ii(e)):i||r||(e.node.children[t]=n.node,e.node.childCount++,Ii(e))}(e.parent,e.name,e)}const Ri=/[\[\].#$\/\u0000-\u001F\u007F]/,Pi=/[\[\].#$\u0000-\u001F\u007F]/,Ai=10485760,Ni=function(e){return"string"==typeof e&&0!==e.length&&!Ri.test(e)},xi=function(e){return"string"==typeof e&&0!==e.length&&!Pi.test(e)},Di=function(e,t,n,i){i&&void 0===t||Oi((0,s.gK)(e,"value"),t,n)},Oi=function(e,t,n){const i=n instanceof fe?new Ie(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+Pe(i));if("function"==typeof t)throw new Error(e+"contains a function "+Pe(i)+" with contents = "+t.toString());if(I(t))throw new Error(e+"contains "+t.toString()+" "+Pe(i));if("string"==typeof t&&t.length>Ai/3&&(0,s.ug)(t)>Ai)throw new Error(e+"contains a string greater than "+Ai+" utf8 bytes "+Pe(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,r=!1;if(L(t,((t,o)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(r=!0,!Ni(t)))throw new Error(e+" contains an invalid key ("+t+") "+Pe(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=(0,s.ug)(t),Re(e)}(i,t),Oi(e,o,i),function(e){const t=e.parts_.pop();e.byteLength_-=(0,s.ug)(t),e.parts_.length>0&&(e.byteLength_-=1)}(i)})),n&&r)throw new Error(e+' contains ".value" child '+Pe(i)+" in addition to actual children.")}},Li=function(e,t,n,i){if(!(i&&void 0===n||xi(n)))throw new Error((0,s.gK)(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Mi=function(e,t,n,i){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Li(e,t,n,i)},ji=function(e,t){if(".info"===ge(t))throw new Error(e+" failed = Can't modify data under /.info/")},Ui=function(e,t){const n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Ni(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),xi(e)}(n))throw new Error((0,s.gK)(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class Fi{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Vi(e,t){let n=null;for(let i=0;i<t.length;i++){const r=t[i],s=r.getPath();null===n||ke(s,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(r)}n&&e.eventLists_.push(n)}function Bi(e,t,n){Vi(e,n),$i(e,(e=>ke(e,t)))}function zi(e,t,n){Vi(e,n),$i(e,(e=>Ce(e,t)||Ce(t,e)))}function $i(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){const r=e.eventLists_[i];if(r){t(r.path)?(qi(e.eventLists_[i]),e.eventLists_[i]=null):n=!1}}n&&(e.eventLists_=[]),e.recursionDepth_--}function qi(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const i=n.getEventRunner();b&&S("event: "+n.toString()),F(i)}}}const Gi="repo_interrupt",Wi=25;class Hi{constructor(e,t,n,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Fi,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=St(),this.transactionQueueTree_=new bi,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Ki(e,t,n){if(e.stats_=ee(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new _t(e.repoInfo_,((t,n,i,r)=>{Yi(e,t,n,i,r)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((()=>Zi(e,!0)),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,s.Wl)(n)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new xe(e.repoInfo_,t,((t,n,i,r)=>{Yi(e,t,n,i,r)}),(t=>{Zi(e,t)}),(t=>{!function(e,t){L(t,((t,n)=>{Xi(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((t=>{e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((t=>{e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=function(e,t){const n=e.toString();return X[n]||(X[n]=t()),X[n]}(e.repoInfo_,(()=>new Ct(e.stats_,e.server_))),e.infoData_=new wt,e.infoSyncTree_=new Gn({startListening:(t,n,i,r)=>{let s=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=Kn(e.infoSyncTree_,t._path,o),setTimeout((()=>{r("ok")}),0)),s},stopListening:()=>{}}),Xi(e,"connected",!1),e.serverSyncTree_=new Gn({startListening:(t,n,i,r)=>(e.server_.listen(t,i,n,((n,i)=>{const s=r(n,i);zi(e.eventQueue_,t._path,s)})),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function Ji(e){const t=e.infoData_.getNode(new fe(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function Qi(e){return hi({timestamp:Ji(e)})}function Yi(e,t,n,i,r){e.dataUpdateCount++;const o=new fe(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let a=[];if(r)if(i){const t=(0,s.UI)(n,(e=>at(e)));a=function(e,t,n,i){const r=oi(e,i);if(r){const i=ai(r),s=i.path,o=i.queryId,a=Ee(s,t),l=zt.fromObject(n);return li(e,s,new xt(Rt(o),a,l))}return[]}(e.serverSyncTree_,o,t,r)}else{const t=at(n);a=Qn(e.serverSyncTree_,o,t,r)}else if(i){const t=(0,s.UI)(n,(e=>at(e)));a=function(e,t,n){const i=zt.fromObject(n);return ei(e,new xt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,i))}(e.serverSyncTree_,o,t)}else{const t=at(n);a=Kn(e.serverSyncTree_,o,t)}let l=o;a.length>0&&(l=lr(e,o)),zi(e.eventQueue_,l,a)}function Zi(e,t){Xi(e,"connected",t),!1===t&&function(e){rr(e,"onDisconnectEvents");const t=Qi(e),n=St();Et(e.onDisconnect_,me(),((i,r)=>{const s=gi(i,r,e.serverSyncTree_,t);Tt(n,i,s)}));let i=[];Et(n,me(),((t,n)=>{i=i.concat(Kn(e.serverSyncTree_,t,n));const r=pr(e,t);lr(e,r)})),e.onDisconnect_=St(),zi(e.eventQueue_,me(),i)}(e)}function Xi(e,t,n){const i=new fe("/.info/"+t),r=at(n);e.infoData_.updateSnapshot(i,r);const s=Kn(e.infoSyncTree_,i,r);zi(e.eventQueue_,i,s)}function er(e){return e.nextWriteId_++}function tr(e,t,n,i,r){rr(e,"set",{path:t.toString(),value:n,priority:i});const s=Qi(e),o=at(n,i),a=Zn(e.serverSyncTree_,t),l=vi(o,a,s),c=er(e),u=Wn(e.serverSyncTree_,t,l,c,!0);Vi(e.eventQueue_,u),e.server_.put(t.toString(),o.val(!0),((n,i)=>{const s="ok"===n;s||C("set at "+t+" failed: "+n);const o=Hn(e.serverSyncTree_,c,!s);zi(e.eventQueue_,t,o),sr(e,r,n,i)}));const d=pr(e,t);lr(e,d),zi(e.eventQueue_,d,[])}function nr(e,t,n){let i;i=".info"===ge(t._path)?Jn(e.infoSyncTree_,t,n):Jn(e.serverSyncTree_,t,n),Bi(e.eventQueue_,t._path,i)}function ir(e){e.persistentConnection_&&e.persistentConnection_.interrupt(Gi)}function rr(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),S(n,...t)}function sr(e,t,n,i){t&&F((()=>{if("ok"===n)t(null);else{const e=(n||"error").toUpperCase();let r=e;i&&(r+=": "+i);const s=new Error(r);s.code=e,t(s)}}))}function or(e,t,n){return Zn(e.serverSyncTree_,t,n)||rt.EMPTY_NODE}function ar(e,t=e.transactionQueueTree_){if(t||hr(e,t),wi(t)){const n=ur(e,t);(0,s.hu)(n.length>0,"Sending zero length transaction queue");n.every((e=>0===e.status))&&function(e,t,n){const i=n.map((e=>e.currentWriteId)),r=or(e,t,i);let o=r;const a=r.hash();for(let e=0;e<n.length;e++){const i=n[e];(0,s.hu)(0===i.status,"tryToSendTransactionQueue_: items in queue should all be run."),i.status=1,i.retryCount++;const r=Ee(t,i.path);o=o.updateChild(r,i.currentOutputSnapshotRaw)}const l=o.val(!0),c=t;e.server_.put(c.toString(),l,(i=>{rr(e,"transaction put response",{path:c.toString(),status:i});let r=[];if("ok"===i){const i=[];for(let t=0;t<n.length;t++)n[t].status=2,r=r.concat(Hn(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&i.push((()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved))),n[t].unwatcher();hr(e,_i(e.transactionQueueTree_,t)),ar(e,e.transactionQueueTree_),zi(e.eventQueue_,t,r);for(let e=0;e<i.length;e++)F(i[e])}else{if("datastale"===i)for(let e=0;e<n.length;e++)3===n[e].status?n[e].status=4:n[e].status=0;else{C("transaction at "+c.toString()+" failed: "+i);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=i}lr(e,t)}}),a)}(e,Ci(t),n)}else Ti(t)&&Ei(t,(t=>{ar(e,t)}))}function lr(e,t){const n=cr(e,t),i=Ci(n);return function(e,t,n){if(0===t.length)return;const i=[];let r=[];const o=t.filter((e=>0===e.status)),a=o.map((e=>e.currentWriteId));for(let o=0;o<t.length;o++){const c=t[o],u=Ee(n,c.path);let d,h=!1;if((0,s.hu)(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),4===c.status)h=!0,d=c.abortReason,r=r.concat(Hn(e.serverSyncTree_,c.currentWriteId,!0));else if(0===c.status)if(c.retryCount>=Wi)h=!0,d="maxretry",r=r.concat(Hn(e.serverSyncTree_,c.currentWriteId,!0));else{const n=or(e,c.path,a);c.currentInputSnapshot=n;const i=t[o].update(n.val());if(void 0!==i){Oi("transaction failed: Data returned ",i,c.path);let t=at(i);"object"==typeof i&&null!=i&&(0,s.r3)(i,".priority")||(t=t.updatePriority(n.getPriority()));const o=c.currentWriteId,l=Qi(e),u=vi(t,n,l);c.currentOutputSnapshotRaw=t,c.currentOutputSnapshotResolved=u,c.currentWriteId=er(e),a.splice(a.indexOf(o),1),r=r.concat(Wn(e.serverSyncTree_,c.path,u,c.currentWriteId,c.applyLocally)),r=r.concat(Hn(e.serverSyncTree_,o,!0))}else h=!0,d="nodata",r=r.concat(Hn(e.serverSyncTree_,c.currentWriteId,!0))}zi(e.eventQueue_,n,r),r=[],h&&(t[o].status=2,l=t[o].unwatcher,setTimeout(l,Math.floor(0)),t[o].onComplete&&("nodata"===d?i.push((()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot))):i.push((()=>t[o].onComplete(new Error(d),!1,null)))))}var l;hr(e,e.transactionQueueTree_);for(let e=0;e<i.length;e++)F(i[e]);ar(e,e.transactionQueueTree_)}(e,ur(e,n),i),i}function cr(e,t){let n,i=e.transactionQueueTree_;for(n=ge(t);null!==n&&void 0===wi(i);)i=_i(i,n),n=ge(t=ye(t));return i}function ur(e,t){const n=[];return dr(e,t,n),n.sort(((e,t)=>e.order-t.order)),n}function dr(e,t,n){const i=wi(t);if(i)for(let e=0;e<i.length;e++)n.push(i[e]);Ei(t,(t=>{dr(e,t,n)}))}function hr(e,t){const n=wi(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,Si(t,n.length>0?n:void 0)}Ei(t,(t=>{hr(e,t)}))}function pr(e,t){const n=Ci(cr(e,t)),i=_i(e.transactionQueueTree_,t);return function(e,t,n){let i=n?e:e.parent;for(;null!==i;){if(t(i))return!0;i=i.parent}}(i,(t=>{fr(e,t)})),fr(e,i),ki(i,(t=>{fr(e,t)})),n}function fr(e,t){const n=wi(t);if(n){const i=[];let r=[],o=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?((0,s.hu)(o===t-1,"All SENT items should be at beginning of queue."),o=t,n[t].status=3,n[t].abortReason="set"):((0,s.hu)(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),r=r.concat(Hn(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&i.push(n[t].onComplete.bind(null,new Error("set"),!1,null))));-1===o?Si(t,void 0):n.length=o+1,zi(e.eventQueue_,Ci(t),r);for(let e=0;e<i.length;e++)F(i[e])}}const mr=function(e,t){const n=gr(e),i=n.namespace;"firebase.com"===n.domain&&k(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||k("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&C("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const r="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new J(n.host,n.secure,i,r,t,"",i!==n.subdomain),path:new fe(n.pathString)}},gr=function(e){let t="",n="",i="",r="",s="",o=!0,a="https",l=443;if("string"==typeof e){let c=e.indexOf("//");c>=0&&(a=e.substring(0,c-1),e=e.substring(c+2));let u=e.indexOf("/");-1===u&&(u=e.length);let d=e.indexOf("?");-1===d&&(d=e.length),t=e.substring(0,Math.min(u,d)),u<d&&(r=function(e){let t="";const n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let i=n[e];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(u,d)));const h=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const i=n.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):C(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,d)));c=t.indexOf(":"),c>=0?(o="https"===a||"wss"===a,l=parseInt(t.substring(c+1),10)):c=t.length;const p=t.slice(0,c);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{const e=t.indexOf(".");i=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=i}"ns"in h&&(s=h.ns)}return{host:t,port:l,domain:n,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}},vr="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz";!function(){let e=0;const t=[]}();class yr{constructor(e,t,n,i){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=i}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+(0,s.Wl)(this.snapshot.exportVal())}}class br{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class _r{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return(0,s.hu)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class wr{constructor(e,t,n,i){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=i}get key(){return Te(this._path)?null:be(this._path)}get ref(){return new Sr(this._repo,this._path)}get _queryIdentifier(){const e=bt(this._queryParams),t=D(e);return"{}"===t?"default":t}get _queryObject(){return bt(this._queryParams)}isEqual(e){if(!((e=(0,s.m9)(e))instanceof wr))return!1;const t=this._repo===e._repo,n=ke(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class Sr extends wr{constructor(e,t){super(e,t,new vt,!1)}get parent(){const e=we(this._path);return null===e?null:new Sr(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class Tr{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new fe(e),n=kr(this.ref,e);return new Tr(this._node.getChild(t),n,Qe)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){if(this._node.isLeafNode())return!1;return!!this._node.forEachChild(this._index,((t,n)=>e(new Tr(n,kr(this.ref,t),Qe))))}hasChild(e){const t=new fe(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Er(e,t){return(e=(0,s.m9)(e))._checkNotDeleted("ref"),void 0!==t?kr(e._root,t):e._root}function kr(e,t){return null===ge((e=(0,s.m9)(e))._path)?Mi("child","path",t,!1):Li("child","path",t,!1),new Sr(e._repo,Se(e._path,t))}function Cr(e,t){e=(0,s.m9)(e),ji("set",e._path),Di("set",t,e._path,!1);const n=new s.BH;return tr(e._repo,e._path,t,null,n.wrapCallback((()=>{}))),n.promise}function Ir(e){e=(0,s.m9)(e);const t=new _r((()=>{})),n=new Rr(t);return function(e,t,n){const i=Xn(e.serverSyncTree_,t);return null!=i?Promise.resolve(i):e.server_.get(t).then((i=>{const r=at(i).withIndex(t._queryParams.getIndex());let s;if(Yn(e.serverSyncTree_,t,n,!0),t._queryParams.loadsAllData())s=Kn(e.serverSyncTree_,t._path,r);else{const n=ri(e.serverSyncTree_,t);s=Qn(e.serverSyncTree_,t._path,r,n)}return zi(e.eventQueue_,t._path,s),Jn(e.serverSyncTree_,t,n,null,!0),r}),(n=>(rr(e,"get for query "+(0,s.Wl)(t)+" failed: "+n),Promise.reject(new Error(n)))))}(e._repo,e,n).then((t=>new Tr(t,new Sr(e._repo,e._path),e._queryParams.getIndex())))}class Rr{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const n=t._queryParams.getIndex();return new yr("value",this,new Tr(e.snapshotNode,new Sr(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new br(this,e,t):null}matches(e){return e instanceof Rr&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class Pr{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new br(this,e,t):null}createEvent(e,t){(0,s.hu)(null!=e.childName,"Child events should have a childName.");const n=kr(new Sr(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new yr(e.type,this,new Tr(e.snapshotNode,n,i),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof Pr&&(this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)))}hasAnyCallback(){return!!this.callbackContext}}function Ar(e,t,n,i,r){let s;if("object"==typeof i&&(s=void 0,r=i),"function"==typeof i&&(s=i),r&&r.onlyOnce){const t=n,i=(n,i)=>{nr(e._repo,e,a),t(n,i)};i.userCallback=n.userCallback,i.context=n.context,n=i}const o=new _r(n,s||void 0),a="value"===t?new Rr(o):new Pr(t,o);return function(e,t,n){let i;i=".info"===ge(t._path)?Yn(e.infoSyncTree_,t,n):Yn(e.serverSyncTree_,t,n),Bi(e.eventQueue_,t._path,i)}(e._repo,e,a),()=>nr(e._repo,e,a)}function Nr(e,t,n,i){return Ar(e,"value",t,n,i)}function xr(e,t,n,i){return Ar(e,"child_added",t,n,i)}!function(e){(0,s.hu)(!Nn,"__referenceConstructor has already been defined"),Nn=e}(Sr),function(e){(0,s.hu)(!xn,"__referenceConstructor has already been defined"),xn=e}(Sr);const Dr="FIREBASE_DATABASE_EMULATOR_HOST",Or={};let Lr=!1;function Mr(e,t,n,i,r){let s=i||e.options.databaseURL;void 0===s&&(e.options.projectId||k("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),S("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,a,l=mr(s,r),c=l.repoInfo;"undefined"!=typeof process&&process.env&&(a=process.env[Dr]),a?(o=!0,s=`http://${a}?ns=${c.namespace}`,l=mr(s,r),c=l.repoInfo):o=!l.repoInfo.secure;const u=r&&o?new $($.OWNER):new z(e.name,e.options,t);Ui("Invalid Firebase Database URL",l),Te(l.path)||k("Database URL must point to the root of a Firebase Database (not including a child path).");const d=function(e,t,n,i){let r=Or[t.name];r||(r={},Or[t.name]=r);let s=r[e.toURLString()];s&&k("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return s=new Hi(e,Lr,n,i),r[e.toURLString()]=s,s}(c,e,u,new B(e.name,n));return new jr(d,e)}class jr{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Ki(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Sr(this._repo,me())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(e,t){const n=Or[t];n&&n[e.key]===e||k(`Database ${t}(${e.repoInfo_}) has already been deleted.`),ir(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&k("Cannot call "+e+" on a deleted database.")}}function Ur(e=(0,i.Mq)(),t){const n=(0,i.qX)(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){const e=(0,s.P0)("database");e&&function(e,t,n,i={}){e=(0,s.m9)(e),e._checkNotDeleted("useEmulator"),e._instanceStarted&&k("Cannot call useEmulator() after instance has already been initialized.");const r=e._repoInternal;let o;if(r.repoInfo_.nodeAdmin)i.mockUserToken&&k('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new $($.OWNER);else if(i.mockUserToken){const t="string"==typeof i.mockUserToken?i.mockUserToken:(0,s.Sg)(i.mockUserToken,e.app.options.projectId);o=new $(t)}!function(e,t,n,i){e.repoInfo_=new J(`${t}:${n}`,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0),i&&(e.authTokenProvider_=i)}(r,t,n,o)}(n,...e)}return n}xe.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},xe.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};var Fr;!function(e){c=e}(i.Jn),(0,i.Xd)(new r.wA("database",((e,{instanceIdentifier:t})=>Mr(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)),"PUBLIC").setMultipleInstances(!0)),(0,i.KN)(a,l,Fr),(0,i.KN)(a,l,"esm2017")},3953:(e,t,n)=>{"use strict";n.d(t,{vr:()=>Bd,hJ:()=>xu,JU:()=>Du,Jm:()=>Bu,QT:()=>Od,PL:()=>Md,ad:()=>Mu,IO:()=>bd,pl:()=>jd,r7:()=>Ud,ar:()=>wd});var i,r=n(1657),s=n(8463),o=n(3333),a=n(4444),l="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},c={},u=u||{},d=l||self;function h(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function p(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var f="closure_uid_"+(1e9*Math.random()>>>0),m=0;function g(e,t,n){return e.call.apply(e.bind,arguments)}function v(e,t,n){if(!e)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function y(e,t,n){return(y=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?g:v).apply(null,arguments)}function b(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function _(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,i){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return t.prototype[n].apply(e,r)}}function w(){this.s=this.s,this.o=this.o}w.prototype.s=!1,w.prototype.sa=function(){var e;!this.s&&(this.s=!0,this.N(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,f)&&e[f]||(e[f]=++m))},w.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const S=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function T(e){const t=e.length;if(0<t){const n=Array(t);for(let i=0;i<t;i++)n[i]=e[i];return n}return[]}function E(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(h(n)){const t=e.length||0,i=n.length||0;e.length=t+i;for(let r=0;r<i;r++)e[t+r]=n[r]}else e.push(n)}}function k(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}k.prototype.h=function(){this.defaultPrevented=!0};var C=function(){if(!d.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{d.addEventListener("test",(()=>{}),t),d.removeEventListener("test",(()=>{}),t)}catch(e){}return e}();function I(e){return/^[\s\xa0]*$/.test(e)}function R(){var e=d.navigator;return e&&(e=e.userAgent)?e:""}function P(e){return-1!=R().indexOf(e)}function A(e){return A[" "](e),e}A[" "]=function(){};var N,x,D,O=P("Opera"),L=P("Trident")||P("MSIE"),M=P("Edge"),j=M||L,U=P("Gecko")&&!(-1!=R().toLowerCase().indexOf("webkit")&&!P("Edge"))&&!(P("Trident")||P("MSIE"))&&!P("Edge"),F=-1!=R().toLowerCase().indexOf("webkit")&&!P("Edge");function V(){var e=d.document;return e?e.documentMode:void 0}e:{var B="",z=(x=R(),U?/rv:([^\);]+)(\)|;)/.exec(x):M?/Edge\/([\d\.]+)/.exec(x):L?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(x):F?/WebKit\/(\S+)/.exec(x):O?/(?:Version)[ \/]?(\S+)/.exec(x):void 0);if(z&&(B=z?z[1]:""),L){var $=V();if(null!=$&&$>parseFloat(B)){N=String($);break e}}N=B}if(d.document&&L){var q=V();D=q||(parseInt(N,10)||void 0)}else D=void 0;var G=D;function W(e,t){if(k.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,i=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(U){e:{try{A(t.nodeName);var r=!0;break e}catch(e){}r=!1}r||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:H[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&W.$.h.call(this)}}_(W,k);var H={2:"touch",3:"pen",4:"mouse"};W.prototype.h=function(){W.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var K="closure_listenable_"+(1e6*Math.random()|0),J=0;function Q(e,t,n,i,r){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!i,this.la=r,this.key=++J,this.fa=this.ia=!1}function Y(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function Z(e,t,n){for(const i in e)t.call(n,e[i],i,e)}function X(e){const t={};for(const n in e)t[n]=e[n];return t}const ee="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function te(e,t){let n,i;for(let t=1;t<arguments.length;t++){for(n in i=arguments[t],i)e[n]=i[n];for(let t=0;t<ee.length;t++)n=ee[t],Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}}function ne(e){this.src=e,this.g={},this.h=0}function ie(e,t){var n=t.type;if(n in e.g){var i,r=e.g[n],s=S(r,t);(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(Y(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function re(e,t,n,i){for(var r=0;r<e.length;++r){var s=e[r];if(!s.fa&&s.listener==t&&s.capture==!!n&&s.la==i)return r}return-1}ne.prototype.add=function(e,t,n,i,r){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=re(e,t,i,r);return-1<o?(t=e[o],n||(t.ia=!1)):((t=new Q(t,this.src,s,!!i,r)).ia=n,e.push(t)),t};var se="closure_lm_"+(1e6*Math.random()|0),oe={};function ae(e,t,n,i,r){if(i&&i.once)return ce(e,t,n,i,r);if(Array.isArray(t)){for(var s=0;s<t.length;s++)ae(e,t[s],n,i,r);return null}return n=ge(n),e&&e[K]?e.O(t,n,p(i)?!!i.capture:!!i,r):le(e,t,n,!1,i,r)}function le(e,t,n,i,r,s){if(!t)throw Error("Invalid event type");var o=p(r)?!!r.capture:!!r,a=fe(e);if(a||(e[se]=a=new ne(e)),(n=a.add(t,n,i,o,s)).proxy)return n;if(i=function(){function e(n){return t.call(e.src,e.listener,n)}const t=pe;return e}(),n.proxy=i,i.src=e,i.listener=n,e.addEventListener)C||(r=o),void 0===r&&(r=!1),e.addEventListener(t.toString(),i,r);else if(e.attachEvent)e.attachEvent(he(t.toString()),i);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(i)}return n}function ce(e,t,n,i,r){if(Array.isArray(t)){for(var s=0;s<t.length;s++)ce(e,t[s],n,i,r);return null}return n=ge(n),e&&e[K]?e.P(t,n,p(i)?!!i.capture:!!i,r):le(e,t,n,!0,i,r)}function ue(e,t,n,i,r){if(Array.isArray(t))for(var s=0;s<t.length;s++)ue(e,t[s],n,i,r);else i=p(i)?!!i.capture:!!i,n=ge(n),e&&e[K]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=re(s=e.g[t],n,i,r))&&(Y(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--)))):e&&(e=fe(e))&&(t=e.g[t.toString()],e=-1,t&&(e=re(t,n,i,r)),(n=-1<e?t[e]:null)&&de(n))}function de(e){if("number"!=typeof e&&e&&!e.fa){var t=e.src;if(t&&t[K])ie(t.i,e);else{var n=e.type,i=e.proxy;t.removeEventListener?t.removeEventListener(n,i,e.capture):t.detachEvent?t.detachEvent(he(n),i):t.addListener&&t.removeListener&&t.removeListener(i),(n=fe(t))?(ie(n,e),0==n.h&&(n.src=null,t[se]=null)):Y(e)}}}function he(e){return e in oe?oe[e]:oe[e]="on"+e}function pe(e,t){if(e.fa)e=!0;else{t=new W(t,this);var n=e.listener,i=e.la||e.src;e.ia&&de(e),e=n.call(i,t)}return e}function fe(e){return(e=e[se])instanceof ne?e:null}var me="__closure_events_fn_"+(1e9*Math.random()>>>0);function ge(e){return"function"==typeof e?e:(e[me]||(e[me]=function(t){return e.handleEvent(t)}),e[me])}function ve(){w.call(this),this.i=new ne(this),this.S=this,this.J=null}function ye(e,t){var n,i=e.J;if(i)for(n=[];i;i=i.J)n.push(i);if(e=e.S,i=t.type||t,"string"==typeof t)t=new k(t,e);else if(t instanceof k)t.target=t.target||e;else{var r=t;te(t=new k(i,e),r)}if(r=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];r=be(o,i,!0,t)&&r}if(r=be(o=t.g=e,i,!0,t)&&r,r=be(o,i,!1,t)&&r,n)for(s=0;s<n.length;s++)r=be(o=t.g=n[s],i,!1,t)&&r}function be(e,t,n,i){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var r=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,l=o.la||o.src;o.ia&&ie(e.i,o),r=!1!==a.call(l,i)&&r}}return r&&!i.defaultPrevented}_(ve,w),ve.prototype[K]=!0,ve.prototype.removeEventListener=function(e,t,n,i){ue(this,e,t,n,i)},ve.prototype.N=function(){if(ve.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],i=0;i<n.length;i++)Y(n[i]);delete t.g[e],t.h--}}this.J=null},ve.prototype.O=function(e,t,n,i){return this.i.add(String(e),t,!1,n,i)},ve.prototype.P=function(e,t,n,i){return this.i.add(String(e),t,!0,n,i)};var _e=d.JSON.stringify;function we(){var e=Re;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Se=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new Te),(e=>e.reset()));class Te{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Ee(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function ke(e){d.setTimeout((()=>{throw e}),0)}let Ce,Ie=!1,Re=new class{constructor(){this.h=this.g=null}add(e,t){const n=Se.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},Pe=()=>{const e=d.Promise.resolve(void 0);Ce=()=>{e.then(Ae)}};var Ae=()=>{for(var e;e=we();){try{e.h.call(e.g)}catch(e){ke(e)}var t=Se;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Ie=!1};function Ne(e,t){ve.call(this),this.h=e||1,this.g=t||d,this.j=y(this.qb,this),this.l=Date.now()}function xe(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function De(e,t,n){if("function"==typeof e)n&&(e=y(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=y(e.handleEvent,e)}return 2147483647<Number(t)?-1:d.setTimeout(e,t||0)}function Oe(e){e.g=De((()=>{e.g=null,e.i&&(e.i=!1,Oe(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}_(Ne,ve),(i=Ne.prototype).ga=!1,i.T=null,i.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),ye(this,"tick"),this.ga&&(xe(this),this.start()))}},i.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},i.N=function(){Ne.$.N.call(this),xe(this),delete this.g};class Le extends w{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Oe(this)}N(){super.N(),this.g&&(d.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Me(e){w.call(this),this.h=e,this.g={}}_(Me,w);var je=[];function Ue(e,t,n,i){Array.isArray(n)||(n&&(je[0]=n.toString()),n=je);for(var r=0;r<n.length;r++){var s=ae(t,n[r],i||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function Fe(e){Z(e.g,(function(e,t){this.g.hasOwnProperty(t)&&de(e)}),e),e.g={}}function Ve(){this.g=!0}function Be(e,t,n,i){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var i=n[e];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<r.length;o++)r[o]=""}}}return _e(n)}catch(e){return t}}(e,n)+(i?" "+i:"")}))}Me.prototype.N=function(){Me.$.N.call(this),Fe(this)},Me.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Ve.prototype.Ea=function(){this.g=!1},Ve.prototype.info=function(){};var ze={},$e=null;function qe(){return $e=$e||new ve}function Ge(e){k.call(this,ze.Ta,e)}function We(e){const t=qe();ye(t,new Ge(t))}function He(e,t){k.call(this,ze.STAT_EVENT,e),this.stat=t}function Ke(e){const t=qe();ye(t,new He(t,e))}function Je(e,t){k.call(this,ze.Ua,e),this.size=t}function Qe(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return d.setTimeout((function(){e()}),t)}ze.Ta="serverreachability",_(Ge,k),ze.STAT_EVENT="statevent",_(He,k),ze.Ua="timingevent",_(Je,k);var Ye={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Ze={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Xe(){}function et(e){return e.h||(e.h=e.i())}function tt(){}Xe.prototype.h=null;var nt,it={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function rt(){k.call(this,"d")}function st(){k.call(this,"c")}function ot(){}function at(e,t,n,i){this.l=e,this.j=t,this.m=n,this.W=i||1,this.U=new Me(this),this.P=ct,e=j?125:void 0,this.V=new Ne(e),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new lt}function lt(){this.i=null,this.g="",this.h=!1}_(rt,k),_(st,k),_(ot,Xe),ot.prototype.g=function(){return new XMLHttpRequest},ot.prototype.i=function(){return{}},nt=new ot;var ct=45e3,ut={},dt={};function ht(e,t,n){e.L=1,e.v=Nt(Ct(t)),e.s=n,e.S=!0,pt(e,null)}function pt(e,t){e.G=Date.now(),vt(e),e.A=Ct(e.v);var n=e.A,i=e.W;Array.isArray(i)||(i=[String(i)]),qt(n.i,"t",i),e.C=0,n=e.l.J,e.h=new lt,e.g=qn(e.l,n?t:null,!e.s),0<e.O&&(e.M=new Le(y(e.Pa,e,e.g),e.O)),Ue(e.U,e.g,"readystatechange",e.nb),t=e.I?X(e.I):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.A,e.u,e.s,t)):(e.u="GET",e.g.ha(e.A,e.u,null,t)),We(),function(e,t,n,i,r,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var u=c[0];c=c[1];var d=u.split("_");o=2<=d.length&&"type"==d[1]?o+(u+"=")+c+"&":o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.W,e.s)}function ft(e){return!!e.g&&("GET"==e.u&&2!=e.L&&e.l.Ha)}function mt(e,t,n){let i,r=!0;for(;!e.J&&e.C<n.length;){if(i=gt(e,n),i==dt){4==t&&(e.o=4,Ke(14),r=!1),Be(e.j,e.m,null,"[Incomplete Response]");break}if(i==ut){e.o=4,Ke(15),Be(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}Be(e.j,e.m,i,null),St(e,i)}ft(e)&&i!=dt&&i!=ut&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,Ke(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),Mn(t),t.M=!0,Ke(11))):(Be(e.j,e.m,n,"[Invalid Chunked Response]"),wt(e),_t(e))}function gt(e,t){var n=e.C,i=t.indexOf("\n",n);return-1==i?dt:(n=Number(t.substring(n,i)),isNaN(n)?ut:(i+=1)+n>t.length?dt:(t=t.slice(i,i+n),e.C=i+n,t))}function vt(e){e.Y=Date.now()+e.P,yt(e,e.P)}function yt(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Qe(y(e.lb,e),t)}function bt(e){e.B&&(d.clearTimeout(e.B),e.B=null)}function _t(e){0==e.l.H||e.J||Fn(e.l,e)}function wt(e){bt(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,xe(e.V),Fe(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function St(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||Qt(n.i,e)))if(!e.K&&Qt(n.i,e)&&3==n.H){try{var i=n.Ja.g.parse(t)}catch(e){i=null}if(Array.isArray(i)&&3==i.length){var r=i;if(0==r[0]){e:if(!n.u){if(n.g){if(!(n.g.G+3e3<e.G))break e;Un(n),Rn(n)}Ln(n),Ke(18)}}else n.Fa=r[1],0<n.Fa-n.V&&37500>r[2]&&n.G&&0==n.A&&!n.v&&(n.v=Qe(y(n.ib,n),6e3));if(1>=Jt(n.i)&&n.oa){try{n.oa()}catch(e){}n.oa=void 0}}else Bn(n,11)}else if((e.K||n.g==e)&&Un(n),!I(t))for(r=n.Ja.g.parse(t),t=0;t<r.length;t++){let c=r[t];if(n.V=c[0],c=c[1],2==n.H)if("c"==c[0]){n.K=c[1],n.pa=c[2];const t=c[3];null!=t&&(n.ra=t,n.l.info("VER="+n.ra));const r=c[4];null!=r&&(n.Ga=r,n.l.info("SVER="+n.Ga));const u=c[5];null!=u&&"number"==typeof u&&0<u&&(i=1.5*u,n.L=i,n.l.info("backChannelRequestTimeoutMs_="+i)),i=n;const d=e.g;if(d){const e=d.g?d.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=i.i;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Yt(s,s.h),s.h=null))}if(i.F){const e=d.g?d.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(i.Da=e,At(i.I,i.F,e))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=e;if((i=n).wa=$n(i,i.J?i.pa:null,i.Y),o.K){Zt(i.i,o);var a=o,l=i.L;l&&a.setTimeout(l),a.B&&(bt(a),vt(a)),i.g=o}else On(i);0<n.j.length&&An(n)}else"stop"!=c[0]&&"close"!=c[0]||Bn(n,7);else 3==n.H&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?Bn(n,7):In(n):"noop"!=c[0]&&n.h&&n.h.Aa(c),n.A=0)}We()}catch(e){}}function Tt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(h(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(h(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const i in e)t[n++]=i;return t}}}(e),i=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(h(e)){for(var t=[],n=e.length,i=0;i<n;i++)t.push(e[i]);return t}for(i in t=[],n=0,e)t[n++]=e[i];return t}(e),r=i.length,s=0;s<r;s++)t.call(void 0,i[s],n&&n[s],e)}(i=at.prototype).setTimeout=function(e){this.P=e},i.nb=function(e){e=e.target;const t=this.M;t&&3==wn(e)?t.l():this.Pa(e)},i.Pa=function(e){try{if(e==this.g)e:{const u=wn(this.g);var t=this.g.Ia();this.g.da();if(!(3>u)&&(3!=u||j||this.g&&(this.h.h||this.g.ja()||Sn(this.g)))){this.J||4!=u||7==t||We(),bt(this);var n=this.g.da();this.ca=n;t:if(ft(this)){var i=Sn(this.g);e="";var r=i.length,s=4==wn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){wt(this),_t(this);var o="";break t}this.h.i=new d.TextDecoder}for(t=0;t<r;t++)this.h.h=!0,e+=this.h.i.decode(i[t],{stream:s&&t==r-1});i.splice(0,r),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(e,t,n,i,r,s,o){e.info((function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.j,this.u,this.A,this.m,this.W,u,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!I(a)){var c=a;break t}}c=null}if(!(n=c)){this.i=!1,this.o=3,Ke(12),wt(this),_t(this);break e}Be(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,St(this,n)}this.S?(mt(this,u,o),j&&this.i&&3==u&&(Ue(this.U,this.V,"tick",this.mb),this.V.start())):(Be(this.j,this.m,o,null),St(this,o)),4==u&&wt(this),this.i&&!this.J&&(4==u?Fn(this.l,this):(this.i=!1,vt(this)))}else(function(e){const t={};e=(e.g&&2<=wn(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<e.length;i++){if(I(e[i]))continue;var n=Ee(e[i]);const r=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=t[r]||[];t[r]=s,s.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.o=3,Ke(12)):(this.o=0,Ke(13)),wt(this),_t(this)}}}catch(e){}},i.mb=function(){if(this.g){var e=wn(this.g),t=this.g.ja();this.C<t.length&&(bt(this),mt(this,e,t),this.i&&4!=e&&vt(this))}},i.cancel=function(){this.J=!0,wt(this)},i.lb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.L&&(We(),Ke(17)),wt(this),this.o=2,_t(this)):yt(this,this.Y-e)};var Et=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function kt(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof kt){this.h=e.h,It(this,e.j),this.s=e.s,this.g=e.g,Rt(this,e.m),this.l=e.l;var t=e.i,n=new Vt;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),Pt(this,n),this.o=e.o}else e&&(t=String(e).match(Et))?(this.h=!1,It(this,t[1]||"",!0),this.s=xt(t[2]||""),this.g=xt(t[3]||"",!0),Rt(this,t[4]),this.l=xt(t[5]||"",!0),Pt(this,t[6]||"",!0),this.o=xt(t[7]||"")):(this.h=!1,this.i=new Vt(null,this.h))}function Ct(e){return new kt(e)}function It(e,t,n){e.j=n?xt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Rt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Pt(e,t,n){t instanceof Vt?(e.i=t,function(e,t){t&&!e.j&&(Bt(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(zt(this,t),qt(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=Dt(t,Ut)),e.i=new Vt(t,e.h))}function At(e,t,n){e.i.set(t,n)}function Nt(e){return At(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function xt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Dt(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,Ot),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Ot(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}kt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Dt(t,Lt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(Dt(t,Lt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(Dt(n,"/"==n.charAt(0)?jt:Mt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Dt(n,Ft)),e.join("")};var Lt=/[#\/\?@]/g,Mt=/[#\?:]/g,jt=/[#\?]/g,Ut=/[#\?@]/g,Ft=/#/g;function Vt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Bt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var i=e[n].indexOf("="),r=null;if(0<=i){var s=e[n].substring(0,i);r=e[n].substring(i+1)}else s=e[n];t(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function zt(e,t){Bt(e),t=Gt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function $t(e,t){return Bt(e),t=Gt(e,t),e.g.has(t)}function qt(e,t,n){zt(e,t),0<n.length&&(e.i=null,e.g.set(Gt(e,t),T(n)),e.h+=n.length)}function Gt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(i=Vt.prototype).add=function(e,t){Bt(this),this.i=null,e=Gt(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},i.forEach=function(e,t){Bt(this),this.g.forEach((function(n,i){n.forEach((function(n){e.call(t,n,i,this)}),this)}),this)},i.ta=function(){Bt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let i=0;i<t.length;i++){const r=e[i];for(let e=0;e<r.length;e++)n.push(t[i])}return n},i.Z=function(e){Bt(this);let t=[];if("string"==typeof e)$t(this,e)&&(t=t.concat(this.g.get(Gt(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},i.set=function(e,t){return Bt(this),this.i=null,$t(this,e=Gt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},i.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},i.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var i=t[n];const s=encodeURIComponent(String(i)),o=this.Z(i);for(i=0;i<o.length;i++){var r=s;""!==o[i]&&(r+="="+encodeURIComponent(String(o[i]))),e.push(r)}}return this.i=e.join("&")};function Wt(e){this.l=e||Ht,d.PerformanceNavigationTiming?e=0<(e=d.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(d.g&&d.g.Ka&&d.g.Ka()&&d.g.Ka().ec),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Ht=10;function Kt(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Jt(e){return e.h?1:e.g?e.g.size:0}function Qt(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Yt(e,t){e.g?e.g.add(t):e.h=t}function Zt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Xt(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.F);return t}return T(e.i)}Wt.prototype.cancel=function(){if(this.i=Xt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var en=class{stringify(e){return d.JSON.stringify(e,void 0)}parse(e){return d.JSON.parse(e,void 0)}};function tn(){this.g=new en}function nn(e,t,n){const i=n||"";try{Tt(e,(function(e,n){let r=e;p(e)&&(r=_e(e)),t.push(i+n+"="+encodeURIComponent(r))}))}catch(e){throw t.push(i+"type="+encodeURIComponent("_badmap")),e}}function rn(e,t,n,i,r){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,r(i)}catch(e){}}function sn(e){this.l=e.fc||null,this.j=e.ob||!1}function on(e,t){ve.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=an,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}_(sn,Xe),sn.prototype.g=function(){return new on(this.l,this.j)},sn.prototype.i=function(e){return function(){return e}}({}),_(on,ve);var an=0;function ln(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function cn(e){e.readyState=4,e.l=null,e.j=null,e.A=null,un(e)}function un(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(i=on.prototype).open=function(e,t){if(this.readyState!=an)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,un(this)},i.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||d).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},i.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,cn(this)),this.readyState=an},i.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,un(this)),this.g&&(this.readyState=3,un(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==d.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;ln(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))},i.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?cn(this):un(this),3==this.readyState&&ln(this)}},i.Za=function(e){this.g&&(this.response=this.responseText=e,cn(this))},i.Ya=function(e){this.g&&(this.response=e,cn(this))},i.ka=function(){this.g&&cn(this)},i.setRequestHeader=function(e,t){this.v.append(e,t)},i.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},i.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(on.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var dn=d.JSON.parse;function hn(e){ve.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=pn,this.L=this.M=!1}_(hn,ve);var pn="",fn=/^https?$/i,mn=["POST","PUT"];function gn(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,vn(e),bn(e)}function vn(e){e.F||(e.F=!0,ye(e,"complete"),ye(e,"error"))}function yn(e){if(e.h&&void 0!==u&&(!e.C[1]||4!=wn(e)||2!=e.da()))if(e.v&&4==wn(e))De(e.La,0,e);else if(ye(e,"readystatechange"),4==wn(e)){e.h=!1;try{const o=e.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var i;if(i=0===o){var r=String(e.I).match(Et)[1]||null;!r&&d.self&&d.self.location&&(r=d.self.location.protocol.slice(0,-1)),i=!fn.test(r?r.toLowerCase():"")}n=i}if(n)ye(e,"complete"),ye(e,"success");else{e.m=6;try{var s=2<wn(e)?e.g.statusText:""}catch(e){s=""}e.j=s+" ["+e.da()+"]",vn(e)}}finally{bn(e)}}}function bn(e,t){if(e.g){_n(e);const n=e.g,i=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||ye(e,"ready");try{n.onreadystatechange=i}catch(e){}}}function _n(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(d.clearTimeout(e.A),e.A=null)}function wn(e){return e.g?e.g.readyState:0}function Sn(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case pn:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Tn(e){let t="";return Z(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function En(e,t,n){e:{for(i in n){var i=!1;break e}i=!0}i||(n=Tn(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):At(e,t,n))}function kn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Cn(e){this.Ga=0,this.j=[],this.l=new Ve,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=kn("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=kn("baseRetryDelayMs",5e3,e),this.hb=kn("retryDelaySeedMs",1e4,e),this.eb=kn("forwardChannelMaxRetries",2,e),this.xa=kn("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.dc||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new Wt(e&&e.concurrentRequestLimit),this.Ja=new tn,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function In(e){if(Pn(e),3==e.H){var t=e.W++,n=Ct(e.I);if(At(n,"SID",e.K),At(n,"RID",t),At(n,"TYPE","terminate"),xn(e,n),(t=new at(e,e.l,t)).L=2,t.v=Nt(Ct(n)),n=!1,d.navigator&&d.navigator.sendBeacon)try{n=d.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&d.Image&&((new Image).src=t.v,n=!0),n||(t.g=qn(t.l,null),t.g.ha(t.v)),t.G=Date.now(),vt(t)}zn(e)}function Rn(e){e.g&&(Mn(e),e.g.cancel(),e.g=null)}function Pn(e){Rn(e),e.u&&(d.clearTimeout(e.u),e.u=null),Un(e),e.i.cancel(),e.m&&("number"==typeof e.m&&d.clearTimeout(e.m),e.m=null)}function An(e){if(!Kt(e.i)&&!e.m){e.m=!0;var t=e.Na;Ce||Pe(),Ie||(Ce(),Ie=!0),Re.add(t,e),e.C=0}}function Nn(e,t){var n;n=t?t.m:e.W++;const i=Ct(e.I);At(i,"SID",e.K),At(i,"RID",n),At(i,"AID",e.V),xn(e,i),e.o&&e.s&&En(i,e.o,e.s),n=new at(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=Dn(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),Yt(e.i,n),ht(n,i,t)}function xn(e,t){e.na&&Z(e.na,(function(e,n){At(t,n,e)})),e.h&&Tt({},(function(e,n){At(t,n,e)}))}function Dn(e,t,n){n=Math.min(e.j.length,n);var i=e.h?y(e.h.Va,e.h,e):null;e:{var r=e.j;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=r[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=r[o].g;const a=r[o].map;if(n-=t,0>n)t=Math.max(0,r[o].g-100),s=!1;else try{nn(a,e,"req"+n+"_")}catch(e){i&&i(a)}}if(s){i=e.join("&");break e}}}return e=e.j.splice(0,n),t.F=e,i}function On(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;Ce||Pe(),Ie||(Ce(),Ie=!0),Re.add(t,e),e.A=0}}function Ln(e){return!(e.g||e.u||3<=e.A)&&(e.ba++,e.u=Qe(y(e.Ma,e),Vn(e,e.A)),e.A++,!0)}function Mn(e){null!=e.B&&(d.clearTimeout(e.B),e.B=null)}function jn(e){e.g=new at(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=Ct(e.wa);At(t,"RID","rpc"),At(t,"SID",e.K),At(t,"AID",e.V),At(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&At(t,"TO",e.qa),At(t,"TYPE","xmlhttp"),xn(e,t),e.o&&e.s&&En(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.v=Nt(Ct(t)),n.s=null,n.S=!0,pt(n,e)}function Un(e){null!=e.v&&(d.clearTimeout(e.v),e.v=null)}function Fn(e,t){var n=null;if(e.g==t){Un(e),Mn(e),e.g=null;var i=2}else{if(!Qt(e.i,t))return;n=t.F,Zt(e.i,t),i=1}if(0!=e.H)if(t.i)if(1==i){n=t.s?t.s.length:0,t=Date.now()-t.G;var r=e.C;ye(i=qe(),new Je(i,n)),An(e)}else On(e);else if(3==(r=t.o)||0==r&&0<t.ca||!(1==i&&function(e,t){return!(Jt(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.j=t.F.concat(e.j),0):1==e.H||2==e.H||e.C>=(e.cb?0:e.eb)||(e.m=Qe(y(e.Na,e,t),Vn(e,e.C)),e.C++,0)))}(e,t)||2==i&&Ln(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),r){case 1:Bn(e,5);break;case 4:Bn(e,10);break;case 3:Bn(e,6);break;default:Bn(e,2)}}function Vn(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function Bn(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var i=y(e.pb,e);n||(n=new kt("//www.google.com/images/cleardot.gif"),d.location&&"http"==d.location.protocol||It(n,"https"),Nt(n)),function(e,t){const n=new Ve;if(d.Image){const i=new Image;i.onload=b(rn,n,i,"TestLoadImage: loaded",!0,t),i.onerror=b(rn,n,i,"TestLoadImage: error",!1,t),i.onabort=b(rn,n,i,"TestLoadImage: abort",!1,t),i.ontimeout=b(rn,n,i,"TestLoadImage: timeout",!1,t),d.setTimeout((function(){i.ontimeout&&i.ontimeout()}),1e4),i.src=e}else t(!1)}(n.toString(),i)}else Ke(2);e.H=0,e.h&&e.h.za(t),zn(e),Pn(e)}function zn(e){if(e.H=0,e.ma=[],e.h){const t=Xt(e.i);0==t.length&&0==e.j.length||(E(e.ma,t),E(e.ma,e.j),e.i.i.length=0,T(e.j),e.j.length=0),e.h.ya()}}function $n(e,t,n){var i=n instanceof kt?Ct(n):new kt(n);if(""!=i.g)t&&(i.g=t+"."+i.g),Rt(i,i.m);else{var r=d.location;i=r.protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port;var s=new kt(null);i&&It(s,i),t&&(s.g=t),r&&Rt(s,r),n&&(s.l=n),i=s}return n=e.F,t=e.Da,n&&t&&At(i,n,t),At(i,"VER",e.ra),xn(e,i),i}function qn(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ha&&!e.va?new hn(new sn({ob:!0})):new hn(e.va)).Oa(e.J),t}function Gn(){}function Wn(){if(L&&!(10<=Number(G)))throw Error("Environmental error: no available transport.")}function Hn(e,t){ve.call(this),this.g=new Cn(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!I(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!I(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new Qn(this)}function Kn(e){rt.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Jn(){st.call(this),this.status=1}function Qn(e){this.g=e}function Yn(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Zn(e,t,n){n||(n=0);var i=Array(16);if("string"==typeof t)for(var r=0;16>r;++r)i[r]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(r=0;16>r;++r)i[r]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],r=e.g[2];var s=e.g[3],o=t+(s^n&(r^s))+i[0]+3614090360&4294967295;o=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=n+(o<<7&4294967295|o>>>25))+((o=s+(r^t&(n^r))+i[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(t^n))+i[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^r&(s^t))+i[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(r^s))+i[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^t&(n^r))+i[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(t^n))+i[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^r&(s^t))+i[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(r^s))+i[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^t&(n^r))+i[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(t^n))+i[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^r&(s^t))+i[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(r^s))+i[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^t&(n^r))+i[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(t^n))+i[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^r&(s^t))+i[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(r^s&(n^r))+i[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(t^n))+i[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=r+(t^n&(s^t))+i[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(r^s))+i[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(r^s&(n^r))+i[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(t^n))+i[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=r+(t^n&(s^t))+i[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(r^s))+i[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(r^s&(n^r))+i[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(t^n))+i[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=r+(t^n&(s^t))+i[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(r^s))+i[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(r^s&(n^r))+i[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(t^n))+i[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=r+(t^n&(s^t))+i[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(r^s))+i[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^r^s)+i[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^r)+i[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^t^n)+i[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^t)+i[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^r^s)+i[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^r)+i[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^t^n)+i[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^t)+i[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^r^s)+i[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^r)+i[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^t^n)+i[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^t)+i[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^r^s)+i[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^r)+i[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^t^n)+i[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^t)+i[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(r^(n|~s))+i[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~r))+i[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=r+(t^(s|~n))+i[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(r|~t))+i[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(r^(n|~s))+i[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~r))+i[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=r+(t^(s|~n))+i[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(r|~t))+i[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(r^(n|~s))+i[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~r))+i[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=r+(t^(s|~n))+i[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(r|~t))+i[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(t=n+((o=t+(r^(n|~s))+i[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~r))+i[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((r=s+((o=r+(t^(s|~n))+i[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+i[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(r+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+r&4294967295,e.g[3]=e.g[3]+s&4294967295}function Xn(e,t){this.h=t;for(var n=[],i=!0,r=e.length-1;0<=r;r--){var s=0|e[r];i&&s==t||(n[r]=s,i=!1)}this.g=n}(i=hn.prototype).Oa=function(e){this.M=e},i.ha=function(e,t,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():nt.g(),this.C=this.u?et(this.u):et(nt),this.g.onreadystatechange=y(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){return void gn(this,e)}if(e=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var r in i)n.set(r,i[r]);else{if("function"!=typeof i.keys||"function"!=typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const e of i.keys())n.set(e,i.get(e))}i=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),r=d.FormData&&e instanceof d.FormData,!(0<=S(mn,t))||i||r||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{_n(this),0<this.B&&((this.L=function(e){return L&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=y(this.ua,this)):this.A=De(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){gn(this,e)}},i.ua=function(){void 0!==u&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ye(this,"timeout"),this.abort(8))},i.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,ye(this,"complete"),ye(this,"abort"),bn(this))},i.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),bn(this,!0)),hn.$.N.call(this)},i.La=function(){this.s||(this.G||this.v||this.l?yn(this):this.kb())},i.kb=function(){yn(this)},i.isActive=function(){return!!this.g},i.da=function(){try{return 2<wn(this)?this.g.status:-1}catch(e){return-1}},i.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},i.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),dn(t)}},i.Ia=function(){return this.m},i.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(i=Cn.prototype).ra=8,i.H=1,i.Na=function(e){if(this.m)if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;const r=new at(this,this.l,e);let s=this.s;if(this.U&&(s?(s=X(s),te(s,this.U)):s=this.U),null!==this.o||this.O||(r.I=s,s=null),this.P)e:{for(var t=0,n=0;n<this.j.length;n++){var i=this.j[n];if(void 0===(i="__data__"in i.map&&"string"==typeof(i=i.map.__data__)?i.length:void 0))break;if(4096<(t+=i)){t=n;break e}if(4096===t||n===this.j.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Dn(this,r,t),At(n=Ct(this.I),"RID",e),At(n,"CVER",22),this.F&&At(n,"X-HTTP-Session-Id",this.F),xn(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(Tn(s)))+"&"+t:this.o&&En(n,this.o,s)),Yt(this.i,r),this.bb&&At(n,"TYPE","init"),this.P?(At(n,"$req",t),At(n,"SID","null"),r.aa=!0,ht(r,n,null)):ht(r,n,t),this.H=2}}else 3==this.H&&(e?Nn(this,e):0==this.j.length||Kt(this.i)||Nn(this))},i.Ma=function(){if(this.u=null,jn(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=Qe(y(this.jb,this),e)}},i.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Ke(10),Rn(this),jn(this))},i.ib=function(){null!=this.v&&(this.v=null,Rn(this),Ln(this),Ke(19))},i.pb=function(e){e?(this.l.info("Successfully pinged google.com"),Ke(2)):(this.l.info("Failed to ping google.com"),Ke(1))},i.isActive=function(){return!!this.h&&this.h.isActive(this)},(i=Gn.prototype).Ba=function(){},i.Aa=function(){},i.za=function(){},i.ya=function(){},i.isActive=function(){return!0},i.Va=function(){},Wn.prototype.g=function(e,t){return new Hn(e,t)},_(Hn,ve),Hn.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;Ke(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=$n(e,null,e.Y),An(e)},Hn.prototype.close=function(){In(this.g)},Hn.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=_e(e),e=n);t.j.push(new class{constructor(e,t){this.g=e,this.map=t}}(t.fb++,e)),3==t.H&&An(t)},Hn.prototype.N=function(){this.g.h=null,delete this.j,In(this.g),delete this.g,Hn.$.N.call(this)},_(Kn,rt),_(Jn,st),_(Qn,Gn),Qn.prototype.Ba=function(){ye(this.g,"a")},Qn.prototype.Aa=function(e){ye(this.g,new Kn(e))},Qn.prototype.za=function(e){ye(this.g,new Jn)},Qn.prototype.ya=function(){ye(this.g,"b")},_(Yn,(function(){this.blockSize=-1})),Yn.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Yn.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,i=this.m,r=this.h,s=0;s<t;){if(0==r)for(;s<=n;)Zn(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(i[r++]=e.charCodeAt(s++),r==this.blockSize){Zn(this,i),r=0;break}}else for(;s<t;)if(i[r++]=e[s++],r==this.blockSize){Zn(this,i),r=0;break}}this.h=r,this.i+=t},Yn.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var i=0;32>i;i+=8)e[n++]=this.g[t]>>>i&255;return e};var ei={};function ti(e){return-128<=e&&128>e?function(e,t){var n=ei;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,(function(e){return new Xn([0|e],0>e?-1:0)})):new Xn([0|e],0>e?-1:0)}function ni(e){if(isNaN(e)||!isFinite(e))return ri;if(0>e)return ci(ni(-e));for(var t=[],n=1,i=0;e>=n;i++)t[i]=e/n|0,n*=ii;return new Xn(t,0)}var ii=4294967296,ri=ti(0),si=ti(1),oi=ti(16777216);function ai(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function li(e){return-1==e.h}function ci(e){for(var t=e.g.length,n=[],i=0;i<t;i++)n[i]=~e.g[i];return new Xn(n,~e.h).add(si)}function ui(e,t){return e.add(ci(t))}function di(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function hi(e,t){this.g=e,this.h=t}function pi(e,t){if(ai(t))throw Error("division by zero");if(ai(e))return new hi(ri,ri);if(li(e))return t=pi(ci(e),t),new hi(ci(t.g),ci(t.h));if(li(t))return t=pi(e,ci(t)),new hi(ci(t.g),t.h);if(30<e.g.length){if(li(e)||li(t))throw Error("slowDivide_ only works with positive integers.");for(var n=si,i=t;0>=i.X(e);)n=fi(n),i=fi(i);var r=mi(n,1),s=mi(i,1);for(i=mi(i,2),n=mi(n,2);!ai(i);){var o=s.add(i);0>=o.X(e)&&(r=r.add(n),s=o),i=mi(i,1),n=mi(n,1)}return t=ui(e,r.R(t)),new hi(r,t)}for(r=ri;0<=e.X(t);){for(n=Math.max(1,Math.floor(e.ea()/t.ea())),i=48>=(i=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,i-48),o=(s=ni(n)).R(t);li(o)||0<o.X(e);)o=(s=ni(n-=i)).R(t);ai(s)&&(s=si),r=r.add(s),e=ui(e,o)}return new hi(r,e)}function fi(e){for(var t=e.g.length+1,n=[],i=0;i<t;i++)n[i]=e.D(i)<<1|e.D(i-1)>>>31;return new Xn(n,e.h)}function mi(e,t){var n=t>>5;t%=32;for(var i=e.g.length-n,r=[],s=0;s<i;s++)r[s]=0<t?e.D(s+n)>>>t|e.D(s+n+1)<<32-t:e.D(s+n);return new Xn(r,e.h)}(i=Xn.prototype).ea=function(){if(li(this))return-ci(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var i=this.D(n);e+=(0<=i?i:ii+i)*t,t*=ii}return e},i.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(ai(this))return"0";if(li(this))return"-"+ci(this).toString(e);for(var t=ni(Math.pow(e,6)),n=this,i="";;){var r=pi(n,t).g,s=((0<(n=ui(n,r.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(ai(n=r))return s+i;for(;6>s.length;)s="0"+s;i=s+i}},i.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},i.X=function(e){return li(e=ui(this,e))?-1:ai(e)?0:1},i.abs=function(){return li(this)?ci(this):this},i.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0,r=0;r<=t;r++){var s=i+(65535&this.D(r))+(65535&e.D(r)),o=(s>>>16)+(this.D(r)>>>16)+(e.D(r)>>>16);i=o>>>16,s&=65535,o&=65535,n[r]=o<<16|s}return new Xn(n,-2147483648&n[n.length-1]?-1:0)},i.R=function(e){if(ai(this)||ai(e))return ri;if(li(this))return li(e)?ci(this).R(ci(e)):ci(ci(this).R(e));if(li(e))return ci(this.R(ci(e)));if(0>this.X(oi)&&0>e.X(oi))return ni(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var r=0;r<e.g.length;r++){var s=this.D(i)>>>16,o=65535&this.D(i),a=e.D(r)>>>16,l=65535&e.D(r);n[2*i+2*r]+=o*l,di(n,2*i+2*r),n[2*i+2*r+1]+=s*l,di(n,2*i+2*r+1),n[2*i+2*r+1]+=o*a,di(n,2*i+2*r+1),n[2*i+2*r+2]+=s*a,di(n,2*i+2*r+2)}for(i=0;i<t;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=t;i<2*t;i++)n[i]=0;return new Xn(n,0)},i.gb=function(e){return pi(this,e).h},i.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.D(i)&e.D(i);return new Xn(n,this.h&e.h)},i.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.D(i)|e.D(i);return new Xn(n,this.h|e.h)},i.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.D(i)^e.D(i);return new Xn(n,this.h^e.h)},Wn.prototype.createWebChannel=Wn.prototype.g,Hn.prototype.send=Hn.prototype.u,Hn.prototype.open=Hn.prototype.m,Hn.prototype.close=Hn.prototype.close,Ye.NO_ERROR=0,Ye.TIMEOUT=8,Ye.HTTP_ERROR=6,Ze.COMPLETE="complete",tt.EventType=it,it.OPEN="a",it.CLOSE="b",it.ERROR="c",it.MESSAGE="d",ve.prototype.listen=ve.prototype.O,hn.prototype.listenOnce=hn.prototype.P,hn.prototype.getLastError=hn.prototype.Sa,hn.prototype.getLastErrorCode=hn.prototype.Ia,hn.prototype.getStatus=hn.prototype.da,hn.prototype.getResponseJson=hn.prototype.Wa,hn.prototype.getResponseText=hn.prototype.ja,hn.prototype.send=hn.prototype.ha,hn.prototype.setWithCredentials=hn.prototype.Oa,Yn.prototype.digest=Yn.prototype.l,Yn.prototype.reset=Yn.prototype.reset,Yn.prototype.update=Yn.prototype.j,Xn.prototype.add=Xn.prototype.add,Xn.prototype.multiply=Xn.prototype.R,Xn.prototype.modulo=Xn.prototype.gb,Xn.prototype.compare=Xn.prototype.X,Xn.prototype.toNumber=Xn.prototype.ea,Xn.prototype.toString=Xn.prototype.toString,Xn.prototype.getBits=Xn.prototype.D,Xn.fromNumber=ni,Xn.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return ci(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var i=ni(Math.pow(n,8)),r=ri,s=0;s<t.length;s+=8){var o=Math.min(8,t.length-s),a=parseInt(t.substring(s,s+o),n);8>o?(o=ni(Math.pow(n,o)),r=r.R(o).add(ni(a))):r=(r=r.R(i)).add(ni(a))}return r};var gi=c.createWebChannelTransport=function(){return new Wn},vi=c.getStatEventTarget=function(){return qe()},yi=c.ErrorCode=Ye,bi=c.EventType=Ze,_i=c.Event=ze,wi=c.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Si=c.FetchXmlHttpFactory=sn,Ti=c.WebChannel=tt,Ei=c.XhrIo=hn,ki=c.Md5=Yn,Ci=c.Integer=Xn;const Ii="@firebase/firestore";class Ri{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ri.UNAUTHENTICATED=new Ri(null),Ri.GOOGLE_CREDENTIALS=new Ri("google-credentials-uid"),Ri.FIRST_PARTY=new Ri("first-party-uid"),Ri.MOCK_USER=new Ri("mock-user");let Pi="9.22.2";const Ai=new o.Yd("@firebase/firestore");function Ni(){return Ai.logLevel}function xi(e,...t){if(Ai.logLevel<=o.in.DEBUG){const n=t.map(Li);Ai.debug(`Firestore (${Pi}): ${e}`,...n)}}function Di(e,...t){if(Ai.logLevel<=o.in.ERROR){const n=t.map(Li);Ai.error(`Firestore (${Pi}): ${e}`,...n)}}function Oi(e,...t){if(Ai.logLevel<=o.in.WARN){const n=t.map(Li);Ai.warn(`Firestore (${Pi}): ${e}`,...n)}}function Li(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function Mi(e="Unexpected state"){const t=`FIRESTORE (${Pi}) INTERNAL ASSERTION FAILED: `+e;throw Di(t),new Error(t)}function ji(e,t){e||Mi()}function Ui(e,t){return e}const Fi={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Vi extends a.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Bi{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class zi{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class $i{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Ri.UNAUTHENTICATED)))}shutdown(){}}class qi{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Gi{constructor(e){this.t=e,this.currentUser=Ri.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const i=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let r=new Bi;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new Bi,e.enqueueRetryable((()=>i(this.currentUser)))};const s=()=>{const t=r;e.enqueueRetryable((async()=>{await t.promise,await i(this.currentUser)}))},o=e=>{xi("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(xi("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new Bi)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(xi("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(ji("string"==typeof t.accessToken),new zi(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return ji(null===e||"string"==typeof e),new Ri(e)}}class Wi{constructor(e,t,n){this.h=e,this.l=t,this.m=n,this.type="FirstParty",this.user=Ri.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);const e=this.p();return e&&this.g.set("Authorization",e),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class Hi{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new Wi(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable((()=>t(Ri.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Ki{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Ji{constructor(e){this.I=e,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(e,t){const n=e=>{null!=e.error&&xi("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.T;return this.T=e.token,xi("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const i=e=>{xi("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.I.onInit((e=>i(e))),setTimeout((()=>{if(!this.appCheck){const e=this.I.getImmediate({optional:!0});e?i(e):xi("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(ji("string"==typeof e.token),this.T=e.token,new Ki(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Qi(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class Yi{static A(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(256/62);let n="";for(;n.length<20;){const i=Qi(40);for(let r=0;r<i.length;++r)n.length<20&&i[r]<t&&(n+=e.charAt(i[r]%62))}return n}}function Zi(e,t){return e<t?-1:e>t?1:0}function Xi(e,t,n){return e.length===t.length&&e.every(((e,i)=>n(e,t[i])))}class er{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Vi(Fi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Vi(Fi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Vi(Fi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Vi(Fi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return er.fromMillis(Date.now())}static fromDate(e){return er.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new er(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Zi(this.nanoseconds,e.nanoseconds):Zi(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class tr{constructor(e){this.timestamp=e}static fromTimestamp(e){return new tr(e)}static min(){return new tr(new er(0,0))}static max(){return new tr(new er(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class nr{constructor(e,t,n){void 0===t?t=0:t>e.length&&Mi(),void 0===n?n=e.length-t:n>e.length-t&&Mi(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===nr.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof nr?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const n=e.get(i),r=t.get(i);if(n<r)return-1;if(n>r)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ir extends nr{construct(e,t,n){return new ir(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Vi(Fi.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new ir(t)}static emptyPath(){return new ir([])}}const rr=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class sr extends nr{construct(e,t,n){return new sr(e,t,n)}static isValidIdentifier(e){return rr.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),sr.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new sr(["__name__"])}static fromServerFormat(e){const t=[];let n="",i=0;const r=()=>{if(0===n.length)throw new Vi(Fi.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;i<e.length;){const t=e[i];if("\\"===t){if(i+1===e.length)throw new Vi(Fi.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[i+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Vi(Fi.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,i+=2}else"`"===t?(s=!s,i++):"."!==t||s?(n+=t,i++):(r(),i++)}if(r(),s)throw new Vi(Fi.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new sr(t)}static emptyPath(){return new sr([])}}class or{constructor(e){this.path=e}static fromPath(e){return new or(ir.fromString(e))}static fromName(e){return new or(ir.fromString(e).popFirst(5))}static empty(){return new or(ir.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ir.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ir.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new or(new ir(e.slice()))}}class ar{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}}ar.UNKNOWN_ID=-1;function lr(e,t){const n=e.toTimestamp().seconds,i=e.toTimestamp().nanoseconds+1,r=tr.fromTimestamp(1e9===i?new er(n+1,0):new er(n,i));return new ur(r,or.empty(),t)}function cr(e){return new ur(e.readTime,e.key,-1)}class ur{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new ur(tr.min(),or.empty(),-1)}static max(){return new ur(tr.max(),or.empty(),-1)}}function dr(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=or.comparator(e.documentKey,t.documentKey),0!==n?n:Zi(e.largestBatchId,t.largestBatchId))}const hr="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class pr{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function fr(e){if(e.code!==Fi.FAILED_PRECONDITION||e.message!==hr)throw e;xi("LocalStore","Unexpectedly lost primary lease")}class mr{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Mi(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new mr(((n,i)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,i)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,i)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof mr?t:mr.resolve(t)}catch(e){return mr.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):mr.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):mr.reject(t)}static resolve(e){return new mr(((t,n)=>{t(e)}))}static reject(e){return new mr(((t,n)=>{n(e)}))}static waitFor(e){return new mr(((t,n)=>{let i=0,r=0,s=!1;e.forEach((e=>{++i,e.next((()=>{++r,s&&r===i&&t()}),(e=>n(e)))})),s=!0,r===i&&t()}))}static or(e){let t=mr.resolve(!1);for(const n of e)t=t.next((e=>e?mr.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,i)=>{n.push(t.call(this,e,i))})),this.waitFor(n)}static mapArray(e,t){return new mr(((n,i)=>{const r=e.length,s=new Array(r);let o=0;for(let a=0;a<r;a++){const l=a;t(e[l]).next((e=>{s[l]=e,++o,o===r&&n(s)}),(e=>i(e)))}}))}static doWhile(e,t){return new mr(((n,i)=>{const r=()=>{!0===e()?t().next((()=>{r()}),i):n()};r()}))}}function gr(e){return"IndexedDbTransactionError"===e.name}class vr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ot(e),this.ut=e=>t.writeSequenceNumber(e))}ot(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ut&&this.ut(e),e}}function yr(e){return null==e}function br(e){return 0===e&&1/e==-1/0}function _r(e){return"number"==typeof e&&Number.isInteger(e)&&!br(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}vr.ct=-1;const wr=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Sr=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Tr=Sr;function Er(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function kr(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Cr(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Ir{constructor(e,t){this.comparator=e,this.root=t||Pr.EMPTY}insert(e,t){return new Ir(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Pr.BLACK,null,null))}remove(e){return new Ir(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Pr.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Rr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Rr(this.root,e,this.comparator,!1)}getReverseIterator(){return new Rr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Rr(this.root,e,this.comparator,!0)}}class Rr{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,t&&i&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(0===r){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Pr{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:Pr.RED,this.left=null!=i?i:Pr.EMPTY,this.right=null!=r?r:Pr.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,r){return new Pr(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const r=n(e,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Pr.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Pr.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Pr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Pr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Mi();if(this.right.isRed())throw Mi();const e=this.left.check();if(e!==this.right.check())throw Mi();return e+(this.isRed()?0:1)}}Pr.EMPTY=null,Pr.RED=!0,Pr.BLACK=!1,Pr.EMPTY=new class{constructor(){this.size=0}get key(){throw Mi()}get value(){throw Mi()}get color(){throw Mi()}get left(){throw Mi()}get right(){throw Mi()}copy(e,t,n,i,r){return this}insert(e,t,n){return new Pr(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ar{constructor(e){this.comparator=e,this.data=new Ir(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Nr(this.data.getIterator())}getIteratorFrom(e){return new Nr(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Ar))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(e,i))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Ar(this.comparator);return t.data=e,t}}class Nr{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class xr{constructor(e){this.fields=e,e.sort(sr.comparator)}static empty(){return new xr([])}unionWith(e){let t=new Ar(sr.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new xr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Xi(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class Dr extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Or{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Dr("Invalid base64 string: "+e):e}}(e);return new Or(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Or(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Zi(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Or.EMPTY_BYTE_STRING=new Or("");const Lr=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Mr(e){if(ji(!!e),"string"==typeof e){let t=0;const n=Lr.exec(e);if(ji(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:jr(e.seconds),nanos:jr(e.nanos)}}function jr(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Ur(e){return"string"==typeof e?Or.fromBase64String(e):Or.fromUint8Array(e)}function Fr(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Vr(e){const t=e.mapValue.fields.__previous_value__;return Fr(t)?Vr(t):t}function Br(e){const t=Mr(e.mapValue.fields.__local_write_time__.timestampValue);return new er(t.seconds,t.nanos)}class zr{constructor(e,t,n,i,r,s,o,a,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=r,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=l}}class $r{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new $r("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof $r&&e.projectId===this.projectId&&e.database===this.database}}const qr={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Gr(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Fr(e)?4:ss(e)?9007199254740991:10:Mi()}function Wr(e,t){if(e===t)return!0;const n=Gr(e);if(n!==Gr(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Br(e).isEqual(Br(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Mr(e.timestampValue),i=Mr(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Ur(e.bytesValue).isEqual(Ur(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return jr(e.geoPointValue.latitude)===jr(t.geoPointValue.latitude)&&jr(e.geoPointValue.longitude)===jr(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return jr(e.integerValue)===jr(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=jr(e.doubleValue),i=jr(t.doubleValue);return n===i?br(n)===br(i):isNaN(n)&&isNaN(i)}return!1}(e,t);case 9:return Xi(e.arrayValue.values||[],t.arrayValue.values||[],Wr);case 10:return function(e,t){const n=e.mapValue.fields||{},i=t.mapValue.fields||{};if(Er(n)!==Er(i))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===i[e]||!Wr(n[e],i[e])))return!1;return!0}(e,t);default:return Mi()}}function Hr(e,t){return void 0!==(e.values||[]).find((e=>Wr(e,t)))}function Kr(e,t){if(e===t)return 0;const n=Gr(e),i=Gr(t);if(n!==i)return Zi(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return Zi(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=jr(e.integerValue||e.doubleValue),i=jr(t.integerValue||t.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(e,t);case 3:return Jr(e.timestampValue,t.timestampValue);case 4:return Jr(Br(e),Br(t));case 5:return Zi(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Ur(e),i=Ur(t);return n.compareTo(i)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),i=t.split("/");for(let e=0;e<n.length&&e<i.length;e++){const t=Zi(n[e],i[e]);if(0!==t)return t}return Zi(n.length,i.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Zi(jr(e.latitude),jr(t.latitude));return 0!==n?n:Zi(jr(e.longitude),jr(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],i=t.values||[];for(let e=0;e<n.length&&e<i.length;++e){const t=Kr(n[e],i[e]);if(t)return t}return Zi(n.length,i.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===qr.mapValue&&t===qr.mapValue)return 0;if(e===qr.mapValue)return 1;if(t===qr.mapValue)return-1;const n=e.fields||{},i=Object.keys(n),r=t.fields||{},s=Object.keys(r);i.sort(),s.sort();for(let e=0;e<i.length&&e<s.length;++e){const t=Zi(i[e],s[e]);if(0!==t)return t;const o=Kr(n[i[e]],r[s[e]]);if(0!==o)return o}return Zi(i.length,s.length)}(e.mapValue,t.mapValue);default:throw Mi()}}function Jr(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Zi(e,t);const n=Mr(e),i=Mr(t),r=Zi(n.seconds,i.seconds);return 0!==r?r:Zi(n.nanos,i.nanos)}function Qr(e){return Yr(e)}function Yr(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Mr(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Ur(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,or.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const i of e.values||[])n?n=!1:t+=",",t+=Yr(i);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",i=!0;for(const r of t)i?i=!1:n+=",",n+=`${r}:${Yr(e.fields[r])}`;return n+"}"}(e.mapValue):Mi();var t,n}function Zr(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Xr(e){return!!e&&"integerValue"in e}function es(e){return!!e&&"arrayValue"in e}function ts(e){return!!e&&"nullValue"in e}function ns(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function is(e){return!!e&&"mapValue"in e}function rs(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return kr(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=rs(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=rs(e.arrayValue.values[n]);return t}return Object.assign({},e)}function ss(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class os{constructor(e){this.value=e}static empty(){return new os({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!is(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=rs(t)}setAll(e){let t=sr.emptyPath(),n={},i=[];e.forEach(((e,r)=>{if(!t.isImmediateParentOf(r)){const e=this.getFieldsMap(t);this.applyChanges(e,n,i),n={},i=[],t=r.popLast()}e?n[r.lastSegment()]=rs(e):i.push(r.lastSegment())}));const r=this.getFieldsMap(t);this.applyChanges(r,n,i)}delete(e){const t=this.field(e.popLast());is(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Wr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];is(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){kr(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new os(rs(this.value))}}function as(e){const t=[];return kr(e.fields,((e,n)=>{const i=new sr([e]);if(is(n)){const e=as(n.mapValue).fields;if(0===e.length)t.push(i);else for(const n of e)t.push(i.child(n))}else t.push(i)})),new xr(t)}class ls{constructor(e,t,n,i,r,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=r,this.data=s,this.documentState=o}static newInvalidDocument(e){return new ls(e,0,tr.min(),tr.min(),tr.min(),os.empty(),0)}static newFoundDocument(e,t,n,i){return new ls(e,1,t,tr.min(),n,i,0)}static newNoDocument(e,t){return new ls(e,2,t,tr.min(),tr.min(),os.empty(),0)}static newUnknownDocument(e,t){return new ls(e,3,t,tr.min(),tr.min(),os.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(tr.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=os.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=os.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=tr.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ls&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ls(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class cs{constructor(e,t){this.position=e,this.inclusive=t}}function us(e,t,n){let i=0;for(let r=0;r<e.position.length;r++){const s=t[r],o=e.position[r];if(i=s.field.isKeyField()?or.comparator(or.fromName(o.referenceValue),n.key):Kr(o,n.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return i}function ds(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Wr(e.position[n],t.position[n]))return!1;return!0}class hs{constructor(e,t="asc"){this.field=e,this.dir=t}}function ps(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class fs{}class ms extends fs{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Ts(e,t,n):"array-contains"===t?new Is(e,n):"in"===t?new Rs(e,n):"not-in"===t?new Ps(e,n):"array-contains-any"===t?new As(e,n):new ms(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Es(e,n):new ks(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Kr(t,this.value)):null!==t&&Gr(this.value)===Gr(t)&&this.matchesComparison(Kr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Mi()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class gs extends fs{constructor(e,t){super(),this.filters=e,this.op=t,this.lt=null}static create(e,t){return new gs(e,t)}matches(e){return vs(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.lt||(this.lt=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.ft((e=>e.isInequality()));return null!==e?e.field:null}ft(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function vs(e){return"and"===e.op}function ys(e){return bs(e)&&vs(e)}function bs(e){for(const t of e.filters)if(t instanceof gs)return!1;return!0}function _s(e){if(e instanceof ms)return e.field.canonicalString()+e.op.toString()+Qr(e.value);if(ys(e))return e.filters.map((e=>_s(e))).join(",");{const t=e.filters.map((e=>_s(e))).join(",");return`${e.op}(${t})`}}function ws(e,t){return e instanceof ms?function(e,t){return t instanceof ms&&e.op===t.op&&e.field.isEqual(t.field)&&Wr(e.value,t.value)}(e,t):e instanceof gs?function(e,t){return t instanceof gs&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,i)=>e&&ws(n,t.filters[i])),!0)}(e,t):void Mi()}function Ss(e){return e instanceof ms?function(e){return`${e.field.canonicalString()} ${e.op} ${Qr(e.value)}`}(e):e instanceof gs?function(e){return e.op.toString()+" {"+e.getFilters().map(Ss).join(" ,")+"}"}(e):"Filter"}class Ts extends ms{constructor(e,t,n){super(e,t,n),this.key=or.fromName(n.referenceValue)}matches(e){const t=or.comparator(e.key,this.key);return this.matchesComparison(t)}}class Es extends ms{constructor(e,t){super(e,"in",t),this.keys=Cs("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class ks extends ms{constructor(e,t){super(e,"not-in",t),this.keys=Cs("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Cs(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>or.fromName(e.referenceValue)))}class Is extends ms{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return es(t)&&Hr(t.arrayValue,this.value)}}class Rs extends ms{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Hr(this.value.arrayValue,t)}}class Ps extends ms{constructor(e,t){super(e,"not-in",t)}matches(e){if(Hr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Hr(this.value.arrayValue,t)}}class As extends ms{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!es(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>Hr(this.value.arrayValue,e)))}}class Ns{constructor(e,t=null,n=[],i=[],r=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=r,this.startAt=s,this.endAt=o,this.dt=null}}function xs(e,t=null,n=[],i=[],r=null,s=null,o=null){return new Ns(e,t,n,i,r,s,o)}function Ds(e){const t=Ui(e);if(null===t.dt){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>_s(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),yr(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>Qr(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>Qr(e))).join(",")),t.dt=e}return t.dt}function Os(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!ps(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!ws(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!ds(e.startAt,t.startAt)&&ds(e.endAt,t.endAt)}function Ls(e){return or.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class Ms{constructor(e,t=null,n=[],i=[],r=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=r,this.limitType=s,this.startAt=o,this.endAt=a,this.wt=null,this._t=null,this.startAt,this.endAt}}function js(e,t,n,i,r,s,o,a){return new Ms(e,t,n,i,r,s,o,a)}function Us(e){return new Ms(e)}function Fs(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Vs(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function Bs(e){for(const t of e.filters){const e=t.getFirstInequalityField();if(null!==e)return e}return null}function zs(e){return null!==e.collectionGroup}function $s(e){const t=Ui(e);if(null===t.wt){t.wt=[];const e=Bs(t),n=Vs(t);if(null!==e&&null===n)e.isKeyField()||t.wt.push(new hs(e)),t.wt.push(new hs(sr.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.wt.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.wt.push(new hs(sr.keyField(),e))}}}return t.wt}function qs(e){const t=Ui(e);if(!t._t)if("F"===t.limitType)t._t=xs(t.path,t.collectionGroup,$s(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const n of $s(t)){const t="desc"===n.dir?"asc":"desc";e.push(new hs(n.field,t))}const n=t.endAt?new cs(t.endAt.position,t.endAt.inclusive):null,i=t.startAt?new cs(t.startAt.position,t.startAt.inclusive):null;t._t=xs(t.path,t.collectionGroup,e,t.filters,t.limit,n,i)}return t._t}function Gs(e,t){t.getFirstInequalityField(),Bs(e);const n=e.filters.concat([t]);return new Ms(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Ws(e,t,n){return new Ms(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Hs(e,t){return Os(qs(e),qs(t))&&e.limitType===t.limitType}function Ks(e){return`${Ds(qs(e))}|lt:${e.limitType}`}function Js(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>Ss(e))).join(", ")}]`),yr(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>Qr(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>Qr(e))).join(",")),`Target(${t})`}(qs(e))}; limitType=${e.limitType})`}function Qs(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):or.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of $s(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const i=us(e,t,n);return e.inclusive?i<=0:i<0}(e.startAt,$s(e),t))&&!(e.endAt&&!function(e,t,n){const i=us(e,t,n);return e.inclusive?i>=0:i>0}(e.endAt,$s(e),t))}(e,t)}function Ys(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Zs(e){return(t,n)=>{let i=!1;for(const r of $s(e)){const e=Xs(r,t,n);if(0!==e)return e;i=i||r.field.isKeyField()}return 0}}function Xs(e,t,n){const i=e.field.isKeyField()?or.comparator(t.key,n.key):function(e,t,n){const i=t.data.field(e),r=n.data.field(e);return null!==i&&null!==r?Kr(i,r):Mi()}(e.field,t,n);switch(e.dir){case"asc":return i;case"desc":return-1*i;default:return Mi()}}class eo{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,i]of n)if(this.equalsFn(t,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],e))return void(i[n]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){kr(this.inner,((t,n)=>{for(const[t,i]of n)e(t,i)}))}isEmpty(){return Cr(this.inner)}size(){return this.innerSize}}const to=new Ir(or.comparator);function no(){return to}const io=new Ir(or.comparator);function ro(...e){let t=io;for(const n of e)t=t.insert(n.key,n);return t}function so(e){let t=io;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function oo(){return lo()}function ao(){return lo()}function lo(){return new eo((e=>e.toString()),((e,t)=>e.isEqual(t)))}const co=new Ir(or.comparator),uo=new Ar(or.comparator);function ho(...e){let t=uo;for(const n of e)t=t.add(n);return t}const po=new Ar(Zi);function fo(){return po}function mo(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:br(t)?"-0":t}}function go(e){return{integerValue:""+e}}function vo(e,t){return _r(t)?go(t):mo(e,t)}class yo{constructor(){this._=void 0}}function bo(e,t,n){return e instanceof So?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Fr(t)&&(t=Vr(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof To?Eo(e,t):e instanceof ko?Co(e,t):function(e,t){const n=wo(e,t),i=Ro(n)+Ro(e.gt);return Xr(n)&&Xr(e.gt)?go(i):mo(e.serializer,i)}(e,t)}function _o(e,t,n){return e instanceof To?Eo(e,t):e instanceof ko?Co(e,t):n}function wo(e,t){return e instanceof Io?Xr(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}class So extends yo{}class To extends yo{constructor(e){super(),this.elements=e}}function Eo(e,t){const n=Po(t);for(const t of e.elements)n.some((e=>Wr(e,t)))||n.push(t);return{arrayValue:{values:n}}}class ko extends yo{constructor(e){super(),this.elements=e}}function Co(e,t){let n=Po(t);for(const t of e.elements)n=n.filter((e=>!Wr(e,t)));return{arrayValue:{values:n}}}class Io extends yo{constructor(e,t){super(),this.serializer=e,this.gt=t}}function Ro(e){return jr(e.integerValue||e.doubleValue)}function Po(e){return es(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Ao{constructor(e,t){this.field=e,this.transform=t}}class No{constructor(e,t){this.version=e,this.transformResults=t}}class xo{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new xo}static exists(e){return new xo(void 0,e)}static updateTime(e){return new xo(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Do(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Oo{}function Lo(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Go(e.key,xo.none()):new Vo(e.key,e.data,xo.none());{const n=e.data,i=os.empty();let r=new Ar(sr.comparator);for(let e of t.fields)if(!r.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?i.delete(e):i.set(e,t),r=r.add(e)}return new Bo(e.key,i,new xr(r.toArray()),xo.none())}}function Mo(e,t,n){e instanceof Vo?function(e,t,n){const i=e.value.clone(),r=$o(e.fieldTransforms,t,n.transformResults);i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):e instanceof Bo?function(e,t,n){if(!Do(e.precondition,t))return void t.convertToUnknownDocument(n.version);const i=$o(e.fieldTransforms,t,n.transformResults),r=t.data;r.setAll(zo(e)),r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function jo(e,t,n,i){return e instanceof Vo?function(e,t,n,i){if(!Do(e.precondition,t))return n;const r=e.value.clone(),s=qo(e.fieldTransforms,i,t);return r.setAll(s),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null}(e,t,n,i):e instanceof Bo?function(e,t,n,i){if(!Do(e.precondition,t))return n;const r=qo(e.fieldTransforms,i,t),s=t.data;return s.setAll(zo(e)),s.setAll(r),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,i):function(e,t,n){return Do(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Uo(e,t){let n=null;for(const i of e.fieldTransforms){const e=t.data.field(i.field),r=wo(i.transform,e||null);null!=r&&(null===n&&(n=os.empty()),n.set(i.field,r))}return n||null}function Fo(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Xi(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof To&&t instanceof To||e instanceof ko&&t instanceof ko?Xi(e.elements,t.elements,Wr):e instanceof Io&&t instanceof Io?Wr(e.gt,t.gt):e instanceof So&&t instanceof So}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Vo extends Oo{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Bo extends Oo{constructor(e,t,n,i,r=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function zo(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const i=e.data.field(n);t.set(n,i)}})),t}function $o(e,t,n){const i=new Map;ji(e.length===n.length);for(let r=0;r<n.length;r++){const s=e[r],o=s.transform,a=t.data.field(s.field);i.set(s.field,_o(o,a,n[r]))}return i}function qo(e,t,n){const i=new Map;for(const r of e){const e=r.transform,s=n.data.field(r.field);i.set(r.field,bo(e,s,t))}return i}class Go extends Oo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Wo extends Oo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Ho{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const i=this.mutations[t];i.key.isEqual(e.key)&&Mo(i,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=jo(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=jo(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=ao();return this.mutations.forEach((i=>{const r=e.get(i.key),s=r.overlayedDocument;let o=this.applyToLocalView(s,r.mutatedFields);o=t.has(i.key)?null:o;const a=Lo(s,o);null!==a&&n.set(i.key,a),s.isValidDocument()||s.convertToNoDocument(tr.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),ho())}isEqual(e){return this.batchId===e.batchId&&Xi(this.mutations,e.mutations,((e,t)=>Fo(e,t)))&&Xi(this.baseMutations,e.baseMutations,((e,t)=>Fo(e,t)))}}class Ko{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){ji(e.mutations.length===n.length);let i=co;const r=e.mutations;for(let e=0;e<r.length;e++)i=i.insert(r[e].key,n[e].version);return new Ko(e,t,n,i)}}class Jo{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Qo{constructor(e,t){this.count=e,this.unchangedNames=t}}var Yo,Zo;function Xo(e){switch(e){default:return Mi();case Fi.CANCELLED:case Fi.UNKNOWN:case Fi.DEADLINE_EXCEEDED:case Fi.RESOURCE_EXHAUSTED:case Fi.INTERNAL:case Fi.UNAVAILABLE:case Fi.UNAUTHENTICATED:return!1;case Fi.INVALID_ARGUMENT:case Fi.NOT_FOUND:case Fi.ALREADY_EXISTS:case Fi.PERMISSION_DENIED:case Fi.FAILED_PRECONDITION:case Fi.ABORTED:case Fi.OUT_OF_RANGE:case Fi.UNIMPLEMENTED:case Fi.DATA_LOSS:return!0}}function ea(e){if(void 0===e)return Di("GRPC error has no .code"),Fi.UNKNOWN;switch(e){case Yo.OK:return Fi.OK;case Yo.CANCELLED:return Fi.CANCELLED;case Yo.UNKNOWN:return Fi.UNKNOWN;case Yo.DEADLINE_EXCEEDED:return Fi.DEADLINE_EXCEEDED;case Yo.RESOURCE_EXHAUSTED:return Fi.RESOURCE_EXHAUSTED;case Yo.INTERNAL:return Fi.INTERNAL;case Yo.UNAVAILABLE:return Fi.UNAVAILABLE;case Yo.UNAUTHENTICATED:return Fi.UNAUTHENTICATED;case Yo.INVALID_ARGUMENT:return Fi.INVALID_ARGUMENT;case Yo.NOT_FOUND:return Fi.NOT_FOUND;case Yo.ALREADY_EXISTS:return Fi.ALREADY_EXISTS;case Yo.PERMISSION_DENIED:return Fi.PERMISSION_DENIED;case Yo.FAILED_PRECONDITION:return Fi.FAILED_PRECONDITION;case Yo.ABORTED:return Fi.ABORTED;case Yo.OUT_OF_RANGE:return Fi.OUT_OF_RANGE;case Yo.UNIMPLEMENTED:return Fi.UNIMPLEMENTED;case Yo.DATA_LOSS:return Fi.DATA_LOSS;default:return Mi()}}(Zo=Yo||(Yo={}))[Zo.OK=0]="OK",Zo[Zo.CANCELLED=1]="CANCELLED",Zo[Zo.UNKNOWN=2]="UNKNOWN",Zo[Zo.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Zo[Zo.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Zo[Zo.NOT_FOUND=5]="NOT_FOUND",Zo[Zo.ALREADY_EXISTS=6]="ALREADY_EXISTS",Zo[Zo.PERMISSION_DENIED=7]="PERMISSION_DENIED",Zo[Zo.UNAUTHENTICATED=16]="UNAUTHENTICATED",Zo[Zo.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Zo[Zo.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Zo[Zo.ABORTED=10]="ABORTED",Zo[Zo.OUT_OF_RANGE=11]="OUT_OF_RANGE",Zo[Zo.UNIMPLEMENTED=12]="UNIMPLEMENTED",Zo[Zo.INTERNAL=13]="INTERNAL",Zo[Zo.UNAVAILABLE=14]="UNAVAILABLE",Zo[Zo.DATA_LOSS=15]="DATA_LOSS";class ta{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return na}static getOrCreateInstance(){return null===na&&(na=new ta),na}onExistenceFilterMismatch(e){const t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach((t=>t(e)))}}let na=null;function ia(){return new TextEncoder}const ra=new Ci([4294967295,4294967295],0);function sa(e){const t=ia().encode(e),n=new ki;return n.update(t),new Uint8Array(n.digest())}function oa(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),i=t.getUint32(4,!0),r=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new Ci([n,i],0),new Ci([r,s],0)]}class aa{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new la(`Invalid padding: ${t}`);if(n<0)throw new la(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new la(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new la(`Invalid padding when bitmap length is 0: ${t}`);this.It=8*e.length-t,this.Tt=Ci.fromNumber(this.It)}Et(e,t,n){let i=e.add(t.multiply(Ci.fromNumber(n)));return 1===i.compare(ra)&&(i=new Ci([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Tt).toNumber()}At(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}vt(e){if(0===this.It)return!1;const t=sa(e),[n,i]=oa(t);for(let e=0;e<this.hashCount;e++){const t=this.Et(n,i,e);if(!this.At(t))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,r=new Uint8Array(Math.ceil(e/8)),s=new aa(r,i,t);return n.forEach((e=>s.insert(e))),s}insert(e){if(0===this.It)return;const t=sa(e),[n,i]=oa(t);for(let e=0;e<this.hashCount;e++){const t=this.Et(n,i,e);this.Rt(t)}}Rt(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class la extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ca{constructor(e,t,n,i,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,ua.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new ca(tr.min(),i,new Ir(Zi),no(),ho())}}class ua{constructor(e,t,n,i,r){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new ua(n,t,ho(),ho(),ho())}}class da{constructor(e,t,n,i){this.Pt=e,this.removedTargetIds=t,this.key=n,this.bt=i}}class ha{constructor(e,t){this.targetId=e,this.Vt=t}}class pa{constructor(e,t,n=Or.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class fa{constructor(){this.St=0,this.Dt=va(),this.Ct=Or.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return 0!==this.St}get Mt(){return this.Nt}$t(e){e.approximateByteSize()>0&&(this.Nt=!0,this.Ct=e)}Ot(){let e=ho(),t=ho(),n=ho();return this.Dt.forEach(((i,r)=>{switch(r){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:Mi()}})),new ua(this.Ct,this.xt,e,t,n)}Ft(){this.Nt=!1,this.Dt=va()}Bt(e,t){this.Nt=!0,this.Dt=this.Dt.insert(e,t)}Lt(e){this.Nt=!0,this.Dt=this.Dt.remove(e)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class ma{constructor(e){this.Gt=e,this.Qt=new Map,this.jt=no(),this.zt=ga(),this.Wt=new Ir(Zi)}Ht(e){for(const t of e.Pt)e.bt&&e.bt.isFoundDocument()?this.Jt(t,e.bt):this.Yt(t,e.key,e.bt);for(const t of e.removedTargetIds)this.Yt(t,e.key,e.bt)}Xt(e){this.forEachTarget(e,(t=>{const n=this.Zt(t);switch(e.state){case 0:this.te(t)&&n.$t(e.resumeToken);break;case 1:n.Ut(),n.kt||n.Ft(),n.$t(e.resumeToken);break;case 2:n.Ut(),n.kt||this.removeTarget(t);break;case 3:this.te(t)&&(n.Kt(),n.$t(e.resumeToken));break;case 4:this.te(t)&&(this.ee(t),n.$t(e.resumeToken));break;default:Mi()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Qt.forEach(((e,n)=>{this.te(n)&&t(n)}))}ne(e){var t;const n=e.targetId,i=e.Vt.count,r=this.se(n);if(r){const s=r.target;if(Ls(s))if(0===i){const e=new or(s.path);this.Yt(n,e,ls.newNoDocument(e,tr.min()))}else ji(1===i);else{const r=this.ie(n);if(r!==i){const i=this.re(e,r);if(0!==i){this.ee(n);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Wt=this.Wt.insert(n,e)}null===(t=ta.instance)||void 0===t||t.notifyOnExistenceFilterMismatch(function(e,t,n){var i,r,s,o,a,l;const c={localCacheCount:t,existenceFilterCount:n.count},u=n.unchangedNames;return u&&(c.bloomFilter={applied:0===e,hashCount:null!==(i=null==u?void 0:u.hashCount)&&void 0!==i?i:0,bitmapLength:null!==(o=null===(s=null===(r=null==u?void 0:u.bits)||void 0===r?void 0:r.bitmap)||void 0===s?void 0:s.length)&&void 0!==o?o:0,padding:null!==(l=null===(a=null==u?void 0:u.bits)||void 0===a?void 0:a.padding)&&void 0!==l?l:0}),c}(i,r,e.Vt))}}}}re(e,t){const{unchangedNames:n,count:i}=e.Vt;if(!n||!n.bits)return 1;const{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=n;let a,l;try{a=Ur(r).toUint8Array()}catch(e){if(e instanceof Dr)return Oi("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw e}try{l=new aa(a,s,o)}catch(e){return Oi(e instanceof la?"BloomFilter error: ":"Applying bloom filter failed: ",e),1}return 0===l.It?1:i!==t-this.oe(e.targetId,l)?2:0}oe(e,t){const n=this.Gt.getRemoteKeysForTarget(e);let i=0;return n.forEach((n=>{const r=this.Gt.ue(),s=`projects/${r.projectId}/databases/${r.database}/documents/${n.path.canonicalString()}`;t.vt(s)||(this.Yt(e,n,null),i++)})),i}ce(e){const t=new Map;this.Qt.forEach(((n,i)=>{const r=this.se(i);if(r){if(n.current&&Ls(r.target)){const t=new or(r.target.path);null!==this.jt.get(t)||this.ae(i,t)||this.Yt(i,t,ls.newNoDocument(t,e))}n.Mt&&(t.set(i,n.Ot()),n.Ft())}}));let n=ho();this.zt.forEach(((e,t)=>{let i=!0;t.forEachWhile((e=>{const t=this.se(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(i=!1,!1)})),i&&(n=n.add(e))})),this.jt.forEach(((t,n)=>n.setReadTime(e)));const i=new ca(e,t,this.Wt,this.jt,n);return this.jt=no(),this.zt=ga(),this.Wt=new Ir(Zi),i}Jt(e,t){if(!this.te(e))return;const n=this.ae(e,t.key)?2:0;this.Zt(e).Bt(t.key,n),this.jt=this.jt.insert(t.key,t),this.zt=this.zt.insert(t.key,this.he(t.key).add(e))}Yt(e,t,n){if(!this.te(e))return;const i=this.Zt(e);this.ae(e,t)?i.Bt(t,1):i.Lt(t),this.zt=this.zt.insert(t,this.he(t).delete(e)),n&&(this.jt=this.jt.insert(t,n))}removeTarget(e){this.Qt.delete(e)}ie(e){const t=this.Zt(e).Ot();return this.Gt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}qt(e){this.Zt(e).qt()}Zt(e){let t=this.Qt.get(e);return t||(t=new fa,this.Qt.set(e,t)),t}he(e){let t=this.zt.get(e);return t||(t=new Ar(Zi),this.zt=this.zt.insert(e,t)),t}te(e){const t=null!==this.se(e);return t||xi("WatchChangeAggregator","Detected inactive target",e),t}se(e){const t=this.Qt.get(e);return t&&t.kt?null:this.Gt.le(e)}ee(e){this.Qt.set(e,new fa),this.Gt.getRemoteKeysForTarget(e).forEach((t=>{this.Yt(e,t,null)}))}ae(e,t){return this.Gt.getRemoteKeysForTarget(e).has(t)}}function ga(){return new Ir(or.comparator)}function va(){return new Ir(or.comparator)}const ya={asc:"ASCENDING",desc:"DESCENDING"},ba={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},_a={and:"AND",or:"OR"};class wa{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Sa(e,t){return e.useProto3Json||yr(t)?t:{value:t}}function Ta(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Ea(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function ka(e,t){return Ta(e,t.toTimestamp())}function Ca(e){return ji(!!e),tr.fromTimestamp(function(e){const t=Mr(e);return new er(t.seconds,t.nanos)}(e))}function Ia(e,t){return function(e){return new ir(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function Ra(e){const t=ir.fromString(e);return ji(Ka(t)),t}function Pa(e,t){return Ia(e.databaseId,t.path)}function Aa(e,t){const n=Ra(t);if(n.get(1)!==e.databaseId.projectId)throw new Vi(Fi.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Vi(Fi.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new or(Oa(n))}function Na(e,t){return Ia(e.databaseId,t)}function xa(e){const t=Ra(e);return 4===t.length?ir.emptyPath():Oa(t)}function Da(e){return new ir(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Oa(e){return ji(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function La(e,t,n){return{name:Pa(e,t),fields:n.value.mapValue.fields}}function Ma(e,t){let n;if(t instanceof Vo)n={update:La(e,t.key,t.value)};else if(t instanceof Go)n={delete:Pa(e,t.key)};else if(t instanceof Bo)n={update:La(e,t.key,t.data),updateMask:Ha(t.fieldMask)};else{if(!(t instanceof Wo))return Mi();n={verify:Pa(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof So)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof To)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof ko)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Io)return{fieldPath:t.field.canonicalString(),increment:n.gt};throw Mi()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:ka(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Mi()}(e,t.precondition)),n}function ja(e,t){return{documents:[Na(e,t.path)]}}function Ua(e,t){const n={structuredQuery:{}},i=t.path;null!==t.collectionGroup?(n.parent=Na(e,i),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Na(e,i.popLast()),n.structuredQuery.from=[{collectionId:i.lastSegment()}]);const r=function(e){if(0!==e.length)return Wa(gs.create(e,"and"))}(t.filters);r&&(n.structuredQuery.where=r);const s=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:qa(e.field),direction:Ba(e.dir)}}(e)))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=Sa(e,t.limit);var a;return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(a=t.startAt).inclusive,values:a.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function Fa(e){let t=xa(e.parent);const n=e.structuredQuery,i=n.from?n.from.length:0;let r=null;if(i>0){ji(1===i);const e=n.from[0];e.allDescendants?r=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=Va(e);return t instanceof gs&&ys(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((e=>function(e){return new hs(Ga(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,yr(t)?null:t}(n.limit));let l=null;n.startAt&&(l=function(e){const t=!!e.before,n=e.values||[];return new cs(n,t)}(n.startAt));let c=null;return n.endAt&&(c=function(e){const t=!e.before,n=e.values||[];return new cs(n,t)}(n.endAt)),js(t,r,o,s,a,"F",l,c)}function Va(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Ga(e.unaryFilter.field);return ms.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Ga(e.unaryFilter.field);return ms.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Ga(e.unaryFilter.field);return ms.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=Ga(e.unaryFilter.field);return ms.create(r,"!=",{nullValue:"NULL_VALUE"});default:return Mi()}}(e):void 0!==e.fieldFilter?function(e){return ms.create(Ga(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Mi()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return gs.create(e.compositeFilter.filters.map((e=>Va(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Mi()}}(e.compositeFilter.op))}(e):Mi()}function Ba(e){return ya[e]}function za(e){return ba[e]}function $a(e){return _a[e]}function qa(e){return{fieldPath:e.canonicalString()}}function Ga(e){return sr.fromServerFormat(e.fieldPath)}function Wa(e){return e instanceof ms?function(e){if("=="===e.op){if(ns(e.value))return{unaryFilter:{field:qa(e.field),op:"IS_NAN"}};if(ts(e.value))return{unaryFilter:{field:qa(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(ns(e.value))return{unaryFilter:{field:qa(e.field),op:"IS_NOT_NAN"}};if(ts(e.value))return{unaryFilter:{field:qa(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:qa(e.field),op:za(e.op),value:e.value}}}(e):e instanceof gs?function(e){const t=e.getFilters().map((e=>Wa(e)));return 1===t.length?t[0]:{compositeFilter:{op:$a(e.op),filters:t}}}(e):Mi()}function Ha(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Ka(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Ja{constructor(e,t,n,i,r=tr.min(),s=tr.min(),o=Or.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new Ja(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Ja(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ja(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ja(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Qa{constructor(e){this.fe=e}}function Ya(e){const t=Fa({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Ws(t,t.limit,"L"):t}class Za{constructor(){}_e(e,t){this.me(e,t),t.ge()}me(e,t){if("nullValue"in e)this.ye(t,5);else if("booleanValue"in e)this.ye(t,10),t.pe(e.booleanValue?1:0);else if("integerValue"in e)this.ye(t,15),t.pe(jr(e.integerValue));else if("doubleValue"in e){const n=jr(e.doubleValue);isNaN(n)?this.ye(t,13):(this.ye(t,15),br(n)?t.pe(0):t.pe(n))}else if("timestampValue"in e){const n=e.timestampValue;this.ye(t,20),"string"==typeof n?t.Ie(n):(t.Ie(`${n.seconds||""}`),t.pe(n.nanos||0))}else if("stringValue"in e)this.Te(e.stringValue,t),this.Ee(t);else if("bytesValue"in e)this.ye(t,30),t.Ae(Ur(e.bytesValue)),this.Ee(t);else if("referenceValue"in e)this.ve(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.ye(t,45),t.pe(n.latitude||0),t.pe(n.longitude||0)}else"mapValue"in e?ss(e)?this.ye(t,Number.MAX_SAFE_INTEGER):(this.Re(e.mapValue,t),this.Ee(t)):"arrayValue"in e?(this.Pe(e.arrayValue,t),this.Ee(t)):Mi()}Te(e,t){this.ye(t,25),this.be(e,t)}be(e,t){t.Ie(e)}Re(e,t){const n=e.fields||{};this.ye(t,55);for(const e of Object.keys(n))this.Te(e,t),this.me(n[e],t)}Pe(e,t){const n=e.values||[];this.ye(t,50);for(const e of n)this.me(e,t)}ve(e,t){this.ye(t,37),or.fromName(e).path.forEach((e=>{this.ye(t,60),this.be(e,t)}))}ye(e,t){e.pe(t)}Ee(e){e.pe(2)}}Za.Ve=new Za;class Xa{constructor(){this.rn=new el}addToCollectionParentIndex(e,t){return this.rn.add(t),mr.resolve()}getCollectionParents(e,t){return mr.resolve(this.rn.getEntries(t))}addFieldIndex(e,t){return mr.resolve()}deleteFieldIndex(e,t){return mr.resolve()}getDocumentsMatchingTarget(e,t){return mr.resolve(null)}getIndexType(e,t){return mr.resolve(0)}getFieldIndexes(e,t){return mr.resolve([])}getNextCollectionGroupToUpdate(e){return mr.resolve(null)}getMinOffset(e,t){return mr.resolve(ur.min())}getMinOffsetFromCollectionGroup(e,t){return mr.resolve(ur.min())}updateCollectionGroup(e,t,n){return mr.resolve()}updateIndexEntries(e,t){return mr.resolve()}}class el{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new Ar(ir.comparator),r=!i.has(n);return this.index[t]=i.add(n),r}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new Ar(ir.comparator)).toArray()}}new Uint8Array(0);class tl{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new tl(e,tl.DEFAULT_COLLECTION_PERCENTILE,tl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}tl.DEFAULT_COLLECTION_PERCENTILE=10,tl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,tl.DEFAULT=new tl(41943040,tl.DEFAULT_COLLECTION_PERCENTILE,tl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),tl.DISABLED=new tl(-1,0,0);class nl{constructor(e){this.Nn=e}next(){return this.Nn+=2,this.Nn}static kn(){return new nl(0)}static Mn(){return new nl(-1)}}class il{constructor(){this.changes=new eo((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ls.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?mr.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class rl{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class sl{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((i=>(n=i,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&jo(n.mutation,e,xr.empty(),er.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,ho()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=ho()){const i=oo();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,n).next((e=>{let t=ro();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=oo();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,ho())))}populateOverlays(e,t,n){const i=[];return n.forEach((e=>{t.has(e)||i.push(e)})),this.documentOverlayCache.getOverlays(e,i).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,i){let r=no();const s=lo(),o=lo();return t.forEach(((e,t)=>{const o=n.get(t.key);i.has(t.key)&&(void 0===o||o.mutation instanceof Bo)?r=r.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),jo(o.mutation,t,o.mutation.getFieldMask(),er.now())):s.set(t.key,xr.empty())})),this.recalculateAndSaveOverlays(e,r).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new rl(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=lo();let i=new Ir(((e,t)=>e-t)),r=ho();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const r of e)r.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||xr.empty();o=r.applyToLocalView(s,o),n.set(e,o);const a=(i.get(r.batchId)||ho()).add(e);i=i.insert(r.batchId,a)}))})).next((()=>{const s=[],o=i.getReverseIterator();for(;o.hasNext();){const i=o.getNext(),a=i.key,l=i.value,c=ao();l.forEach((e=>{if(!r.has(e)){const i=Lo(t.get(e),n.get(e));null!==i&&c.set(e,i),r=r.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,a,c))}return mr.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n){return function(e){return or.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):zs(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next((r=>{const s=i-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-r.size):mr.resolve(oo());let o=-1,a=r;return s.next((t=>mr.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),r.get(t)?mr.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,r))).next((()=>this.computeViews(e,a,t,ho()))).next((e=>({batchId:o,changes:so(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new or(t)).next((e=>{let t=ro();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n){const i=t.collectionGroup;let r=ro();return this.indexManager.getCollectionParents(e,i).next((s=>mr.forEach(s,(s=>{const o=function(e,t){return new Ms(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(i));return this.getDocumentsMatchingCollectionQuery(e,o,n).next((e=>{e.forEach(((e,t)=>{r=r.insert(e,t)}))}))})).next((()=>r))))}getDocumentsMatchingCollectionQuery(e,t,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((r=>(i=r,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i)))).next((e=>{i.forEach(((t,n)=>{const i=n.getKey();null===e.get(i)&&(e=e.insert(i,ls.newInvalidDocument(i)))}));let n=ro();return e.forEach(((e,r)=>{const s=i.get(e);void 0!==s&&jo(s.mutation,r,xr.empty(),er.now()),Qs(t,r)&&(n=n.insert(e,r))})),n}))}}class ol{constructor(e){this.serializer=e,this.cs=new Map,this.hs=new Map}getBundleMetadata(e,t){return mr.resolve(this.cs.get(t))}saveBundleMetadata(e,t){var n;return this.cs.set(t.id,{id:(n=t).id,version:n.version,createTime:Ca(n.createTime)}),mr.resolve()}getNamedQuery(e,t){return mr.resolve(this.hs.get(t))}saveNamedQuery(e,t){return this.hs.set(t.name,function(e){return{name:e.name,query:Ya(e.bundledQuery),readTime:Ca(e.readTime)}}(t)),mr.resolve()}}class al{constructor(){this.overlays=new Ir(or.comparator),this.ls=new Map}getOverlay(e,t){return mr.resolve(this.overlays.get(t))}getOverlays(e,t){const n=oo();return mr.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,i)=>{this.we(e,t,i)})),mr.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.ls.get(n);return void 0!==i&&(i.forEach((e=>this.overlays=this.overlays.remove(e))),this.ls.delete(n)),mr.resolve()}getOverlaysForCollection(e,t,n){const i=oo(),r=t.length+1,s=new or(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===r&&e.largestBatchId>n&&i.set(e.getKey(),e)}return mr.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let r=new Ir(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=r.get(e.largestBatchId);null===t&&(t=oo(),r=r.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=oo(),a=r.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=i)););return mr.resolve(o)}we(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const e=this.ls.get(i.largestBatchId).delete(n.key);this.ls.set(i.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Jo(t,n));let r=this.ls.get(t);void 0===r&&(r=ho(),this.ls.set(t,r)),this.ls.set(t,r.add(n.key))}}class ll{constructor(){this.fs=new Ar(cl.ds),this.ws=new Ar(cl._s)}isEmpty(){return this.fs.isEmpty()}addReference(e,t){const n=new cl(e,t);this.fs=this.fs.add(n),this.ws=this.ws.add(n)}gs(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.ys(new cl(e,t))}ps(e,t){e.forEach((e=>this.removeReference(e,t)))}Is(e){const t=new or(new ir([])),n=new cl(t,e),i=new cl(t,e+1),r=[];return this.ws.forEachInRange([n,i],(e=>{this.ys(e),r.push(e.key)})),r}Ts(){this.fs.forEach((e=>this.ys(e)))}ys(e){this.fs=this.fs.delete(e),this.ws=this.ws.delete(e)}Es(e){const t=new or(new ir([])),n=new cl(t,e),i=new cl(t,e+1);let r=ho();return this.ws.forEachInRange([n,i],(e=>{r=r.add(e.key)})),r}containsKey(e){const t=new cl(e,0),n=this.fs.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class cl{constructor(e,t){this.key=e,this.As=t}static ds(e,t){return or.comparator(e.key,t.key)||Zi(e.As,t.As)}static _s(e,t){return Zi(e.As,t.As)||or.comparator(e.key,t.key)}}class ul{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.vs=1,this.Rs=new Ar(cl.ds)}checkEmpty(e){return mr.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const r=this.vs;this.vs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Ho(r,t,n,i);this.mutationQueue.push(s);for(const t of i)this.Rs=this.Rs.add(new cl(t.key,r)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return mr.resolve(s)}lookupMutationBatch(e,t){return mr.resolve(this.Ps(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=this.bs(n),r=i<0?0:i;return mr.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return mr.resolve(0===this.mutationQueue.length?-1:this.vs-1)}getAllMutationBatches(e){return mr.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new cl(t,0),i=new cl(t,Number.POSITIVE_INFINITY),r=[];return this.Rs.forEachInRange([n,i],(e=>{const t=this.Ps(e.As);r.push(t)})),mr.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Ar(Zi);return t.forEach((e=>{const t=new cl(e,0),i=new cl(e,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([t,i],(e=>{n=n.add(e.As)}))})),mr.resolve(this.Vs(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let r=n;or.isDocumentKey(r)||(r=r.child(""));const s=new cl(new or(r),0);let o=new Ar(Zi);return this.Rs.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===i&&(o=o.add(e.As)),!0)}),s),mr.resolve(this.Vs(o))}Vs(e){const t=[];return e.forEach((e=>{const n=this.Ps(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){ji(0===this.Ss(t.batchId,"removed")),this.mutationQueue.shift();let n=this.Rs;return mr.forEach(t.mutations,(i=>{const r=new cl(i.key,t.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Rs=n}))}Cn(e){}containsKey(e,t){const n=new cl(t,0),i=this.Rs.firstAfterOrEqual(n);return mr.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,mr.resolve()}Ss(e,t){return this.bs(e)}bs(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Ps(e){const t=this.bs(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class dl{constructor(e){this.Ds=e,this.docs=new Ir(or.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),r=i?i.size:0,s=this.Ds(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-r,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return mr.resolve(n?n.document.mutableCopy():ls.newInvalidDocument(t))}getEntries(e,t){let n=no();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():ls.newInvalidDocument(e))})),mr.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let r=no();const s=t.path,o=new or(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||dr(cr(o),n)<=0||(i.has(o.key)||Qs(t,o))&&(r=r.insert(o.key,o.mutableCopy()))}return mr.resolve(r)}getAllFromCollectionGroup(e,t,n,i){Mi()}Cs(e,t){return mr.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new hl(this)}getSize(e){return mr.resolve(this.size)}}class hl extends il{constructor(e){super(),this.os=e}applyChanges(e){const t=[];return this.changes.forEach(((n,i)=>{i.isValidDocument()?t.push(this.os.addEntry(e,i)):this.os.removeEntry(n)})),mr.waitFor(t)}getFromCache(e,t){return this.os.getEntry(e,t)}getAllFromCache(e,t){return this.os.getEntries(e,t)}}class pl{constructor(e){this.persistence=e,this.xs=new eo((e=>Ds(e)),Os),this.lastRemoteSnapshotVersion=tr.min(),this.highestTargetId=0,this.Ns=0,this.ks=new ll,this.targetCount=0,this.Ms=nl.kn()}forEachTarget(e,t){return this.xs.forEach(((e,n)=>t(n))),mr.resolve()}getLastRemoteSnapshotVersion(e){return mr.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return mr.resolve(this.Ns)}allocateTargetId(e){return this.highestTargetId=this.Ms.next(),mr.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Ns&&(this.Ns=t),mr.resolve()}Fn(e){this.xs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Ms=new nl(t),this.highestTargetId=t),e.sequenceNumber>this.Ns&&(this.Ns=e.sequenceNumber)}addTargetData(e,t){return this.Fn(t),this.targetCount+=1,mr.resolve()}updateTargetData(e,t){return this.Fn(t),mr.resolve()}removeTargetData(e,t){return this.xs.delete(t.target),this.ks.Is(t.targetId),this.targetCount-=1,mr.resolve()}removeTargets(e,t,n){let i=0;const r=[];return this.xs.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.xs.delete(s),r.push(this.removeMatchingKeysForTargetId(e,o.targetId)),i++)})),mr.waitFor(r).next((()=>i))}getTargetCount(e){return mr.resolve(this.targetCount)}getTargetData(e,t){const n=this.xs.get(t)||null;return mr.resolve(n)}addMatchingKeys(e,t,n){return this.ks.gs(t,n),mr.resolve()}removeMatchingKeys(e,t,n){this.ks.ps(t,n);const i=this.persistence.referenceDelegate,r=[];return i&&t.forEach((t=>{r.push(i.markPotentiallyOrphaned(e,t))})),mr.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.ks.Is(t),mr.resolve()}getMatchingKeysForTargetId(e,t){const n=this.ks.Es(t);return mr.resolve(n)}containsKey(e,t){return mr.resolve(this.ks.containsKey(t))}}class fl{constructor(e,t){this.$s={},this.overlays={},this.Os=new vr(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=e(this),this.Bs=new pl(this),this.indexManager=new Xa,this.remoteDocumentCache=function(e){return new dl(e)}((e=>this.referenceDelegate.Ls(e))),this.serializer=new Qa(t),this.qs=new ol(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new al,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.$s[e.toKey()];return n||(n=new ul(t,this.referenceDelegate),this.$s[e.toKey()]=n),n}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(e,t,n){xi("MemoryPersistence","Starting transaction:",e);const i=new ml(this.Os.next());return this.referenceDelegate.Us(),n(i).next((e=>this.referenceDelegate.Ks(i).next((()=>e)))).toPromise().then((e=>(i.raiseOnCommittedEvent(),e)))}Gs(e,t){return mr.or(Object.values(this.$s).map((n=>()=>n.containsKey(e,t))))}}class ml extends pr{constructor(e){super(),this.currentSequenceNumber=e}}class gl{constructor(e){this.persistence=e,this.Qs=new ll,this.js=null}static zs(e){return new gl(e)}get Ws(){if(this.js)return this.js;throw Mi()}addReference(e,t,n){return this.Qs.addReference(n,t),this.Ws.delete(n.toString()),mr.resolve()}removeReference(e,t,n){return this.Qs.removeReference(n,t),this.Ws.add(n.toString()),mr.resolve()}markPotentiallyOrphaned(e,t){return this.Ws.add(t.toString()),mr.resolve()}removeTarget(e,t){this.Qs.Is(t.targetId).forEach((e=>this.Ws.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Ws.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Us(){this.js=new Set}Ks(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return mr.forEach(this.Ws,(n=>{const i=or.fromPath(n);return this.Hs(e,i).next((e=>{e||t.removeEntry(i,tr.min())}))})).next((()=>(this.js=null,t.apply(e))))}updateLimboDocument(e,t){return this.Hs(e,t).next((e=>{e?this.Ws.delete(t.toString()):this.Ws.add(t.toString())}))}Ls(e){return 0}Hs(e,t){return mr.or([()=>mr.resolve(this.Qs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gs(e,t)])}}class vl{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Fi=n,this.Bi=i}static Li(e,t){let n=ho(),i=ho();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:i=i.add(e.doc.key)}return new vl(e,t.fromCache,n,i)}}class yl{constructor(){this.qi=!1}initialize(e,t){this.Ui=e,this.indexManager=t,this.qi=!0}getDocumentsMatchingQuery(e,t,n,i){return this.Ki(e,t).next((r=>r||this.Gi(e,t,i,n))).next((n=>n||this.Qi(e,t)))}Ki(e,t){if(Fs(t))return mr.resolve(null);let n=qs(t);return this.indexManager.getIndexType(e,n).next((i=>0===i?null:(null!==t.limit&&1===i&&(t=Ws(t,null,"F"),n=qs(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((i=>{const r=ho(...i);return this.Ui.getDocuments(e,r).next((i=>this.indexManager.getMinOffset(e,n).next((n=>{const s=this.ji(t,i);return this.zi(t,s,r,n.readTime)?this.Ki(e,Ws(t,null,"F")):this.Wi(e,s,t,n)}))))})))))}Gi(e,t,n,i){return Fs(t)||i.isEqual(tr.min())?this.Qi(e,t):this.Ui.getDocuments(e,n).next((r=>{const s=this.ji(t,r);return this.zi(t,s,n,i)?this.Qi(e,t):(Ni()<=o.in.DEBUG&&xi("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Js(t)),this.Wi(e,s,t,lr(i,-1)))}))}ji(e,t){let n=new Ar(Zs(e));return t.forEach(((t,i)=>{Qs(e,i)&&(n=n.add(i))})),n}zi(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const r="F"===e.limitType?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}Qi(e,t){return Ni()<=o.in.DEBUG&&xi("QueryEngine","Using full collection scan to execute query:",Js(t)),this.Ui.getDocumentsMatchingQuery(e,t,ur.min())}Wi(e,t,n,i){return this.Ui.getDocumentsMatchingQuery(e,n,i).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class bl{constructor(e,t,n,i){this.persistence=e,this.Hi=t,this.serializer=i,this.Ji=new Ir(Zi),this.Yi=new eo((e=>Ds(e)),Os),this.Xi=new Map,this.Zi=e.getRemoteDocumentCache(),this.Bs=e.getTargetCache(),this.qs=e.getBundleCache(),this.tr(n)}tr(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new sl(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ji)))}}function _l(e,t,n,i){return new bl(e,t,n,i)}async function wl(e,t){const n=Ui(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let i;return n.mutationQueue.getAllMutationBatches(e).next((r=>(i=r,n.tr(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const r=[],s=[];let o=ho();for(const e of i){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({er:e,removedBatchIds:r,addedBatchIds:s})))}))}))}function Sl(e){const t=Ui(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Bs.getLastRemoteSnapshotVersion(e)))}function Tl(e,t,n){let i=ho(),r=ho();return n.forEach((e=>i=i.add(e))),t.getEntries(e,i).next((e=>{let i=no();return n.forEach(((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(r=r.add(n)),s.isNoDocument()&&s.version.isEqual(tr.min())?(t.removeEntry(n,s.readTime),i=i.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),i=i.insert(n,s)):xi("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{nr:i,sr:r}}))}function El(e,t){const n=Ui(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}function kl(e,t){const n=Ui(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let i;return n.Bs.getTargetData(e,t).next((r=>r?(i=r,mr.resolve(i)):n.Bs.allocateTargetId(e).next((r=>(i=new Ja(t,r,"TargetPurposeListen",e.currentSequenceNumber),n.Bs.addTargetData(e,i).next((()=>i)))))))})).then((e=>{const i=n.Ji.get(e.targetId);return(null===i||e.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ji=n.Ji.insert(e.targetId,e),n.Yi.set(t,e.targetId)),e}))}async function Cl(e,t,n){const i=Ui(e),r=i.Ji.get(t),s=n?"readwrite":"readwrite-primary";try{n||await i.persistence.runTransaction("Release target",s,(e=>i.persistence.referenceDelegate.removeTarget(e,r)))}catch(e){if(!gr(e))throw e;xi("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}i.Ji=i.Ji.remove(t),i.Yi.delete(r.target)}function Il(e,t,n){const i=Ui(e);let r=tr.min(),s=ho();return i.persistence.runTransaction("Execute query","readonly",(e=>function(e,t,n){const i=Ui(e),r=i.Yi.get(n);return void 0!==r?mr.resolve(i.Ji.get(r)):i.Bs.getTargetData(t,n)}(i,e,qs(t)).next((t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,i.Bs.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>i.Hi.getDocumentsMatchingQuery(e,t,n?r:tr.min(),n?s:ho()))).next((e=>(Rl(i,Ys(t),e),{documents:e,ir:s})))))}function Rl(e,t,n){let i=e.Xi.get(t)||tr.min();n.forEach(((e,t)=>{t.readTime.compareTo(i)>0&&(i=t.readTime)})),e.Xi.set(t,i)}class Pl{constructor(){this.activeTargetIds=fo()}lr(e){this.activeTargetIds=this.activeTargetIds.add(e)}dr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}hr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Al{constructor(){this.Hr=new Pl,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Hr.lr(e),this.Jr[e]||"not-current"}updateQueryState(e,t,n){this.Jr[e]=t}removeLocalQueryTarget(e){this.Hr.dr(e)}isLocalQueryTarget(e){return this.Hr.activeTargetIds.has(e)}clearQueryState(e){delete this.Jr[e]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(e){return this.Hr.activeTargetIds.has(e)}start(){return this.Hr=new Pl,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Nl{Yr(e){}shutdown(){}}class xl{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(e){this.so.push(e)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){xi("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.so)e(0)}no(){xi("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.so)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Dl=null;function Ol(){return null===Dl?Dl=268435456+Math.round(2147483648*Math.random()):Dl++,"0x"+Dl.toString(16)}const Ll={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Ml{constructor(e){this.ro=e.ro,this.oo=e.oo}uo(e){this.co=e}ao(e){this.ho=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.ro(e)}fo(){this.co()}wo(e){this.ho(e)}_o(e){this.lo(e)}}const jl="WebChannelConnection";class Ul extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.mo=t+"://"+e.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(e,t,n,i,r){const s=Ol(),o=this.To(e,t);xi("RestConnection",`Sending RPC '${e}' ${s}:`,o,n);const a={};return this.Eo(a,i,r),this.Ao(e,o,a,n).then((t=>(xi("RestConnection",`Received RPC '${e}' ${s}: `,t),t)),(t=>{throw Oi("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t}))}vo(e,t,n,i,r,s){return this.Io(e,t,n,i,r)}Eo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Pi,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}To(e,t){const n=Ll[e];return`${this.mo}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ao(e,t,n,i){const r=Ol();return new Promise(((s,o)=>{const a=new Ei;a.setWithCredentials(!0),a.listenOnce(bi.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case yi.NO_ERROR:const t=a.getResponseJson();xi(jl,`XHR for RPC '${e}' ${r} received:`,JSON.stringify(t)),s(t);break;case yi.TIMEOUT:xi(jl,`RPC '${e}' ${r} timed out`),o(new Vi(Fi.DEADLINE_EXCEEDED,"Request time out"));break;case yi.HTTP_ERROR:const n=a.getStatus();if(xi(jl,`RPC '${e}' ${r} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Fi).indexOf(t)>=0?t:Fi.UNKNOWN}(t.status);o(new Vi(e,t.message))}else o(new Vi(Fi.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Vi(Fi.UNAVAILABLE,"Connection failed."));break;default:Mi()}}finally{xi(jl,`RPC '${e}' ${r} completed.`)}}));const l=JSON.stringify(i);xi(jl,`RPC '${e}' ${r} sending request:`,i),a.send(t,"POST",l,n,15)}))}Ro(e,t,n){const i=Ol(),r=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=gi(),o=vi(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(a.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(a.xmlHttpFactory=new Si({})),this.Eo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const c=r.join("");xi(jl,`Creating RPC '${e}' stream ${i}: ${c}`,a);const u=s.createWebChannel(c,a);let d=!1,h=!1;const p=new Ml({ro:t=>{h?xi(jl,`Not sending because RPC '${e}' stream ${i} is closed:`,t):(d||(xi(jl,`Opening RPC '${e}' stream ${i} transport.`),u.open(),d=!0),xi(jl,`RPC '${e}' stream ${i} sending:`,t),u.send(t))},oo:()=>u.close()}),f=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return f(u,Ti.EventType.OPEN,(()=>{h||xi(jl,`RPC '${e}' stream ${i} transport opened.`)})),f(u,Ti.EventType.CLOSE,(()=>{h||(h=!0,xi(jl,`RPC '${e}' stream ${i} transport closed`),p.wo())})),f(u,Ti.EventType.ERROR,(t=>{h||(h=!0,Oi(jl,`RPC '${e}' stream ${i} transport errored:`,t),p.wo(new Vi(Fi.UNAVAILABLE,"The operation could not be completed")))})),f(u,Ti.EventType.MESSAGE,(t=>{var n;if(!h){const r=t.data[0];ji(!!r);const s=r,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){xi(jl,`RPC '${e}' stream ${i} received error:`,o);const t=o.status;let n=function(e){const t=Yo[e];if(void 0!==t)return ea(t)}(t),r=o.message;void 0===n&&(n=Fi.INTERNAL,r="Unknown error status: "+t+" with message "+o.message),h=!0,p.wo(new Vi(n,r)),u.close()}else xi(jl,`RPC '${e}' stream ${i} received:`,r),p._o(r)}})),f(o,_i.STAT_EVENT,(t=>{t.stat===wi.PROXY?xi(jl,`RPC '${e}' stream ${i} detected buffering proxy`):t.stat===wi.NOPROXY&&xi(jl,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{p.fo()}),0),p}}function Fl(){return"undefined"!=typeof document?document:null}function Vl(e){return new wa(e,!0)}class Bl{constructor(e,t,n=1e3,i=1.5,r=6e4){this.ii=e,this.timerId=t,this.Po=n,this.bo=i,this.Vo=r,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(e){this.cancel();const t=Math.floor(this.So+this.ko()),n=Math.max(0,Date.now()-this.Co),i=Math.max(0,t-n);i>0&&xi("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.So} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,i,(()=>(this.Co=Date.now(),e()))),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){null!==this.Do&&(this.Do.skipDelay(),this.Do=null)}cancel(){null!==this.Do&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}class zl{constructor(e,t,n,i,r,s,o,a){this.ii=e,this.$o=n,this.Oo=i,this.connection=r,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new Bl(e,t)}Uo(){return 1===this.state||5===this.state||this.Ko()}Ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Go()}async stop(){this.Uo()&&await this.close(0)}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&null===this.Bo&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,(()=>this.zo())))}Wo(e){this.Ho(),this.stream.send(e)}async zo(){if(this.Ko())return this.close(0)}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}async close(e,t){this.Ho(),this.Jo(),this.qo.cancel(),this.Fo++,4!==e?this.qo.reset():t&&t.code===Fi.RESOURCE_EXHAUSTED?(Di(t.toString()),Di("Using maximum backoff delay to prevent overloading the backend."),this.qo.xo()):t&&t.code===Fi.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Yo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.ao(t)}Yo(){}auth(){this.state=1;const e=this.Xo(this.Fo),t=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Fo===t&&this.Zo(e,n)}),(t=>{e((()=>{const e=new Vi(Fi.UNKNOWN,"Fetching auth token failed: "+t.message);return this.tu(e)}))}))}Zo(e,t){const n=this.Xo(this.Fo);this.stream=this.eu(e,t),this.stream.uo((()=>{n((()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,(()=>(this.Ko()&&(this.state=3),Promise.resolve()))),this.listener.uo())))})),this.stream.ao((e=>{n((()=>this.tu(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}Go(){this.state=5,this.qo.No((async()=>{this.state=0,this.start()}))}tu(e){return xi("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Xo(e){return t=>{this.ii.enqueueAndForget((()=>this.Fo===e?t():(xi("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class $l extends zl{constructor(e,t,n,i,r,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,s),this.serializer=r}eu(e,t){return this.connection.Ro("Listen",e,t)}onMessage(e){this.qo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const i=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Mi()}(t.targetChange.targetChangeType||"NO_CHANGE"),r=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(ji(void 0===t||"string"==typeof t),Or.fromBase64String(t||"")):(ji(void 0===t||t instanceof Uint8Array),Or.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?Fi.UNKNOWN:ea(e.code);return new Vi(t,e.message||"")}(o);n=new pa(i,r,s,a||null)}else if("documentChange"in t){t.documentChange;const i=t.documentChange;i.document,i.document.name,i.document.updateTime;const r=Aa(e,i.document.name),s=Ca(i.document.updateTime),o=i.document.createTime?Ca(i.document.createTime):tr.min(),a=new os({mapValue:{fields:i.document.fields}}),l=ls.newFoundDocument(r,s,o,a),c=i.targetIds||[],u=i.removedTargetIds||[];n=new da(c,u,l.key,l)}else if("documentDelete"in t){t.documentDelete;const i=t.documentDelete;i.document;const r=Aa(e,i.document),s=i.readTime?Ca(i.readTime):tr.min(),o=ls.newNoDocument(r,s),a=i.removedTargetIds||[];n=new da([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const i=t.documentRemove;i.document;const r=Aa(e,i.document),s=i.removedTargetIds||[];n=new da([],s,r,null)}else{if(!("filter"in t))return Mi();{t.filter;const e=t.filter;e.targetId;const{count:i=0,unchangedNames:r}=e,s=new Qo(i,r),o=e.targetId;n=new ha(o,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return tr.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?tr.min():t.readTime?Ca(t.readTime):tr.min()}(e);return this.listener.nu(t,n)}su(e){const t={};t.database=Da(this.serializer),t.addTarget=function(e,t){let n;const i=t.target;if(n=Ls(i)?{documents:ja(e,i)}:{query:Ua(e,i)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Ea(e,t.resumeToken);const i=Sa(e,t.expectedCount);null!==i&&(n.expectedCount=i)}else if(t.snapshotVersion.compareTo(tr.min())>0){n.readTime=Ta(e,t.snapshotVersion.toTimestamp());const i=Sa(e,t.expectedCount);null!==i&&(n.expectedCount=i)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Mi()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.Wo(t)}iu(e){const t={};t.database=Da(this.serializer),t.removeTarget=e,this.Wo(t)}}class ql extends zl{constructor(e,t,n,i,r,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,s),this.serializer=r,this.ru=!1}get ou(){return this.ru}start(){this.ru=!1,this.lastStreamToken=void 0,super.start()}Yo(){this.ru&&this.uu([])}eu(e,t){return this.connection.Ro("Write",e,t)}onMessage(e){if(ji(!!e.streamToken),this.lastStreamToken=e.streamToken,this.ru){this.qo.reset();const t=function(e,t){return e&&e.length>0?(ji(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?Ca(e.updateTime):Ca(t);return n.isEqual(tr.min())&&(n=Ca(t)),new No(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=Ca(e.commitTime);return this.listener.cu(n,t)}return ji(!e.writeResults||0===e.writeResults.length),this.ru=!0,this.listener.au()}hu(){const e={};e.database=Da(this.serializer),this.Wo(e)}uu(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>Ma(this.serializer,e)))};this.Wo(t)}}class Gl extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.lu=!1}fu(){if(this.lu)throw new Vi(Fi.FAILED_PRECONDITION,"The client has already been terminated.")}Io(e,t,n){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,r])=>this.connection.Io(e,t,n,i,r))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Fi.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Vi(Fi.UNKNOWN,e.toString())}))}vo(e,t,n,i){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,s])=>this.connection.vo(e,t,n,r,s,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Fi.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Vi(Fi.UNKNOWN,e.toString())}))}terminate(){this.lu=!0}}class Wl{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){0===this.wu&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve()))))}Iu(e){"Online"===this.state?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.yu("Offline")))}set(e){this.Tu(),this.wu=0,"Online"===e&&(this.mu=!1),this.yu(e)}yu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}pu(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.mu?(Di(t),this.mu=!1):xi("OnlineStateTracker",t)}Tu(){null!==this._u&&(this._u.cancel(),this._u=null)}}class Hl{constructor(e,t,n,i,r){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=r,this.Pu.Yr((e=>{n.enqueueAndForget((async()=>{nc(this)&&(xi("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=Ui(e);t.vu.add(4),await Jl(t),t.bu.set("Unknown"),t.vu.delete(4),await Kl(t)}(this))}))})),this.bu=new Wl(n,i)}}async function Kl(e){if(nc(e))for(const t of e.Ru)await t(!0)}async function Jl(e){for(const t of e.Ru)await t(!1)}function Ql(e,t){const n=Ui(e);n.Au.has(t.targetId)||(n.Au.set(t.targetId,t),tc(n)?ec(n):_c(n).Ko()&&Zl(n,t))}function Yl(e,t){const n=Ui(e),i=_c(n);n.Au.delete(t),i.Ko()&&Xl(n,t),0===n.Au.size&&(i.Ko()?i.jo():nc(n)&&n.bu.set("Unknown"))}function Zl(e,t){if(e.Vu.qt(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(tr.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}_c(e).su(t)}function Xl(e,t){e.Vu.qt(t),_c(e).iu(t)}function ec(e){e.Vu=new ma({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),le:t=>e.Au.get(t)||null,ue:()=>e.datastore.serializer.databaseId}),_c(e).start(),e.bu.gu()}function tc(e){return nc(e)&&!_c(e).Uo()&&e.Au.size>0}function nc(e){return 0===Ui(e).vu.size}function ic(e){e.Vu=void 0}async function rc(e){e.Au.forEach(((t,n)=>{Zl(e,t)}))}async function sc(e,t){ic(e),tc(e)?(e.bu.Iu(t),ec(e)):e.bu.set("Unknown")}async function oc(e,t,n){if(e.bu.set("Online"),t instanceof pa&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const i of t.targetIds)e.Au.has(i)&&(await e.remoteSyncer.rejectListen(i,n),e.Au.delete(i),e.Vu.removeTarget(i))}(e,t)}catch(n){xi("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await ac(e,n)}else if(t instanceof da?e.Vu.Ht(t):t instanceof ha?e.Vu.ne(t):e.Vu.Xt(t),!n.isEqual(tr.min()))try{const t=await Sl(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Vu.ce(t);return n.targetChanges.forEach(((n,i)=>{if(n.resumeToken.approximateByteSize()>0){const r=e.Au.get(i);r&&e.Au.set(i,r.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const i=e.Au.get(t);if(!i)return;e.Au.set(t,i.withResumeToken(Or.EMPTY_BYTE_STRING,i.snapshotVersion)),Xl(e,t);const r=new Ja(i.target,t,n,i.sequenceNumber);Zl(e,r)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){xi("RemoteStore","Failed to raise snapshot:",t),await ac(e,t)}}async function ac(e,t,n){if(!gr(t))throw t;e.vu.add(1),await Jl(e),e.bu.set("Offline"),n||(n=()=>Sl(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{xi("RemoteStore","Retrying IndexedDB access"),await n(),e.vu.delete(1),await Kl(e)}))}function lc(e,t){return t().catch((n=>ac(e,n,t)))}async function cc(e){const t=Ui(e),n=wc(t);let i=t.Eu.length>0?t.Eu[t.Eu.length-1].batchId:-1;for(;uc(t);)try{const e=await El(t.localStore,i);if(null===e){0===t.Eu.length&&n.jo();break}i=e.batchId,dc(t,e)}catch(e){await ac(t,e)}hc(t)&&pc(t)}function uc(e){return nc(e)&&e.Eu.length<10}function dc(e,t){e.Eu.push(t);const n=wc(e);n.Ko()&&n.ou&&n.uu(t.mutations)}function hc(e){return nc(e)&&!wc(e).Uo()&&e.Eu.length>0}function pc(e){wc(e).start()}async function fc(e){wc(e).hu()}async function mc(e){const t=wc(e);for(const n of e.Eu)t.uu(n.mutations)}async function gc(e,t,n){const i=e.Eu.shift(),r=Ko.from(i,t,n);await lc(e,(()=>e.remoteSyncer.applySuccessfulWrite(r))),await cc(e)}async function vc(e,t){t&&wc(e).ou&&await async function(e,t){if(Xo(n=t.code)&&n!==Fi.ABORTED){const n=e.Eu.shift();wc(e).Qo(),await lc(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await cc(e)}var n}(e,t),hc(e)&&pc(e)}async function yc(e,t){const n=Ui(e);n.asyncQueue.verifyOperationInProgress(),xi("RemoteStore","RemoteStore received new credentials");const i=nc(n);n.vu.add(3),await Jl(n),i&&n.bu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.vu.delete(3),await Kl(n)}async function bc(e,t){const n=Ui(e);t?(n.vu.delete(2),await Kl(n)):t||(n.vu.add(2),await Jl(n),n.bu.set("Unknown"))}function _c(e){return e.Su||(e.Su=function(e,t,n){const i=Ui(e);return i.fu(),new $l(t,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(e.datastore,e.asyncQueue,{uo:rc.bind(null,e),ao:sc.bind(null,e),nu:oc.bind(null,e)}),e.Ru.push((async t=>{t?(e.Su.Qo(),tc(e)?ec(e):e.bu.set("Unknown")):(await e.Su.stop(),ic(e))}))),e.Su}function wc(e){return e.Du||(e.Du=function(e,t,n){const i=Ui(e);return i.fu(),new ql(t,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(e.datastore,e.asyncQueue,{uo:fc.bind(null,e),ao:vc.bind(null,e),au:mc.bind(null,e),cu:gc.bind(null,e)}),e.Ru.push((async t=>{t?(e.Du.Qo(),await cc(e)):(await e.Du.stop(),e.Eu.length>0&&(xi("RemoteStore",`Stopping write stream with ${e.Eu.length} pending writes`),e.Eu=[]))}))),e.Du}class Sc{constructor(e,t,n,i,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=r,this.deferred=new Bi,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}static createAndSchedule(e,t,n,i,r){const s=Date.now()+n,o=new Sc(e,t,s,i,r);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Vi(Fi.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Tc(e,t){if(Di("AsyncQueue",`${t}: ${e}`),gr(e))return new Vi(Fi.UNAVAILABLE,`${t}: ${e}`);throw e}class Ec{constructor(e){this.comparator=e?(t,n)=>e(t,n)||or.comparator(t.key,n.key):(e,t)=>or.comparator(e.key,t.key),this.keyedMap=ro(),this.sortedSet=new Ir(this.comparator)}static emptySet(e){return new Ec(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ec))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(!e.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Ec;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class kc{constructor(){this.Cu=new Ir(or.comparator)}track(e){const t=e.doc.key,n=this.Cu.get(t);n?0!==e.type&&3===n.type?this.Cu=this.Cu.insert(t,e):3===e.type&&1!==n.type?this.Cu=this.Cu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Cu=this.Cu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Cu=this.Cu.remove(t):1===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):Mi():this.Cu=this.Cu.insert(t,e)}xu(){const e=[];return this.Cu.inorderTraversal(((t,n)=>{e.push(n)})),e}}class Cc{constructor(e,t,n,i,r,s,o,a,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=r,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,i,r){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new Cc(e,t,Ec.emptySet(t),s,n,i,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Hs(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class Ic{constructor(){this.Nu=void 0,this.listeners=[]}}class Rc{constructor(){this.queries=new eo((e=>Ks(e)),Hs),this.onlineState="Unknown",this.ku=new Set}}async function Pc(e,t){const n=Ui(e),i=t.query;let r=!1,s=n.queries.get(i);if(s||(r=!0,s=new Ic),r)try{s.Nu=await n.onListen(i)}catch(e){const n=Tc(e,`Initialization of query '${Js(t.query)}' failed`);return void t.onError(n)}n.queries.set(i,s),s.listeners.push(t),t.Mu(n.onlineState),s.Nu&&t.$u(s.Nu)&&Dc(n)}async function Ac(e,t){const n=Ui(e),i=t.query;let r=!1;const s=n.queries.get(i);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),r=0===s.listeners.length)}if(r)return n.queries.delete(i),n.onUnlisten(i)}function Nc(e,t){const n=Ui(e);let i=!1;for(const e of t){const t=e.query,r=n.queries.get(t);if(r){for(const t of r.listeners)t.$u(e)&&(i=!0);r.Nu=e}}i&&Dc(n)}function xc(e,t,n){const i=Ui(e),r=i.queries.get(t);if(r)for(const e of r.listeners)e.onError(n);i.queries.delete(t)}function Dc(e){e.ku.forEach((e=>{e.next()}))}class Oc{constructor(e,t,n){this.query=e,this.Ou=t,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=n||{}}$u(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Cc(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Fu?this.Lu(e)&&(this.Ou.next(e),t=!0):this.qu(e,this.onlineState)&&(this.Uu(e),t=!0),this.Bu=e,t}onError(e){this.Ou.error(e)}Mu(e){this.onlineState=e;let t=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,e)&&(this.Uu(this.Bu),t=!0),t}qu(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.Ku||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Lu(e){if(e.docChanges.length>0)return!0;const t=this.Bu&&this.Bu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Uu(e){e=Cc.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Fu=!0,this.Ou.next(e)}}class Lc{constructor(e){this.key=e}}class Mc{constructor(e){this.key=e}}class jc{constructor(e,t){this.query=e,this.Yu=t,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=ho(),this.mutatedKeys=ho(),this.tc=Zs(e),this.ec=new Ec(this.tc)}get nc(){return this.Yu}sc(e,t){const n=t?t.ic:new kc,i=t?t.ec:this.ec;let r=t?t.mutatedKeys:this.mutatedKeys,s=i,o=!1;const a="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,l="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((e,t)=>{const c=i.get(e),u=Qs(this.query,t)?t:null,d=!!c&&this.mutatedKeys.has(c.key),h=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let p=!1;c&&u?c.data.isEqual(u.data)?d!==h&&(n.track({type:3,doc:u}),p=!0):this.rc(c,u)||(n.track({type:2,doc:u}),p=!0,(a&&this.tc(u,a)>0||l&&this.tc(u,l)<0)&&(o=!0)):!c&&u?(n.track({type:0,doc:u}),p=!0):c&&!u&&(n.track({type:1,doc:c}),p=!0,(a||l)&&(o=!0)),p&&(u?(s=s.add(u),r=h?r.add(e):r.delete(e)):(s=s.delete(e),r=r.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),r=r.delete(e.key),n.track({type:1,doc:e})}return{ec:s,ic:n,zi:o,mutatedKeys:r}}rc(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const i=this.ec;this.ec=e.ec,this.mutatedKeys=e.mutatedKeys;const r=e.ic.xu();r.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Mi()}};return n(e)-n(t)}(e.type,t.type)||this.tc(e.doc,t.doc))),this.oc(n);const s=t?this.uc():[],o=0===this.Zu.size&&this.current?1:0,a=o!==this.Xu;return this.Xu=o,0!==r.length||a?{snapshot:new Cc(this.query,e.ec,i,r,e.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),cc:s}:{cc:s}}Mu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ec:this.ec,ic:new kc,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(e){return!this.Yu.has(e)&&!!this.ec.has(e)&&!this.ec.get(e).hasLocalMutations}oc(e){e&&(e.addedDocuments.forEach((e=>this.Yu=this.Yu.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.Yu=this.Yu.delete(e))),this.current=e.current)}uc(){if(!this.current)return[];const e=this.Zu;this.Zu=ho(),this.ec.forEach((e=>{this.ac(e.key)&&(this.Zu=this.Zu.add(e.key))}));const t=[];return e.forEach((e=>{this.Zu.has(e)||t.push(new Mc(e))})),this.Zu.forEach((n=>{e.has(n)||t.push(new Lc(n))})),t}hc(e){this.Yu=e.ir,this.Zu=ho();const t=this.sc(e.documents);return this.applyChanges(t,!0)}lc(){return Cc.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,0===this.Xu,this.hasCachedResults)}}class Uc{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Fc{constructor(e){this.key=e,this.fc=!1}}class Vc{constructor(e,t,n,i,r,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=s,this.dc={},this.wc=new eo((e=>Ks(e)),Hs),this._c=new Map,this.mc=new Set,this.gc=new Ir(or.comparator),this.yc=new Map,this.Ic=new ll,this.Tc={},this.Ec=new Map,this.Ac=nl.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return!0===this.vc}}async function Bc(e,t){const n=su(e);let i,r;const s=n.wc.get(t);if(s)i=s.targetId,n.sharedClientState.addLocalQueryTarget(i),r=s.view.lc();else{const e=await kl(n.localStore,qs(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);i=e.targetId,r=await zc(n,t,i,"current"===s,e.resumeToken),n.isPrimaryClient&&Ql(n.remoteStore,e)}return r}async function zc(e,t,n,i,r){e.Rc=(t,n,i)=>async function(e,t,n,i){let r=t.view.sc(n);r.zi&&(r=await Il(e.localStore,t.query,!1).then((({documents:e})=>t.view.sc(e,r))));const s=i&&i.targetChanges.get(t.targetId),o=t.view.applyChanges(r,e.isPrimaryClient,s);return Xc(e,t.targetId,o.cc),o.snapshot}(e,t,n,i);const s=await Il(e.localStore,t,!0),o=new jc(t,s.ir),a=o.sc(s.documents),l=ua.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==e.onlineState,r),c=o.applyChanges(a,e.isPrimaryClient,l);Xc(e,n,c.cc);const u=new Uc(t,n,o);return e.wc.set(t,u),e._c.has(n)?e._c.get(n).push(t):e._c.set(n,[t]),c.snapshot}async function $c(e,t){const n=Ui(e),i=n.wc.get(t),r=n._c.get(i.targetId);if(r.length>1)return n._c.set(i.targetId,r.filter((e=>!Hs(e,t)))),void n.wc.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await Cl(n.localStore,i.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(i.targetId),Yl(n.remoteStore,i.targetId),Yc(n,i.targetId)})).catch(fr)):(Yc(n,i.targetId),await Cl(n.localStore,i.targetId,!0))}async function qc(e,t){const n=Ui(e);try{const e=await function(e,t){const n=Ui(e),i=t.snapshotVersion;let r=n.Ji;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.Zi.newChangeBuffer({trackRemovals:!0});r=n.Ji;const o=[];t.targetChanges.forEach(((s,a)=>{const l=r.get(a);if(!l)return;o.push(n.Bs.removeMatchingKeys(e,s.removedDocuments,a).next((()=>n.Bs.addMatchingKeys(e,s.addedDocuments,a))));let c=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?c=c.withResumeToken(Or.EMPTY_BYTE_STRING,tr.min()).withLastLimboFreeSnapshotVersion(tr.min()):s.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(s.resumeToken,i)),r=r.insert(a,c),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(l,c,s)&&o.push(n.Bs.updateTargetData(e,c))}));let a=no(),l=ho();if(t.documentUpdates.forEach((i=>{t.resolvedLimboDocuments.has(i)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,i))})),o.push(Tl(e,s,t.documentUpdates).next((e=>{a=e.nr,l=e.sr}))),!i.isEqual(tr.min())){const t=n.Bs.getLastRemoteSnapshotVersion(e).next((t=>n.Bs.setTargetsMetadata(e,e.currentSequenceNumber,i)));o.push(t)}return mr.waitFor(o).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,l))).next((()=>a))})).then((e=>(n.Ji=r,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const i=n.yc.get(t);i&&(ji(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?i.fc=!0:e.modifiedDocuments.size>0?ji(i.fc):e.removedDocuments.size>0&&(ji(i.fc),i.fc=!1))})),await nu(n,e,t)}catch(e){await fr(e)}}function Gc(e,t,n){const i=Ui(e);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const e=[];i.wc.forEach(((n,i)=>{const r=i.view.Mu(t);r.snapshot&&e.push(r.snapshot)})),function(e,t){const n=Ui(e);n.onlineState=t;let i=!1;n.queries.forEach(((e,n)=>{for(const e of n.listeners)e.Mu(t)&&(i=!0)})),i&&Dc(n)}(i.eventManager,t),e.length&&i.dc.nu(e),i.onlineState=t,i.isPrimaryClient&&i.sharedClientState.setOnlineState(t)}}async function Wc(e,t,n){const i=Ui(e);i.sharedClientState.updateQueryState(t,"rejected",n);const r=i.yc.get(t),s=r&&r.key;if(s){let e=new Ir(or.comparator);e=e.insert(s,ls.newNoDocument(s,tr.min()));const n=ho().add(s),r=new ca(tr.min(),new Map,new Ir(Zi),e,n);await qc(i,r),i.gc=i.gc.remove(s),i.yc.delete(t),tu(i)}else await Cl(i.localStore,t,!1).then((()=>Yc(i,t,n))).catch(fr)}async function Hc(e,t){const n=Ui(e),i=t.batch.batchId;try{const e=await function(e,t){const n=Ui(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const i=t.batch.keys(),r=n.Zi.newChangeBuffer({trackRemovals:!0});return function(e,t,n,i){const r=n.batch,s=r.keys();let o=mr.resolve();return s.forEach((e=>{o=o.next((()=>i.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);ji(null!==s),t.version.compareTo(s)<0&&(r.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),i.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,r)))}(n,e,t,r).next((()=>r.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,i,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=ho();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,i)))}))}(n.localStore,t);Qc(n,i,null),Jc(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),await nu(n,e)}catch(e){await fr(e)}}async function Kc(e,t,n){const i=Ui(e);try{const e=await function(e,t){const n=Ui(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let i;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(ji(null!==t),i=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,i,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,i))).next((()=>n.localDocuments.getDocuments(e,i)))}))}(i.localStore,t);Qc(i,t,n),Jc(i,t),i.sharedClientState.updateMutationState(t,"rejected",n),await nu(i,e)}catch(n){await fr(n)}}function Jc(e,t){(e.Ec.get(t)||[]).forEach((e=>{e.resolve()})),e.Ec.delete(t)}function Qc(e,t,n){const i=Ui(e);let r=i.Tc[i.currentUser.toKey()];if(r){const e=r.get(t);e&&(n?e.reject(n):e.resolve(),r=r.remove(t)),i.Tc[i.currentUser.toKey()]=r}}function Yc(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const i of e._c.get(t))e.wc.delete(i),n&&e.dc.Pc(i,n);e._c.delete(t),e.isPrimaryClient&&e.Ic.Is(t).forEach((t=>{e.Ic.containsKey(t)||Zc(e,t)}))}function Zc(e,t){e.mc.delete(t.path.canonicalString());const n=e.gc.get(t);null!==n&&(Yl(e.remoteStore,n),e.gc=e.gc.remove(t),e.yc.delete(n),tu(e))}function Xc(e,t,n){for(const i of n)i instanceof Lc?(e.Ic.addReference(i.key,t),eu(e,i)):i instanceof Mc?(xi("SyncEngine","Document no longer in limbo: "+i.key),e.Ic.removeReference(i.key,t),e.Ic.containsKey(i.key)||Zc(e,i.key)):Mi()}function eu(e,t){const n=t.key,i=n.path.canonicalString();e.gc.get(n)||e.mc.has(i)||(xi("SyncEngine","New document in limbo: "+n),e.mc.add(i),tu(e))}function tu(e){for(;e.mc.size>0&&e.gc.size<e.maxConcurrentLimboResolutions;){const t=e.mc.values().next().value;e.mc.delete(t);const n=new or(ir.fromString(t)),i=e.Ac.next();e.yc.set(i,new Fc(n)),e.gc=e.gc.insert(n,i),Ql(e.remoteStore,new Ja(qs(Us(n.path)),i,"TargetPurposeLimboResolution",vr.ct))}}async function nu(e,t,n){const i=Ui(e),r=[],s=[],o=[];i.wc.isEmpty()||(i.wc.forEach(((e,a)=>{o.push(i.Rc(a,t,n).then((e=>{if((e||n)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(a.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){r.push(e);const t=vl.Li(a.targetId,e);s.push(t)}})))})),await Promise.all(o),i.dc.nu(r),await async function(e,t){const n=Ui(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>mr.forEach(t,(t=>mr.forEach(t.Fi,(i=>n.persistence.referenceDelegate.addReference(e,t.targetId,i))).next((()=>mr.forEach(t.Bi,(i=>n.persistence.referenceDelegate.removeReference(e,t.targetId,i)))))))))}catch(e){if(!gr(e))throw e;xi("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.Ji.get(t),i=e.snapshotVersion,r=e.withLastLimboFreeSnapshotVersion(i);n.Ji=n.Ji.insert(t,r)}}}(i.localStore,s))}async function iu(e,t){const n=Ui(e);if(!n.currentUser.isEqual(t)){xi("SyncEngine","User change. New user:",t.toKey());const e=await wl(n.localStore,t);n.currentUser=t,function(e,t){e.Ec.forEach((e=>{e.forEach((e=>{e.reject(new Vi(Fi.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.Ec.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await nu(n,e.er)}}function ru(e,t){const n=Ui(e),i=n.yc.get(t);if(i&&i.fc)return ho().add(i.key);{let e=ho();const i=n._c.get(t);if(!i)return e;for(const t of i){const i=n.wc.get(t);e=e.unionWith(i.view.nc)}return e}}function su(e){const t=Ui(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=qc.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=ru.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Wc.bind(null,t),t.dc.nu=Nc.bind(null,t.eventManager),t.dc.Pc=xc.bind(null,t.eventManager),t}function ou(e){const t=Ui(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Hc.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Kc.bind(null,t),t}class au{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=Vl(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return _l(this.persistence,new yl,e.initialUser,this.serializer)}createPersistence(e){return new fl(gl.zs,this.serializer)}createSharedClientState(e){return new Al}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class lu{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Gc(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=iu.bind(null,this.syncEngine),await bc(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Rc}createDatastore(e){const t=Vl(e.databaseInfo.databaseId),n=(i=e.databaseInfo,new Ul(i));var i;return function(e,t,n,i){return new Gl(e,t,n,i)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,i=e.asyncQueue,r=e=>Gc(this.syncEngine,e,0),s=xl.D()?new xl:new Nl,new Hl(t,n,i,r,s);var t,n,i,r,s}createSyncEngine(e,t){return function(e,t,n,i,r,s,o){const a=new Vc(e,t,n,i,r,s);return o&&(a.vc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=Ui(e);xi("RemoteStore","RemoteStore shutting down."),t.vu.add(5),await Jl(t),t.Pu.shutdown(),t.bu.set("Unknown")}(this.remoteStore)}}class cu{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Sc(this.observer.next,e)}error(e){this.observer.error?this.Sc(this.observer.error,e):Di("Uncaught Error in snapshot listener:",e.toString())}Dc(){this.muted=!0}Sc(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class uu{constructor(e,t,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=Ri.UNAUTHENTICATED,this.clientId=Yi.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{xi("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(xi("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Vi(Fi.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Bi;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Tc(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function du(e,t){e.asyncQueue.verifyOperationInProgress(),xi("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let i=n.initialUser;e.setCredentialChangeListener((async e=>{i.isEqual(e)||(await wl(t.localStore,e),i=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function hu(e,t){e.asyncQueue.verifyOperationInProgress();const n=await fu(e);xi("FirestoreClient","Initializing OnlineComponentProvider");const i=await e.getConfiguration();await t.initialize(n,i),e.setCredentialChangeListener((e=>yc(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>yc(t.remoteStore,n))),e._onlineComponents=t}function pu(e){return"FirebaseError"===e.name?e.code===Fi.FAILED_PRECONDITION||e.code===Fi.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function fu(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){xi("FirestoreClient","Using user provided OfflineComponentProvider");try{await du(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!pu(n))throw n;Oi("Error using user provided cache. Falling back to memory cache: "+n),await du(e,new au)}}else xi("FirestoreClient","Using default OfflineComponentProvider"),await du(e,new au);return e._offlineComponents}async function mu(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(xi("FirestoreClient","Using user provided OnlineComponentProvider"),await hu(e,e._uninitializedComponentsProvider._online)):(xi("FirestoreClient","Using default OnlineComponentProvider"),await hu(e,new lu))),e._onlineComponents}function gu(e){return mu(e).then((e=>e.syncEngine))}async function vu(e){const t=await mu(e),n=t.eventManager;return n.onListen=Bc.bind(null,t.syncEngine),n.onUnlisten=$c.bind(null,t.syncEngine),n}function yu(e,t,n={}){const i=new Bi;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,i,r){const s=new cu({next:s=>{t.enqueueAndForget((()=>Ac(e,o)));const a=s.docs.has(n);!a&&s.fromCache?r.reject(new Vi(Fi.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&i&&"server"===i.source?r.reject(new Vi(Fi.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(s)},error:e=>r.reject(e)}),o=new Oc(Us(n.path),s,{includeMetadataChanges:!0,Ku:!0});return Pc(e,o)}(await vu(e),e.asyncQueue,t,n,i))),i.promise}function bu(e,t,n={}){const i=new Bi;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,i,r){const s=new cu({next:n=>{t.enqueueAndForget((()=>Ac(e,o))),n.fromCache&&"server"===i.source?r.reject(new Vi(Fi.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(n)},error:e=>r.reject(e)}),o=new Oc(n,s,{includeMetadataChanges:!0,Ku:!0});return Pc(e,o)}(await vu(e),e.asyncQueue,t,n,i))),i.promise}function _u(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const wu=new Map;function Su(e,t,n){if(!n)throw new Vi(Fi.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Tu(e){if(!or.isDocumentKey(e))throw new Vi(Fi.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Eu(e){if(or.isDocumentKey(e))throw new Vi(Fi.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function ku(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Mi()}function Cu(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Vi(Fi.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=ku(e);throw new Vi(Fi.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class Iu{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new Vi(Fi.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.cache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Vi(Fi.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,i){if(!0===t&&!0===i)throw new Vi(Fi.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=_u(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new Vi(Fi.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new Vi(Fi.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new Vi(Fi.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,n}}class Ru{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Iu({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Vi(Fi.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Vi(Fi.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Iu(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new $i;switch(e.type){case"firstParty":return new Hi(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new Vi(Fi.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=wu.get(e);t&&(xi("ComponentProvider","Removing Datastore"),wu.delete(e),t.terminate())}(this),Promise.resolve()}}class Pu{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Nu(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Pu(this.firestore,e,this._key)}}class Au{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Au(this.firestore,e,this._query)}}class Nu extends Au{constructor(e,t,n){super(e,t,Us(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Pu(this.firestore,null,new or(e))}withConverter(e){return new Nu(this.firestore,e,this._path)}}function xu(e,t,...n){if(e=(0,a.m9)(e),Su("collection","path",t),e instanceof Ru){const i=ir.fromString(t,...n);return Eu(i),new Nu(e,null,i)}{if(!(e instanceof Pu||e instanceof Nu))throw new Vi(Fi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=e._path.child(ir.fromString(t,...n));return Eu(i),new Nu(e.firestore,null,i)}}function Du(e,t,...n){if(e=(0,a.m9)(e),1===arguments.length&&(t=Yi.A()),Su("doc","path",t),e instanceof Ru){const i=ir.fromString(t,...n);return Tu(i),new Pu(e,null,new or(i))}{if(!(e instanceof Pu||e instanceof Nu))throw new Vi(Fi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=e._path.child(ir.fromString(t,...n));return Tu(i),new Pu(e.firestore,e instanceof Nu?e.converter:null,new or(i))}}class Ou{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new Bl(this,"async_queue_retry"),this.Xc=()=>{const e=Fl();e&&xi("AsyncQueue","Visibility state changed to "+e.visibilityState),this.qo.Mo()};const e=Fl();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Zc(),this.ta(e)}enterRestrictedMode(e){if(!this.jc){this.jc=!0,this.Jc=e||!1;const t=Fl();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Xc)}}enqueue(e){if(this.Zc(),this.jc)return new Promise((()=>{}));const t=new Bi;return this.ta((()=>this.jc&&this.Jc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Qc.push(e),this.ea())))}async ea(){if(0!==this.Qc.length){try{await this.Qc[0](),this.Qc.shift(),this.qo.reset()}catch(e){if(!gr(e))throw e;xi("AsyncQueue","Operation failed with retryable error: "+e)}this.Qc.length>0&&this.qo.No((()=>this.ea()))}}ta(e){const t=this.Gc.then((()=>(this.Hc=!0,e().catch((e=>{this.Wc=e,this.Hc=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Di("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.Hc=!1,e))))));return this.Gc=t,t}enqueueAfterDelay(e,t,n){this.Zc(),this.Yc.indexOf(e)>-1&&(t=0);const i=Sc.createAndSchedule(this,e,t,n,(e=>this.na(e)));return this.zc.push(i),i}Zc(){this.Wc&&Mi()}verifyOperationInProgress(){}async sa(){let e;do{e=this.Gc,await e}while(e!==this.Gc)}ia(e){for(const t of this.zc)if(t.timerId===e)return!0;return!1}ra(e){return this.sa().then((()=>{this.zc.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.zc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.sa()}))}oa(e){this.Yc.push(e)}na(e){const t=this.zc.indexOf(e);this.zc.splice(t,1)}}class Lu extends Ru{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new Ou,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Uu(this),this._firestoreClient.terminate()}}function Mu(e,t){const n="object"==typeof e?e:(0,r.Mq)(),i="string"==typeof e?e:t||"(default)",s=(0,r.qX)(n,"firestore").getImmediate({identifier:i});if(!s._initialized){const e=(0,a.P0)("firestore");e&&function(e,t,n,i={}){var r;const s=(e=Cu(e,Ru))._getSettings(),o=`${t}:${n}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&Oi("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),i.mockUserToken){let t,n;if("string"==typeof i.mockUserToken)t=i.mockUserToken,n=Ri.MOCK_USER;else{t=(0,a.Sg)(i.mockUserToken,null===(r=e._app)||void 0===r?void 0:r.options.projectId);const s=i.mockUserToken.sub||i.mockUserToken.user_id;if(!s)throw new Vi(Fi.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Ri(s)}e._authCredentials=new qi(new zi(t,n))}}(s,...e)}return s}function ju(e){return e._firestoreClient||Uu(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Uu(e){var t,n,i;const r=e._freezeSettings(),s=function(e,t,n,i){return new zr(e,t,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,_u(i.experimentalLongPollingOptions),i.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,r);e._firestoreClient=new uu(e._authCredentials,e._appCheckCredentials,e._queue,s),(null===(n=r.cache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(i=r.cache)||void 0===i?void 0:i._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:r.cache.kind,_offline:r.cache._offlineComponentProvider,_online:r.cache._onlineComponentProvider})}class Fu{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Fu(Or.fromBase64String(e))}catch(e){throw new Vi(Fi.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Fu(Or.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Vu{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Vi(Fi.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new sr(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function Bu(){return new Vu("__name__")}class zu{constructor(e){this._methodName=e}}class $u{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Vi(Fi.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Vi(Fi.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Zi(this._lat,e._lat)||Zi(this._long,e._long)}}const qu=/^__.*__$/;class Gu{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Bo(e,this.data,this.fieldMask,t,this.fieldTransforms):new Vo(e,this.data,t,this.fieldTransforms)}}class Wu{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Bo(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Hu(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Mi()}}class Ku{constructor(e,t,n,i,r,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===r&&this.ua(),this.fieldTransforms=r||[],this.fieldMask=s||[]}get path(){return this.settings.path}get ca(){return this.settings.ca}aa(e){return new Ku(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ha(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.aa({path:n,la:!1});return i.fa(e),i}da(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.aa({path:n,la:!1});return i.ua(),i}wa(e){return this.aa({path:void 0,la:!0})}_a(e){return dd(e,this.settings.methodName,this.settings.ma||!1,this.path,this.settings.ga)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}ua(){if(this.path)for(let e=0;e<this.path.length;e++)this.fa(this.path.get(e))}fa(e){if(0===e.length)throw this._a("Document fields must not be empty");if(Hu(this.ca)&&qu.test(e))throw this._a('Document fields cannot begin and end with "__"')}}class Ju{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Vl(e)}ya(e,t,n,i=!1){return new Ku({ca:e,methodName:t,ga:n,path:sr.emptyPath(),la:!1,ma:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Qu(e){const t=e._freezeSettings(),n=Vl(e._databaseId);return new Ju(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Yu(e,t,n,i,r,s={}){const o=e.ya(s.merge||s.mergeFields?2:0,t,n,r);ad("Data must be an object, but it was:",o,i);const a=sd(i,o);let l,c;if(s.merge)l=new xr(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const i of s.mergeFields){const r=ld(t,i,n);if(!o.contains(r))throw new Vi(Fi.INVALID_ARGUMENT,`Field '${r}' is specified in your field mask but missing from your input data.`);hd(e,r)||e.push(r)}l=new xr(e),c=o.fieldTransforms.filter((e=>l.covers(e.field)))}else l=null,c=o.fieldTransforms;return new Gu(new os(a),l,c)}class Zu extends zu{_toFieldTransform(e){if(2!==e.ca)throw 1===e.ca?e._a(`${this._methodName}() can only appear at the top level of your update data`):e._a(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Zu}}function Xu(e,t,n){return new Ku({ca:3,ga:t.settings.ga,methodName:e._methodName,la:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class ed extends zu{constructor(e,t){super(e),this.pa=t}_toFieldTransform(e){const t=Xu(this,e,!0),n=this.pa.map((e=>rd(e,t))),i=new To(n);return new Ao(e.path,i)}isEqual(e){return this===e}}function td(e,t,n,i){const r=e.ya(1,t,n);ad("Data must be an object, but it was:",r,i);const s=[],o=os.empty();kr(i,((e,i)=>{const l=ud(t,e,n);i=(0,a.m9)(i);const c=r.da(l);if(i instanceof Zu)s.push(l);else{const e=rd(i,c);null!=e&&(s.push(l),o.set(l,e))}}));const l=new xr(s);return new Wu(o,l,r.fieldTransforms)}function nd(e,t,n,i,r,s){const o=e.ya(1,t,n),l=[ld(t,i,n)],c=[r];if(s.length%2!=0)throw new Vi(Fi.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)l.push(ld(t,s[e])),c.push(s[e+1]);const u=[],d=os.empty();for(let e=l.length-1;e>=0;--e)if(!hd(u,l[e])){const t=l[e];let n=c[e];n=(0,a.m9)(n);const i=o.da(t);if(n instanceof Zu)u.push(t);else{const e=rd(n,i);null!=e&&(u.push(t),d.set(t,e))}}const h=new xr(u);return new Wu(d,h,o.fieldTransforms)}function id(e,t,n,i=!1){return rd(n,e.ya(i?4:3,t))}function rd(e,t){if(od(e=(0,a.m9)(e)))return ad("Unsupported field value:",t,e),sd(e,t);if(e instanceof zu)return function(e,t){if(!Hu(t.ca))throw t._a(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t._a(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.la&&4!==t.ca)throw t._a("Nested arrays are not supported");return function(e,t){const n=[];let i=0;for(const r of e){let e=rd(r,t.wa(i));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),i++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=(0,a.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return vo(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=er.fromDate(e);return{timestampValue:Ta(t.serializer,n)}}if(e instanceof er){const n=new er(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Ta(t.serializer,n)}}if(e instanceof $u)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Fu)return{bytesValue:Ea(t.serializer,e._byteString)};if(e instanceof Pu){const n=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(n))throw t._a(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Ia(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t._a(`Unsupported field value: ${ku(e)}`)}(e,t)}function sd(e,t){const n={};return Cr(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):kr(e,((e,i)=>{const r=rd(i,t.ha(e));null!=r&&(n[e]=r)})),{mapValue:{fields:n}}}function od(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof er||e instanceof $u||e instanceof Fu||e instanceof Pu||e instanceof zu)}function ad(e,t,n){if(!od(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const i=ku(n);throw"an object"===i?t._a(e+" a custom object"):t._a(e+" "+i)}}function ld(e,t,n){if((t=(0,a.m9)(t))instanceof Vu)return t._internalPath;if("string"==typeof t)return ud(e,t);throw dd("Field path arguments must be of type string or ",e,!1,void 0,n)}const cd=new RegExp("[~\\*/\\[\\]]");function ud(e,t,n){if(t.search(cd)>=0)throw dd(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Vu(...t.split("."))._internalPath}catch(i){throw dd(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function dd(e,t,n,i,r){const s=i&&!i.isEmpty(),o=void 0!==r;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${i}`),o&&(l+=` in document ${r}`),l+=")"),new Vi(Fi.INVALID_ARGUMENT,a+e+l)}function hd(e,t){return e.some((e=>e.isEqual(t)))}class pd{constructor(e,t,n,i,r){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new Pu(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new fd(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(md("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class fd extends pd{data(){return super.data()}}function md(e,t){return"string"==typeof t?ud(e,t):t instanceof Vu?t._internalPath:t._delegate._internalPath}function gd(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new Vi(Fi.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class vd{}class yd extends vd{}function bd(e,t,...n){let i=[];t instanceof vd&&i.push(t),i=i.concat(n),function(e){const t=e.filter((e=>e instanceof Sd)).length,n=e.filter((e=>e instanceof _d)).length;if(t>1||t>0&&n>0)throw new Vi(Fi.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(const t of i)e=t._apply(e);return e}class _d extends yd{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new _d(e,t,n)}_apply(e){const t=this._parse(e);return kd(e._query,t),new Au(e.firestore,e.converter,Gs(e._query,t))}_parse(e){const t=Qu(e.firestore),n=function(e,t,n,i,r,s,o){let a;if(r.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new Vi(Fi.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){Ed(o,s);const t=[];for(const n of o)t.push(Td(i,e,n));a={arrayValue:{values:t}}}else a=Td(i,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||Ed(o,s),a=id(n,"where",o,"in"===s||"not-in"===s);return ms.create(r,s,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function wd(e,t,n){const i=t,r=md("where",e);return _d._create(r,i,n)}class Sd extends vd{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Sd(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:gs.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const i=t.getFlattenedFilters();for(const e of i)kd(n,e),n=Gs(n,e)}(e._query,t),new Au(e.firestore,e.converter,Gs(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function Td(e,t,n){if("string"==typeof(n=(0,a.m9)(n))){if(""===n)throw new Vi(Fi.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!zs(t)&&-1!==n.indexOf("/"))throw new Vi(Fi.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const i=t.path.child(ir.fromString(n));if(!or.isDocumentKey(i))throw new Vi(Fi.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return Zr(e,new or(i))}if(n instanceof Pu)return Zr(e,n._key);throw new Vi(Fi.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ku(n)}.`)}function Ed(e,t){if(!Array.isArray(e)||0===e.length)throw new Vi(Fi.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function kd(e,t){if(t.isInequality()){const n=Bs(e),i=t.field;if(null!==n&&!n.isEqual(i))throw new Vi(Fi.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${i.toString()}'`);const r=Vs(e);null!==r&&Cd(e,i,r)}const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new Vi(Fi.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new Vi(Fi.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function Cd(e,t,n){if(!n.isEqual(t))throw new Vi(Fi.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class Id{convertValue(e,t="none"){switch(Gr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return jr(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ur(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Mi()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return kr(e,((e,i)=>{n[e]=this.convertValue(i,t)})),n}convertGeoPoint(e){return new $u(jr(e.latitude),jr(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Vr(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Br(e));default:return null}}convertTimestamp(e){const t=Mr(e);return new er(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ir.fromString(e);ji(Ka(n));const i=new $r(n.get(1),n.get(3)),r=new or(n.popFirst(5));return i.isEqual(t)||Di(`Document ${r} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}function Rd(e,t,n){let i;return i=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,i}class Pd{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Ad extends pd{constructor(e,t,n,i,r,s){super(e,t,n,i,s),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Nd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(md("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Nd extends Ad{data(e={}){return super.data(e)}}class xd{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Pd(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new Nd(this._firestore,this._userDataWriter,n.key,n,new Pd(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Vi(Fi.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const i=new Nd(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Pd(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const i=new Nd(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Pd(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let r=-1,s=-1;return 0!==t.type&&(r=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:Dd(t.type),doc:i,oldIndex:r,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Dd(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Mi()}}function Od(e){e=Cu(e,Pu);const t=Cu(e.firestore,Lu);return yu(ju(t),e._key).then((n=>Vd(t,e,n)))}class Ld extends Id{constructor(e){super(),this.firestore=e}convertBytes(e){return new Fu(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Pu(this.firestore,null,t)}}function Md(e){e=Cu(e,Au);const t=Cu(e.firestore,Lu),n=ju(t),i=new Ld(t);return gd(e._query),bu(n,e._query).then((n=>new xd(t,i,e,n)))}function jd(e,t,n){e=Cu(e,Pu);const i=Cu(e.firestore,Lu),r=Rd(e.converter,t,n);return Fd(i,[Yu(Qu(i),"setDoc",e._key,r,null!==e.converter,n).toMutation(e._key,xo.none())])}function Ud(e,t,n,...i){e=Cu(e,Pu);const r=Cu(e.firestore,Lu),s=Qu(r);let o;return o="string"==typeof(t=(0,a.m9)(t))||t instanceof Vu?nd(s,"updateDoc",e._key,t,n,i):td(s,"updateDoc",e._key,t),Fd(r,[o.toMutation(e._key,xo.exists(!0))])}function Fd(e,t){return function(e,t){const n=new Bi;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const i=ou(e);try{const e=await function(e,t){const n=Ui(e),i=er.now(),r=t.reduce(((e,t)=>e.add(t.key)),ho());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=no(),l=ho();return n.Zi.getEntries(e,r).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(l=l.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((r=>{s=r;const o=[];for(const e of t){const t=Uo(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new Bo(e.key,t,as(t.value.mapValue),xo.exists(!0)))}return n.mutationQueue.addMutationBatch(e,i,o,t)})).next((t=>{o=t;const i=t.applyToLocalDocumentSet(s,l);return n.documentOverlayCache.saveOverlays(e,t.batchId,i)}))})).then((()=>({batchId:o.batchId,changes:so(s)})))}(i.localStore,t);i.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let i=e.Tc[e.currentUser.toKey()];i||(i=new Ir(Zi)),i=i.insert(t,n),e.Tc[e.currentUser.toKey()]=i}(i,e.batchId,n),await nu(i,e.changes),await cc(i.remoteStore)}catch(e){const t=Tc(e,"Failed to persist write");n.reject(t)}}(await gu(e),t,n))),n.promise}(ju(e),t)}function Vd(e,t,n){const i=n.docs.get(t._key),r=new Ld(e);return new Ad(e,r,t._key,i,new Pd(n.hasPendingWrites,n.fromCache),t.converter)}function Bd(...e){return new ed("arrayUnion",e)}!function(e,t=!0){!function(e){Pi=e}(r.Jn),(0,r.Xd)(new s.wA("firestore",((e,{instanceIdentifier:n,options:i})=>{const r=e.getProvider("app").getImmediate(),s=new Lu(new Gi(e.getProvider("auth-internal")),new Ji(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Vi(Fi.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new $r(e.options.projectId,t)}(r,n),r);return i=Object.assign({useFetchStreams:t},i),s._setSettings(i),s}),"PUBLIC").setMultipleInstances(!0)),(0,r.KN)(Ii,"3.12.2",e),(0,r.KN)(Ii,"3.12.2","esm2017")}()},270:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>c});const i=e=>{let t;const n=new Set,i=(e,i)=>{const r="function"==typeof e?e(t):e;if(!Object.is(r,t)){const e=t;t=(null!=i?i:"object"!=typeof r)?r:Object.assign({},t,r),n.forEach((n=>n(t,e)))}},r=()=>t,s={setState:i,getState:r,subscribe:e=>(n.add(e),()=>n.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}};return t=e(i,r,s),s},r=e=>e?i(e):i;var s=n(7294),o=n(2798);const{useSyncExternalStoreWithSelector:a}=o;const l=e=>{"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t="function"==typeof e?r(e):e,n=(e,n)=>function(e,t=e.getState,n){const i=a(e.subscribe,e.getState,e.getServerState||e.getState,t,n);return(0,s.useDebugValue)(i),i}(t,e,n);return Object.assign(n,t),n};var c=e=>(console.warn("[DEPRECATED] Default export is deprecated. Instead use `import { create } from 'zustand'`."),(e=>e?l(e):l)(e))},782:(e,t,n)=>{"use strict";n.d(t,{mW:()=>s,tJ:()=>c});const i=new Map,r=e=>{const t=i.get(e);return t?Object.fromEntries(Object.entries(t.stores).map((([e,t])=>[e,t.getState()]))):{}},s=(e,t={})=>(n,s,a)=>{const{enabled:l,anonymousActionType:c,store:u,...d}=t;let h;try{h=(null==l||l)&&window.__REDUX_DEVTOOLS_EXTENSION__}catch(e){}if(!h)return l&&console.warn("[zustand devtools middleware] Please install/enable Redux devtools extension"),e(n,s,a);const{connection:p,...f}=((e,t,n)=>{if(void 0===e)return{type:"untracked",connection:t.connect(n)};const r=i.get(n.name);if(r)return{type:"tracked",store:e,...r};const s={connection:t.connect(n),stores:{}};return i.set(n.name,s),{type:"tracked",store:e,...s}})(u,h,d);let m=!0;a.setState=(e,t,i)=>{const o=n(e,t);if(!m)return o;const l=void 0===i?{type:c||"anonymous"}:"string"==typeof i?{type:i}:i;return void 0===u?(null==p||p.send(l,s()),o):(null==p||p.send({...l,type:`${u}/${l.type}`},{...r(d.name),[u]:a.getState()}),o)};const g=(...e)=>{const t=m;m=!1,n(...e),m=t},v=e(a.setState,s,a);if("untracked"===f.type?null==p||p.init(v):(f.stores[f.store]=a,null==p||p.init(Object.fromEntries(Object.entries(f.stores).map((([e,t])=>[e,e===f.store?v:t.getState()]))))),a.dispatchFromDevtools&&"function"==typeof a.dispatch){let e=!1;const t=a.dispatch;a.dispatch=(...n)=>{"__setState"!==n[0].type||e||(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),e=!0),t(...n)}}return p.subscribe((e=>{var t;switch(e.type){case"ACTION":return"string"!=typeof e.payload?void console.error("[zustand devtools middleware] Unsupported action format"):o(e.payload,(e=>{if("__setState"!==e.type)a.dispatchFromDevtools&&"function"==typeof a.dispatch&&a.dispatch(e);else{if(void 0===u)return void g(e.state);1!==Object.keys(e.state).length&&console.error('\n                    [zustand devtools middleware] Unsupported __setState action format. \n                    When using \'store\' option in devtools(), the \'state\' should have only one key, which is a value of \'store\' that was passed in devtools(),\n                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }\n                    ');const t=e.state[u];if(null==t)return;JSON.stringify(a.getState())!==JSON.stringify(t)&&g(t)}}));case"DISPATCH":switch(e.payload.type){case"RESET":return g(v),void 0===u?null==p?void 0:p.init(a.getState()):null==p?void 0:p.init(r(d.name));case"COMMIT":return void 0===u?void(null==p||p.init(a.getState())):null==p?void 0:p.init(r(d.name));case"ROLLBACK":return o(e.state,(e=>{if(void 0===u)return g(e),void(null==p||p.init(a.getState()));g(e[u]),null==p||p.init(r(d.name))}));case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return o(e.state,(e=>{void 0!==u?JSON.stringify(a.getState())!==JSON.stringify(e[u])&&g(e[u]):g(e)}));case"IMPORT_STATE":{const{nextLiftedState:n}=e.payload,i=null==(t=n.computedStates.slice(-1)[0])?void 0:t.state;if(!i)return;return g(void 0===u?i:i[u]),void(null==p||p.send(null,n))}case"PAUSE_RECORDING":return m=!m}return}})),v},o=(e,t)=>{let n;try{n=JSON.parse(e)}catch(e){console.error("[zustand devtools middleware] Could not parse the received json",e)}void 0!==n&&t(n)};function a(e,t){let n;try{n=e()}catch(e){return}return{getItem:e=>{var i;const r=e=>null===e?null:JSON.parse(e,null==t?void 0:t.reviver),s=null!=(i=n.getItem(e))?i:null;return s instanceof Promise?s.then(r):r(s)},setItem:(e,i)=>n.setItem(e,JSON.stringify(i,null==t?void 0:t.replacer)),removeItem:e=>n.removeItem(e)}}const l=e=>t=>{try{const n=e(t);return n instanceof Promise?n:{then:e=>l(e)(n),catch(e){return this}}}catch(e){return{then(e){return this},catch:t=>l(t)(e)}}},c=(e,t)=>"getStorage"in t||"serialize"in t||"deserialize"in t?(console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),((e,t)=>(n,i,r)=>{let s={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},o=!1;const a=new Set,c=new Set;let u;try{u=s.getStorage()}catch(e){}if(!u)return e(((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${s.name}', the given storage is currently unavailable.`),n(...e)}),i,r);const d=l(s.serialize),h=()=>{const e=s.partialize({...i()});let t;const n=d({state:e,version:s.version}).then((e=>u.setItem(s.name,e))).catch((e=>{t=e}));if(t)throw t;return n},p=r.setState;r.setState=(e,t)=>{p(e,t),h()};const f=e(((...e)=>{n(...e),h()}),i,r);let m;const g=()=>{var e;if(!u)return;o=!1,a.forEach((e=>e(i())));const t=(null==(e=s.onRehydrateStorage)?void 0:e.call(s,i()))||void 0;return l(u.getItem.bind(u))(s.name).then((e=>{if(e)return s.deserialize(e)})).then((e=>{if(e){if("number"!=typeof e.version||e.version===s.version)return e.state;if(s.migrate)return s.migrate(e.state,e.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}})).then((e=>{var t;return m=s.merge(e,null!=(t=i())?t:f),n(m,!0),h()})).then((()=>{null==t||t(m,void 0),o=!0,c.forEach((e=>e(m)))})).catch((e=>{null==t||t(void 0,e)}))};return r.persist={setOptions:e=>{s={...s,...e},e.getStorage&&(u=e.getStorage())},clearStorage:()=>{null==u||u.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>g(),hasHydrated:()=>o,onHydrate:e=>(a.add(e),()=>{a.delete(e)}),onFinishHydration:e=>(c.add(e),()=>{c.delete(e)})},g(),m||f})(e,t)):((e,t)=>(n,i,r)=>{let s={storage:a((()=>localStorage)),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},o=!1;const c=new Set,u=new Set;let d=s.storage;if(!d)return e(((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${s.name}', the given storage is currently unavailable.`),n(...e)}),i,r);const h=()=>{const e=s.partialize({...i()});return d.setItem(s.name,{state:e,version:s.version})},p=r.setState;r.setState=(e,t)=>{p(e,t),h()};const f=e(((...e)=>{n(...e),h()}),i,r);let m;const g=()=>{var e,t;if(!d)return;o=!1,c.forEach((e=>{var t;return e(null!=(t=i())?t:f)}));const r=(null==(t=s.onRehydrateStorage)?void 0:t.call(s,null!=(e=i())?e:f))||void 0;return l(d.getItem.bind(d))(s.name).then((e=>{if(e){if("number"!=typeof e.version||e.version===s.version)return e.state;if(s.migrate)return s.migrate(e.state,e.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}})).then((e=>{var t;return m=s.merge(e,null!=(t=i())?t:f),n(m,!0),h()})).then((()=>{null==r||r(m,void 0),m=i(),o=!0,u.forEach((e=>e(m)))})).catch((e=>{null==r||r(void 0,e)}))};return r.persist={setOptions:e=>{s={...s,...e},e.storage&&(d=e.storage)},clearStorage:()=>{null==d||d.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>g(),hasHydrated:()=>o,onHydrate:e=>(c.add(e),()=>{c.delete(e)}),onFinishHydration:e=>(u.add(e),()=>{u.delete(e)})},s.skipHydration||g(),m||f})(e,t)},7437:e=>{"use strict";e.exports={i8:"0.4.4"}}},i={};function r(e){var t=i[e];if(void 0!==t)return t.exports;var s=i[e]={exports:{}};return n[e].call(s.exports,s,s.exports,r),s.exports}r.amdO={},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,r.t=function(n,i){if(1&i&&(n=this(n)),8&i)return n;if("object"==typeof n&&n){if(4&i&&n.__esModule)return n;if(16&i&&"function"==typeof n.then)return n}var s=Object.create(null);r.r(s);var o={};e=e||[null,t({}),t([]),t(t)];for(var a=2&i&&n;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>o[e]=()=>n[e]));return o.default=()=>n,r.d(s,o),s},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="./",r.nc=void 0;var s={};return(()=>{"use strict";r.r(s);var e=r(5893),t=r(745),n=r(5783),i=r(725),o=r(143),a=r(7943),l=r(1142),c=r(2485);class u{constructor(e,t){this.user=null,this.teams=[],this.user=e,this.teams=t}update(e){let t=(0,c.Gg)(e)?(0,c.$W)(e):a.EO.offline;this.teams.forEach((e=>{this._updateRDB(e,this.user.uid,t)}))}_updateRDB(e,t,n){const i=(0,o.Ip)(e,t);(0,l.Wo)(i,n).catch(this.handleError)}handleError(e){console.error("Team presence failed to update",e)}}var d=r(8679);(0,d.N8)();var h=r(2549);class p{constructor(e,t){this.presence=a.EO.offline,this.status="",this.expiry=0,this.presenceListener=null,this.teamPresence=null,this.connectionListener=null,this.initialized=!1,this.user=e,this.onChange=t,this.teams=null,this.init()}async init(){await this.initTeamPresence();const e=await this.checkCurrent().catch((e=>{}));if(e){const t=(0,c.$W)(e),n=void 0===e.status?"":e.status,i=void 0===e.expiry?0:e.expiry;await this.changePresence(t,true),this.set({presence:t,status:n,expiry:i}),this.afterChange()}else await this.changePresence(a.EO.online,true),this.afterChange();this.listen(),this.listenForDisconnects(),this.newUserConnected(),setTimeout((()=>{this.initialized=!0}),2e3)}async initTeamPresence(){const e=await(0,h.YR)(this.user.uid,this.user.companies);return e&&(this.teams=e.map((e=>e.uid)),this.teamPresence=new u(this.user,this.teams)),Promise.resolve()}listenForDisconnects(){this.connectionListener&&this.connectionListener(),this.connectionListener=function(e){const t=(0,d.N8)(),n=(0,d.iH)(t,".info/connected");return(0,d.jM)(n,(t=>{!0===t.val()?e(!0):e(!1)}))}((e=>{e?this.initialized&&this.changePresence(a.EO.offline):this.onReconnection()}))}async checkCurrent(){const e=(0,o.hB)(this.user.uid);return(0,l.Tr)(e)}async onReconnection(){const e=(0,o.hB)(this.user.uid);(0,l.Tr)(e).then((e=>{e&&!(0,c.Gg)(e)&&this.changePresence(a.EO.online)})).catch((e=>{}))}destroy(){this.stopPresenceListener(),this.connectionListener&&this.connectionListener()}stopPresenceListener(){return null!==this.presenceListener&&(this.presenceListener(),!0)}stopConnectionListener(){null!==this.connectionListener&&this.connectionListener()}listen(){this.stopPresenceListener();this.presenceListener=(0,l.oL)((0,o.hB)(this.user.uid),(e=>{e&&this.initialized&&this.set(e)}))}async changePresence(e,t=!1){if(!this.isValidPresence(e))return void console.error("not a valida presence",e,a.EO);const n=(0,o.hB)(this.user.uid,"/presence");return await(0,l.Wo)(n,e).catch((e=>this.handleError("Error while updating presence",e))),this.set({presence:e}),t||this.afterChange(),!0}async changeStatus(e,t=0){const n=(0,c.$W)({presence:this.presence,status:e,expiry:t}),i=this.data(n,e,t),r=(0,o.hB)(this.user.uid);await(0,l.Wo)(r,i).catch((e=>this.handleError("Error while updating status",e))),await this.set({presence:n,status:e,expiry:t}),this.afterChange()}afterChange(e=this.data()){this.teamPresence&&this.teamPresence.update(e),this.onChange&&this.onChange(e)}handleError(e,t){console.error(t),alert(e)}isValidPresence(e){let t=!1;return Object.entries(a.EO).forEach((([n,i])=>{i==e&&(t=!0)})),t}async set(e){"presence"in e&&(this.presence=e.presence),"status"in e&&(this.status=e.status),"expiry"in e&&(this.expiry=parseInt(e.expiry))}data(e=this.presence,t=this.status,n=this.expiry){return{presence:e,status:t,expiry:n}}async newUserConnected(e=1){if(this.user.companies&&this.user.companies[0]){const t=(0,o.Si)(this.user.companies[0])+"/"+this.user.uid;await(0,l.Wo)(t,e)}}}var f=r(6806),m=r(9462);async function g(e,t){const n=[];return(await(0,h.YR)(e.uid,e.companies)).forEach((e=>{let i=function(e,t){const n=(0,o.zV)(e);return l.oL(n,(e=>{e?.state==f.n.live&&t(e)}))}(e.uid,t);i&&n.push(i)})),Promise.resolve(n)}var v=r(8709),y=r(8345),b=r(9994),_=r(8119),w=r(4290),S=r(4430),T=r(6540),E=r(8013),k=r(7294),C=r(1008),I=r(9250),R=r(5633),P=r(6267),A=r(8341),N=r(3995),x=r(7166);function D(){const t=(0,S.i)((e=>e.pendingRequest)),r=(0,S.i)(),{user:s}=(0,k.useContext)(v.St),a=(0,n._U)(i.ln),c=(0,I.s0)(),[u,d]=(0,k.useState)(!1);function h(e=!0,t=!1){e&&r.dispatch("pendingRequest",null),t&&r.dispatch("pendingRedirect",null),d(!1)}function p(){h(!0,!0),(0,C.n)(s.uid,t.person.uid,m.C.reject,!1)}function g(){h(!0,!0),setTimeout((()=>{(0,N.k)(f.q.rejected,s.uid,t.team.uid)}),333)}return(0,k.useEffect)((()=>{const e=t.person?function(){if(s?.uid&&t.person?.uid){const e=(0,o.aU)(s.uid,t.person.uid);return l.oL(e,(e=>{e?.guestState==m.C.left&&h(!0,!0)}))}return null}():t.team?l.oL((0,o.zV)(t.team.uid),(e=>{e?.state==f.n.ended&&h(!0,!0)})):null;return()=>{e&&e(),d(!1)}}),[]),t.person?(0,e.jsx)(E.Z,{classNames:"additional-call-request",onClose:p,title:`${(0,R.R)(t.person)} is calling you`,image:(0,A.a)(t.person),message:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{children:"Do you want to accept?"}),(0,e.jsx)("div",{children:"You will end your current call"})]}),children:u?(0,e.jsx)("img",{src:x.Z}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("button",{onClick:p,className:"outlined-light",children:"Decline"}),(0,e.jsx)("button",{onClick:async function(){const e=P.Z6.getIncomingRoute(t.room,t.person.uid);if(a)return d(!0),r.dispatch("pendingRedirect",e),void h();h(),setTimeout((()=>{c(e)}),100)},className:"green",children:"Accept"})]})}):t.team?(0,e.jsx)(E.Z,{classNames:"additional-call-request",onClose:g,title:`${t.team.name} is calling you`,message:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{children:"Do you want to accept?"}),(0,e.jsx)("div",{children:"You will end your current call"})]}),children:u?(0,e.jsx)("img",{src:x.Z}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("button",{onClick:g,className:"outlined-light",children:"Decline"}),(0,e.jsx)("button",{onClick:async function(){const e=P.Z6.getTeamCallRoute(t.room,t.team.uid,t.company);if(a)return d(!0),r.dispatch("pendingRedirect",e),void h();c(e),h(!0,!0)},className:"green",children:"Accept"})]})}):null}var O=r(8874),L=r(3647),M=r(5390),j=r(4224);const U=r.p+"aca2d04b23c4aa6c9393fc7f243f95a2.svg";var F=r(6008),V=r(8409),B=r(3531),z=r(9947);function $(t){const{user:n,presenceObj:i,onClick:r}=t,[s,o]=(0,k.useState)((0,c.ZT)(i));return(0,k.useEffect)((function(){o((0,c.ZT)(i))}),[i.presence,i.status,i.expiry]),(0,e.jsxs)("div",{className:"fav-contact-profile-image",onClick:r,children:[(0,e.jsx)(B.Z,{user:n}),(0,e.jsx)(z.Z,{classNames:"status-dot",currentState:s})]})}const q=function(t){const{user:n,createCall:i}=t,{presenceObj:r,stopListener:s}=(0,V.C)(n),o=(0,V.c)(r),a=(0,k.useContext)(v.St),{missedCall:l,stopMissedListener:c}=(0,M.NG)(a?.user?.uid,n.uid);return(0,k.useEffect)((function(){return()=>{s&&s(),c&&c()}}),[]),(0,e.jsx)(F.im,{className:o?"":"disabled-hovers",children:(0,e.jsxs)("div",{className:"fav-contact-div",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)($,{user:n,presenceObj:r,onClick:()=>{o&&i(n)}}),l&&(0,e.jsx)("div",{className:"live-meeting-icon",children:"1"})]}),(0,e.jsx)("div",{className:"fav-contact-name",children:n?.name})]})})};let G;function W(t){const{user:n}=(0,k.useContext)(v.St),{missedCounter:i,stopMissedCallsListener:r}=(0,M.yY)(n.uid),[s,o]=(0,k.useState)([]),a=(0,w.E)((e=>e.users)),l=(0,I.s0)();(0,k.useEffect)((()=>()=>{r&&r()}),[]),(0,k.useEffect)((()=>{n&&async function(){n.companies&&n.companies.length>0&&(G=setTimeout((()=>{!function(e=!1){(function(e=!1){if(a&&a.length&&!e)return Promise.resolve(a);{const e=[n.uid];return(0,L.E)(n.companies[0],e)}})(e).then((async e=>{const t=await(0,j.V)(n.uid);let i=[];t.numbersOfCalls.map((t=>{let n=e.find((e=>e.uid===t));n&&i.push(n)})),o(i)}))}()}),1e3))}()}),[n]);const c=e=>{var n;n=e.uid,t.toggleMinimize(),l(P.Z6.getOutgoingRoute(n))};return(0,e.jsxs)("div",{className:"minimzed-view",children:[(0,e.jsxs)("div",{className:"minimzed-view__left",children:[t?.children?t.children:(0,e.jsx)("img",{className:"photon-logo__small",src:O.Z}),s.length>0&&(0,e.jsx)(e.Fragment,{children:s.map((t=>(0,e.jsx)(q,{user:t,createCall:c},t.uid)))})]}),(0,e.jsxs)("div",{className:"minimzed-view__right",children:[(0,e.jsx)("button",{className:"clear-light",onClick:t.toggleMinimize,children:(0,e.jsx)("img",{src:U})}),i>0&&(0,e.jsx)("div",{className:"missed-icon",children:i})]})]})}var H=r(2460),K=r(9655),J=r(5814);function Q(){const{user:t}=(0,k.useContext)(v.St);return(0,e.jsx)("div",{className:"header-profile",children:(0,e.jsxs)(K.rU,{to:"/profile",className:"header-profile__link",children:[(0,e.jsx)(B.Z,{user:t}),(0,e.jsx)(J.Z,{classNames:"profile-status-dot"})]})})}function Y(t){const{user:n}=(0,k.useContext)(v.St);return(0,e.jsxs)("header",{className:"nav-header",children:[(0,e.jsx)(K.rU,{to:"/",children:(0,e.jsx)("img",{className:"photon-logo__small",alt:"Photon",src:O.Z})}),(0,e.jsx)("div",{className:"nav-header__right",children:n?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Q,{}),(0,e.jsx)(H.G,{toggleMinimize:t.toggleMinimize,theme:"dark"})]}):(0,e.jsx)("div",{className:"TODO-adjust-minimization-arrow",children:(0,e.jsx)(H.G,{toggleMinimize:t.toggleMinimize,theme:"dark"})})})]})}var Z=r(565),X=r(3844),ee=r(9063),te=r(8784),ne=r(5915),ie=r(2599);let re=!1,se="";const oe=[P._e,P.UC],ae=[...oe,P.Kd];function le(){const t=(0,I.s0)(),[r,s]=(0,k.useState)((0,_.XS)()),[c,u]=(0,k.useState)(null),[d,h]=(0,k.useState)(null),[E,C]=(0,k.useState)(0),R=(0,I.TH)(),[A,N]=(0,k.useState)(!1),[x,O]=(0,k.useState)(!1),L=(0,T.a)(),M=((0,T.a)((e=>e.data)),(0,w.E)((e=>e.clearAll))),[j,U]=(0,k.useState)(!1),F=(0,n._U)(i.ln),{pendingRedirect:V,pendingRequest:B}=(0,S.i)((e=>e)),z=(0,S.i)(),[$,q]=(0,k.useState)(!1),[G,H]=(0,k.useState)(null),[K,J]=(0,k.useState)(!0);function Q(){N(!A)}async function le(e){O(!0),console.log("reg social user",e),await(0,te.oe)(e);const n=P.Z6.getRegisterFinishRoute(e.uid);t(n)}function ce(){d?.changePresence(a.EO.offline)}function ue(e,t=null){null!==d&&d?.destroy();const n=new p(e,L.dispatch);h(n),(0,_.H5)(),t&&t()}function de(e){e&&e?.room?j||re?(A&&N(!1),(0,y.focusApp)(),pe({room:e.room,person:e.createdBy,company:e.company},!0)):(A&&N(!1),setTimeout((()=>{(0,y.focusApp)();const n=P.Z6.getIncomingRoute(e.room,e.createdBy);t(n)}),100)):console.error("failed room navigation?",e)}function he(e){if(e&&e?.room&&e?.team){if(e?.createdBy==c?.uid)return;if("live"==e.state){let n=!1;if(Object.keys(e.members).forEach((t=>{t==c?.uid&&e.members[t].state==f.q.invited&&(n=!0)})),n)if(A&&N(!1),(0,y.focusApp)(),j)pe({room:e.room,team:{uid:e.team,name:"",users:[]},company:e.company},!1);else{let n=P.Z6.getTeamCallRoute(e.room,e.team,e.company);t(n)}}}else console.error("Missing room or team",e)}async function pe(e,t){if(null===B||B.room!=e.room)if(t){let t=await(0,te.bG)(String(e.person));if(t){const n={person:t,room:e.room,company:e.company};z.dispatch("pendingRequest",n)}}else{let t=await(0,ee.I)(e.company,String(e.team));if(t){const n={team:t,room:e.room,company:e.company};z.dispatch("pendingRequest",n)}}}(0,ne.Z)((()=>{z.dispatch("reset"),M(),window.electron.ipcRenderer.on("before-app-close",ce)})),(0,k.useEffect)((function(){let e=Z.I.onAuthStateChanged((async e=>{if(e)H(e);else{O(!0),H(null);const e=(0,ie.fp)(P.ZP,R);e&&!0===e[0]?.route.protected&&!oe.includes(R.pathname)&&t((0,_.HB)())}}));return window.addEventListener("beforeunload",ce),()=>{e&&e(),d?.destroy&&d.destroy(),window.removeEventListener("beforeunload",ce)}}),[]),(0,k.useEffect)((function(){if(c&&c.uid&&x){const e=function(e,t){const n=(0,o.JZ)(e.uid);return l.iH(n,(e=>{e.guestState==m.C.invite&&t(e)}))}(c,de);let t=null;return g(c,he).then((e=>{t=e})),()=>{e&&e(),t&&t.forEach((e=>e()))}}}),[c?.uid,c?.teams,x]),(0,k.useEffect)((function(){if(se=R.pathname,!x)return;s((0,_.XS)()),(0,y.onElectronResize)(R.pathname);const e=(0,ie.fp)(P.ZP,R),t=!(!e||!0!==e[0]?.route.isCallRoute);U(t),re=t}),[R]),(0,k.useEffect)((function(){if(!x)return;const e="is-minimized";if(A)(0,b.Z)(280,55,!0),document.body.classList.add(e);else{const t=R.pathname.split("/");(0,y.onElectronResize)(`/${t[1]}`,!0,{maximizing:!0}),document.body.classList.remove(e)}}),[A]),(0,k.useEffect)((function(){x&&(0,y.onElectronResize)(R.pathname,!0)}),[x]),(0,k.useEffect)((()=>{let e=()=>{};return x&&c&&c.uid&&c.companies&&c.companies.length&&(e=function(e,t){const n=(0,o.Si)(e);return l.iH(n,(e=>{t(e)}))}(c.companies[0],(()=>{C(Date.now())}))),()=>{e&&e()}}),[c?.companies,x]),(0,k.useEffect)((()=>{null!=V&&F||null==V||F||setTimeout((()=>{t(V),setTimeout((()=>{z.dispatch("reset")}))}),500)}),[V,F]),(0,k.useEffect)((()=>{$&&G&&R.pathname!=P.wn?le(G):K&&!ae.includes(se)&&G&&async function(){if(ae.includes(R.pathname)||ae.includes(se))return;if(!G||!K)return;const e=await(0,te.oM)(G);J(!1),e?(!async function(e){const t=await(0,X._Z)(e);u(t),O(!0),ue(t)}(G),R.pathname!==P.ef&&t(P.ef)):le(G)}()}),[$,K,R,G]);const fe=c?P.ZP:P.ZP.filter((e=>!1===e.protected));return(0,e.jsx)("div",{id:"app",children:(0,e.jsx)(v.St.Provider,{value:{user:c,userInCall:j,setUser:u,usedBefore:r,onFinishRegistration:async function(e){const n=await(0,X._Z)({uid:e}).catch((e=>console.error(e)));n&&(q(!1),O(!0),u(n),ue(n,(()=>{setTimeout((()=>{t(P.ef)}),50)})))}},children:(0,e.jsx)(v.Qm.Provider,{value:{companyUpdated:E},children:(0,e.jsxs)(v.Oy.Provider,{value:d,children:[(0,e.jsx)(I.Z5,{children:fe.map(((t,n)=>(0,e.jsx)(I.AW,{index:t.path==P.ef,path:t.path,element:(0,e.jsxs)(e.Fragment,{children:[A?(0,e.jsx)(W,{toggleMinimize:Q}):!0===t?.nav?(0,e.jsx)(Y,{toggleMinimize:Q}):null,(0,e.jsx)(t.component,{toggleMinimize:Q})]})},t.path)))}),null!==B?(0,e.jsx)(D,{}):null]})})})})}!async function(){const i=document.getElementById("root");(0,t.s)(i).render((0,e.jsx)(e.Fragment,{children:(0,e.jsx)(n.dx,{children:(0,e.jsx)(I.VA,{children:(0,e.jsx)(le,{})})})})),function(){try{window.electron.ipcRenderer.once("ipc-example",(e=>{console.log(e)})),window.electron.ipcRenderer.sendMessage("ipc-example",["ping"])}catch(e){console.error("ignore if testing on browser",e)}}()}()})(),s})()));
//# sourceMappingURL=renderer.js.map